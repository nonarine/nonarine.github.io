{
  "version": 3,
  "sources": ["../src/utils/debug-logger.js", "../src/math/jacobian.js", "../src/math/coordinate-charts.js", "../src/math/coordinate-systems.js", "../src/utils/float-packing.js", "../src/webgl/textures.js", "../src/webgl/framebuffer.js", "../src/webgl/bloom.js", "../src/webgl/bilateral.js", "../src/math/parser.js", "../src/webgl/shaders.js", "../src/webgl/smaa.js", "../src/webgl/buffer-stats.js", "../src/webgl/velocity-stats.js", "../src/particles/system.js", "../src/math/integrators.js", "../src/math/mappers.js", "../src/math/transforms.js", "../src/math/colors.js", "../src/math/gradients.js", "../src/math/tonemapping.js", "../src/webgl/renderer.js", "../src/webgl/coordinate-strategy.js", "../src/webgl/strategies/rgba-strategy.js", "../src/webgl/strategies/float-strategy.js", "../src/ui/control-base.js", "../src/ui/accordion-utils.js", "../src/ui/animatable-slider.js", "../src/ui/animatable-timestep.js", "../src/ui/control-utilities.js", "../src/ui/parameter-control.js", "../src/ui/custom-controls.js", "../src/ui/gradient-editor.js", "../src/ui/coordinate-editor.js", "../src/math/inverse-solver.js", "../src/ui/controls-v2.js", "../src/main.js", "../src/animation/animator.js", "../src/ui/tabs/tab-base.js", "../src/ui/modal.js", "../src/ui/tabs/custom-functions-tab.js", "../src/ui/tabs/debug-tab.js", "../src/ui/tabs/docs-tab.js"],
  "sourcesContent": ["/**\n * Debug logging utility\n */\n\nclass DebugLogger {\n    constructor() {\n        this.enabled = true;\n        this.verbosity = 'info'; // verbose, debug, info, warn, error\n        this.maxLogs = 100; // Display buffer size\n        this.logs = [];\n        this.consoleHooked = false;\n        this.originalConsole = {};\n        this.outputElement = null; // Can be set to a specific element, defaults to $('#debug-output')\n\n        // Silent mode buffering\n        this.silenced = false;\n        this.silencedBuffer = [];\n        this.maxSilencedLogs = 5000; // Buffer more logs during silent mode\n    }\n\n    /**\n     * Set the output element for log display\n     */\n    setOutputElement(element) {\n        this.outputElement = element;\n    }\n\n    /**\n     * Set whether logging is enabled\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n\n    /**\n     * Set verbosity level\n     */\n    setVerbosity(level) {\n        const wasSilent = this.verbosity === 'silent';\n        this.verbosity = level;\n        const isSilent = level === 'silent';\n\n        // If transitioning from silent to non-silent, flush buffer\n        if (wasSilent && !isSilent) {\n            this.unsilence();\n        } else if (!wasSilent && isSilent) {\n            this.silence();\n        }\n    }\n\n    /**\n     * Enter silent mode (buffer logs instead of displaying)\n     */\n    silence() {\n        if (this.silenced) return;\n        this.silenced = true;\n        this.info('Entering silent mode - logs will be buffered', null, false); // Not silenceable\n    }\n\n    /**\n     * Exit silent mode and flush buffered logs\n     */\n    unsilence() {\n        if (!this.silenced) return;\n        const bufferSize = this.silencedBuffer.length;\n        this.silenced = false;\n        this.flush();\n        this.info(`Exited silent mode - flushed ${bufferSize} buffered logs`, null, false); // Not silenceable\n    }\n\n    /**\n     * Flush silenced buffer to main logs and UI\n     */\n    flush() {\n        if (this.silencedBuffer.length === 0) return;\n\n        const bufferSize = this.silencedBuffer.length;\n        this.info(`Flushing ${bufferSize} silenced logs...`, null, false); // Not silenceable\n\n        // Output all buffered logs to console\n        const consoleMethod = this.consoleHooked ? this.originalConsole.log : console.log;\n        for (const logEntry of this.silencedBuffer) {\n            const consoleMsg = `[${logEntry.timestamp}] ${logEntry.message}`;\n            if (logEntry.data) {\n                consoleMethod(consoleMsg, logEntry.data);\n            } else {\n                consoleMethod(consoleMsg);\n            }\n            if (logEntry.stack) {\n                consoleMethod('Stack trace:', logEntry.stack);\n            }\n        }\n\n        // Add ALL buffered logs to main logs\n        this.logs.push(...this.silencedBuffer);\n\n        // Then truncate to keep only the last maxLogs entries\n        if (this.logs.length > this.maxLogs) {\n            this.logs = this.logs.slice(-this.maxLogs);\n        }\n\n        // Clear buffer\n        this.silencedBuffer = [];\n\n        // Update UI with all logs\n        this.updateUI();\n    }\n\n    /**\n     * Clear silenced buffer without flushing\n     */\n    clearSilencedBuffer() {\n        const count = this.silencedBuffer.length;\n        this.silencedBuffer = [];\n        this.info(`Cleared ${count} buffered logs`, null, false); // Not silenceable\n    }\n\n    /**\n     * Check if a log level should be displayed\n     * Note: In silent mode, logs still pass this check but are buffered instead of displayed\n     */\n    shouldLog(level) {\n        if (!this.enabled) return false;\n\n        const levels = {\n            verbose: 0,\n            debug: 1,\n            info: 2,\n            warn: 3,\n            error: 4,\n            silent: 0  // Silent mode - accept all logs but buffer them\n        };\n\n        return levels[level] >= levels[this.verbosity];\n    }\n\n    /**\n     * Log a message\n     * @param {string} level - Log level (verbose, debug, info, warn, error)\n     * @param {string} message - Log message\n     * @param {*} data - Optional data to log\n     * @param {boolean} silenceable - If true, log can be silenced (buffered); if false, always outputs immediately\n     */\n    log(level, message, data = null, silenceable = true) {\n        if (!this.shouldLog(level)) return;\n\n        const timestamp = new Date().toLocaleTimeString();\n\n        // Extract stack trace for errors\n        let stack = null;\n        if (data instanceof Error) {\n            stack = data.stack;\n            data = {\n                message: data.message,\n                name: data.name,\n                stack: data.stack\n            };\n        }\n\n        const logEntry = {\n            timestamp,\n            level,\n            message,\n            data,\n            stack\n        };\n\n        // If in silent mode and this log is silenceable, buffer it instead of displaying\n        if (this.silenced && silenceable) {\n            this.silencedBuffer.push(logEntry);\n\n            // Keep only last maxSilencedLogs entries in buffer\n            if (this.silencedBuffer.length > this.maxSilencedLogs) {\n                this.silencedBuffer.shift();\n            }\n\n            // Don't output to console or UI\n            return;\n        }\n\n        // Normal logging (not silenced or not silenceable)\n        this.logs.push(logEntry);\n\n        // Keep only last maxLogs entries\n        if (this.logs.length > this.maxLogs) {\n            this.logs.shift();\n        }\n\n        // Also log to console for debugging (use original console to avoid infinite loop)\n        const consoleMethod = this.consoleHooked ? this.originalConsole.log : console.log;\n        const consoleMsg = `[${timestamp}] ${message}`;\n        if (data) {\n            consoleMethod(consoleMsg, data);\n        } else {\n            consoleMethod(consoleMsg);\n        }\n        if (stack) {\n            consoleMethod('Stack trace:', stack);\n        }\n\n        // Trigger UI update\n        this.updateUI();\n    }\n\n    /**\n     * Convenience methods\n     * @param {string} message - Log message\n     * @param {*} data - Optional data to log\n     * @param {boolean} silenceable - If true (default), log can be buffered in silent mode\n     */\n    verbose(message, data = null, silenceable = true) {\n        this.log('verbose', message, data, silenceable);\n    }\n\n    debug(message, data = null, silenceable = true) {\n        this.log('debug', message, data, silenceable);\n    }\n\n    info(message, data = null, silenceable = true) {\n        this.log('info', message, data, silenceable);\n    }\n\n    warn(message, data = null, silenceable = true) {\n        this.log('warn', message, data, silenceable);\n    }\n\n    error(message, data = null, silenceable = true) {\n        this.log('error', message, data, silenceable);\n    }\n\n    /**\n     * Clear all logs\n     */\n    clear() {\n        this.logs = [];\n        this.updateUI();\n    }\n\n    /**\n     * Update the UI with current logs\n     */\n    updateUI() {\n        // Use configured output element or fallback to default selector\n        const output = this.outputElement ? $(this.outputElement) : $('#debug-output');\n        if (!output || output.length === 0) return;\n\n        output.empty();\n\n        for (const log of this.logs) {\n            const logDiv = $('<div class=\"debug-log\"></div>')\n                .addClass(log.level);\n\n            const timestamp = $('<span class=\"debug-timestamp\"></span>')\n                .text(log.timestamp);\n\n            const message = $('<span></span>').text(log.message);\n\n            logDiv.append(timestamp).append(message);\n\n            if (log.data) {\n                const dataStr = typeof log.data === 'object' ?\n                    JSON.stringify(log.data, null, 2) :\n                    String(log.data);\n                const dataSpan = $('<span></span>')\n                    .text(' | ' + dataStr)\n                    .css('color', '#888');\n                logDiv.append(dataSpan);\n            }\n\n            // Show stack trace for errors (collapsed by default)\n            if (log.stack) {\n                const stackBtn = $('<span></span>')\n                    .text(' [stack]')\n                    .css({\n                        'color': '#ff6b6b',\n                        'cursor': 'pointer',\n                        'text-decoration': 'underline'\n                    });\n\n                const stackDiv = $('<pre></pre>')\n                    .text(log.stack)\n                    .css({\n                        'display': 'none',\n                        'color': '#ff6b6b',\n                        'font-size': '9px',\n                        'margin': '4px 0 0 20px',\n                        'padding': '4px',\n                        'background': '#2a0000',\n                        'border-left': '2px solid #ff6b6b',\n                        'overflow-x': 'auto'\n                    });\n\n                stackBtn.on('click', function() {\n                    stackDiv.toggle();\n                });\n\n                logDiv.append(stackBtn);\n                logDiv.append(stackDiv);\n            }\n\n            output.append(logDiv);\n        }\n\n        // Auto-scroll to bottom\n        output.scrollTop(output[0].scrollHeight);\n    }\n\n    /**\n     * Get all logs\n     */\n    getLogs() {\n        return this.logs;\n    }\n\n    /**\n     * Get silenced buffer\n     */\n    getSilencedBuffer() {\n        return this.silencedBuffer;\n    }\n\n    /**\n     * Get silenced state\n     */\n    isSilenced() {\n        return this.silenced;\n    }\n\n    /**\n     * Get buffer stats\n     */\n    getBufferStats() {\n        return {\n            silenced: this.silenced,\n            bufferSize: this.silencedBuffer.length,\n            maxBufferSize: this.maxSilencedLogs,\n            bufferUsagePercent: Math.round((this.silencedBuffer.length / this.maxSilencedLogs) * 100)\n        };\n    }\n\n    /**\n     * Hook browser console methods to echo to debug console\n     */\n    hookConsole() {\n        if (this.consoleHooked) {\n            this.warn('Console already hooked');\n            return;\n        }\n\n        // Store original console methods\n        this.originalConsole = {\n            log: console.log,\n            info: console.info,\n            warn: console.warn,\n            error: console.error\n        };\n\n        const self = this;\n\n        // Override console.log\n        console.log = function(...args) {\n            self.originalConsole.log.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.debug('[console.log] ' + message);\n        };\n\n        // Override console.info\n        console.info = function(...args) {\n            self.originalConsole.info.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.debug('[console.info] ' + message);\n        };\n\n        // Override console.warn\n        console.warn = function(...args) {\n            self.originalConsole.warn.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.warn('[console] ' + message);\n        };\n\n        // Override console.error\n        console.error = function(...args) {\n            self.originalConsole.error.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.error('[console] ' + message);\n        };\n\n        this.consoleHooked = true;\n        this.info('Console hooked - browser console calls will echo to debug console');\n    }\n\n    /**\n     * Unhook browser console methods (restore original behavior)\n     */\n    unhookConsole() {\n        if (!this.consoleHooked) {\n            this.warn('Console not hooked');\n            return;\n        }\n\n        console.log = this.originalConsole.log;\n        console.info = this.originalConsole.info;\n        console.warn = this.originalConsole.warn;\n        console.error = this.originalConsole.error;\n\n        this.consoleHooked = false;\n        this.info('Console unhooked - restored original behavior');\n    }\n}\n\n// Create singleton instance\nexport const logger = new DebugLogger();\n", "/**\n * Jacobian matrix computation using symbolic differentiation\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Variable names for each dimension (matches parser.js)\n */\nconst VARIABLE_NAMES = ['x', 'y', 'z', 'w', 'u', 'v'];\n\n/**\n * Optimize power expressions: replace pow(x, n) with x*x*... for small integers\n * Also cleans up other common patterns\n *\n * @param {string} expr - Expression to optimize\n * @returns {string} - Optimized expression\n */\nfunction optimizePowerExpressions(expr) {\n    // Replace pow(var, integer) with repeated multiplication for n <= 4\n    expr = expr.replace(/([a-z]+)\\^(\\d+)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        // if (n <= 4) {\n            return Array(n).fill(base).join('*');\n        // }\n        return match; // Keep pow for larger exponents\n    });\n\n    // Nerdamer uses ^ for exponentiation, but also handle pow() format\n    expr = expr.replace(/pow\\(([a-z]+),\\s*(\\d+)\\)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        if (n <= 4) {\n            return Array(n).fill(base).join('*');\n        }\n        return match;\n    });\n\n    return expr;\n}\n\n/**\n * Compute the Jacobian matrix symbolically\n *\n * For a vector field f = [f_0, f_1, ..., f_n], computes the matrix:\n * J[i][j] = \u2202f_i/\u2202x_j\n *\n * BUG: This function sometimes produces inconsistent results on initial page load\n * (possibly due to Nerdamer initialization timing issues or internal caching bugs).\n * Workaround: Always start with fixed-point iteration and switch to Newton's method\n * after a 3-second delay (see controls-v2.js).\n *\n * @param {string[]} expressions - Array of expression strings (one per dimension)\n * @param {number} dimensions - Number of dimensions\n * @returns {string[][]|null} - 2D array of symbolic derivative strings, or null if failed\n */\nexport function computeSymbolicJacobian(expressions, dimensions) {\n\n    logger.verbosity = 'verbose';\n\n    logger.info('=== JACOBIAN COMPUTATION START ===');\n    logger.info('Timestamp:', new Date().toISOString());\n    logger.info('Nerdamer loaded:', !!window.nerdamer);\n    logger.info('Nerdamer type:', typeof window.nerdamer);\n    logger.info('Nerdamer is function:', typeof window.nerdamer === 'function');\n    logger.info('Nerdamer.diff exists:', window.nerdamer && typeof window.nerdamer.diff === 'function');\n    logger.info('Nerdamer.clear exists:', window.nerdamer && typeof window.nerdamer.clear === 'function');\n    logger.info('Input expressions:', expressions.toString());\n    logger.info('Dimensions:', dimensions);\n\n    if (!window.nerdamer) {\n        logger.error('Nerdamer not loaded - cannot compute Jacobian');\n        return null;\n    }\n\n    if (typeof window.nerdamer !== 'function') {\n        logger.error('Nerdamer is not a function - invalid state');\n        return null;\n    }\n\n    if (!window.nerdamer.diff) {\n        logger.error('Nerdamer.diff not available - incomplete initialization');\n        return null;\n    }\n\n    try {\n        // Clear Nerdamer's internal cache to avoid stale results\n        if (window.nerdamer && window.nerdamer.clear) {\n            logger.verbose('Clearing Nerdamer cache');\n            window.nerdamer.clear('all');\n        }\n\n        // Test consistency: differentiate a simple expression twice\n        logger.verbose('Testing Nerdamer consistency...');\n        try {\n            const testExpr = 'x*y';\n            const testVar = 'x';\n            const test1 = window.nerdamer.diff(window.nerdamer(testExpr), testVar).toString();\n            window.nerdamer.clear('all'); // Clear between tests\n            const test2 = window.nerdamer.diff(window.nerdamer(testExpr), testVar).toString();\n            logger.verbose(`Consistency test: d(${testExpr})/d${testVar}`);\n            logger.verbose(`  First result:  ${test1}`);\n            logger.verbose(`  Second result: ${test2}`);\n            logger.verbose(`  Consistent: ${test1 === test2}`);\n            if (test1 !== test2) {\n                logger.error('WARNING: Nerdamer is giving inconsistent results!');\n            }\n        } catch (e) {\n            logger.warn('Consistency test failed:', e.message);\n        }\n\n        // WORKAROUND: Nerdamer doesn't support atan2(y, x) differentiation\n        // Replace atan2(A, B) with atan(A/B) for differentiation\n        // The derivatives are mathematically identical:\n        //   d/dB[atan2(A,B)] = -A/(A\u00B2+B\u00B2) = d/dB[atan(A/B)]\n        //   d/dA[atan2(A,B)] = B/(A\u00B2+B\u00B2) = d/dA[atan(A/B)]\n        // Multi-chart approach handles singularities: Chart 2 swaps arguments so\n        // atan2(y,x) becomes atan2(x,y) \u2192 atan(x/y), moving singularity from x=0 to y=0\n        const expressionsForDiff = expressions.map(expr => {\n            const replaced = expr.replace(/atan2\\s*\\(\\s*([^,]+)\\s*,\\s*([^)]+)\\s*\\)/g, 'atan(($1)/($2))');\n            if (replaced !== expr) {\n                logger.verbose(`Replaced atan2 for differentiation: \"${expr}\" \u2192 \"${replaced}\"`);\n            }\n            return replaced;\n        });\n\n        const jacobian = [];\n\n        // For each output dimension i\n        for (let i = 0; i < dimensions; i++) {\n            const row = [];\n            const expr = expressionsForDiff[i]; // Use preprocessed expression\n            logger.verbose(`Row ${i}: differentiating expression \"${expr}\"`);\n\n            // For each input variable j\n            for (let j = 0; j < dimensions; j++) {\n                const variable = VARIABLE_NAMES[j];\n\n                try {\n                    // Compute symbolic derivative \u2202f_i/\u2202x_j\n                    // Use nerdamer() to parse fresh each time\n                    logger.verbose(`  Computing \u2202(${expr})/\u2202${variable}...`);\n                    const derivative = window.nerdamer.diff(window.nerdamer(expr), variable).toString();\n                    logger.verbose(`  Raw derivative: ${derivative}`);\n\n                    // Simplify the result to cancel common factors BEFORE inversion\n                    // This helps Nerdamer produce cleaner inverse matrices\n                    // expand() first to distribute terms, then simplify to cancel\n                    // let simplified = window.nerdamer(`simplify(expand(${derivative}))`).toString();\n                    // logger.verbose(`  Simplified: ${simplified}`);\n\n                    // Optimize: replace pow(x, n) with x*x*... for small integer exponents\n                    let optimized = optimizePowerExpressions(window.nerdamer(`simplify(${derivative})`).toString());\n                    logger.verbose(`  Optimized: ${optimized}`);\n\n                    row.push(optimized);\n                } catch (error) {\n                    logger.warn(`Failed to differentiate expression \"${expr}\" w.r.t. ${variable}: ${error.message}`);\n                    // Default to zero if differentiation fails\n                    row.push('0');\n                }\n            }\n\n            jacobian.push(row);\n        }\n\n        logger.info('=== JACOBIAN COMPUTATION COMPLETE ===');\n        logger.info('Final Jacobian matrix:');\n        for (let i = 0; i < jacobian.length; i++) {\n            logger.info(`  Row ${i}: [${jacobian[i].join(', ')}]`);\n        }\n\n        // Simplify the forward Jacobian BEFORE inversion to help with complex sqrt terms\n        // logger.verbose('Simplifying forward Jacobian before inversion...');\n        // const simplifiedJacobian = jacobian.map((row, i) => {\n        //     return row.map((element, j) => {\n        //         try {\n        //             const simplified = window.nerdamer(`simplify(${element})`).toString();\n        //             if (simplified !== element) {\n        //                 logger.verbose(`  J[${i},${j}]: \"${element}\" \u2192 \"${simplified}\"`);\n        //             }\n        //             return simplified;\n        //         } catch (e) {\n        //             logger.warn(`Failed to simplify J[${i},${j}]: ${e.message}`);\n        //             return element;\n        //         }\n        //     });\n        // });\n\n        return jacobian;\n\n    } catch (error) {\n        logger.error('Failed to compute Jacobian matrix', error);\n        return null;\n    }\n}\n\n/**\n * Test if a Jacobian matrix is valid (no undefined/null entries)\n *\n * @param {string[][]|null} jacobian - Jacobian matrix to test\n * @returns {boolean} - True if valid\n */\nexport function isValidJacobian(jacobian) {\n    if (!jacobian || !Array.isArray(jacobian)) {\n        return false;\n    }\n\n    for (const row of jacobian) {\n        if (!Array.isArray(row)) {\n            return false;\n        }\n        for (const entry of row) {\n            if (typeof entry !== 'string' || entry === '') {\n                return false;\n            }\n        }\n    }\n\n    return true;\n}\n\n/**\n * Format Jacobian matrix for display\n *\n * @param {string[][]} jacobian - Jacobian matrix\n * @returns {string} - Formatted string representation\n */\nexport function formatJacobian(jacobian) {\n    if (!jacobian) return 'null';\n\n    const maxLen = Math.max(...jacobian.flat().map(s => s.length));\n\n    let result = '[\\n';\n    for (const row of jacobian) {\n        result += '  [' + row.map(s => s.padEnd(maxLen)).join(', ') + ']\\n';\n    }\n    result += ']';\n\n    return result;\n}\n\n/**\n * Invert a symbolic Jacobian matrix using Nerdamer\n * Supports 2x2, 3x3, and 4x4 matrices\n *\n * @param {string[][]} jacobian - Jacobian matrix to invert\n * @returns {string[][]|null} - Inverted matrix or null if failed\n */\nexport function invertJacobian(jacobian) {\n    if (!jacobian || !Array.isArray(jacobian)) {\n        logger.error('Invalid Jacobian for inversion');\n        return null;\n    }\n\n    const n = jacobian.length;\n    if (n < 2 || n > 4) {\n        logger.error(`Jacobian inversion only supported for 2x2, 3x3, and 4x4 matrices (got ${n}x${n})`);\n        return null;\n    }\n\n    try {\n        // Use Nerdamer's matrix inversion for all sizes\n        // matrix() takes rows as separate arguments: matrix([a,b],[c,d]), not matrix([[a,b],[c,d]])\n        const matrixArgs = jacobian.map(row => `[${row.join(',')}]`).join(',');\n        logger.verbose('Inverting Jacobian matrix:', `matrix(${matrixArgs})`);\n\n        // Invert the matrix using Nerdamer's invert function (once!)\n        window.nerdamer.setVar('J_temp', `matrix(${matrixArgs})`);\n        window.nerdamer.setVar('J_inv', 'invert(J_temp)');\n\n        // Extract result as array using matget() for each element\n        const result = [];\n        for (let i = 0; i < n; i++) {\n            const row = [];\n            for (let j = 0; j < n; j++) {\n                // Use matget to access matrix element (0-based indexing)\n                const element = window.nerdamer(`matget(J_inv, ${i}, ${j})`).toString();\n                // Don't simplify - it introduces imaginary numbers and timeouts\n                const optimized = optimizePowerExpressions(element);\n                row.push(optimized);\n            }\n            result.push(row);\n        }\n\n        logger.verbose('Inverted Jacobian:');\n        for (let i = 0; i < result.length; i++) {\n            logger.verbose(`  Row ${i}: [${result[i].join(', ')}]`);\n        }\n\n        return result;\n\n    } catch (error) {\n        logger.error('Failed to invert Jacobian:', error.message);\n        return null;\n    }\n}\n", "/**\n * Coordinate Chart Generation\n *\n * Automatically detects singularities in coordinate transforms (primarily atan2)\n * and generates multiple coordinate charts to avoid numerical issues near singularities.\n *\n * Uses the \"atlas\" approach from differential geometry: cover the space with\n * multiple charts, each with singularities in different locations.\n */\n\n/**\n * Detect atan2(A, B) patterns in an expression\n * @param {string} expression - Math expression to analyze\n * @returns {Array<{numerator, denominator, fullMatch}>} - Array of atan2 patterns found\n */\nexport function detectAtan2Patterns(expression) {\n    const patterns = [];\n    const regex = /atan2\\s*\\(\\s*([^,]+)\\s*,\\s*([^)]+)\\s*\\)/g;\n\n    let match;\n    while ((match = regex.exec(expression)) !== null) {\n        patterns.push({\n            fullMatch: match[0],\n            numerator: match[1].trim(),\n            denominator: match[2].trim()\n        });\n    }\n\n    return patterns;\n}\n\n/**\n * Generate an alternative chart by swapping atan2 arguments\n * For atan2(y, x) \u2192 generate chart with \u03C0/2 - atan2(x, y)\n *\n * @param {Array<string>} forwardTransforms - Original coordinate transforms\n * @param {Object} atan2Info - {numerator, denominator, fullMatch}\n * @returns {Object} - {condition, forwardTransforms}\n */\nexport function generateAlternativeChart(forwardTransforms, atan2Info) {\n    const {numerator, denominator, fullMatch} = atan2Info;\n\n    // Swap arguments and adjust angle\n    // \u03B8 = atan2(y, x) becomes \u03B8 = \u03C0/2 - atan2(x, y)\n    const swappedAtan2 = `PI/2 - atan2(${denominator}, ${numerator})`;\n\n    // Replace in all transforms\n    const alternativeTransforms = forwardTransforms.map(expr =>\n        expr.replace(fullMatch, swappedAtan2)\n    );\n\n    // Condition: use this chart when |denominator| <= |numerator|\n    // (i.e., when the original chart would have small denominator)\n    const condition = `abs(${denominator}) <= abs(${numerator})`;\n\n    return {\n        condition,\n        forwardTransforms: alternativeTransforms\n    };\n}\n\n/**\n * Generate multiple coordinate charts to handle singularities\n *\n * Strategy:\n * - For 2D/cylindrical with atan2(y, x): Generate 2 charts (x-dominant vs y-dominant)\n * - For spherical with multiple atan2s: Generate 4-6 charts as needed\n *\n * @param {Array<string>} forwardTransforms - Original coordinate transform expressions\n * @param {number} dimensions - Number of dimensions\n * @returns {Array<{condition, forwardTransforms}>} - Array of charts\n */\nexport function generateCharts(forwardTransforms, dimensions) {\n    const charts = [];\n\n    // Find all atan2 patterns across all transforms\n    const allAtan2Patterns = [];\n    forwardTransforms.forEach((expr, index) => {\n        const patterns = detectAtan2Patterns(expr);\n        patterns.forEach(pattern => {\n            allAtan2Patterns.push({...pattern, transformIndex: index});\n        });\n    });\n\n    // No atan2 found - single chart covers everything\n    if (allAtan2Patterns.length === 0) {\n        return [{\n            condition: 'true',\n            forwardTransforms\n        }];\n    }\n\n    // Handle 2D/3D-cylindrical case (single atan2)\n    if (dimensions === 2 || (dimensions === 3 && allAtan2Patterns.length === 1)) {\n        const atan2Info = allAtan2Patterns[0];\n\n        // Chart 1: Original (good when denominator is large)\n        charts.push({\n            condition: `abs(${atan2Info.denominator}) >= abs(${atan2Info.numerator})`,\n            forwardTransforms: forwardTransforms\n        });\n\n        // Chart 2: Swapped (good when numerator is large)\n        charts.push(generateAlternativeChart(forwardTransforms, atan2Info));\n\n        return charts;\n    }\n\n    // Handle spherical case (multiple atan2s or complex patterns)\n    if (dimensions === 3 && allAtan2Patterns.length >= 2) {\n        // For standard spherical (r, \u03B8, \u03C6) with atan2 in azimuthal angle\n        // We need to consider both polar angle regions AND azimuthal regions\n\n        // Find the azimuthal atan2 (usually the last one, typically atan2(y, x))\n        const azimuthalAtan2 = allAtan2Patterns[allAtan2Patterns.length - 1];\n\n        // Simple strategy: Generate 2 charts based on azimuthal angle\n        // More sophisticated approach would handle polar angle singularities too\n\n        // Chart 1: Original\n        charts.push({\n            condition: `abs(${azimuthalAtan2.denominator}) >= abs(${azimuthalAtan2.numerator})`,\n            forwardTransforms: forwardTransforms\n        });\n\n        // Chart 2: Swapped azimuthal\n        charts.push(generateAlternativeChart(forwardTransforms, azimuthalAtan2));\n\n        return charts;\n    }\n\n    // Fallback: single chart\n    return [{\n        condition: 'true',\n        forwardTransforms\n    }];\n}\n\n/**\n * Generate GLSL condition expression from JavaScript condition string\n * Converts variable names to GLSL pos.x, pos.y, pos.z format\n *\n * @param {string} condition - Condition like \"abs(x) >= abs(y)\"\n * @param {Array<string>} cartesianVars - Variable names ['x', 'y', 'z']\n * @returns {string} - GLSL condition like \"abs(pos.x) >= abs(pos.y)\"\n */\nexport function generateGLSLCondition(condition, cartesianVars) {\n    if (condition === 'true') {\n        return 'true';\n    }\n\n    let glslCondition = condition;\n\n    // Replace each Cartesian variable with pos.x, pos.y, etc.\n    cartesianVars.forEach((varName, index) => {\n        const swizzle = ['x', 'y', 'z', 'w'][index];\n        // Use word boundaries to avoid replacing 'x' in 'exp'\n        const regex = new RegExp(`\\\\b${varName}\\\\b`, 'g');\n        glslCondition = glslCondition.replace(regex, `pos.${swizzle}`);\n    });\n\n    // Convert PI to 3.14159265359\n    glslCondition = glslCondition.replace(/\\bPI\\b/g, '3.14159265359');\n\n    return glslCondition;\n}\n", "/**\n * Coordinate Systems Module\n *\n * Defines alternate coordinate systems (polar, spherical, etc.) and handles\n * conversion between user-defined coordinates and Cartesian coordinates.\n *\n * Flow:\n * 1. User defines vector field in alternate coordinates (e.g., dr/dt, d\u03B8/dt)\n * 2. System converts position from Cartesian to native coordinates\n * 3. Evaluates velocity in native coordinates\n * 4. Converts velocity back to Cartesian using Jacobian\n * 5. Integration happens in Cartesian space (all existing integrators work)\n */\n\nimport { computeSymbolicJacobian, invertJacobian } from './jacobian.js';\nimport { generateCharts, generateGLSLCondition } from './coordinate-charts.js';\n\n/**\n * Base class for coordinate systems\n */\nclass CoordinateSystem {\n    constructor(name, dimensions, variables, forwardTransforms, inverseTransforms = null, useIterativeSolver = false, charts = null) {\n        this.name = name;\n        this.dimensions = dimensions;\n        this.variables = variables; // Array of { label: \"r\", displayLabel: \"r\" }\n        this.forwardTransforms = forwardTransforms; // Array of expressions: Cartesian \u2192 Native\n        this.inverseTransforms = inverseTransforms; // Array of expressions: Native \u2192 Cartesian (optional)\n        this.useIterativeSolver = useIterativeSolver; // Use Newton's method in GLSL to compute inverse\n\n        // Auto-generate charts to handle singularities if not explicitly provided\n        // Charts allow us to use different coordinate representations in different regions\n        // NOTE: Charts will be deprecated once we switch to native-space integration\n        this.charts = charts || generateCharts(forwardTransforms, dimensions);\n    }\n\n    /**\n     * Get variable names for this coordinate system\n     * @returns {Array<string>} - Variable names (e.g., ['r', 'theta'])\n     */\n    getVariableNames() {\n        return this.variables.map(v => v.label);\n    }\n\n    /**\n     * Get display labels (may include unicode symbols)\n     * @returns {Array<string>} - Display labels (e.g., ['r', '\u03B8'])\n     */\n    getDisplayLabels() {\n        return this.variables.map(v => v.displayLabel);\n    }\n\n    /**\n     * Generate GLSL code for forward transform (Cartesian \u2192 Native)\n     * @param {Array<string>} cartesianVars - Cartesian variable names (e.g., ['x', 'y'])\n     * @returns {string} - GLSL function code\n     */\n    generateForwardTransformGLSL(cartesianVars, parseFunc) {\n        const nativeVars = this.getVariableNames();\n        const dimType = `vec${this.dimensions}`;\n\n        // Parse each transform expression to GLSL\n        const transformCode = this.forwardTransforms.map((expr, i) => {\n            const glsl = parseFunc(expr, cartesianVars);\n            return `    result.${['x', 'y', 'z', 'w'][i]} = ${glsl};`;\n        }).join('\\n');\n\n        return `\n// Forward transform: Cartesian \u2192 ${this.name}\n${dimType} transformToNative(${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${['x', 'y', 'z', 'w'][i]}`).join(', ')};\n${transformCode}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for velocity transform using Jacobian\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateVelocityTransformGLSL(cartesianVars, parseFunc) {\n        // If we have multiple charts, use chart-aware generation\n        if (this.charts && this.charts.length > 1) {\n            return this.generateMultiChartVelocityTransformGLSL(cartesianVars, parseFunc);\n        }\n\n        // Single chart - use original logic\n        const forwardTransforms = this.charts && this.charts.length === 1\n            ? this.charts[0].forwardTransforms\n            : this.forwardTransforms;\n\n        // Compute forward Jacobian matrix: J_forward = \u2202(native)/\u2202(cartesian)\n        const jacobian = computeSymbolicJacobian(forwardTransforms, this.dimensions);\n\n        if (!jacobian) {\n            console.error('Failed to compute Jacobian for coordinate system:', this.name);\n            // Fallback: identity transform (incorrect but prevents crashes)\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (IDENTITY FALLBACK - ERROR)\n// WARNING: Jacobian computation failed, using identity transform\nvec${this.dimensions} transformVelocityToCartesian(vec${this.dimensions} vel_native, vec${this.dimensions} pos) {\n    return vel_native; // INCORRECT: Should use inverse Jacobian\n}`;\n        }\n\n        // CRITICAL FIX: Invert the Jacobian matrix\n        // By chain rule: vel_cartesian = J_inverse * vel_native\n        // where J_inverse = (J_forward)^(-1)\n        const inverseJacobian = invertJacobian(jacobian);\n\n        if (!inverseJacobian) {\n            console.error('Failed to invert Jacobian for coordinate system:', this.name);\n            console.error('Forward Jacobian was:', jacobian);\n            // Fallback: identity transform (incorrect but prevents crashes)\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (IDENTITY FALLBACK - ERROR)\n// WARNING: Jacobian inversion failed, using identity transform\n// This will produce INCORRECT results for non-Cartesian coordinates!\nvec${this.dimensions} transformVelocityToCartesian(vec${this.dimensions} vel_native, vec${this.dimensions} pos) {\n    return vel_native; // INCORRECT: Jacobian inversion failed\n}`;\n        }\n\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Generate matrix multiplication code: vel_cartesian = J_inverse * vel_native\n        const matrixMultCode = [];\n        for (let i = 0; i < this.dimensions; i++) {\n            const row = inverseJacobian[i];\n            const terms = row.map((entry, j) => {\n                const parsedEntry = parseFunc(entry, cartesianVars);\n                return `(${parsedEntry}) * vel_native.${swizzles[j]}`;\n            });\n            matrixMultCode.push(`    result.${swizzles[i]} = ${terms.join(' + ')};`);\n        }\n\n        return `\n// Velocity transform: ${this.name} \u2192 Cartesian via Inverse Jacobian\n// J_forward = [${jacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//             ')}]\n// J_inverse = [${inverseJacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//             ')}]\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${swizzles[i]}`).join(', ')};\n${matrixMultCode.join('\\n')}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for velocity transform using multiple charts\n     * Each chart has different coordinate singularities, allowing robust computation\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code with chart selection\n     */\n    generateMultiChartVelocityTransformGLSL(cartesianVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Compute Jacobian and inverse for each chart\n        const chartData = this.charts.map((chart, index) => {\n            const jacobian = computeSymbolicJacobian(chart.forwardTransforms, this.dimensions);\n\n            if (!jacobian) {\n                console.warn(`Failed to compute Jacobian for chart ${index} of ${this.name}`);\n                return null;\n            }\n\n            const inverseJacobian = invertJacobian(jacobian);\n\n            if (!inverseJacobian) {\n                console.warn(`Failed to invert Jacobian for chart ${index} of ${this.name}`);\n                return null;\n            }\n\n            // Generate matrix multiplication code for this chart\n            const matrixMultCode = [];\n            for (let i = 0; i < this.dimensions; i++) {\n                const row = inverseJacobian[i];\n                const terms = row.map((entry, j) => {\n                    const parsedEntry = parseFunc(entry, cartesianVars);\n                    return `(${parsedEntry}) * vel_native.${swizzles[j]}`;\n                });\n                matrixMultCode.push(`        result.${swizzles[i]} = ${terms.join(' + ')};`);\n            }\n\n            return {\n                condition: chart.condition,\n                jacobian,\n                inverseJacobian,\n                matrixMultCode\n            };\n        }).filter(data => data !== null);\n\n        if (chartData.length === 0) {\n            console.error('All charts failed for coordinate system:', this.name);\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (ERROR: All charts failed)\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    return vel_native; // FALLBACK: All charts failed\n}`;\n        }\n\n        // Generate GLSL with if/else chain for chart selection\n        const chartCases = chartData.map((data, index) => {\n            const glslCondition = generateGLSLCondition(data.condition, cartesianVars);\n            const keyword = index === 0 ? 'if' : 'else if';\n            const condPart = glslCondition === 'true' ? '' : ` (${glslCondition})`;\n\n            return `    ${keyword}${condPart} {\n        // Chart ${index + 1}: Avoid singularities when ${data.condition}\n${data.matrixMultCode.join('\\n')}\n    }`;\n        }).join(' ');\n\n        // Add documentation comments\n        const chartDocs = chartData.map((data, index) => {\n            return `// Chart ${index + 1}: condition=${data.condition}\n//   J_forward = [${data.jacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//               ')}]\n//   J_inverse = [${data.inverseJacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//               ')}]`;\n        }).join('\\n');\n\n        return `\n// Velocity transform: ${this.name} \u2192 Cartesian via Multiple Charts\n// Using ${chartData.length} charts to handle coordinate singularities\n${chartDocs}\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${swizzles[i]}`).join(', ')};\n${chartCases}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for inverse transform (Native \u2192 Cartesian)\n     * Uses three-tier strategy:\n     *   Tier 1: Explicit inverse transforms (if provided)\n     *   Tier 3: Newton's method iterative solver (if useIterativeSolver is true)\n     * @param {Array<string>} nativeVars - Native variable names (e.g., ['r', 'theta'])\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateInverseTransformGLSL(nativeVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n        const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n\n        // Tier 1: Use explicit inverse transforms if provided\n        if (this.inverseTransforms && this.inverseTransforms.length === this.dimensions) {\n            const transformCode = this.inverseTransforms.map((expr, i) => {\n                // Inverse transforms are simple expressions using native variable names\n                // Don't parse them - use directly since we extract variables first\n                return `    result.${swizzles[i]} = ${expr};`;\n            }).join('\\n');\n\n            return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// Using explicit inverse transform (Tier 1)\n${dimType} transformToCartesian(${dimType} native_pos) {\n    ${dimType} result;\n    float ${nativeVars.map((v, i) => `${v} = native_pos.${swizzles[i]}`).join(', ')};\n${transformCode}\n    return result;\n}`;\n        }\n\n        // Tier 3: Use Newton's method iterative solver\n        if (this.useIterativeSolver) {\n            return this.generateNewtonSolverGLSL(cartesianVars, nativeVars, parseFunc);\n        }\n\n        // Fallback: Identity transform (should not reach here in production)\n        console.warn(`No inverse transform defined for ${this.name}, using identity`);\n        return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// WARNING: Using identity fallback - no inverse defined!\n${dimType} transformToCartesian(${dimType} native_pos) {\n    return native_pos; // INCORRECT: Identity fallback\n}`;\n    }\n\n    /**\n     * Generate GLSL code for Newton's method iterative solver\n     * Solves: F(cartesian) = native_target\n     * Using: cartesian_new = cartesian_old - inverse(J) * (F(cartesian_old) - native_target)\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Array<string>} nativeVars - Native variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateNewtonSolverGLSL(cartesianVars, nativeVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const matType = `mat${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Generate forward transform code (used inside Newton iteration)\n        const forwardTransformCode = this.forwardTransforms.map((expr, i) => {\n            const glsl = parseFunc(expr, cartesianVars);\n            return `        native.${swizzles[i]} = ${glsl};`;\n        }).join('\\n');\n\n        // Compute Jacobian for Newton's method\n        const jacobian = computeSymbolicJacobian(this.forwardTransforms, this.dimensions);\n\n        if (!jacobian) {\n            console.error('Failed to compute Jacobian for Newton solver:', this.name);\n            return `\n// Newton solver failed: could not compute Jacobian\n${dimType} transformToCartesian(${dimType} native_pos) {\n    return native_pos; // ERROR FALLBACK\n}`;\n        }\n\n        // Generate Jacobian matrix construction code\n        const jacobianCode = [];\n        for (let i = 0; i < this.dimensions; i++) {\n            for (let j = 0; j < this.dimensions; j++) {\n                const parsedEntry = parseFunc(jacobian[i][j], cartesianVars);\n                jacobianCode.push(`        J[${i}][${j}] = ${parsedEntry};`);\n            }\n        }\n\n        return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// Using Newton's method iterative solver (Tier 3)\n${dimType} transformToCartesian(${dimType} native_target) {\n    // Use previous position as initial guess (stored in global)\n    ${dimType} guess = vec${this.dimensions}(0.0); // TODO: Use previous frame position\n\n    const int MAX_ITERATIONS = 10;\n    const float TOLERANCE = 1e-6;\n\n    for(int iter = 0; iter < MAX_ITERATIONS; iter++) {\n        // Evaluate forward transform at current guess\n        ${dimType} native;\n        float ${cartesianVars.map((v, i) => `${v} = guess.${swizzles[i]}`).join(', ')};\n${forwardTransformCode}\n\n        // Compute error\n        ${dimType} error = native - native_target;\n        if(length(error) < TOLERANCE) {\n            break; // Converged\n        }\n\n        // Build Jacobian matrix J = \u2202(native)/\u2202(cartesian)\n        ${matType} J;\n${jacobianCode.join('\\n')}\n\n        // Newton step: guess -= inverse(J) * error\n        guess -= inverse(J) * error;\n    }\n\n    return guess;\n}`;\n    }\n\n    /**\n     * Serialize to JSON for storage\n     */\n    toJSON() {\n        return {\n            name: this.name,\n            dimensions: this.dimensions,\n            variables: this.variables,\n            forwardTransforms: this.forwardTransforms,\n            inverseTransforms: this.inverseTransforms,\n            useIterativeSolver: this.useIterativeSolver\n        };\n    }\n\n    /**\n     * Deserialize from JSON\n     */\n    static fromJSON(json) {\n        return new CoordinateSystem(\n            json.name,\n            json.dimensions,\n            json.variables,\n            json.forwardTransforms,\n            json.inverseTransforms || null,\n            json.useIterativeSolver || false\n        );\n    }\n}\n\n/**\n * Preset coordinate systems\n */\nconst PRESET_COORDINATE_SYSTEMS = {\n    // 2D Systems\n    'cartesian2d': new CoordinateSystem(\n        'Cartesian 2D',\n        2,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' }\n        ],\n        ['x', 'y'], // Forward: Identity transform\n        ['x', 'y']  // Inverse: Identity transform\n    ),\n\n    'polar2d': new CoordinateSystem(\n        'Polar 2D',\n        2,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' }\n        ],\n        [\n            'sqrt(x^2 + y^2)',  // r = \u221A(x\u00B2 + y\u00B2)\n            'atan2(y, x)'       // \u03B8 = atan2(y, x)\n        ],\n        [\n            'r*cos(theta)',     // x = r\u00B7cos(\u03B8)\n            'r*sin(theta)'      // y = r\u00B7sin(\u03B8)\n        ]\n    ),\n\n    // 3D Systems\n    'cartesian3d': new CoordinateSystem(\n        'Cartesian 3D',\n        3,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' },\n            { label: 'z', displayLabel: 'z' }\n        ],\n        ['x', 'y', 'z'], // Forward: Identity\n        ['x', 'y', 'z']  // Inverse: Identity\n    ),\n\n    'cylindrical3d': new CoordinateSystem(\n        'Cylindrical 3D',\n        3,\n        [\n            { label: 'rho', displayLabel: '\u03C1' },\n            { label: 'phi', displayLabel: '\u03C6' },\n            { label: 'z', displayLabel: 'z' }\n        ],\n        [\n            'sqrt(x^2 + y^2)',   // \u03C1 = \u221A(x\u00B2 + y\u00B2)\n            'atan2(y, x)',       // \u03C6 = atan2(y, x)\n            'z'                  // z = z\n        ],\n        [\n            'rho*cos(phi)',      // x = \u03C1\u00B7cos(\u03C6)\n            'rho*sin(phi)',      // y = \u03C1\u00B7sin(\u03C6)\n            'z'                  // z = z\n        ]\n    ),\n\n    'spherical3d': new CoordinateSystem(\n        'Spherical 3D',\n        3,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' },\n            { label: 'phi', displayLabel: '\u03C6' }\n        ],\n        [\n            'sqrt(x^2 + y^2 + z^2)',              // r = \u221A(x\u00B2 + y\u00B2 + z\u00B2)\n            'acos(z / sqrt(x^2 + y^2 + z^2))',   // \u03B8 = acos(z/r) - polar angle from z-axis\n            'atan2(y, x)'                         // \u03C6 = atan2(y, x) - azimuthal angle\n        ],\n        [\n            'r*sin(theta)*cos(phi)',              // x = r\u00B7sin(\u03B8)\u00B7cos(\u03C6)\n            'r*sin(theta)*sin(phi)',              // y = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\n            'r*cos(theta)'                        // z = r\u00B7cos(\u03B8)\n        ]\n    ),\n\n    // 4D Systems\n    'cartesian4d': new CoordinateSystem(\n        'Cartesian 4D',\n        4,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' },\n            { label: 'z', displayLabel: 'z' },\n            { label: 'w', displayLabel: 'w' }\n        ],\n        ['x', 'y', 'z', 'w'], // Forward: Identity\n        ['x', 'y', 'z', 'w']  // Inverse: Identity\n    ),\n\n    'hyperspherical4d': new CoordinateSystem(\n        'Hyperspherical 4D',\n        4,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' },\n            { label: 'phi', displayLabel: '\u03C6' },\n            { label: 'psi', displayLabel: '\u03C8' }\n        ],\n        [\n            'sqrt(x^2 + y^2 + z^2 + w^2)',                           // r = \u221A(x\u00B2 + y\u00B2 + z\u00B2 + w\u00B2)\n            'acos(w / sqrt(x^2 + y^2 + z^2 + w^2))',                // \u03B8 = acos(w/r)\n            'acos(z / sqrt(x^2 + y^2 + z^2))',                      // \u03C6 = acos(z/\u221A(x\u00B2+y\u00B2+z\u00B2))\n            'atan2(y, x)'                                            // \u03C8 = atan2(y, x)\n        ],\n        [\n            'r*sin(theta)*sin(phi)*cos(psi)',                        // x = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\u00B7cos(\u03C8)\n            'r*sin(theta)*sin(phi)*sin(psi)',                        // y = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\u00B7sin(\u03C8)\n            'r*sin(theta)*cos(phi)',                                 // z = r\u00B7sin(\u03B8)\u00B7cos(\u03C6)\n            'r*cos(theta)'                                           // w = r\u00B7cos(\u03B8)\n        ]\n    )\n};\n\n/**\n * Get coordinate system by key\n */\nfunction getCoordinateSystem(key) {\n    return PRESET_COORDINATE_SYSTEMS[key] || null;\n}\n\n/**\n * Get preset coordinate systems for a given dimension\n */\nfunction getPresetsForDimension(dimensions) {\n    const presets = [];\n    for (const [key, system] of Object.entries(PRESET_COORDINATE_SYSTEMS)) {\n        if (system.dimensions === dimensions) {\n            presets.push({ key, system });\n        }\n    }\n    return presets;\n}\n\n/**\n * Get default Cartesian coordinate system for given dimensions\n */\nfunction getCartesianSystem(dimensions) {\n    const key = `cartesian${dimensions}d`;\n    return PRESET_COORDINATE_SYSTEMS[key] || createCartesianSystem(dimensions);\n}\n\n/**\n * Create a Cartesian coordinate system for arbitrary dimensions\n */\nfunction createCartesianSystem(dimensions) {\n    const varNames = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n    return new CoordinateSystem(\n        `Cartesian ${dimensions}D`,\n        dimensions,\n        varNames.map(v => ({ label: v, displayLabel: v })),\n        varNames\n    );\n}\n\n// Export for use in other modules\nexport {\n    CoordinateSystem,\n    PRESET_COORDINATE_SYSTEMS,\n    getCoordinateSystem,\n    getPresetsForDimension,\n    getCartesianSystem,\n    createCartesianSystem\n};\n", "/**\n * Float packing utilities for encoding/decoding floats into RGBA bytes\n * This allows high-precision storage in WebGL textures without requiring\n * floating point texture support.\n *\n * Uses fixed-point encoding for simplicity and reliability\n */\n\n// Fixed point scale for encoding [0, 1] values to 32-bit integers\nconst FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n\n/**\n * Encode a float into 4 bytes (RGBA) using fixed-point encoding\n * Expects value in [0, 1] range (viewport-normalized)\n * @param {number} value - Float value to encode (should be in [0, 1])\n * @param {Uint8Array} out - Output array\n * @param {number} offset - Offset in output array\n */\nexport function encodeFloatRGBA(value, out, offset) {\n    // Clamp to [0, 1] range\n    value = Math.max(0, Math.min(1, value));\n\n    // Map to [0, 2^32-1]\n    const intValue = Math.floor(value * FIXED_POINT_SCALE);\n\n    // Split 32-bit integer into 4 bytes (big-endian)\n    out[offset + 0] = (intValue >>> 24) & 0xFF;\n    out[offset + 1] = (intValue >>> 16) & 0xFF;\n    out[offset + 2] = (intValue >>> 8) & 0xFF;\n    out[offset + 3] = intValue & 0xFF;\n}\n\n/**\n * Decode RGBA bytes into a float using fixed-point decoding\n * Returns value in [0, 1] range (viewport-normalized)\n * @param {number} r - Red channel (0-255)\n * @param {number} g - Green channel (0-255)\n * @param {number} b - Blue channel (0-255)\n * @param {number} a - Alpha channel (0-255)\n * @returns {number} Decoded float value in [0, 1]\n */\nexport function decodeFloatRGBA(r, g, b, a) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    const intValue = (r << 24) | (g << 16) | (b << 8) | a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    // Handle unsigned to avoid sign issues\n    const uintValue = intValue >>> 0; // convert to unsigned\n    return uintValue / FIXED_POINT_SCALE;\n}\n\n/**\n * GLSL shader code for fixed-point constants (shared by encode/decode)\n * @returns {string} GLSL constant definitions\n */\nexport function getFixedPointConstantsGLSL() {\n    return `\n// Map to [0, 1] range for maximum precision at any zoom level\nconst float FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n`;\n}\n\n/**\n * GLSL shader code for encoding float to RGBA\n * Now uses viewport-relative encoding for dimensions 0 and 1 (x, y)\n * @returns {string} GLSL function code\n */\nexport function getEncodeGLSL() {\n    return `\n// Encode float in [0, 1] range to RGBA bytes\nvec4 encodeFloat(float v) {\n    // Clamp to [0, 1]\n    v = clamp(v, 0.0, 1.0);\n\n    // Map to [0, 2^32-1]\n    float normalized = v * FIXED_POINT_SCALE;\n\n    // Split into 4 bytes (big-endian)\n    float byte0 = floor(normalized / 16777216.0);  // 2^24\n    normalized -= byte0 * 16777216.0;\n    float byte1 = floor(normalized / 65536.0);      // 2^16\n    normalized -= byte1 * 65536.0;\n    float byte2 = floor(normalized / 256.0);        // 2^8\n    normalized -= byte2 * 256.0;\n    float byte3 = floor(normalized);\n\n    return vec4(byte0, byte1, byte2, byte3) / 255.0;\n}\n\n// Helper to normalize world coordinate to [0, 1] relative to viewport\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return (worldValue - minVal) / (maxVal - minVal);\n}\n\n// Helper to denormalize from [0, 1] back to world coordinates\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return minVal + normalized * (maxVal - minVal);\n}\n`;\n}\n\n/**\n * GLSL shader code for decoding RGBA to float\n * @returns {string} GLSL function code\n */\nexport function getDecodeGLSL() {\n    return `\n// Decode RGBA bytes back to float in [0, 1] range\nfloat decodeFloat(vec4 rgba) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    vec4 bytes = rgba * 255.0;\n    float intValue = bytes.r * 16777216.0 + bytes.g * 65536.0 + bytes.b * 256.0 + bytes.a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    return intValue / FIXED_POINT_SCALE;\n}\n`;\n}\n", "/**\n * Texture manager for N-dimensional particle positions\n * Uses ping-pong textures to update positions on GPU\n */\n\n/**\n * Create a collection of textures for storing N-dimensional positions\n */\nexport class TextureManager {\n    constructor(gl, dimensions, resolution, strategy) {\n        this.gl = gl;\n        this.dimensions = dimensions;\n        this.resolution = resolution;\n        this.strategy = strategy;\n\n        // Create read and write texture pairs for each dimension (dual buffering for point mode)\n        this.readTextures = [];\n        this.writeTextures = [];\n\n        for (let i = 0; i < dimensions; i++) {\n            this.readTextures.push(this.createTexture());\n            this.writeTextures.push(this.createTexture());\n        }\n\n        // Triple buffering (always active for velocity computation and line rendering)\n        this.lineMode = false; // Render mode: false = points, true = lines\n        this.prevTextures = [];\n        for (let i = 0; i < dimensions; i++) {\n            this.prevTextures.push(this.createTexture());\n        }\n\n        // Note: Age is stored in alpha channel of dimension 0, no separate age textures needed\n\n        // Texture units start from 0\n        this.textureUnitOffset = 0;\n    }\n\n    /**\n     * Create a single texture using the configured strategy\n     */\n    createTexture() {\n        const gl = this.gl;\n        const texture = gl.createTexture();\n        const format = this.strategy.getTextureFormat();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n        // Create empty texture using strategy's format\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            format.internalFormat,\n            this.resolution,\n            this.resolution,\n            0,\n            format.format,\n            format.type,\n            null\n        );\n\n        return texture;\n    }\n\n    /**\n     * Set line rendering mode (affects draw call only, not texture management)\n     * @param {boolean} enabled - Whether to render lines (true) or points (false)\n     */\n    setLineMode(enabled) {\n        this.lineMode = enabled; // Only affects rendering, prevTextures always exist\n    }\n\n    /**\n     * Enable previous textures (no-op, textures always exist now)\n     * @param {boolean} enabled - Whether previous textures are needed\n     */\n    setNeedsPrevTextures(enabled) {\n        // No-op: prevTextures are always created now\n    }\n\n    /**\n     * Initialize textures with particle data\n     * @param {TypedArray[]} data - Array of encoded particle positions (one per dimension)\n     */\n    initializeData(data) {\n        const gl = this.gl;\n        const format = this.strategy.getTextureFormat();\n\n        for (let i = 0; i < this.dimensions; i++) {\n            // Initialize read texture with data\n            gl.bindTexture(gl.TEXTURE_2D, this.readTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                data[i]\n            );\n\n            // Write texture stays empty (will be written to in first frame)\n            gl.bindTexture(gl.TEXTURE_2D, this.writeTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                null\n            );\n\n            // Initialize previous texture with same data\n            gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                data[i]\n            );\n        }\n\n        // Initialize alpha channel of dimension 0 to age = 1.0 so particles render immediately\n        // Age is stored in alpha channel of u_pos_0\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        // For float textures (RGBA format), set alpha channel to 1.0\n        if (format.format === gl.RGBA) {\n            // Re-read the data[0] texture to modify alpha channel\n            const dim0Data = data[0];\n            for (let i = 0; i < this.resolution * this.resolution; i++) {\n                // Alpha is the 4th component (index 3) in RGBA\n                if (componentsPerValue === 4) {\n                    dim0Data[i * 4 + 3] = 1.0; // Set age = 1.0\n                }\n            }\n\n            // Re-upload dimension 0 with modified alpha\n            gl.bindTexture(gl.TEXTURE_2D, this.readTextures[0]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                dim0Data\n            );\n\n            // Also upload to previous texture\n            gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[0]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                dim0Data\n            );\n        }\n    }\n\n    /**\n     * Bind read textures to shader uniforms\n     * @param {WebGLProgram} program - Shader program\n     */\n    bindReadTextures(program) {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            const uniformName = `u_pos_${i}`;\n            const location = gl.getUniformLocation(program, uniformName);\n\n            if (location !== null) {\n                gl.activeTexture(gl.TEXTURE0 + this.textureUnitOffset + i);\n                gl.bindTexture(gl.TEXTURE_2D, this.readTextures[i]);\n                gl.uniform1i(location, this.textureUnitOffset + i);\n            }\n        }\n    }\n\n    /**\n     * Bind previous frame textures to shader uniforms (always available)\n     * @param {WebGLProgram} program - Shader program\n     */\n    bindPrevTextures(program) {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            const uniformName = `u_prev_pos_${i}`;\n            const location = gl.getUniformLocation(program, uniformName);\n\n            if (location !== null) {\n                // Use texture units after the current position textures\n                const textureUnit = this.textureUnitOffset + this.dimensions + i;\n                gl.activeTexture(gl.TEXTURE0 + textureUnit);\n                gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[i]);\n                gl.uniform1i(location, textureUnit);\n            }\n        }\n    }\n\n    /**\n     * Get write texture for a specific dimension\n     * @param {number} dimension - Dimension index\n     */\n    getWriteTexture(dimension) {\n        return this.writeTextures[dimension];\n    }\n\n    /**\n     * Swap read and write textures (ping-pong for points, triple-buffer rotation for lines)\n     */\n    swap() {\n        // Triple buffer rotation: prev <- read <- write <- prev\n        const temp = this.prevTextures;\n        this.prevTextures = this.readTextures;\n        this.readTextures = this.writeTextures;\n        this.writeTextures = temp;\n\n        // Age is now in alpha channel of dimension 0, swapped with position textures\n    }\n\n    /**\n     * Resize textures\n     */\n    resize(newResolution) {\n        const gl = this.gl;\n        this.resolution = newResolution;\n\n        // Delete old textures\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.deleteTexture(this.readTextures[i]);\n            gl.deleteTexture(this.writeTextures[i]);\n            gl.deleteTexture(this.prevTextures[i]);\n        }\n\n        // Create new ones\n        this.readTextures = [];\n        this.writeTextures = [];\n        this.prevTextures = [];\n\n        for (let i = 0; i < this.dimensions; i++) {\n            this.readTextures.push(this.createTexture());\n            this.writeTextures.push(this.createTexture());\n            this.prevTextures.push(this.createTexture());\n        }\n    }\n\n    /**\n     * Clean up resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.deleteTexture(this.readTextures[i]);\n            gl.deleteTexture(this.writeTextures[i]);\n            gl.deleteTexture(this.prevTextures[i]);\n        }\n\n        this.readTextures = [];\n        this.writeTextures = [];\n        this.prevTextures = [];\n    }\n\n    /**\n     * Get current read textures (for debugging)\n     */\n    getReadTextures() {\n        return this.readTextures;\n    }\n\n    /**\n     * Read back texture data (for debugging/analysis)\n     */\n    readTexture(dimension) {\n        const gl = this.gl;\n        const format = this.strategy.getTextureFormat();\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        const data = new ArrayType(this.resolution * this.resolution * componentsPerValue);\n\n        const framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n        gl.framebufferTexture2D(\n            gl.FRAMEBUFFER,\n            gl.COLOR_ATTACHMENT0,\n            gl.TEXTURE_2D,\n            this.readTextures[dimension],\n            0\n        );\n\n        gl.readPixels(0, 0, this.resolution, this.resolution, format.format, format.type, data);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.deleteFramebuffer(framebuffer);\n\n        return data;\n    }\n}\n", "/**\n * HDR Framebuffer Management\n * Handles creation and management of floating-point render targets for HDR rendering\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * FramebufferManager class\n * Manages HDR framebuffers with float texture attachments\n */\nexport class FramebufferManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.useHDR = config.useHDR !== undefined ? config.useHDR : true;\n        this.usePingPong = config.usePingPong !== undefined ? config.usePingPong : true;\n\n        // Check for required extensions\n        this.checkExtensions();\n\n        // Create framebuffers and textures\n        this.initialize();\n\n        logger.info('FramebufferManager initialized', {\n            width,\n            height,\n            useHDR: this.useHDR,\n            hdrSupported: this.hdrSupported,\n            textureFormat: this.getTextureFormatName()\n        });\n    }\n\n    /**\n     * Check for required WebGL extensions\n     */\n    checkExtensions() {\n        const gl = this.gl;\n\n        logger.verbose('Checking WebGL extensions for HDR support...');\n\n        // Check for float texture support (needed for particle positions, already checked elsewhere)\n        this.floatTextureExt = gl.getExtension('OES_texture_float');\n\n        // Check for half-float texture support\n        this.halfFloatTextureExt = gl.getExtension('OES_texture_half_float');\n\n        // Check for float color buffer (WebGL 1.0)\n        this.floatColorBufferExt = gl.getExtension('WEBGL_color_buffer_float') ||\n                                    gl.getExtension('EXT_color_buffer_float');\n\n        // Check for half-float color buffer (WebGL 1.0)\n        this.halfFloatColorBufferExt = gl.getExtension('EXT_color_buffer_half_float');\n\n        // Check for linear filtering of float textures\n        this.floatLinearExt = gl.getExtension('OES_texture_float_linear');\n        this.halfFloatLinearExt = gl.getExtension('OES_texture_half_float_linear');\n\n        // Check for float blending (needed for additive blending with float framebuffers)\n        this.floatBlendExt = gl.getExtension('EXT_float_blend');\n\n        logger.verbose('WebGL extension support:', {\n            OES_texture_float: !!this.floatTextureExt,\n            OES_texture_half_float: !!this.halfFloatTextureExt,\n            WEBGL_color_buffer_float: !!this.floatColorBufferExt,\n            EXT_color_buffer_half_float: !!this.halfFloatColorBufferExt,\n            OES_texture_float_linear: !!this.floatLinearExt,\n            OES_texture_half_float_linear: !!this.halfFloatLinearExt,\n            EXT_float_blend: !!this.floatBlendExt\n        });\n\n        // Determine HDR support\n        this.hdrSupported = !!(this.floatColorBufferExt || this.halfFloatColorBufferExt);\n\n        logger.verbose(`HDR support determined: ${this.hdrSupported ? 'SUPPORTED' : 'NOT SUPPORTED'}`);\n\n        // If HDR requested but not supported, fall back to LDR\n        if (this.useHDR && !this.hdrSupported) {\n            logger.warn('HDR rendering requested but not supported by device. Falling back to LDR.');\n            this.useHDR = false;\n        }\n\n        // Prefer full float, fall back to half float\n        if (this.useHDR) {\n            if (this.floatColorBufferExt) {\n                this.hdrType = gl.FLOAT;\n                this.hdrTypeExt = this.floatTextureExt;\n                this.linearExt = this.floatLinearExt;\n                logger.info('Selected RGBA32F (full float) for HDR framebuffers');\n            } else if (this.halfFloatColorBufferExt) {\n                this.hdrType = this.halfFloatTextureExt.HALF_FLOAT_OES;\n                this.hdrTypeExt = this.halfFloatTextureExt;\n                this.linearExt = this.halfFloatLinearExt;\n                logger.info('Selected RGBA16F (half float) for HDR framebuffers');\n            }\n\n            if (!this.linearExt) {\n                logger.warn('Linear filtering not supported for float textures. Bloom quality may be affected.');\n            }\n        } else {\n            logger.verbose('Using LDR (RGBA8) framebuffers');\n        }\n    }\n\n    /**\n     * Initialize framebuffers and textures\n     */\n    initialize() {\n        const gl = this.gl;\n\n        logger.verbose(`Creating ${this.usePingPong ? 'ping-pong' : 'single'} framebuffers...`);\n\n        // Create two framebuffers for ping-pong rendering\n        if (this.usePingPong) {\n            this.framebuffers = [\n                gl.createFramebuffer(),\n                gl.createFramebuffer()\n            ];\n\n            this.textures = [\n                this.createTexture(),\n                this.createTexture()\n            ];\n\n            // Create shared depth buffer for both framebuffers\n            this.depthBuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n\n            // Attach textures and depth buffer to framebuffers\n            for (let i = 0; i < 2; i++) {\n                gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n                gl.framebufferTexture2D(\n                    gl.FRAMEBUFFER,\n                    gl.COLOR_ATTACHMENT0,\n                    gl.TEXTURE_2D,\n                    this.textures[i],\n                    0\n                );\n\n                // Attach depth buffer\n                gl.framebufferRenderbuffer(\n                    gl.FRAMEBUFFER,\n                    gl.DEPTH_ATTACHMENT,\n                    gl.RENDERBUFFER,\n                    this.depthBuffer\n                );\n\n                // Check framebuffer status\n                this.checkFramebufferStatus(i);\n            }\n\n            // Track current buffer index\n            this.currentIndex = 0;\n        } else {\n            // Single framebuffer\n            this.framebuffers = [gl.createFramebuffer()];\n            this.textures = [this.createTexture()];\n\n            // Create depth buffer\n            this.depthBuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[0]);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                this.textures[0],\n                0\n            );\n\n            // Attach depth buffer\n            gl.framebufferRenderbuffer(\n                gl.FRAMEBUFFER,\n                gl.DEPTH_ATTACHMENT,\n                gl.RENDERBUFFER,\n                this.depthBuffer\n            );\n\n            this.checkFramebufferStatus(0);\n            this.currentIndex = 0;\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Create a texture (HDR or LDR depending on configuration)\n     */\n    createTexture() {\n        const gl = this.gl;\n        const texture = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        // Use linear filtering if supported, otherwise nearest\n        const minFilter = (this.useHDR && this.linearExt) ? gl.LINEAR : gl.NEAREST;\n        const magFilter = (this.useHDR && this.linearExt) ? gl.LINEAR : gl.NEAREST;\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\n\n        // Allocate texture storage\n        if (this.useHDR) {\n            // HDR: use float or half-float texture\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA,\n                this.width,\n                this.height,\n                0,\n                gl.RGBA,\n                this.hdrType,\n                null\n            );\n        } else {\n            // LDR: use standard RGBA8 texture\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA,\n                this.width,\n                this.height,\n                0,\n                gl.RGBA,\n                gl.UNSIGNED_BYTE,\n                null\n            );\n        }\n\n        return texture;\n    }\n\n    /**\n     * Check framebuffer completeness\n     */\n    checkFramebufferStatus(index) {\n        const gl = this.gl;\n\n        // Check if WebGL context is lost\n        if (gl.isContextLost()) {\n            throw new Error('WebGL context lost');\n        }\n\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            const errorMsg = this.getFramebufferStatusString(status);\n            logger.error(`Framebuffer ${index} is not complete: ${errorMsg}`, {\n                format: this.getTextureFormatName(),\n                size: `${this.width}x${this.height}`,\n                status: status,\n                contextLost: gl.isContextLost()\n            });\n            throw new Error(`Framebuffer ${index} incomplete: ${errorMsg}`);\n        }\n\n        logger.verbose(`Framebuffer ${index} created successfully: ${this.getTextureFormatName()} at ${this.width}x${this.height}`);\n    }\n\n    /**\n     * Get human-readable framebuffer status string\n     */\n    getFramebufferStatusString(status) {\n        const gl = this.gl;\n        switch (status) {\n            case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n                return 'INCOMPLETE_ATTACHMENT';\n            case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n                return 'INCOMPLETE_MISSING_ATTACHMENT';\n            case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n                return 'INCOMPLETE_DIMENSIONS';\n            case gl.FRAMEBUFFER_UNSUPPORTED:\n                return 'UNSUPPORTED';\n            default:\n                return `UNKNOWN (${status})`;\n        }\n    }\n\n    /**\n     * Get human-readable texture format name\n     */\n    getTextureFormatName() {\n        if (!this.useHDR) return 'RGBA8 (LDR)';\n        if (this.hdrType === this.gl.FLOAT) return 'RGBA32F (Full HDR)';\n        return 'RGBA16F (Half HDR)';\n    }\n\n    /**\n     * Bind current framebuffer for rendering\n     */\n    bind() {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.currentIndex]);\n        gl.viewport(0, 0, this.width, this.height);\n    }\n\n    /**\n     * Bind to canvas (unbind framebuffer)\n     */\n    bindCanvas() {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Get current texture\n     */\n    getCurrentTexture() {\n        return this.textures[this.currentIndex];\n    }\n\n    /**\n     * Get previous texture (for ping-pong rendering)\n     */\n    getPreviousTexture() {\n        if (!this.usePingPong) return this.textures[0];\n        return this.textures[1 - this.currentIndex];\n    }\n\n    /**\n     * Swap ping-pong buffers\n     */\n    swap() {\n        if (this.usePingPong) {\n            this.currentIndex = 1 - this.currentIndex;\n        }\n    }\n\n    /**\n     * Clear current framebuffer\n     */\n    clear(r = 0, g = 0, b = 0, a = 1) {\n        const gl = this.gl;\n        this.bind();\n        gl.clearColor(r, g, b, a);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n\n    /**\n     * Clear all framebuffers (used for reset/resize)\n     */\n    clearAll(r = 0, g = 0, b = 0, a = 1) {\n        const gl = this.gl;\n        for (let i = 0; i < this.framebuffers.length; i++) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n            gl.clearColor(r, g, b, a);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Resize framebuffers\n     */\n    resize(width, height) {\n        if (width === this.width && height === this.height) return;\n\n        logger.info('Resizing HDR framebuffers', {\n            from: `${this.width}x${this.height}`,\n            to: `${width}x${height}`,\n            format: this.getTextureFormatName()\n        });\n\n        this.width = width;\n        this.height = height;\n\n        const gl = this.gl;\n\n        // Delete old textures\n        for (const texture of this.textures) {\n            gl.deleteTexture(texture);\n        }\n\n        // Delete old depth buffer\n        if (this.depthBuffer) {\n            gl.deleteRenderbuffer(this.depthBuffer);\n        }\n\n        // Recreate depth buffer with new size\n        this.depthBuffer = gl.createRenderbuffer();\n        gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\n\n        // Recreate textures\n        this.textures = [];\n        for (let i = 0; i < this.framebuffers.length; i++) {\n            this.textures.push(this.createTexture());\n\n            // Reattach to framebuffer\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                this.textures[i],\n                0\n            );\n\n            // Reattach depth buffer\n            gl.framebufferRenderbuffer(\n                gl.FRAMEBUFFER,\n                gl.DEPTH_ATTACHMENT,\n                gl.RENDERBUFFER,\n                this.depthBuffer\n            );\n\n            this.checkFramebufferStatus(i);\n        }\n\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        // Clear all buffers after resize\n        this.clearAll();\n    }\n\n    /**\n     * Dispose of all resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        for (const framebuffer of this.framebuffers) {\n            gl.deleteFramebuffer(framebuffer);\n        }\n\n        for (const texture of this.textures) {\n            gl.deleteTexture(texture);\n        }\n\n        this.framebuffers = [];\n        this.textures = [];\n\n        logger.verbose('FramebufferManager disposed');\n    }\n\n    /**\n     * Check if HDR is enabled and supported\n     */\n    isHDR() {\n        return this.useHDR && this.hdrSupported;\n    }\n\n    /**\n     * Get HDR support status\n     */\n    getHDRSupport() {\n        return {\n            supported: this.hdrSupported,\n            enabled: this.useHDR,\n            format: this.getTextureFormatName(),\n            hasFloatColorBuffer: !!this.floatColorBufferExt,\n            hasHalfFloatColorBuffer: !!this.halfFloatColorBufferExt,\n            hasLinearFiltering: !!this.linearExt\n        };\n    }\n}\n", "/**\n * Bloom Effect Manager\n * Manages framebuffers and rendering for HDR bloom effect\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * BloomManager class\n * Handles bloom extraction, blur, and composition\n */\nexport class BloomManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.enabled = config.enabled !== undefined ? config.enabled : true;\n        this.intensity = config.intensity !== undefined ? config.intensity : 0.5;\n        this.threshold = config.threshold !== undefined ? config.threshold : 1.0;\n        this.radius = config.radius !== undefined ? config.radius : 1.0;\n\n        // Use full resolution for bloom to avoid blocky artifacts\n        // Can be configured with quality setting\n        this.bloomScale = config.bloomScale !== undefined ? config.bloomScale : 1.0;\n        this.bloomWidth = Math.floor(width * this.bloomScale);\n        this.bloomHeight = Math.floor(height * this.bloomScale);\n\n        // Check for required extensions (reuse from framebuffer manager)\n        this.checkExtensions();\n\n        // Create bloom framebuffers\n        this.initialize();\n\n        logger.info('BloomManager initialized', {\n            bloomSize: `${this.bloomWidth}x${this.bloomHeight}`,\n            scale: this.bloomScale,\n            threshold: this.threshold,\n            intensity: this.intensity\n        });\n    }\n\n    /**\n     * Check for required WebGL extensions\n     */\n    checkExtensions() {\n        const gl = this.gl;\n\n        // Check for float texture support\n        this.floatTextureExt = gl.getExtension('OES_texture_float');\n        this.halfFloatTextureExt = gl.getExtension('OES_texture_half_float');\n\n        // Check for float color buffer\n        this.floatColorBufferExt = gl.getExtension('WEBGL_color_buffer_float') ||\n                                    gl.getExtension('EXT_color_buffer_float');\n        this.halfFloatColorBufferExt = gl.getExtension('EXT_color_buffer_half_float');\n\n        // Check for linear filtering\n        this.floatLinearExt = gl.getExtension('OES_texture_float_linear');\n        this.halfFloatLinearExt = gl.getExtension('OES_texture_half_float_linear');\n\n        // Check for float blending (needed for blending with float framebuffers)\n        this.floatBlendExt = gl.getExtension('EXT_float_blend');\n\n        // Determine HDR support\n        this.hdrSupported = !!(this.floatColorBufferExt || this.halfFloatColorBufferExt);\n\n        if (!this.hdrSupported) {\n            logger.warn('HDR not supported for bloom. Bloom effect will be disabled.');\n            this.enabled = false;\n            return;\n        }\n\n        // Prefer full float, fall back to half float\n        if (this.floatColorBufferExt) {\n            this.hdrType = gl.FLOAT;\n            this.linearExt = this.floatLinearExt;\n        } else if (this.halfFloatColorBufferExt) {\n            this.hdrType = this.halfFloatTextureExt.HALF_FLOAT_OES;\n            this.linearExt = this.halfFloatLinearExt;\n        }\n\n        if (!this.linearExt) {\n            logger.warn('Linear filtering not supported for bloom textures. Bloom quality may be reduced.');\n        }\n    }\n\n    /**\n     * Initialize bloom framebuffers\n     */\n    initialize() {\n        if (!this.enabled || !this.hdrSupported) return;\n\n        const gl = this.gl;\n\n        // Create two framebuffers for ping-pong blur passes\n        // FBO 0: Bright pass extraction target\n        // FBO 1: Horizontal blur target\n        // Then we ping-pong between them for blur passes\n        this.brightFBO = gl.createFramebuffer();\n        this.blurFBO1 = gl.createFramebuffer();\n        this.blurFBO2 = gl.createFramebuffer();\n\n        // Create textures\n        this.brightTexture = this.createTexture();\n        this.blurTexture1 = this.createTexture();\n        this.blurTexture2 = this.createTexture();\n\n        // Attach textures to framebuffers\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.brightFBO);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.brightTexture, 0);\n        this.checkFramebufferStatus('Bright extraction');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blurFBO1);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.blurTexture1, 0);\n        this.checkFramebufferStatus('Blur 1');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blurFBO2);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.blurTexture2, 0);\n        this.checkFramebufferStatus('Blur 2');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        logger.verbose('Bloom framebuffers initialized successfully');\n    }\n\n    /**\n     * Create a bloom texture (HDR float texture)\n     */\n    createTexture() {\n        const gl = this.gl;\n        const texture = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        // Use linear filtering for smooth bloom\n        const filter = this.linearExt ? gl.LINEAR : gl.NEAREST;\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n\n        // Allocate float texture\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            gl.RGBA,\n            this.bloomWidth,\n            this.bloomHeight,\n            0,\n            gl.RGBA,\n            this.hdrType,\n            null\n        );\n\n        return texture;\n    }\n\n    /**\n     * Check framebuffer completeness\n     */\n    checkFramebufferStatus(name) {\n        const gl = this.gl;\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error(`${name} framebuffer is not complete: ${status}`);\n            throw new Error(`${name} framebuffer incomplete`);\n        }\n\n        logger.verbose(`${name} framebuffer created successfully`);\n    }\n\n    /**\n     * Get bright extraction framebuffer\n     */\n    getBrightFBO() {\n        return this.brightFBO;\n    }\n\n    /**\n     * Get bright extraction texture\n     */\n    getBrightTexture() {\n        return this.brightTexture;\n    }\n\n    /**\n     * Get blur framebuffers\n     */\n    getBlurFBOs() {\n        return [this.blurFBO1, this.blurFBO2];\n    }\n\n    /**\n     * Get blur textures\n     */\n    getBlurTextures() {\n        return [this.blurTexture1, this.blurTexture2];\n    }\n\n    /**\n     * Get bloom dimensions\n     */\n    getBloomSize() {\n        return { width: this.bloomWidth, height: this.bloomHeight };\n    }\n\n    /**\n     * Update bloom parameters\n     */\n    updateConfig(config) {\n        if (config.enabled !== undefined) {\n            this.enabled = config.enabled;\n        }\n        if (config.intensity !== undefined) {\n            this.intensity = config.intensity;\n        }\n        if (config.threshold !== undefined) {\n            this.threshold = config.threshold;\n        }\n        if (config.radius !== undefined) {\n            this.radius = config.radius;\n        }\n    }\n\n    /**\n     * Resize bloom framebuffers\n     */\n    resize(width, height) {\n        if (!this.enabled || !this.hdrSupported) return;\n\n        const newBloomWidth = Math.floor(width * this.bloomScale);\n        const newBloomHeight = Math.floor(height * this.bloomScale);\n\n        if (newBloomWidth === this.bloomWidth && newBloomHeight === this.bloomHeight) return;\n\n        logger.info('Resizing bloom framebuffers', {\n            from: `${this.bloomWidth}x${this.bloomHeight}`,\n            to: `${newBloomWidth}x${newBloomHeight}`\n        });\n\n        this.width = width;\n        this.height = height;\n        this.bloomWidth = newBloomWidth;\n        this.bloomHeight = newBloomHeight;\n\n        // Delete old textures\n        const gl = this.gl;\n        gl.deleteTexture(this.brightTexture);\n        gl.deleteTexture(this.blurTexture1);\n        gl.deleteTexture(this.blurTexture2);\n\n        // Recreate textures\n        this.brightTexture = this.createTexture();\n        this.blurTexture1 = this.createTexture();\n        this.blurTexture2 = this.createTexture();\n\n        // Reattach to framebuffers\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.brightFBO);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.brightTexture, 0);\n        this.checkFramebufferStatus('Bright extraction (resized)');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blurFBO1);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.blurTexture1, 0);\n        this.checkFramebufferStatus('Blur 1 (resized)');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blurFBO2);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.blurTexture2, 0);\n        this.checkFramebufferStatus('Blur 2 (resized)');\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Dispose of all resources\n     */\n    dispose() {\n        if (!this.enabled || !this.hdrSupported) return;\n\n        const gl = this.gl;\n\n        gl.deleteFramebuffer(this.brightFBO);\n        gl.deleteFramebuffer(this.blurFBO1);\n        gl.deleteFramebuffer(this.blurFBO2);\n\n        gl.deleteTexture(this.brightTexture);\n        gl.deleteTexture(this.blurTexture1);\n        gl.deleteTexture(this.blurTexture2);\n\n        logger.verbose('BloomManager disposed');\n    }\n\n    /**\n     * Check if bloom is enabled and supported\n     */\n    isEnabled() {\n        return this.enabled && this.hdrSupported;\n    }\n}\n", "/**\n * Bilateral Filter Manager\n * Edge-preserving noise filter that smooths flat areas while preserving sharp edges\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { createProgram } from './shaders.js';\n\n/**\n * Generate Bilateral Filter Shader\n * Blurs based on both spatial distance AND intensity difference\n */\nfunction generateBilateralFilterShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform vec2 u_resolution;\nuniform float u_spatialSigma;   // Spatial blur radius\nuniform float u_intensitySigma; // Edge preservation threshold\n\nvarying vec2 v_uv;\n\n// Gaussian function\nfloat gaussian(float x, float sigma) {\n    return exp(-(x * x) / (2.0 * sigma * sigma));\n}\n\n// Luminance for edge detection\nfloat luminance(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvoid main() {\n    vec2 texelSize = 1.0 / u_resolution;\n\n    vec3 centerColor = texture2D(u_screen, v_uv).rgb;\n    float centerLum = luminance(centerColor);\n\n    // Single-pass noise detection using simple statistics\n    const float brightnessThreshold = 0.05;\n\n    // Sample 3x3 neighborhood (unrolled - no arrays)\n    float s0 = luminance(texture2D(u_screen, v_uv + vec2(-1.0, -1.0) * texelSize).rgb);\n    float s1 = luminance(texture2D(u_screen, v_uv + vec2( 0.0, -1.0) * texelSize).rgb);\n    float s2 = luminance(texture2D(u_screen, v_uv + vec2( 1.0, -1.0) * texelSize).rgb);\n    float s3 = luminance(texture2D(u_screen, v_uv + vec2(-1.0,  0.0) * texelSize).rgb);\n    float s4 = luminance(texture2D(u_screen, v_uv + vec2( 0.0,  0.0) * texelSize).rgb);\n    float s5 = luminance(texture2D(u_screen, v_uv + vec2( 1.0,  0.0) * texelSize).rgb);\n    float s6 = luminance(texture2D(u_screen, v_uv + vec2(-1.0,  1.0) * texelSize).rgb);\n    float s7 = luminance(texture2D(u_screen, v_uv + vec2( 0.0,  1.0) * texelSize).rgb);\n    float s8 = luminance(texture2D(u_screen, v_uv + vec2( 1.0,  1.0) * texelSize).rgb);\n\n    // Compute statistics\n    float sum = s0 + s1 + s2 + s3 + s4 + s5 + s6 + s7 + s8;\n    float sumSquares = s0*s0 + s1*s1 + s2*s2 + s3*s3 + s4*s4 + s5*s5 + s6*s6 + s7*s7 + s8*s8;\n\n    float brightCount = 0.0;\n    if (s0 > brightnessThreshold) brightCount += 1.0;\n    if (s1 > brightnessThreshold) brightCount += 1.0;\n    if (s2 > brightnessThreshold) brightCount += 1.0;\n    if (s3 > brightnessThreshold) brightCount += 1.0;\n    if (s4 > brightnessThreshold) brightCount += 1.0;\n    if (s5 > brightnessThreshold) brightCount += 1.0;\n    if (s6 > brightnessThreshold) brightCount += 1.0;\n    if (s7 > brightnessThreshold) brightCount += 1.0;\n    if (s8 > brightnessThreshold) brightCount += 1.0;\n\n    float mean = sum / 9.0;\n    float variance = (sumSquares / 9.0) - (mean * mean);\n\n    // Simple edge detection: check gradient magnitude\n    float gradX = abs(s5 - s3); // right - left\n    float gradY = abs(s7 - s1); // bottom - top\n    float gradient = gradX + gradY;\n\n    // Noise detection: sparse scattered particles\n    // If there's ANY variance in a dark region with low gradient, it's probably noise\n\n    bool isDarkAndSparse = (mean < 0.2) && (brightCount < 5.0);\n    bool hasNoEdges = (gradient < 0.15);\n\n    // Apply blur to dark sparse regions with no strong edges\n    bool shouldBlur = isDarkAndSparse && hasNoEdges;\n\n    if (!shouldBlur) {\n        // Structured region - pass through unchanged\n        gl_FragColor = vec4(centerColor, 1.0);\n        return;\n    }\n\n    // Sparse region - apply aggressive gaussian blur\n    vec3 colorSum = vec3(0.0);\n    float weightSum = 0.0;\n\n    // Larger kernel radius for stronger smoothing\n    const int radius = 5; // 11x11 kernel\n\n    for (int x = -radius; x <= radius; x++) {\n        for (int y = -radius; y <= radius; y++) {\n            vec2 offset = vec2(float(x), float(y)) * texelSize;\n            vec3 sampleColor = texture2D(u_screen, v_uv + offset).rgb;\n\n            // Only spatial weight (pure gaussian blur in sparse regions)\n            float spatialDist = length(vec2(float(x), float(y)));\n            float weight = gaussian(spatialDist, u_spatialSigma);\n\n            colorSum += sampleColor * weight;\n            weightSum += weight;\n        }\n    }\n\n    // Normalize\n    vec3 result = colorSum / weightSum;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n\n/**\n * BilateralFilterManager class\n * Single-pass edge-preserving blur\n */\nexport class BilateralFilterManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.enabled = config.enabled !== undefined ? config.enabled : false; // Disabled by default\n        this.spatialSigma = config.spatialSigma !== undefined ? config.spatialSigma : 4.0;\n        this.intensitySigma = config.intensitySigma !== undefined ? config.intensitySigma : 0.2;\n\n        // Framebuffer for filter output\n        this.framebuffer = null;\n        this.texture = null;\n\n        // Shader program\n        this.program = null;\n\n        // Vertex buffer (shared with renderer)\n        this.quadBuffer = null;\n\n        this.initialize();\n\n        logger.info('BilateralFilterManager initialized', {\n            size: `${width}x${height}`,\n            enabled: this.enabled,\n            spatialSigma: this.spatialSigma,\n            intensitySigma: this.intensitySigma\n        });\n    }\n\n    /**\n     * Initialize bilateral filter resources\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create framebuffer\n        this.createFramebuffer();\n\n        // Compile shader\n        this.compileShader();\n\n        // Create quad buffer if not provided\n        if (!this.quadBuffer) {\n            const quadVertices = new Float32Array([\n                0, 0,  1, 0,  0, 1,\n                0, 1,  1, 0,  1, 1\n            ]);\n            this.quadBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n        }\n    }\n\n    /**\n     * Create framebuffer for filter output\n     */\n    createFramebuffer() {\n        const gl = this.gl;\n\n        // Create texture (LDR format)\n        this.texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        // Create framebuffer\n        this.framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture, 0);\n\n        // Check framebuffer status\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Bilateral filter framebuffer incomplete', { status });\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Compile bilateral filter shader\n     */\n    compileShader() {\n        const gl = this.gl;\n\n        const vertexShaderSource = `\nattribute vec2 a_pos;\nvarying vec2 v_uv;\n\nvoid main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const fragmentShaderSource = generateBilateralFilterShader();\n\n        this.program = createProgram(gl, vertexShaderSource, fragmentShaderSource);\n\n        if (!this.program) {\n            logger.error('Failed to compile bilateral filter shader');\n        }\n    }\n\n    /**\n     * Apply bilateral filter\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @returns {WebGLTexture} - Filtered texture (or original if disabled)\n     */\n    apply(inputTexture) {\n        if (!this.enabled) {\n            // Pass through without filtering\n            return inputTexture;\n        }\n\n        const gl = this.gl;\n\n        // Bind framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n\n        // Use bilateral filter shader\n        gl.useProgram(this.program);\n\n        // Bind input texture\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.program, 'u_screen'), 0);\n\n        // Set uniforms\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_spatialSigma'), this.spatialSigma);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_intensitySigma'), this.intensitySigma);\n\n        // Bind quad buffer\n        const aPosLoc = gl.getAttribLocation(this.program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Draw fullscreen quad\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Unbind framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Return filtered texture\n        return this.texture;\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config) {\n        if (config.enabled !== undefined) {\n            this.enabled = config.enabled;\n        }\n        if (config.spatialSigma !== undefined) {\n            this.spatialSigma = config.spatialSigma;\n        }\n        if (config.intensitySigma !== undefined) {\n            this.intensitySigma = config.intensitySigma;\n        }\n    }\n\n    /**\n     * Check if bilateral filter is enabled\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n\n    /**\n     * Resize resources\n     */\n    resize(width, height) {\n        this.width = width;\n        this.height = height;\n\n        // Recreate framebuffer with new size\n        this.cleanup();\n        this.createFramebuffer();\n    }\n\n    /**\n     * Clean up WebGL resources\n     */\n    cleanup() {\n        const gl = this.gl;\n\n        if (this.framebuffer) {\n            gl.deleteFramebuffer(this.framebuffer);\n            this.framebuffer = null;\n        }\n\n        if (this.texture) {\n            gl.deleteTexture(this.texture);\n            this.texture = null;\n        }\n    }\n\n    /**\n     * Set quad buffer (share with renderer)\n     */\n    setQuadBuffer(buffer) {\n        this.quadBuffer = buffer;\n    }\n}\n", "/**\n * Math expression parser that converts user expressions to GLSL code\n * Supports standard math operations and functions\n */\n\n// Tokenizer\nconst TOKEN_TYPES = {\n    NUMBER: 'NUMBER',\n    VARIABLE: 'VARIABLE',\n    FUNCTION: 'FUNCTION',\n    OPERATOR: 'OPERATOR',\n    LPAREN: 'LPAREN',\n    RPAREN: 'RPAREN',\n    COMMA: 'COMMA',\n    EOF: 'EOF'\n};\n\nconst OPERATORS = {\n    '+': { precedence: 1, associativity: 'L' },\n    '-': { precedence: 1, associativity: 'L' },\n    '*': { precedence: 2, associativity: 'L' },\n    '/': { precedence: 2, associativity: 'L' },\n    '^': { precedence: 3, associativity: 'R' },\n    '%': { precedence: 2, associativity: 'L' }\n};\n\nconst BUILTIN_FUNCTIONS = new Set([\n    'sin', 'cos', 'tan', 'asin', 'acos', 'atan', 'atan2',\n    'sinh', 'cosh', 'tanh',\n    'exp', 'log', 'log2', 'sqrt', 'abs',\n    'floor', 'ceil', 'fract', 'sign',\n    'min', 'max', 'pow', 'mod',\n    'length', 'normalize', 'dot'\n]);\n\n// Custom function registry\n// Format: { functionName: { params: ['x', 'y', ...], body: 'expression' } }\nconst customFunctions = {};\n\nconst CONSTANTS = {\n    'pi': 'PI',\n    'e': 'E',\n    'PI': 'PI',\n    'E': 'E'\n};\n\n/**\n * Tokenize an expression string\n */\nfunction tokenize(expr) {\n    const tokens = [];\n    let i = 0;\n    let lastToken = null;\n\n    while (i < expr.length) {\n        let char = expr[i];\n\n        // Skip whitespace\n        if (/\\s/.test(char)) {\n            i++;\n            continue;\n        }\n\n        // Numbers\n        if (/\\d/.test(char) || (char === '.' && /\\d/.test(expr[i + 1]))) {\n            let num = '';\n            while (i < expr.length && /[\\d.]/.test(expr[i])) {\n                num += expr[i++];\n            }\n            const token = { type: TOKEN_TYPES.NUMBER, value: parseFloat(num) };\n            tokens.push(token);\n            lastToken = token;\n            continue;\n        }\n\n        // Variables, functions, and constants\n        if (/[a-zA-Z_]/.test(char)) {\n            let name = '';\n            while (i < expr.length && /[a-zA-Z_0-9]/.test(expr[i])) {\n                name += expr[i++];\n            }\n\n            let token;\n            if (BUILTIN_FUNCTIONS.has(name) || customFunctions.hasOwnProperty(name)) {\n                token = { type: TOKEN_TYPES.FUNCTION, value: name };\n            } else if (CONSTANTS.hasOwnProperty(name)) {\n                token = { type: TOKEN_TYPES.NUMBER, value: CONSTANTS[name], isConstant: true };\n            } else {\n                token = { type: TOKEN_TYPES.VARIABLE, value: name };\n            }\n            tokens.push(token);\n            lastToken = token;\n            continue;\n        }\n\n        // Operators (handle unary minus)\n        if (OPERATORS.hasOwnProperty(char)) {\n            // Check if this is a unary minus\n            if (char === '-' && (lastToken === null ||\n                lastToken.type === TOKEN_TYPES.OPERATOR ||\n                lastToken.type === TOKEN_TYPES.LPAREN ||\n                lastToken.type === TOKEN_TYPES.COMMA)) {\n                // Insert a 0 to make it binary: -x becomes 0-x\n                tokens.push({ type: TOKEN_TYPES.NUMBER, value: 0 });\n            }\n            const token = { type: TOKEN_TYPES.OPERATOR, value: char };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        // Parentheses\n        if (char === '(') {\n            const token = { type: TOKEN_TYPES.LPAREN };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n        if (char === ')') {\n            const token = { type: TOKEN_TYPES.RPAREN };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        // Comma\n        if (char === ',') {\n            const token = { type: TOKEN_TYPES.COMMA };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        throw new Error(`Unexpected character: ${char} at position ${i}`);\n    }\n\n    tokens.push({ type: TOKEN_TYPES.EOF });\n    return tokens;\n}\n\n/**\n * Parse tokens into an AST using Shunting Yard algorithm\n */\nfunction parse(tokens) {\n    const output = [];\n    const operators = [];\n    let i = 0;\n\n    const peek = () => tokens[i];\n    const consume = () => tokens[i++];\n\n    while (peek().type !== TOKEN_TYPES.EOF) {\n        const token = consume();\n\n        if (token.type === TOKEN_TYPES.NUMBER) {\n            output.push(token);\n        } else if (token.type === TOKEN_TYPES.VARIABLE) {\n            output.push(token);\n        } else if (token.type === TOKEN_TYPES.FUNCTION) {\n            operators.push(token);\n        } else if (token.type === TOKEN_TYPES.COMMA) {\n            while (operators.length > 0 && operators[operators.length - 1].type !== TOKEN_TYPES.LPAREN) {\n                output.push(operators.pop());\n            }\n        } else if (token.type === TOKEN_TYPES.OPERATOR) {\n            const o1 = token;\n            while (operators.length > 0) {\n                const o2 = operators[operators.length - 1];\n                if (o2.type === TOKEN_TYPES.OPERATOR) {\n                    const op1 = OPERATORS[o1.value];\n                    const op2 = OPERATORS[o2.value];\n                    if ((op1.associativity === 'L' && op1.precedence <= op2.precedence) ||\n                        (op1.associativity === 'R' && op1.precedence < op2.precedence)) {\n                        output.push(operators.pop());\n                    } else {\n                        break;\n                    }\n                } else {\n                    break;\n                }\n            }\n            operators.push(o1);\n        } else if (token.type === TOKEN_TYPES.LPAREN) {\n            operators.push(token);\n        } else if (token.type === TOKEN_TYPES.RPAREN) {\n            while (operators.length > 0 && operators[operators.length - 1].type !== TOKEN_TYPES.LPAREN) {\n                output.push(operators.pop());\n            }\n            if (operators.length === 0) {\n                throw new Error('Mismatched parentheses');\n            }\n            operators.pop(); // Remove the LPAREN\n\n            // If there's a function on top, pop it to output\n            if (operators.length > 0 && operators[operators.length - 1].type === TOKEN_TYPES.FUNCTION) {\n                output.push(operators.pop());\n            }\n        }\n    }\n\n    while (operators.length > 0) {\n        const op = operators.pop();\n        if (op.type === TOKEN_TYPES.LPAREN) {\n            throw new Error('Mismatched parentheses');\n        }\n        output.push(op);\n    }\n\n    return output;\n}\n\n/**\n * Convert RPN AST to JavaScript code\n */\nfunction toJS(rpn, variables) {\n    const stack = [];\n    const varSet = new Set(variables);\n\n    // Add velocity variables to allowed set\n    const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n    velocityVars.forEach(v => varSet.add(v));\n\n    // Add animation alpha variable\n    varSet.add('a');\n\n    for (const token of rpn) {\n        if (token.type === TOKEN_TYPES.NUMBER) {\n            if (token.isConstant) {\n                // Constants like PI, E\n                const constMap = { 'PI': 'Math.PI', 'E': 'Math.E' };\n                stack.push(constMap[token.value] || token.value.toString());\n            } else {\n                stack.push(token.value.toString());\n            }\n        } else if (token.type === TOKEN_TYPES.VARIABLE) {\n            if (varSet.has(token.value)) {\n                stack.push(token.value);\n            } else {\n                throw new Error(`Unknown variable: ${token.value}. Available: ${variables.join(', ')}, dx, dy, dz, dw, du, dv, a (animation alpha)`);\n            }\n        } else if (token.type === TOKEN_TYPES.OPERATOR) {\n            if (stack.length < 2) throw new Error('Invalid expression');\n            const b = stack.pop();\n            const a = stack.pop();\n\n            if (token.value === '^') {\n                stack.push(`Math.pow(${a}, ${b})`);\n            } else {\n                stack.push(`(${a} ${token.value} ${b})`);\n            }\n        } else if (token.type === TOKEN_TYPES.FUNCTION) {\n            const argCount = getFunctionArgCount(token.value);\n            if (stack.length < argCount) throw new Error(`Not enough arguments for ${token.value}`);\n\n            const args = [];\n            for (let i = 0; i < argCount; i++) {\n                args.unshift(stack.pop());\n            }\n\n            // Map GLSL functions to JS Math functions\n            const funcMap = {\n                'mod': '%',\n                'fract': '(x => x - Math.floor(x))',\n                'mix': '(a, b, t) => a * (1 - t) + b * t'\n            };\n\n            const funcName = funcMap[token.value] || `Math.${token.value}`;\n            stack.push(`${funcName}(${args.join(', ')})`);\n        }\n    }\n\n    if (stack.length !== 1) {\n        throw new Error('Invalid expression');\n    }\n\n    return stack[0];\n}\n\n/**\n * Convert RPN AST to GLSL code\n */\nfunction toGLSL(rpn, variables, useDirectMapping = false, posVarName = 'pos') {\n    const stack = [];\n    const varMap = {};\n\n    if (useDirectMapping) {\n        // Direct mapping for custom functions - variables map to themselves\n        variables.forEach(v => {\n            varMap[v] = v;\n        });\n    } else {\n        // Map variable names to swizzle notation (for vector fields)\n        const swizzles = ['x', 'y', 'z', 'w', 'u', 'v'];\n        const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n\n        // Map position variables (x, y, z, w, u, v) or custom variables (r, theta, etc.)\n        variables.forEach((v, i) => {\n            if (i < 6) {\n                varMap[v] = `${posVarName}.${swizzles[i]}`;\n            } else {\n                varMap[v] = `${posVarName}[${i}]`;\n            }\n        });\n\n        // Map velocity variables (dx, dy, dz, dw, du, dv)\n        velocityVars.forEach((v, i) => {\n            if (i < 6) {\n                varMap[v] = `velocity.${swizzles[i]}`;\n            } else {\n                varMap[v] = `velocity[${i}]`;\n            }\n        });\n\n        // Map animation alpha variable to uniform\n        varMap['a'] = 'u_alpha';\n    }\n\n    for (const token of rpn) {\n        if (token.type === TOKEN_TYPES.NUMBER) {\n            if (token.isConstant) {\n                // Constants like PI, E\n                const constMap = { 'PI': '3.14159265359', 'E': '2.71828182846' };\n                stack.push(constMap[token.value] || token.value.toString());\n            } else {\n                // Convert to GLSL float literal (ensure .0 suffix for integers)\n                let numStr = token.value.toString();\n                if (!numStr.includes('.') && !numStr.includes('e') && !numStr.includes('E')) {\n                    numStr += '.0';\n                }\n                stack.push(numStr);\n            }\n        } else if (token.type === TOKEN_TYPES.VARIABLE) {\n            if (varMap.hasOwnProperty(token.value)) {\n                stack.push(varMap[token.value]);\n            } else {\n                throw new Error(`Unknown variable: ${token.value}. Available: ${variables.join(', ')}`);\n            }\n        } else if (token.type === TOKEN_TYPES.OPERATOR) {\n            if (stack.length < 2) throw new Error('Invalid expression');\n            const b = stack.pop();\n            const a = stack.pop();\n\n            if (token.value === '^') {\n                // Optimize: expand small integer exponents instead of using pow()\n                const expMatch = b.match(/^(\\d+)\\.0$/);\n                if (expMatch) {\n                    const n = parseInt(expMatch[1]);\n                    if (n === 0) {\n                        stack.push('1.0');\n                    } else if (n === 1) {\n                        stack.push(a);\n                    } else if (n <= 4) {\n                        // Expand x^n as x*x*...\n                        stack.push(`(${Array(n).fill(a).join(' * ')})`);\n                    } else {\n                        stack.push(`pow(${a}, ${b})`);\n                    }\n                } else {\n                    stack.push(`pow(${a}, ${b})`);\n                }\n            } else if (token.value === '%') {\n                stack.push(`mod(${a}, ${b})`);\n            } else {\n                stack.push(`(${a} ${token.value} ${b})`);\n            }\n        } else if (token.type === TOKEN_TYPES.FUNCTION) {\n            const argCount = getFunctionArgCount(token.value);\n            if (stack.length < argCount) throw new Error(`Not enough arguments for ${token.value}`);\n\n            const args = [];\n            for (let i = 0; i < argCount; i++) {\n                args.unshift(stack.pop());\n            }\n\n            // Map function names to GLSL equivalents\n            let glslFunc = token.value;\n            if (token.value === 'atan2') {\n                // GLSL uses atan(y, x) instead of atan2(y, x)\n                glslFunc = 'atan';\n            }\n\n            stack.push(`${glslFunc}(${args.join(', ')})`);\n        }\n    }\n\n    if (stack.length !== 1) {\n        throw new Error('Invalid expression');\n    }\n\n    return stack[0];\n}\n\n/**\n * Get the number of arguments a function expects\n */\nfunction getFunctionArgCount(funcName) {\n    // Check custom functions first\n    if (customFunctions.hasOwnProperty(funcName)) {\n        return customFunctions[funcName].params.length;\n    }\n    // Check built-in functions\n    const multiArg = new Set(['min', 'max', 'pow', 'mod', 'dot', 'atan2']);\n    return multiArg.has(funcName) ? 2 : 1;\n}\n\n/**\n * Generate GLSL function declarations for all custom functions\n * @param {string[]} availableVars - Variables available in the current context\n * @returns {string} GLSL function declarations\n */\nfunction generateGLSLFunctionDeclarations(availableVars) {\n    let declarations = '';\n\n    for (const [funcName, func] of Object.entries(customFunctions)) {\n        // Parse the function body\n        const bodyTokens = tokenize(func.body);\n        const bodyRpn = parse(bodyTokens);\n\n        // Convert body to GLSL using function parameters as variables\n        // Use direct mapping so parameters are used as-is (not mapped to pos.x, etc.)\n        const bodyGLSL = toGLSL(bodyRpn, func.params, true);\n\n        // Generate GLSL function declaration\n        declarations += `float ${funcName}(`;\n        declarations += func.params.map(p => `float ${p}`).join(', ');\n        declarations += `) {\\n`;\n        declarations += `    return ${bodyGLSL};\\n`;\n        declarations += `}\\n\\n`;\n    }\n\n    return declarations;\n}\n\n/**\n * Main parser function\n * @param {string} expression - Math expression to parse\n * @param {number} dimensions - Number of dimensions\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @param {string} posVarName - Optional GLSL position variable name (default: 'pos')\n * @returns {string} GLSL code\n */\nexport function parseExpression(expression, dimensions, customVariables = null, posVarName = 'pos') {\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n\n    try {\n        const tokens = tokenize(expression);\n        const rpn = parse(tokens);\n        const glsl = toGLSL(rpn, variables, false, posVarName);\n        return glsl;\n    } catch (error) {\n        throw new Error(`Parse error: ${error.message}`);\n    }\n}\n\n/**\n * Get GLSL function declarations for custom functions\n * This should be prepended to shaders that use custom functions\n * @returns {string} GLSL function declarations\n */\nexport function getGLSLFunctionDeclarations() {\n    return generateGLSLFunctionDeclarations([]);\n}\n\n/**\n * Parse all dimension expressions\n * @param {string[]} expressions - Array of expressions, one per dimension\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @param {string} posVarName - Optional GLSL position variable name (default: 'pos')\n * @returns {string[]} Array of GLSL code strings\n */\nexport function parseVectorField(expressions, customVariables = null, posVarName = 'pos') {\n    const dimensions = expressions.length;\n    return expressions.map((expr, i) => {\n        try {\n            return parseExpression(expr.trim(), dimensions, customVariables, posVarName);\n        } catch (error) {\n            throw new Error(`Error in dimension ${i}: ${error.message}`);\n        }\n    });\n}\n\n/**\n * Create JavaScript velocity evaluator functions\n * @param {string[]} expressions - Array of expressions, one per dimension\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @returns {Function[]} Array of evaluator functions\n */\nexport function createVelocityEvaluators(expressions, customVariables = null) {\n    const dimensions = expressions.length;\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n\n    return expressions.map((expr, i) => {\n        try {\n            const tokens = tokenize(expr.trim());\n            const rpn = parse(tokens);\n            const jsCode = toJS(rpn, variables);\n\n            // Create a function that takes position components as arguments\n            // e.g., for 2D: (x, y) => expression\n            const funcBody = `return ${jsCode};`;\n            return new Function(...variables, funcBody);\n        } catch (error) {\n            throw new Error(`Error creating evaluator for dimension ${i}: ${error.message}`);\n        }\n    });\n}\n\n/**\n * Parse and register custom function definitions\n * @param {string} functionsText - Multi-line text with function definitions\n * Format: functionName(arg1, arg2, ...) = expression\n */\nexport function setCustomFunctions(functionsText) {\n    // Clear existing custom functions\n    for (const key in customFunctions) {\n        delete customFunctions[key];\n    }\n\n    if (!functionsText || !functionsText.trim()) {\n        return; // Empty input, just cleared functions\n    }\n\n    const lines = functionsText.split('\\n');\n\n    for (let lineNum = 0; lineNum < lines.length; lineNum++) {\n        const line = lines[lineNum].trim();\n\n        // Skip empty lines and comments\n        if (!line || line.startsWith('//') || line.startsWith('#')) {\n            continue;\n        }\n\n        // Parse function definition: functionName(arg1, arg2) = expression\n        const match = line.match(/^([a-zA-Z_][a-zA-Z_0-9]*)\\s*\\(([^)]*)\\)\\s*=\\s*(.+)$/);\n\n        if (!match) {\n            throw new Error(`Line ${lineNum + 1}: Invalid function definition syntax. Expected: functionName(arg1, arg2) = expression`);\n        }\n\n        const [, functionName, paramsStr, body] = match;\n\n        // Check if function name conflicts with built-in functions\n        if (BUILTIN_FUNCTIONS.has(functionName)) {\n            throw new Error(`Line ${lineNum + 1}: Cannot override built-in function '${functionName}'`);\n        }\n\n        // Check if function name conflicts with constants\n        if (CONSTANTS.hasOwnProperty(functionName)) {\n            throw new Error(`Line ${lineNum + 1}: Cannot use constant name '${functionName}' as function name`);\n        }\n\n        // Parse parameters\n        const params = paramsStr.split(',').map(p => p.trim()).filter(p => p);\n\n        // Validate parameters are valid identifiers\n        for (const param of params) {\n            if (!/^[a-zA-Z_][a-zA-Z_0-9]*$/.test(param)) {\n                throw new Error(`Line ${lineNum + 1}: Invalid parameter name '${param}'`);\n            }\n        }\n\n        // Validate the function body can be parsed\n        try {\n            const testTokens = tokenize(body);\n            parse(testTokens);\n        } catch (error) {\n            throw new Error(`Line ${lineNum + 1}: Error parsing function body: ${error.message}`);\n        }\n\n        // Store the function definition\n        customFunctions[functionName] = {\n            params: params,\n            body: body\n        };\n    }\n}\n\n/**\n * Get current custom function definitions\n * @returns {object} Custom functions registry\n */\nexport function getCustomFunctions() {\n    return { ...customFunctions };\n}\n", "/**\n * Shader templates and compilation utilities\n */\n\nimport { getGLSLFunctionDeclarations } from '../math/parser.js';\n\n/**\n * Compile a shader\n */\nexport function compileShader(gl, type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        const info = gl.getShaderInfoLog(shader);\n        gl.deleteShader(shader);\n        throw new Error(`Shader compilation error: ${info}\\n\\nSource:\\n${addLineNumbers(source)}`);\n    }\n\n    return shader;\n}\n\n/**\n * Link a shader program\n */\nexport function linkProgram(gl, vertexShader, fragmentShader) {\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        const info = gl.getProgramInfoLog(program);\n        gl.deleteProgram(program);\n        throw new Error(`Program linking error: ${info}`);\n    }\n\n    return program;\n}\n\n/**\n * Create a complete shader program\n */\nexport function createProgram(gl, vertexSource, fragmentSource) {\n    const vertexShader = compileShader(gl, gl.VERTEX_SHADER, vertexSource);\n    const fragmentShader = compileShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n    const program = linkProgram(gl, vertexShader, fragmentShader);\n\n    // Clean up shaders (they're now in the program)\n    gl.deleteShader(vertexShader);\n    gl.deleteShader(fragmentShader);\n\n    return program;\n}\n\n/**\n * Add line numbers to source for error reporting\n */\nfunction addLineNumbers(source) {\n    return source.split('\\n').map((line, i) => `${i + 1}: ${line}`).join('\\n');\n}\n\n/**\n * Generate position update vertex shader\n */\nexport function generateUpdateVertexShader() {\n    return `\nprecision highp float;\n\nattribute vec2 a_pos;\n\nvoid main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * Generate position update fragment shader\n * @param {number} dimensions - Number of dimensions\n * @param {string[]} velocityExpressions - GLSL expressions for velocity (one per dimension)\n * @param {string} integratorCode - Integration method code\n * @param {CoordinateStrategy} strategy - Coordinate storage strategy\n * @param {object} transformCode - Transform GLSL code {forward, inverse, jacobian}\n * @param {object} coordinateSystemCode - Coordinate system GLSL code {forwardTransform, velocityTransform}\n */\nexport function generateUpdateFragmentShader(dimensions, velocityExpressions, integratorCode, strategy, transformCode = null, coordinateSystemCode = null) {\n    // Generate uniforms for position textures\n    const positionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_pos_${i};`\n    ).join('\\n');\n\n    // Note: Age is stored in alpha channel of u_pos_0 texture\n\n    // Generate vector constructor from texture reads\n    const vecType = `vec${dimensions}`;\n    const readPositions = Array.from({ length: dimensions }, (_, i) =>\n        `decodeFloat(texture2D(u_pos_${i}, v_texcoord))`\n    ).join(', ');\n\n    // Generate velocity function\n    const swizzles = ['x', 'y', 'z', 'w'];\n    const velocityComponents = velocityExpressions.map((expr, i) =>\n        `    result.${swizzles[i]} = ${expr};`\n    ).join('\\n');\n\n    // Add coordinate system functions if provided\n    const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n    const coordinateSystemFunctions = hasCoordinateSystem ? `\n// Coordinate system transformation functions (native-space integration)\n${coordinateSystemCode.forwardTransform}\n${coordinateSystemCode.inverseTransform}\n// Note: velocityTransform not needed with native-space integration\n` : '';\n\n    // Add transform functions if provided\n    const hasTransform = transformCode && transformCode.forward;\n    const transformFunctions = hasTransform ? `\n// Domain transformation functions\n${transformCode.helpers || ''}\n${transformCode.forward}\n${transformCode.inverse}\n${transformCode.jacobian}\n` : '';\n\n    // Modify velocity function to include coordinate system and/or domain transform\n    // Priority: Coordinate system wraps the velocity definition, domain transform wraps integration\n    const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates (${coordinateSystemCode.name || 'custom'})\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n    // Extract native coordinates for use in expressions\n    float ${coordinateSystemCode.nativeVars ? coordinateSystemCode.nativeVars.map((v, i) => `${v} = pos_native.${swizzles[i]}`).join(', ') : swizzles.slice(0, dimensions).map((s, i) => `${s} = pos_native.${s}`).join(', ')};\n${velocityComponents}\n    return result;\n}\n\n// Velocity function in Cartesian (redirects to native, for use by integrator)\n${vecType} get_velocity(${vecType} pos_native) {\n    return get_velocity_native(pos_native);\n}\n` : hasTransform ? `\n// Original velocity field in world coordinates\n${vecType} get_velocity_original(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n\n// Transformed velocity field: dy/dt = J_T(x) * f(x)\n// where y = T(x)\n${vecType} get_velocity(${vecType} pos_transformed) {\n    // Transform back to world coordinates\n    ${vecType} pos = transform_inverse(pos_transformed);\n\n    // Evaluate original velocity field\n    ${vecType} vel_original = get_velocity_original(pos);\n\n    // Apply Jacobian: component-wise multiplication\n    ${vecType} jacobian = transform_jacobian(pos);\n    return vel_original * jacobian;\n}\n` : `\n// User-defined velocity field (no transform)\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${strategy.getGLSLConstants()}\n${strategy.getGLSLDecodeFunction()}\n${strategy.getGLSLEncodeFunction()}\n${strategy.getGLSLNormalizeFunction()}\n${strategy.getGLSLDenormalizeFunction()}\n\n${customFunctions}\n\n${positionUniforms}\n\nuniform vec2 u_min;\nuniform vec2 u_max;\nuniform float u_h;\nuniform float u_rand_seed;\nuniform float u_drop_rate;\nuniform int u_out_coordinate;\nuniform float u_particles_res;\nuniform float u_max_velocity;\nuniform float u_drop_low_velocity;\nuniform float u_velocity_threshold;\nuniform float u_alpha;\n${hasTransform ? 'uniform vec4 u_transform_params;' : ''}\n\n${coordinateSystemFunctions}\n\n${transformFunctions}\n\n${velocityFunction}\n\n${integratorCode}\n\n// High-quality hash-based random number generator\n// Returns value in [0, 1] with good distribution\nfloat rand(vec2 co) {\n    // Hash the input\n    vec2 p = co + vec2(u_rand_seed, u_rand_seed * 1.61803398875);\n    // Use a better hash function\n    p = fract(p * vec2(443.897, 441.423));\n    p += dot(p.yx, p.xy + vec2(19.19, 17.17));\n    return fract(p.x * p.y);\n}\n\n// Secondary independent random function\nfloat rand2(vec2 co) {\n    vec2 p = co + vec2(u_rand_seed * 2.71828, u_rand_seed * 3.14159);\n    p = fract(p * vec2(269.5, 271.3));\n    p += dot(p.yx, p.xy + vec2(23.23, 29.29));\n    return fract(p.x * p.y);\n}\n\nvoid main() {\n    vec2 texcoord = gl_FragCoord.xy / u_particles_res;\n\n    // Read current age from alpha channel of u_pos_0\n    float current_age = texture2D(u_pos_0, texcoord).a;\n\n    // Read current position from textures\n    // Positions are stored as normalized [0,1] values, denormalize to world coords\n    ${vecType} pos;\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            // Higher dimensions use fixed range [-10, 10]\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n\n    // Integrate to get new position\n    ${vecType} new_pos;\n    ${hasCoordinateSystem ? `\n    // NATIVE-SPACE INTEGRATION:\n    // 1. Transform position to native coordinates\n    // 2. Integrate in native space (using velocity defined in native coords)\n    // 3. Transform result back to Cartesian\n    ${vecType} pos_native = transformToNative(pos);\n    ${vecType} new_pos_native = integrate(pos_native, u_h);\n    new_pos = transformToCartesian(new_pos_native);\n    ` : hasTransform ? `\n    // Transform to y-space, integrate, then transform back to x-space\n    ${vecType} pos_transformed = transform_forward(pos);\n    ${vecType} new_pos_transformed = integrate(pos_transformed, u_h);\n    new_pos = transform_inverse(new_pos_transformed);\n    ` : `\n    // Direct integration (no transform)\n    new_pos = integrate(pos, u_h);\n    `}\n\n    // Calculate velocity at new position for low-velocity dropping\n    ${vecType} velocity = ${hasTransform ? 'get_velocity_original(new_pos)' : 'get_velocity(new_pos)'};\n    float speed = length(velocity);\n\n    // Check if particle is outside viewport bounds with small margin\n    // Use 20% margin to allow particles to flow slightly off-screen before respawning\n    float width = u_max.x - u_min.x;\n    float height = u_max.y - u_min.y;\n    bool outside = new_pos.x < (u_min.x - width * 0.2) || new_pos.x > (u_max.x + width * 0.2) ||\n                   new_pos.y < (u_min.y - height * 0.2) || new_pos.y > (u_max.y + height * 0.2);\n\n    // Check if particle is too slow (if drop_low_velocity is enabled)\n    bool too_slow = u_drop_low_velocity > 0.5 && speed < (u_max_velocity * u_velocity_threshold);\n\n    // Random drop: reset particle to random position with small probability\n    // Also reset if particle exits the viewport or is too slow\n    float drop_chance = rand(texcoord);\n    bool should_respawn = drop_chance < u_drop_rate || outside || too_slow;\n    if (should_respawn) {\n        // Spawn particles 2% OUTSIDE viewport for natural flow-in effect (negative margin)\n        // Use texcoord + rand_seed for truly independent random values per particle per frame\n        const float margin = -0.02;\n        ${dimensions === 2 ? `new_pos.x = u_min.x + width * margin + rand(texcoord * 1.234 + vec2(u_rand_seed)) * width * (1.0 - 2.0 * margin);\n        new_pos.y = u_min.y + height * margin + rand2(texcoord * 5.678 + vec2(u_rand_seed * 2.345)) * height * (1.0 - 2.0 * margin);` :\n        Array.from({ length: dimensions }, (_, i) => {\n            const coords = ['x', 'y', 'z', 'w'];\n            if (i === 0) return `new_pos.x = u_min.x + width * margin + rand(texcoord * 1.234 + vec2(u_rand_seed)) * width * (1.0 - 2.0 * margin);`;\n            if (i === 1) return `new_pos.y = u_min.y + height * margin + rand2(texcoord * 5.678 + vec2(u_rand_seed * 2.345)) * height * (1.0 - 2.0 * margin);`;\n            // For higher dimensions, use varied seeds for better distribution\n            return `new_pos.${coords[i]} = -10.4 + rand(texcoord * ${i + 1}.37 + vec2(u_rand_seed * ${i + 3}.5)) * 20.8;`;\n        }).join('\\n        ')}\n    }\n\n    // Calculate new age (based on all spawn conditions)\n    float new_age;\n    if (should_respawn) {\n        new_age = 0.0; // Reset age for newly spawned particles\n    } else {\n        new_age = min(current_age + 0.5, 1.0); // Increment age, cap at 1.0\n    }\n\n    // Output the selected coordinate\n    // Normalize world coords back to [0, 1] before encoding\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        let normalizeExpr;\n        if (i === 0) {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, u_min.x, u_max.x)`;\n        } else if (i === 1) {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, u_min.y, u_max.y)`;\n        } else {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, -10.0, 10.0)`;\n        }\n\n        if (i === 0) {\n            return `if (u_out_coordinate == ${i}) {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n        gl_FragColor.a = new_age; // Store age in alpha channel\n    }`;\n        } else if (i === dimensions - 1) {\n            return ` else {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n    }`;\n        } else {\n            return ` else if (u_out_coordinate == ${i}) {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n    }`;\n        }\n    }).join('')}\n}\n`;\n}\n\n/**\n * Generate particle rendering vertex shader\n */\nexport function generateDrawVertexShader(dimensions, mapperCode, velocityExpressions, strategy, lineMode = false, coordinateSystemCode = null) {\n    const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n\n    const positionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_pos_${i};`\n    ).join('\\n');\n\n    // Previous position uniforms (always included)\n    const prevPositionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_prev_pos_${i};`\n    ).join('\\n');\n\n    const vecType = `vec${dimensions}`;\n\n    // Generate velocity function\n    const swizzles = ['x', 'y', 'z', 'w'];\n    const velocityComponents = velocityExpressions.map((expr, i) =>\n        `    result.${swizzles[i]} = ${expr};`\n    ).join('\\n');\n\n    // Add coordinate system functions if provided (hasCoordinateSystem already declared at function start)\n    const coordinateSystemFunctions = hasCoordinateSystem ? `\n// Coordinate system transformation functions\n${coordinateSystemCode.forwardTransform}\n${coordinateSystemCode.inverseTransform}\n// Note: inverseTransform needed for computing Cartesian velocity via finite differences\n` : '';\n\n    // Velocity function with coordinate system support\n    const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n${velocityComponents}\n    return result;\n}\n\n// Velocity field for visualization (no Cartesian transform needed with native-space integration)\n${vecType} get_velocity(${vecType} pos_cartesian) {\n    ${vecType} pos_native = transformToNative(pos_cartesian);\n    return get_velocity_native(pos_native);\n}\n` : `\n// User-defined velocity field\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${strategy.getGLSLConstants()}\n${strategy.getGLSLDecodeFunction()}\n${strategy.getGLSLDenormalizeFunction()}\n\n${customFunctions}\n\nattribute float a_index;\n${lineMode ? 'attribute float a_vertex_id; // 0 = prev, 1 = current' : ''}\n\n${positionUniforms}\n${prevPositionUniforms}\n\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\nuniform float u_alpha;\nuniform float u_particle_size;\nuniform vec2 u_viewport_size;  // Actual render resolution (renderWidth, renderHeight)\nuniform vec2 u_canvas_size;    // Canvas resolution (canvas.width, canvas.height)\n\nvarying vec${dimensions} v_pos;\nvarying vec${dimensions} v_velocity;          // Full N-dimensional velocity (for expression mode)\nvarying vec${dimensions} v_velocity_projected; // Projected 2D velocity (for angle-based color modes)\n\n${mapperCode}\n\n${coordinateSystemFunctions}\n\n${velocityFunction}\n\nvoid main() {\n    ${lineMode ? `\n    // Line mode: index buffer has [0,0,1,1,2,2,3,3,...], vertex ID buffer has [0,1,0,1,0,1,...]\n    // a_vertex_id = 0 means previous position, 1 means current position\n    float particle_index = a_index;\n    bool is_current = a_vertex_id > 0.5;\n    ` : `\n    // Point mode: one vertex per particle\n    float particle_index = a_index;\n    `}\n\n    // Calculate texture coordinate from particle index\n    // Add 0.5 to sample from texel centers\n    vec2 texcoord = vec2(\n        (mod(particle_index, u_particles_res) + 0.5) / u_particles_res,\n        (floor(particle_index / u_particles_res) + 0.5) / u_particles_res\n    );\n\n    // Read age from alpha channel of u_pos_0\n    float age = texture2D(u_pos_0, texcoord).a;\n\n    // Read position from textures and denormalize to world coordinates\n    ${vecType} pos;\n    ${lineMode ? `\n    if (is_current) {\n        // Current position\n        ${Array.from({ length: dimensions }, (_, i) => {\n            const coord = ['x', 'y', 'z', 'w'][i];\n            if (i === 0) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n            } else if (i === 1) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n            } else {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n            }\n        }).join('\\n        ')}\n    } else {\n        // Previous position\n        ${Array.from({ length: dimensions }, (_, i) => {\n            const coord = ['x', 'y', 'z', 'w'][i];\n            if (i === 0) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n            } else if (i === 1) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n            } else {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), -10.0, 10.0);`;\n            }\n        }).join('\\n        ')}\n    }\n    ` : `\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n    `}\n\n    // Calculate velocity for coloring\n    ${vecType} velocity;\n    ${hasCoordinateSystem ? `\n    // For coordinate systems: compute Cartesian velocity from position difference\n    // Read previous position (already in Cartesian space from update shader)\n    ${vecType} prev_pos;\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n\n    // Cartesian velocity from finite difference\n    velocity = pos - prev_pos;\n    ` : `\n    // For Cartesian systems: compute velocity directly\n    velocity = get_velocity(pos);\n    `}\n\n    // Pass N-dimensional position and full velocity to fragment shader\n    v_pos = pos;\n    v_velocity = velocity; // Full N-dimensional velocity for expression mode\n\n    // Skip newly spawned particles (age < 1) by moving them off-screen\n    if (age < 1.0) {\n        gl_Position = vec4(10.0, 10.0, 10.0, 1.0); // Far outside clip space\n        gl_PointSize = 0.0;\n        v_velocity_projected = velocity; // Won't be used since particle is off-screen\n    } else {\n        // Project position to 3D (with depth)\n        vec3 pos_3d = project_to_3d(pos);\n\n        // Project velocity to 2D (using same mapper)\n        // For linear projections, this is correct for tangent vectors\n        vec2 velocity_2d = project_to_2d(velocity);\n\n        // Create 2D velocity vector (pad to match dimensions for varying)\n        ${vecType} velocity_projected;\n        velocity_projected.x = velocity_2d.x;\n        velocity_projected.y = velocity_2d.y;\n        ${dimensions > 2 ? 'velocity_projected.z = 0.0;' : ''}\n        ${dimensions > 3 ? 'velocity_projected.w = 0.0;' : ''}\n\n        // Pass projected 2D velocity to fragment shader (for angle-based color modes)\n        v_velocity_projected = velocity_projected;\n\n        // Map to screen space\n        vec2 normalized = (pos_3d.xy - u_min) / (u_max - u_min);\n\n        // Use depth value (normalized to [-1, 1] range)\n        // For now, assume depth is in similar range to x/y coordinates\n        float depth_normalized = (pos_3d.z - (u_min.x + u_min.y) * 0.5) / ((u_max.x - u_min.x + u_max.y - u_min.y) * 0.5);\n        depth_normalized = clamp(depth_normalized, -1.0, 1.0);\n\n        gl_Position = vec4(normalized * 2.0 - 1.0, depth_normalized, 1.0);\n\n        // Scale particle size by render scale to maintain consistent visual size\n        // Calculate render scale as viewport size / canvas size\n        float render_scale = u_viewport_size.x / u_canvas_size.x;\n        gl_PointSize = u_particle_size * render_scale;\n    }\n}\n`;\n}\n\n/**\n * Generate particle rendering fragment shader\n */\nexport function generateDrawFragmentShader(dimensions, colorCode, usesMaxVelocity) {\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${customFunctions}\n\nvarying vec${dimensions} v_pos;\nvarying vec${dimensions} v_velocity;          // Full N-dimensional velocity (for expression mode)\nvarying vec${dimensions} v_velocity_projected; // Projected 2D velocity (for angle-based color modes)\n\n${usesMaxVelocity ? 'uniform float u_max_velocity;\\nuniform float u_velocity_log_scale;' : ''}\nuniform float u_particle_intensity;\nuniform float u_color_saturation;\nuniform float u_alpha;\nuniform vec2 u_viewport_size;  // Actual render resolution\nuniform vec2 u_canvas_size;    // Canvas resolution\n\n${colorCode}\n\nvoid main() {\n    // Get color based on position and velocity\n    vec3 color = getColor(v_pos, v_velocity, v_velocity_projected);\n\n    // Apply saturation adjustment (for attractor visualization)\n    // 0.0 = grayscale, 1.0 = full saturation\n    if (u_color_saturation < 1.0) {\n        float luminance = dot(color, vec3(0.2126, 0.7152, 0.0722));\n        vec3 grayscale = vec3(luminance);\n        color = mix(grayscale, color, u_color_saturation);\n    }\n\n    // Scale by intensity for HDR (allows colors > 1.0)\n    color *= u_particle_intensity;\n\n    // Calculate render scale factor\n    float render_scale = u_viewport_size.x / u_canvas_size.x;\n\n    // Compensate alpha for particle size scaling to maintain constant brightness\n    // Particle area scales with render_scale\u00B2, so divide alpha by render_scale\u00B2\n    // This ensures that larger particles contribute the same total brightness\n    float area_compensation = 1.0 / (render_scale * render_scale);\n    float adjusted_alpha = 0.35 * area_compensation;\n\n    // Alpha blending allows proper fade to black\n    gl_FragColor = vec4(color, adjusted_alpha);\n}\n`;\n}\n\n/**\n * Generate screen fade/composite vertex shader\n */\nexport function generateScreenVertexShader() {\n    return `\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\n\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * Generate screen fade fragment shader\n */\nexport function generateScreenFadeFragmentShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform float u_fade;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    vec4 color = texture2D(u_screen, v_texcoord);\n    vec3 faded = color.rgb * u_fade;\n\n    // Snap to black if very dark (prevents floating point precision issues)\n    // This ensures trails fade completely to black\n    float brightness = max(max(faded.r, faded.g), faded.b);\n    if (brightness < 0.003) {\n        faded = vec3(0.0);\n    }\n\n    gl_FragColor = vec4(faded, 1.0);\n}\n`;\n}\n\n/**\n * Generate screen copy fragment shader\n */\nexport function generateScreenCopyFragmentShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_FragColor = texture2D(u_screen, v_texcoord);\n}\n`;\n}\n\n/**\n * Generate tone mapping fragment shader\n * @param {string} tonemapCode - GLSL code for tone mapping operator (from tonemapping.js)\n */\nexport function generateTonemapFragmentShader(tonemapCode = '') {\n    // Default to simple exposure + gamma if no operator provided\n    if (!tonemapCode) {\n        tonemapCode = `\nvec3 tonemap(vec3 color) {\n    return color * u_exposure;\n}\n\nvec3 applyGamma(vec3 color) {\n    return pow(color, vec3(1.0 / u_gamma));\n}\n`;\n    }\n\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform sampler2D u_bloom;\nuniform float u_bloom_intensity;\nuniform float u_bloom_alpha;\nuniform bool u_bloom_enabled;\nuniform float u_exposure;\nuniform float u_gamma;\nuniform float u_whitePoint;\nuniform float u_brightness_desat;\nuniform float u_brightness_sat;\nuniform float u_hdr_max_brightness;\nuniform float u_hdr_avg_brightness;\nuniform float u_highlight_compression;\nuniform float u_compression_threshold;\n\nvarying vec2 v_texcoord;\n\n// Logarithmic highlight compression (pre-tone mapping)\n// Only compresses values above threshold to help tone mapper cover full dynamic range\n// Preserves hue by compressing luminance only, then scaling RGB to match\nvec3 compressHighlights(vec3 color, float strength, float threshold) {\n    if (strength < 0.0001) return color; // Disabled\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return color;\n\n    // Compress luminance only\n    float compressedLuma;\n    if (luma <= threshold) {\n        compressedLuma = luma; // Below threshold: unchanged\n    } else {\n        // Above threshold: compress the excess\n        float excess = luma - threshold;\n        float compressed = log(1.0 + excess * strength) / strength;\n        compressedLuma = threshold + compressed;\n    }\n\n    // Scale RGB to match compressed luminance (preserves hue and saturation)\n    return color * (compressedLuma / luma);\n}\n\n${tonemapCode}\n\nvoid main() {\n    // Read HDR color from framebuffer\n    vec3 hdrColor = texture2D(u_screen, v_texcoord).rgb;\n\n    // Blend bloom if enabled (before tone mapping)\n    if (u_bloom_enabled) {\n        vec3 bloomColor = texture2D(u_bloom, v_texcoord).rgb * u_bloom_intensity;\n        // Alpha blend: mix base color with bloom using alpha\n        hdrColor = mix(hdrColor, hdrColor + bloomColor, u_bloom_alpha);\n    }\n\n    // Calculate HDR brightness once for both effects (Rec. 709 luminance)\n    float hdrBrightness = dot(hdrColor, vec3(0.2126, 0.7152, 0.0722));\n    vec3 hdrGray = vec3(hdrBrightness);\n\n    // Get adaptive thresholds based on actual HDR buffer statistics\n    float avgBrightness = max(u_hdr_avg_brightness, 0.1); // Avoid division by zero\n    float maxBrightness = max(u_hdr_max_brightness, 1.0);\n\n    // Work in log space to handle the massive dynamic range (0.1 to 100,000+)\n    float logAvg = log2(avgBrightness + 1.0);\n    float logMax = log2(maxBrightness + 1.0);\n    float logBrightness = log2(hdrBrightness + 1.0);\n\n    // Apply brightness-based DESATURATION (desaturates BRIGHT regions)\n    // Prevents oversaturation and RGB clipping in dense accumulations\n    if (u_brightness_desat > 0.0) {\n        // Target brighter-than-average regions (where particles accumulate)\n        // Start desaturating at 2x average, full desat at 100x average\n        // This hits the actual bright accumulations, not just the max peaks\n        float brightStart = avgBrightness * 2.0;\n        float brightEnd = avgBrightness * 100.0;\n        float logBrightStart = log2(brightStart + 1.0);\n        float logBrightEnd = log2(brightEnd + 1.0);\n        float desatFactor = smoothstep(logBrightStart, logBrightEnd, logBrightness) * u_brightness_desat;\n\n        // Blend toward grayscale\n        hdrColor = mix(hdrColor, hdrGray, desatFactor);\n    }\n\n    // Apply brightness-based SATURATION BUILDUP (desaturates DIM regions)\n    // Creates effect where sparse particles are washed out, dense accumulations pop with color\n    if (u_brightness_sat > 0.0) {\n        // Slider controls the threshold: higher values = more aggressive desaturation\n        // - At 0.3: pixels below ~1000x average are desaturated\n        // - At 0.5: pixels below ~4000x average are desaturated\n        // - At 1.0: pixels below ~137,000 (max) are desaturated (very aggressive)\n        float threshold = avgBrightness * pow(10.0, u_brightness_sat * 3.0); // 1x to 1000x average\n        float logThreshold = log2(threshold + 1.0);\n\n        // Narrow transition for sharp cutoff\n        float logTransitionStart = log2(avgBrightness * 0.1 + 1.0); // 10% of average\n        float satFactor = smoothstep(logTransitionStart, logThreshold, logBrightness);\n\n        // Apply the effect: low brightness gets desaturated AND dimmed\n        float desatAmount = (1.0 - satFactor) * u_brightness_sat;\n        hdrColor = mix(hdrColor, hdrGray, desatAmount);\n\n        // Also reduce brightness in desaturated regions\n        // This makes sparse trails even more subtle (both dim and colorless)\n        hdrColor *= (1.0 - desatAmount * 0.5); // Reduce brightness by up to 50%\n    }\n\n    // Apply gamma correction in HDR space (before tone mapping)\n    // This prevents clipping and gives the tone mapper more headroom\n    vec3 gammaCorrected = applyGamma(hdrColor);\n\n    // Apply luminance gamma in HDR space (hue-preserving brightness adjustment)\n    vec3 hdrGammaCorrected = applyLuminanceGamma(gammaCorrected);\n\n    // Apply highlight compression to compress bright values before tone mapping\n    // This helps the tone mapper cover the full dynamic range more effectively\n    vec3 compressed = compressHighlights(hdrGammaCorrected, u_highlight_compression, u_compression_threshold);\n\n    // Apply tone mapping operator to compress HDR values into LDR range\n    vec3 ldrColor = tonemap(compressed);\n\n    gl_FragColor = vec4(ldrColor, 1.0);\n}\n`;\n}\n\n/**\n * Generate bloom bright pass fragment shader\n * Extracts pixels above threshold for bloom layer\n */\nexport function generateBloomBrightPassShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform float u_threshold;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    vec3 color = texture2D(u_screen, v_texcoord).rgb;\n\n    // Calculate luminance\n    float brightness = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Extract bright regions above threshold\n    // Use smooth step for soft transition\n    float contribution = smoothstep(u_threshold * 0.8, u_threshold * 1.2, brightness);\n\n    // Output bright pixels only\n    gl_FragColor = vec4(color * contribution, 1.0);\n}\n`;\n}\n\n/**\n * Generate bloom blur fragment shader\n * Two-pass separable Gaussian blur with bilinear optimization\n * @param {boolean} horizontal - True for horizontal pass, false for vertical\n * @param {number} radius - Blur radius (1.0 = standard, higher = wider blur)\n */\nexport function generateBloomBlurShader(horizontal = true, radius = 1.0) {\n    const direction = horizontal ? 'vec2(1.0, 0.0)' : 'vec2(0.0, 1.0)';\n\n    return `\nprecision highp float;\n\nuniform sampler2D u_texture;\nuniform vec2 u_texel_size;\nuniform float u_radius;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    vec2 direction = ${direction};\n    vec3 result = vec3(0.0);\n\n    // Bilinear-optimized 13-tap Gaussian blur\n    // Uses hardware linear filtering to sample between pixels for smoother results\n    // This reduces the blocky appearance by effectively sampling at sub-pixel positions\n\n    vec2 off1 = vec2(1.3846153846) * direction * u_texel_size * u_radius;\n    vec2 off2 = vec2(3.2307692308) * direction * u_texel_size * u_radius;\n    vec2 off3 = vec2(5.0769230769) * direction * u_texel_size * u_radius;\n\n    result += texture2D(u_texture, v_texcoord).rgb * 0.2270270270;\n    result += texture2D(u_texture, v_texcoord + off1).rgb * 0.3162162162;\n    result += texture2D(u_texture, v_texcoord - off1).rgb * 0.3162162162;\n    result += texture2D(u_texture, v_texcoord + off2).rgb * 0.0702702703;\n    result += texture2D(u_texture, v_texcoord - off2).rgb * 0.0702702703;\n    result += texture2D(u_texture, v_texcoord + off3).rgb * 0.0162162162;\n    result += texture2D(u_texture, v_texcoord - off3).rgb * 0.0162162162;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n\n/**\n * Generate bloom combine fragment shader\n * Combines base HDR with bloom layer\n */\nexport function generateBloomCombineShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_base;\nuniform sampler2D u_bloom;\nuniform float u_bloom_intensity;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    vec3 baseColor = texture2D(u_base, v_texcoord).rgb;\n    vec3 bloomColor = texture2D(u_bloom, v_texcoord).rgb;\n\n    // Add bloom to base with intensity control\n    vec3 result = baseColor + bloomColor * u_bloom_intensity;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n", "/**\n * SMAA (Subpixel Morphological Anti-Aliasing) Manager\n * Better edge preservation than FXAA - uses pattern recognition\n * Simplified implementation without precomputed area/search textures\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { createProgram } from './shaders.js';\n\n/**\n * SMAA Edge Detection Shader\n * Detects edges using luminance differences\n */\nfunction generateSMAAEdgeDetectionShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform vec2 u_resolution;\nuniform float u_threshold;\n\nvarying vec2 v_uv;\n\nfloat luminance(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    // Sample center\n    vec3 center = texture2D(u_screen, v_uv).rgb;\n    float lumC = luminance(center);\n\n    // Sample neighbors\n    float lumL = luminance(texture2D(u_screen, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).rgb);\n    float lumR = luminance(texture2D(u_screen, v_uv + vec2(1.0, 0.0) * inverseScreenSize).rgb);\n    float lumT = luminance(texture2D(u_screen, v_uv + vec2(0.0, -1.0) * inverseScreenSize).rgb);\n    float lumB = luminance(texture2D(u_screen, v_uv + vec2(0.0, 1.0) * inverseScreenSize).rgb);\n\n    // Compute delta (edge strength)\n    float deltaL = abs(lumC - lumL);\n    float deltaR = abs(lumC - lumR);\n    float deltaT = abs(lumC - lumT);\n    float deltaB = abs(lumC - lumB);\n\n    // Horizontal and vertical edges\n    vec2 edges = vec2(0.0);\n\n    // Horizontal edge (top-bottom difference)\n    float maxDeltaH = max(deltaT, deltaB);\n    if (maxDeltaH > u_threshold) {\n        edges.x = maxDeltaH;\n    }\n\n    // Vertical edge (left-right difference)\n    float maxDeltaV = max(deltaL, deltaR);\n    if (maxDeltaV > u_threshold) {\n        edges.y = maxDeltaV;\n    }\n\n    gl_FragColor = vec4(edges, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * SMAA Blending Weight Shader\n * Calculates blend weights based on edge patterns\n */\nfunction generateSMAABlendingWeightShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_edgesTex;\nuniform vec2 u_resolution;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    vec2 edges = texture2D(u_edgesTex, v_uv).xy;\n    vec4 weights = vec4(0.0);\n\n    // If no edges detected, skip\n    if (dot(edges, vec2(1.0)) < 0.001) {\n        gl_FragColor = weights;\n        return;\n    }\n\n    // Simplified weight calculation\n    // For horizontal edge, blend vertically\n    if (edges.x > 0.0) {\n        // Check how far edge extends\n        float edgeT = texture2D(u_edgesTex, v_uv + vec2(0.0, -1.0) * inverseScreenSize).x;\n        float edgeB = texture2D(u_edgesTex, v_uv + vec2(0.0, 1.0) * inverseScreenSize).x;\n\n        // Weight based on edge continuity\n        weights.x = edges.x * 0.5; // Top blend\n        weights.y = edges.x * 0.5; // Bottom blend\n\n        // Reduce weight if edge continues (sharp feature, not aliasing)\n        if (edgeT > 0.0 && edgeB > 0.0) {\n            weights.x *= 0.25;\n            weights.y *= 0.25;\n        }\n    }\n\n    // For vertical edge, blend horizontally\n    if (edges.y > 0.0) {\n        float edgeL = texture2D(u_edgesTex, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).y;\n        float edgeR = texture2D(u_edgesTex, v_uv + vec2(1.0, 0.0) * inverseScreenSize).y;\n\n        weights.z = edges.y * 0.5; // Left blend\n        weights.w = edges.y * 0.5; // Right blend\n\n        // Reduce weight if edge continues\n        if (edgeL > 0.0 && edgeR > 0.0) {\n            weights.z *= 0.25;\n            weights.w *= 0.25;\n        }\n    }\n\n    gl_FragColor = weights;\n}\n`;\n}\n\n/**\n * SMAA Neighborhood Blending Shader\n * Final pass - blends pixels based on weights\n */\nfunction generateSMAANeighborhoodBlendingShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_colorTex;\nuniform sampler2D u_blendTex;\nuniform vec2 u_resolution;\nuniform float u_intensity;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    // Get blend weights\n    vec4 weights = texture2D(u_blendTex, v_uv) * u_intensity;\n\n    // If no blending needed, return original color\n    if (dot(weights, vec4(1.0)) < 0.001) {\n        gl_FragColor = texture2D(u_colorTex, v_uv);\n        return;\n    }\n\n    // Sample neighbors\n    vec3 colorC = texture2D(u_colorTex, v_uv).rgb;\n    vec3 colorT = texture2D(u_colorTex, v_uv + vec2(0.0, -1.0) * inverseScreenSize).rgb;\n    vec3 colorB = texture2D(u_colorTex, v_uv + vec2(0.0, 1.0) * inverseScreenSize).rgb;\n    vec3 colorL = texture2D(u_colorTex, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).rgb;\n    vec3 colorR = texture2D(u_colorTex, v_uv + vec2(1.0, 0.0) * inverseScreenSize).rgb;\n\n    // Blend based on weights\n    vec3 result = colorC;\n    result += colorT * weights.x;\n    result += colorB * weights.y;\n    result += colorL * weights.z;\n    result += colorR * weights.w;\n\n    // Normalize\n    float totalWeight = 1.0 + weights.x + weights.y + weights.z + weights.w;\n    result /= totalWeight;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n\n/**\n * SMAAManager class\n * Three-pass morphological antialiasing\n */\nexport class SMAAManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.enabled = config.enabled !== undefined ? config.enabled : true;\n        this.intensity = config.intensity !== undefined ? config.intensity : 0.75;\n        this.threshold = config.threshold !== undefined ? config.threshold : 0.1;\n\n        // Framebuffers and textures\n        this.edgesFramebuffer = null;\n        this.edgesTexture = null;\n        this.blendFramebuffer = null;\n        this.blendTexture = null;\n\n        // Shader programs\n        this.edgeDetectionProgram = null;\n        this.blendingWeightProgram = null;\n        this.neighborhoodBlendProgram = null;\n\n        // Vertex buffer (shared with renderer)\n        this.quadBuffer = null;\n\n        this.initialize();\n\n        logger.info('SMAAManager initialized', {\n            size: `${width}x${height}`,\n            enabled: this.enabled,\n            intensity: this.intensity,\n            threshold: this.threshold\n        });\n    }\n\n    /**\n     * Initialize SMAA resources\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create framebuffers\n        this.createFramebuffers();\n\n        // Compile shaders\n        this.compileShaders();\n\n        // Create quad buffer if not provided\n        if (!this.quadBuffer) {\n            const quadVertices = new Float32Array([\n                0, 0,  1, 0,  0, 1,\n                0, 1,  1, 0,  1, 1\n            ]);\n            this.quadBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n        }\n    }\n\n    /**\n     * Create framebuffers for multi-pass rendering\n     */\n    createFramebuffers() {\n        const gl = this.gl;\n\n        // Edges framebuffer (stores edge detection results)\n        this.edgesTexture = this.createTexture();\n        this.edgesFramebuffer = this.createFramebuffer(this.edgesTexture);\n\n        // Blend weights framebuffer\n        this.blendTexture = this.createTexture();\n        this.blendFramebuffer = this.createFramebuffer(this.blendTexture);\n    }\n\n    /**\n     * Create a texture for intermediate results\n     */\n    createTexture() {\n        const gl = this.gl;\n\n        const texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        return texture;\n    }\n\n    /**\n     * Create a framebuffer attached to a texture\n     */\n    createFramebuffer(texture) {\n        const gl = this.gl;\n\n        const framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('SMAA framebuffer incomplete', { status });\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        return framebuffer;\n    }\n\n    /**\n     * Compile SMAA shader programs\n     */\n    compileShaders() {\n        const gl = this.gl;\n\n        const vertexShaderSource = `\nattribute vec2 a_pos;\nvarying vec2 v_uv;\n\nvoid main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        this.edgeDetectionProgram = createProgram(gl, vertexShaderSource, generateSMAAEdgeDetectionShader());\n        this.blendingWeightProgram = createProgram(gl, vertexShaderSource, generateSMAABlendingWeightShader());\n        this.neighborhoodBlendProgram = createProgram(gl, vertexShaderSource, generateSMAANeighborhoodBlendingShader());\n\n        if (!this.edgeDetectionProgram || !this.blendingWeightProgram || !this.neighborhoodBlendProgram) {\n            logger.error('Failed to compile SMAA shaders');\n        }\n    }\n\n    /**\n     * Apply SMAA to framebuffer (three-pass algorithm)\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @param {WebGLFramebuffer} targetFramebuffer - Target framebuffer to render to\n     * @param {WebGLBuffer} quadBuffer - Quad buffer for rendering\n     */\n    applyToFramebuffer(inputTexture, targetFramebuffer, quadBuffer) {\n        if (!this.enabled || this.intensity <= 0.0) {\n            // Pass through - just copy input to target framebuffer\n            const gl = this.gl;\n            gl.bindFramebuffer(gl.FRAMEBUFFER, targetFramebuffer);\n            gl.viewport(0, 0, this.width, this.height);\n            this.copyToFramebuffer(inputTexture, quadBuffer);\n            return;\n        }\n\n        const gl = this.gl;\n\n        // Pass 1: Edge Detection\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.edgesFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.edgeDetectionProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.edgeDetectionProgram, 'u_screen'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_threshold'), this.threshold);\n\n        this.drawQuad(this.edgeDetectionProgram, quadBuffer);\n\n        // Pass 2: Blending Weight Calculation\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blendFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.blendingWeightProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.edgesTexture);\n        gl.uniform1i(gl.getUniformLocation(this.blendingWeightProgram, 'u_edgesTex'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.blendingWeightProgram, 'u_resolution'), this.width, this.height);\n\n        this.drawQuad(this.blendingWeightProgram, quadBuffer);\n\n        // Pass 3: Neighborhood Blending (to target framebuffer)\n        gl.bindFramebuffer(gl.FRAMEBUFFER, targetFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), this.intensity);\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Apply SMAA to canvas (three-pass algorithm)\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @param {WebGLBuffer} quadBuffer - Quad buffer for rendering\n     */\n    applyToCanvas(inputTexture, quadBuffer) {\n        // Apply SMAA to canvas (null framebuffer)\n        this.applyToFramebuffer(inputTexture, null, quadBuffer);\n    }\n\n    /**\n     * DEPRECATED: Old applyToCanvas implementation (kept for reference)\n     */\n    applyToCanvas_OLD(inputTexture, quadBuffer) {\n        if (!this.enabled || this.intensity <= 0.0) {\n            // Pass through - just copy input to canvas\n            this.copyToCanvas(inputTexture, quadBuffer);\n            return;\n        }\n\n        const gl = this.gl;\n\n        // Pass 1: Edge Detection\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.edgesFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.edgeDetectionProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.edgeDetectionProgram, 'u_screen'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_threshold'), this.threshold);\n\n        this.drawQuad(this.edgeDetectionProgram, quadBuffer);\n\n        // Pass 2: Blending Weight Calculation\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blendFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.blendingWeightProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.edgesTexture);\n        gl.uniform1i(gl.getUniformLocation(this.blendingWeightProgram, 'u_edgesTex'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.blendingWeightProgram, 'u_resolution'), this.width, this.height);\n\n        this.drawQuad(this.blendingWeightProgram, quadBuffer);\n\n        // Pass 3: Neighborhood Blending (to canvas)\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), this.intensity);\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Draw fullscreen quad\n     */\n    drawQuad(program, quadBuffer) {\n        const gl = this.gl;\n\n        const aPosLoc = gl.getAttribLocation(program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    /**\n     * Copy input texture to currently bound framebuffer (passthrough)\n     */\n    copyToFramebuffer(inputTexture, quadBuffer) {\n        const gl = this.gl;\n\n        // Simple copy shader (reuse neighborhood blend program without weights)\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture); // Empty blend = passthrough\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), 0.0); // Zero intensity = no AA\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Copy input texture to canvas (passthrough)\n     */\n    copyToCanvas(inputTexture, quadBuffer) {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.width, this.height);\n        this.copyToFramebuffer(inputTexture, quadBuffer);\n    }\n\n    /**\n     * Update SMAA configuration\n     */\n    updateConfig(config) {\n        if (config.enabled !== undefined) {\n            this.enabled = config.enabled;\n        }\n        if (config.intensity !== undefined) {\n            this.intensity = config.intensity;\n        }\n        if (config.threshold !== undefined) {\n            this.threshold = config.threshold;\n        }\n    }\n\n    /**\n     * Check if SMAA is enabled\n     */\n    isEnabled() {\n        return this.enabled && this.intensity > 0.0;\n    }\n\n    /**\n     * Resize SMAA resources\n     */\n    resize(width, height) {\n        this.width = width;\n        this.height = height;\n\n        // Recreate framebuffers with new size\n        this.cleanup();\n        this.createFramebuffers();\n    }\n\n    /**\n     * Clean up WebGL resources\n     */\n    cleanup() {\n        const gl = this.gl;\n\n        if (this.edgesFramebuffer) gl.deleteFramebuffer(this.edgesFramebuffer);\n        if (this.blendFramebuffer) gl.deleteFramebuffer(this.blendFramebuffer);\n        if (this.edgesTexture) gl.deleteTexture(this.edgesTexture);\n        if (this.blendTexture) gl.deleteTexture(this.blendTexture);\n\n        this.edgesFramebuffer = null;\n        this.blendFramebuffer = null;\n        this.edgesTexture = null;\n        this.blendTexture = null;\n    }\n\n    /**\n     * Set quad buffer (share with renderer)\n     */\n    setQuadBuffer(buffer) {\n        this.quadBuffer = buffer;\n    }\n\n    /**\n     * Expose framebuffer for tone mapping target (compatibility with FXAA interface)\n     */\n    get framebuffer() {\n        // Return null - SMAA doesn't use this pattern\n        return null;\n    }\n}\n", "/**\n * GPU-based buffer statistics computation\n * Uses multi-pass reduction to compute min/max/avg efficiently\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * BufferStatsManager\n * Computes min/max/avg of framebuffer using GPU reduction\n */\nexport class BufferStatsManager {\n    constructor(gl) {\n        this.gl = gl;\n        this.reductionProgram = null;\n        this.finalProgram = null;\n        this.quadBuffer = null;\n        this.reductionFBOs = [];\n        this.reductionTextures = [];\n\n        // Cached statistics\n        this.stats = {\n            red: { min: 0, max: 0, avg: 0 },\n            green: { min: 0, max: 0, avg: 0 },\n            blue: { min: 0, max: 0, avg: 0 },\n            maxBrightness: 0,\n            avgBrightness: 0,\n            histogram: [], // Logarithmic histogram bins\n            timestamp: 0\n        };\n\n        this.initialized = false;\n    }\n\n    /**\n     * Initialize shaders and buffers\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create quad buffer\n        this.quadBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]), gl.STATIC_DRAW);\n\n        // Reduction shader (downsample 2x2 blocks, compute local min/max/sum)\n        const reductionVS = `\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const reductionFS = `\nprecision highp float;\nuniform sampler2D u_texture;\nuniform vec2 u_texel_size;\nvarying vec2 v_texcoord;\n\nvoid main() {\n    // Sample 2x2 block\n    vec2 base = v_texcoord;\n    vec3 s0 = texture2D(u_texture, base).rgb;\n    vec3 s1 = texture2D(u_texture, base + vec2(u_texel_size.x, 0.0)).rgb;\n    vec3 s2 = texture2D(u_texture, base + vec2(0.0, u_texel_size.y)).rgb;\n    vec3 s3 = texture2D(u_texture, base + u_texel_size).rgb;\n\n    // Compute min/max across the 2x2 block\n    vec3 minVal = min(min(s0, s1), min(s2, s3));\n    vec3 maxVal = max(max(s0, s1), max(s2, s3));\n\n    // Store: R=min, G=max, B=sum (for averaging)\n    // We'll pack min in R channel, max in G channel, sum in B channel\n    // Actually, we need all three channels for each stat, so let's use a different approach\n    // Let's just compute the max for now (most useful for saturation buildup)\n\n    gl_FragColor = vec4(maxVal, 1.0);\n}\n`;\n\n        this.reductionProgram = this.createProgram(reductionVS, reductionFS);\n        if (!this.reductionProgram) {\n            logger.error('Failed to create reduction shader');\n            return false;\n        }\n\n        this.initialized = true;\n        return true;\n    }\n\n    /**\n     * Create shader program\n     */\n    createProgram(vsSource, fsSource) {\n        const gl = this.gl;\n\n        const vs = gl.createShader(gl.VERTEX_SHADER);\n        gl.shaderSource(vs, vsSource);\n        gl.compileShader(vs);\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n            logger.error('Vertex shader compile error:', gl.getShaderInfoLog(vs));\n            return null;\n        }\n\n        const fs = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(fs, fsSource);\n        gl.compileShader(fs);\n        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n            logger.error('Fragment shader compile error:', gl.getShaderInfoLog(fs));\n            return null;\n        }\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        gl.linkProgram(program);\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            logger.error('Program link error:', gl.getProgramInfoLog(program));\n            return null;\n        }\n\n        return program;\n    }\n\n    /**\n     * Compute statistics (coarse = faster, samples every Nth pixel)\n     */\n    compute(sourceTexture, width, height, coarse = true) {\n        if (!this.initialized && !this.initialize()) {\n            return this.stats; // Return cached stats on failure\n        }\n\n        const gl = this.gl;\n        const sampleRate = coarse ? 16 : 2; // Downsample by 16x (coarse) or 2x (fine) - 16x gives ~4x less pixels\n\n        // For now, let's do a simple CPU-based sampling approach\n        // (GPU reduction is complex and requires multiple passes)\n        return this.computeCPUSampled(sourceTexture, width, height, sampleRate);\n    }\n\n    /**\n     * CPU-based sampling (reads back sampled pixels)\n     * Reads multiple small regions distributed across the screen\n     */\n    computeCPUSampled(sourceTexture, width, height, sampleRate) {\n        const gl = this.gl;\n\n        // Create temporary framebuffer\n        const fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, sourceTexture, 0);\n\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Framebuffer not complete for stats readback');\n            gl.deleteFramebuffer(fbo);\n            return this.stats;\n        }\n\n        // Sample multiple regions across the screen in a grid pattern\n        // This ensures we capture bright/dark areas anywhere on screen, not just center\n        const gridSize = 4; // 4x4 grid = 16 regions\n        const regionSize = 16; // Each region is 16x16 pixels\n        const totalPixels = gridSize * gridSize * regionSize * regionSize;\n        const allPixels = new Float32Array(totalPixels * 4);\n\n        let pixelIndex = 0;\n        for (let gy = 0; gy < gridSize; gy++) {\n            for (let gx = 0; gx < gridSize; gx++) {\n                // Calculate position for this region (evenly distributed)\n                const x = Math.floor((width / gridSize) * gx + (width / gridSize - regionSize) / 2);\n                const y = Math.floor((height / gridSize) * gy + (height / gridSize - regionSize) / 2);\n\n                // Read this region\n                const regionPixels = new Float32Array(regionSize * regionSize * 4);\n                gl.readPixels(x, y, regionSize, regionSize, gl.RGBA, gl.FLOAT, regionPixels);\n\n                // Copy to combined buffer\n                allPixels.set(regionPixels, pixelIndex * 4);\n                pixelIndex += regionSize * regionSize;\n            }\n        }\n\n        gl.deleteFramebuffer(fbo);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Compute statistics from all sampled pixels\n        let minR = Infinity, maxR = -Infinity, sumR = 0;\n        let minG = Infinity, maxG = -Infinity, sumG = 0;\n        let minB = Infinity, maxB = -Infinity, sumB = 0;\n        const count = totalPixels;\n\n        for (let i = 0; i < count; i++) {\n            const idx = i * 4;\n            const r = allPixels[idx];\n            const g = allPixels[idx + 1];\n            const b = allPixels[idx + 2];\n\n            minR = Math.min(minR, r);\n            maxR = Math.max(maxR, r);\n            sumR += r;\n\n            minG = Math.min(minG, g);\n            maxG = Math.max(maxG, g);\n            sumG += g;\n\n            minB = Math.min(minB, b);\n            maxB = Math.max(maxB, b);\n            sumB += b;\n        }\n\n        // Compute averages\n        const avgR = count > 0 ? sumR / count : 0;\n        const avgG = count > 0 ? sumG / count : 0;\n        const avgB = count > 0 ? sumB / count : 0;\n\n        // Compute logarithmic histogram (20 bins)\n        const numBins = 20;\n        const histogram = new Array(numBins).fill(0);\n        const maxBright = Math.max(maxR, maxG, maxB);\n\n        if (maxBright > 0) {\n            const logMax = Math.log2(maxBright + 1);\n\n            for (let i = 0; i < count; i++) {\n                const idx = i * 4;\n                const brightness = Math.max(allPixels[idx], allPixels[idx + 1], allPixels[idx + 2]);\n                const logBrightness = Math.log2(brightness + 1);\n                const binIndex = Math.min(Math.floor((logBrightness / logMax) * numBins), numBins - 1);\n                histogram[binIndex]++;\n            }\n        }\n\n        // Update cached stats\n        this.stats = {\n            red: { min: minR, max: maxR, avg: avgR },\n            green: { min: minG, max: maxG, avg: avgG },\n            blue: { min: minB, max: maxB, avg: avgB },\n            maxBrightness: Math.max(maxR, maxG, maxB),\n            avgBrightness: (avgR + avgG + avgB) / 3,\n            histogram: histogram,\n            timestamp: Date.now(),\n            sampledPixels: count,\n            sampleRate: sampleRate\n        };\n\n        return this.stats;\n    }\n\n    /**\n     * Get cached statistics (doesn't recompute)\n     */\n    getCached() {\n        return this.stats;\n    }\n\n    /**\n     * Dispose resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        if (this.quadBuffer) gl.deleteBuffer(this.quadBuffer);\n        if (this.reductionProgram) gl.deleteProgram(this.reductionProgram);\n        if (this.finalProgram) gl.deleteProgram(this.finalProgram);\n\n        this.reductionFBOs.forEach(fbo => gl.deleteFramebuffer(fbo));\n        this.reductionTextures.forEach(tex => gl.deleteTexture(tex));\n\n        this.reductionFBOs = [];\n        this.reductionTextures = [];\n    }\n}\n", "/**\n * GPU-based velocity statistics computation\n * Samples particles and computes max/avg velocity using shaders\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\nexport class VelocityStatsManager {\n    constructor(gl) {\n        this.gl = gl;\n        this.program = null;\n        this.quadBuffer = null;\n        this.resultTexture = null;\n        this.resultFBO = null;\n\n        // Cached statistics\n        this.stats = {\n            maxVelocity: 5.0,\n            avgVelocity: 2.0,\n            sampleCount: 0,\n            timestamp: 0\n        };\n\n        this.initialized = false;\n        this.shaderSource = null; // Store for debugging\n    }\n\n    /**\n     * Initialize shaders and buffers\n     * @param {number} dimensions - Number of dimensions\n     * @param {string[]} velocityExpressions - Compiled GLSL expressions\n     * @param {Object} coordinateSystemCode - Optional coordinate system transformation code\n     */\n    initialize(dimensions, velocityExpressions, coordinateSystemCode = null) {\n        const gl = this.gl;\n\n        // Create quad buffer for full-screen pass\n        this.quadBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]), gl.STATIC_DRAW);\n\n        // Create small result texture (64x1 pixels for 64 samples)\n        this.resultTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.resultTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 64, 1, 0, gl.RGBA, gl.FLOAT, null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        // Create framebuffer\n        this.resultFBO = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.resultFBO);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.resultTexture, 0);\n\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Velocity stats framebuffer not complete');\n            this.dispose();\n            return false;\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Generate velocity function from expressions\n        const vecType = `vec${dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n        const velocityComponents = velocityExpressions.map((expr, i) =>\n            `    result.${swizzles[i]} = ${expr};`\n        ).join('\\n');\n\n        // Check if we have coordinate system transformations\n        const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n\n        const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n${velocityComponents}\n    return result;\n}\n\n// Velocity field for statistics (native-space integration)\n${vecType} get_velocity(${vecType} pos_cartesian) {\n    ${vecType} pos_native = transformToNative(pos_cartesian);\n    return get_velocity_native(pos_native);\n}\n` : `\n// User-defined velocity field\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n        // Create shader program\n        const vertexShader = `\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const fragmentShader = `\nprecision highp float;\n\n${Array.from({length: dimensions}, (_, i) => `uniform sampler2D u_pos_${i};`).join('\\n')}\nuniform vec2 u_bbox_min;\nuniform vec2 u_bbox_max;\nuniform float u_resolution;\nuniform float u_sample_count;\nuniform float u_alpha;\n\nvarying vec2 v_texcoord;\n\n${hasCoordinateSystem ? coordinateSystemCode.forwardTransform : ''}\n\n${velocityFunction}\n\nvoid main() {\n    // Each output pixel computes velocity for one sampled particle\n    float particleIndex = floor(v_texcoord.x * u_sample_count);\n\n    // Random sampling across all particles\n    float totalParticles = u_resolution * u_resolution;\n    float stride = totalParticles / u_sample_count;\n    float sampleIdx = particleIndex * stride;\n\n    // Convert to texture coordinates\n    float x = mod(sampleIdx, u_resolution);\n    float y = floor(sampleIdx / u_resolution);\n    vec2 texCoord = (vec2(x, y) + 0.5) / u_resolution;\n\n    // Read position from textures\n    vec${dimensions} position;\n    ${Array.from({length: dimensions}, (_, i) =>\n        `position[${i}] = texture2D(u_pos_${i}, texCoord).r;`\n    ).join('\\n    ')}\n\n    // Compute velocity\n    vec${dimensions} velocity = get_velocity(position);\n\n    // Compute magnitude\n    float speed = length(velocity);\n\n    // Output: R = velocity magnitude, G = 1.0 (for counting), B/A unused\n    gl_FragColor = vec4(speed, 1.0, 0.0, 1.0);\n}\n`;\n\n        const vs = gl.createShader(gl.VERTEX_SHADER);\n        gl.shaderSource(vs, vertexShader);\n        gl.compileShader(vs);\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n            logger.error('Velocity stats vertex shader error:', gl.getShaderInfoLog(vs));\n            return false;\n        }\n\n        const fs = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(fs, fragmentShader);\n        gl.compileShader(fs);\n        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n            logger.error('Velocity stats fragment shader error:', gl.getShaderInfoLog(fs));\n            logger.error('Generated shader code:\\n' + fragmentShader);\n            return false;\n        }\n\n        this.program = gl.createProgram();\n        gl.attachShader(this.program, vs);\n        gl.attachShader(this.program, fs);\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            logger.error('Velocity stats program link error:', gl.getProgramInfoLog(this.program));\n            return false;\n        }\n\n        this.initialized = true;\n        this.dimensions = dimensions;\n        this.shaderSource = fragmentShader; // Store for debugging\n        logger.verbose('VelocityStatsManager initialized');\n        return true;\n    }\n\n    /**\n     * Compute velocity statistics\n     */\n    compute(positionTextures, bbox, resolution, animationAlpha = 0.0) {\n        if (!this.initialized) {\n            return this.stats;\n        }\n\n        const gl = this.gl;\n\n        // Render to result texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.resultFBO);\n        gl.viewport(0, 0, 64, 1);\n\n        gl.useProgram(this.program);\n\n        // Bind position textures\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, positionTextures[i]);\n            gl.uniform1i(gl.getUniformLocation(this.program, `u_pos_${i}`), i);\n        }\n\n        // Set uniforms\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_bbox_min'), bbox.min[0], bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_bbox_max'), bbox.max[0], bbox.max[1]);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_resolution'), resolution);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_sample_count'), 64);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_alpha'), animationAlpha);\n\n        // Draw quad\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        const aPosLoc = gl.getAttribLocation(this.program, 'a_pos');\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Read back result (64 pixels \u00D7 4 channels)\n        const results = new Float32Array(64 * 4);\n        gl.readPixels(0, 0, 64, 1, gl.RGBA, gl.FLOAT, results);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Process results - extract valid velocities\n        const velocities = [];\n        let maxVel = 0;\n        let sumVel = 0;\n\n        for (let i = 0; i < 64; i++) {\n            const vel = results[i * 4]; // R channel = velocity magnitude\n            if (isFinite(vel) && vel > 0) {\n                velocities.push(vel);\n                maxVel = Math.max(maxVel, vel);\n                sumVel += vel;\n            }\n        }\n\n        const count = velocities.length;\n        const avgVel = count > 0 ? sumVel / count : 0;\n\n        // Compute percentiles (90th and 95th) for more robust scaling\n        let percentile90 = avgVel;\n        let percentile95 = avgVel;\n        if (count > 0) {\n            velocities.sort((a, b) => a - b);\n            const idx90 = Math.floor(count * 0.90);\n            const idx95 = Math.floor(count * 0.95);\n            percentile90 = velocities[Math.min(idx90, count - 1)];\n            percentile95 = velocities[Math.min(idx95, count - 1)];\n        }\n\n        // Update cached stats\n        this.stats = {\n            maxVelocity: maxVel > 0 ? maxVel : this.stats.maxVelocity,\n            avgVelocity: avgVel > 0 ? avgVel : this.stats.avgVelocity,\n            percentile90: percentile90 > 0 ? percentile90 : this.stats.percentile90 || avgVel,\n            percentile95: percentile95 > 0 ? percentile95 : this.stats.percentile95 || avgVel,\n            sampleCount: count,\n            timestamp: Date.now()\n        };\n\n        return this.stats;\n    }\n\n    /**\n     * Get cached statistics\n     */\n    getCached() {\n        return this.stats;\n    }\n\n    /**\n     * Dispose resources\n     */\n    dispose() {\n        const gl = this.gl;\n        if (this.quadBuffer) gl.deleteBuffer(this.quadBuffer);\n        if (this.program) gl.deleteProgram(this.program);\n        if (this.resultTexture) gl.deleteTexture(this.resultTexture);\n        if (this.resultFBO) gl.deleteFramebuffer(this.resultFBO);\n        this.initialized = false;\n    }\n\n    /**\n     * Needs recompilation when velocity field changes\n     */\n    needsRecompile() {\n        return true; // Caller should track this\n    }\n\n    /**\n     * Get shader source for debugging\n     */\n    getShaderSource() {\n        return this.shaderSource;\n    }\n}\n", "/**\n * Particle system for managing particle data\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Particle system class\n */\nexport class ParticleSystem {\n    constructor(particleCount, dimensions, bbox, strategy) {\n        this.particleCount = particleCount;\n        this.dimensions = dimensions;\n        this.bbox = bbox || this.getDefaultBBox(dimensions);\n        this.strategy = strategy;\n\n        // Calculate texture resolution (square texture)\n        this.resolution = Math.ceil(Math.sqrt(particleCount));\n        this.actualParticleCount = this.resolution * this.resolution;\n\n        // Initialize particle data\n        this.initializeParticles();\n    }\n\n    /**\n     * Get default bounding box based on dimensions\n     */\n    getDefaultBBox(dimensions) {\n        const bbox = {\n            min: new Array(dimensions).fill(-5),\n            max: new Array(dimensions).fill(5)\n        };\n        return bbox;\n    }\n\n    /**\n     * Initialize particle positions randomly within bounding box\n     */\n    initializeParticles() {\n        this.data = [];\n        const debugSamples = []; // Track samples for debugging\n\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            const dimData = new ArrayType(this.actualParticleCount * componentsPerValue);\n\n            for (let i = 0; i < this.actualParticleCount; i++) {\n                // Random position within bounding box for this dimension\n                // Generate world coordinate\n                // Spawn 2% OUTSIDE viewport for natural flow-in effect\n                const margin = -0.02;\n                let worldValue;\n\n                if (dim < 2 && this.bbox.min && this.bbox.max) {\n                    // Use 2D bounding box for first two dimensions\n                    const min = dim === 0 ? this.bbox.min[0] : this.bbox.min[1];\n                    const max = dim === 0 ? this.bbox.max[0] : this.bbox.max[1];\n                    const range = max - min;\n                    // Spawn slightly outside viewport (negative margin)\n                    worldValue = min + range * margin + Math.random() * range * (1 - 2 * margin);\n                } else {\n                    // For higher dimensions, use default range [-10, 10] extending slightly beyond\n                    worldValue = -10.4 + Math.random() * 20.8;\n                }\n\n                // Encode using strategy\n                const min = dim < 2 ? (dim === 0 ? this.bbox.min[0] : this.bbox.min[1]) : -10;\n                const max = dim < 2 ? (dim === 0 ? this.bbox.max[0] : this.bbox.max[1]) : 10;\n                const encoded = this.strategy.encodeValue(worldValue, min, max);\n\n                // Copy encoded value to dimData\n                const offset = i * componentsPerValue;\n                for (let c = 0; c < componentsPerValue; c++) {\n                    dimData[offset + c] = encoded[c];\n                }\n\n                // Debug: log first 10 particles for dimension 0 and 1\n                if (i < 10 && dim < 2) {\n                    // Test round-trip: decode what we just encoded\n                    const buffer = new ArrayType(componentsPerValue);\n                    for (let c = 0; c < componentsPerValue; c++) {\n                        buffer[c] = dimData[offset + c];\n                    }\n                    const decodedWorld = this.strategy.decodeValue(buffer, min, max);\n\n                    if (!debugSamples[i]) debugSamples[i] = {};\n\n                    // Format encoded value for display\n                    let encodedStr;\n                    if (componentsPerValue === 4) {\n                        encodedStr = `[${encoded[0].toFixed?.(0) || encoded[0]}, ${encoded[1].toFixed?.(0) || encoded[1]}, ${encoded[2].toFixed?.(0) || encoded[2]}, ${encoded[3].toFixed?.(0) || encoded[3]}]`;\n                    } else {\n                        encodedStr = encoded[0].toString();\n                    }\n\n                    debugSamples[i][dim === 0 ? 'x' : 'y'] = {\n                        worldValue: worldValue.toFixed(4),\n                        encoded: encodedStr,\n                        decodedWorld: decodedWorld.toFixed(4),\n                        error: Math.abs(worldValue - decodedWorld).toFixed(6)\n                    };\n                }\n            }\n\n            this.data.push(dimData);\n        }\n\n        // Log debug samples\n        if (debugSamples.length > 0) {\n            logger.info('Particle initialization - first 10 particles:', {\n                strategy: this.strategy.getName(),\n                bbox: `[${this.bbox.min[0]}, ${this.bbox.min[1]}] to [${this.bbox.max[0]}, ${this.bbox.max[1]}]`,\n                samples: debugSamples.filter(s => s) // Filter out undefined\n            });\n        }\n\n        // Create particle index buffer (for rendering)\n        this.indices = new Float32Array(this.actualParticleCount);\n        for (let i = 0; i < this.actualParticleCount; i++) {\n            this.indices[i] = i;\n        }\n    }\n\n    /**\n     * Get particle data for a specific dimension\n     */\n    getDimensionData(dimension) {\n        return this.data[dimension];\n    }\n\n    /**\n     * Get all particle data\n     */\n    getAllData() {\n        return this.data;\n    }\n\n    /**\n     * Get particle indices for rendering\n     */\n    getIndices() {\n        return this.indices;\n    }\n\n    /**\n     * Update particle count and reinitialize\n     */\n    setParticleCount(newCount) {\n        this.particleCount = newCount;\n        this.resolution = Math.ceil(Math.sqrt(newCount));\n        this.actualParticleCount = this.resolution * this.resolution;\n        this.initializeParticles();\n    }\n\n    /**\n     * Update dimensions and reinitialize\n     */\n    setDimensions(newDimensions) {\n        this.dimensions = newDimensions;\n        this.bbox = this.getDefaultBBox(newDimensions);\n        this.initializeParticles();\n    }\n\n    /**\n     * Update bounding box\n     */\n    setBBox(newBBox) {\n        this.bbox = newBBox;\n    }\n\n    /**\n     * Get current resolution\n     */\n    getResolution() {\n        return this.resolution;\n    }\n\n    /**\n     * Get actual particle count (may be higher than requested due to square texture)\n     */\n    getActualParticleCount() {\n        return this.actualParticleCount;\n    }\n}\n", "/**\n * Numerical integration methods for updating particle positions\n * Each integrator generates GLSL code for computing position updates\n */\n\nimport { computeSymbolicJacobian, isValidJacobian } from './jacobian.js';\nimport { parseExpression } from './parser.js';\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Variable names for dimensions\n */\nconst VARIABLE_NAMES = ['x', 'y', 'z', 'w', 'u', 'v'];\n\n/**\n * Generate GLSL code for NxN matrix inversion using Gauss-Jordan elimination\n *\n * @param {number} n - Matrix dimension\n * @returns {string} - GLSL function code for matrix inverse\n */\nfunction generateMatrixInverseGLSL(n) {\n    const matType = n === 2 ? 'mat2' : n === 3 ? 'mat3' : 'mat4';\n    const funcName = `inverse${n}`;\n\n    // For 2x2, use fast closed-form formula\n    if (n === 2) {\n        return `\n// Compute inverse of 2x2 matrix (closed form)\n// For matrix [a c; b d] (column-major), inverse is [d -c; -b a] / det\nmat2 inverse2(mat2 m) {\n    float det = m[0][0]*m[1][1] - m[1][0]*m[0][1];\n    return mat2(m[1][1], -m[1][0], -m[0][1], m[0][0]) / det;\n}`;\n    }\n\n    // For 3x3 and larger, use Gauss-Jordan elimination\n    // Create augmented matrix [A | I] and reduce to [I | A^-1]\n\n    let code = `\n// Compute inverse of ${n}x${n} matrix using Gauss-Jordan elimination\n${matType} ${funcName}(${matType} m) {\n    // Create augmented matrix [m | I] stored as ${n} column vectors\n`;\n\n    // Initialize augmented matrix columns\n    for (let col = 0; col < n; col++) {\n        code += `    vec${n} aug${col} = vec${n}(`;\n        for (let row = 0; row < n; row++) {\n            if (row > 0) code += ', ';\n            // First n columns are m, next n columns are identity\n            code += `m[${col}][${row}]`;\n        }\n        code += `);\\n`;\n    }\n\n    // Add identity matrix columns\n    for (let col = 0; col < n; col++) {\n        code += `    vec${n} aug${n + col} = vec${n}(`;\n        for (let row = 0; row < n; row++) {\n            if (row > 0) code += ', ';\n            code += (row === col) ? '1.0' : '0.0';\n        }\n        code += `);\\n`;\n    }\n\n    code += `\\n`;\n\n    // Gauss-Jordan elimination (working on rows)\n    for (let pivot = 0; pivot < n; pivot++) {\n        code += `    // Pivot ${pivot}: Make diagonal element = 1 and eliminate column ${pivot}\\n`;\n\n        // Scale pivot row to make diagonal element = 1\n        // The pivot row is row ${pivot}, which means element [${pivot}] in each column vector\n        code += `    float scale${pivot} = aug${pivot}[${pivot}];\\n`;\n        // Protect against division by zero\n        code += `    if (abs(scale${pivot}) < 0.0001) scale${pivot} = 0.0001;\\n`;\n        for (let col = 0; col < 2 * n; col++) {\n            // Divide element [pivot] in each column by the pivot value\n            code += `    aug${col}[${pivot}] /= scale${pivot};\\n`;\n        }\n        code += `\\n`;\n\n        // Eliminate other rows in this column\n        for (let row = 0; row < n; row++) {\n            if (row === pivot) continue;\n\n            code += `    // Eliminate row ${row}\\n`;\n            code += `    float factor${pivot}_${row} = aug${pivot}[${row}];\\n`;\n            for (let col = 0; col < 2 * n; col++) {\n                // Subtract factor * pivot_row[col] from current row[col]\n                code += `    aug${col}[${row}] -= factor${pivot}_${row} * aug${col}[${pivot}];\\n`;\n            }\n            code += `\\n`;\n        }\n    }\n\n    // Extract inverse matrix from right side of augmented matrix\n    code += `    // Extract inverse from augmented matrix\\n`;\n    code += `    return ${matType}(\\n`;\n    for (let col = 0; col < n; col++) {\n        if (col > 0) code += `,\\n`;\n        code += `        aug${n + col}`;\n    }\n    code += `\\n    );\\n`;\n    code += `}\\n`;\n\n    return code;\n}\n\n/**\n * Generate GLSL code for computing the Jacobian matrix\n *\n * @param {string[][]} jacobianMatrix - 2D array of symbolic expressions\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL function code for computing Jacobian\n */\nfunction generateJacobianGLSL(jacobianMatrix, dimensions) {\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const vecType = `vec${dimensions}`;\n\n    // Generate variable declarations\n    let varDecls = '';\n    for (let i = 0; i < dimensions; i++) {\n        varDecls += `    float ${VARIABLE_NAMES[i]} = pos.${['x', 'y', 'z', 'w'][i]};\\n`;\n    }\n\n    // Generate matrix constructor arguments\n    // GLSL matrices are column-major, so we need to transpose\n    const matrixElements = [];\n    for (let col = 0; col < dimensions; col++) {\n        for (let row = 0; row < dimensions; row++) {\n            const symbolicExpr = jacobianMatrix[row][col];\n            try {\n                const glslExpr = parseExpression(symbolicExpr, dimensions);\n                matrixElements.push(glslExpr);\n            } catch (error) {\n                logger.warn(`Failed to compile Jacobian element [${row}][${col}]: ${symbolicExpr}`, error);\n                matrixElements.push('0.0');\n            }\n        }\n    }\n\n    // Generate matrix inverse function (WebGL 1.0 doesn't have built-in inverse())\n    const inverseFunc = generateMatrixInverseGLSL(dimensions);\n\n    return `\n${inverseFunc}\n\n// Compute Jacobian matrix at given position\n${matType} computeJacobian(${vecType} pos) {\n${varDecls}\n    return ${matType}(\n        ${matrixElements.join(',\\n        ')}\n    );\n}`;\n}\n\n/**\n * Solver generator functions for implicit equations\n * These generate GLSL code for different iterative solver methods\n */\n\n/**\n * Generate fixed-point iteration solver body (single iteration step)\n *\n * @param {string} varName - Variable name to solve for (e.g., 'x_new', 'k1')\n * @param {function(string): string} updateExprFn - Function that takes variable name and returns GLSL update expression\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateFixedPointSolverBody(varName, updateExprFn, dimensions) {\n    const updateExpr = updateExprFn(varName);\n    return `        ${varName} = ${updateExpr};`;\n}\n\n/**\n * Generate midpoint solver body (predictor-corrector single iteration step)\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} updateExprFn - Function that takes variable name and returns GLSL update expression\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateMidpointSolverBody(varName, updateExprFn, dimensions) {\n    const vecType = `vec${dimensions}`;\n    const predName = `${varName}_pred`;\n    const midName = `${varName}_mid`;\n\n    const updateExprPred = updateExprFn(varName);\n    const updateExprMid = updateExprFn(midName);\n\n    return `        // Predictor: standard fixed-point step\n        ${vecType} ${predName} = ${updateExprPred};\n\n        // Corrector: evaluate at midpoint between current and predictor\n        ${vecType} ${midName} = (${varName} + ${predName}) * 0.5;\n        ${varName} = ${updateExprMid};`;\n}\n\n/**\n * Generate Newton's method solver body (single iteration step)\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} residualExprFn - Function that takes variable name and returns GLSL residual F(x)\n * @param {function(string): string} jacobianExprFn - Function that takes variable name and returns GLSL Jacobian matrix\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateNewtonSolverBody(varName, residualExprFn, jacobianExprFn, dimensions) {\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const inverseFuncName = `inverse${dimensions}`;\n\n    const residualExpr = residualExprFn(varName);\n    const jacobianExpr = jacobianExprFn(varName);\n\n    // Use varName prefix for local variables to avoid redeclaration when used multiple times in same scope\n    return `        ${vecType} F_${varName} = ${residualExpr};\n        ${matType} J_${varName} = ${jacobianExpr};\n\n        // Newton step: x -= J^(-1) * F\n        ${vecType} delta_${varName} = ${inverseFuncName}(J_${varName}) * F_${varName};\n        ${varName} -= delta_${varName};`;\n}\n\n/**\n * Generate Newton's method solver body with finite difference Jacobian (single iteration step)\n *\n * Uses finite differences to approximate the Jacobian matrix instead of symbolic differentiation.\n * This avoids dependency on symbolic math but may create interesting numerical artifacts.\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} velocityExprFn - Function that takes position and returns GLSL velocity expression\n * @param {number} dimensions - Number of dimensions\n * @param {string} hScale - Scaling factor for velocity Jacobian (e.g., 'h', 'h*0.5', '1.0')\n * @param {string} residualRHS - Right-hand side of residual (e.g., 'pos + h * vel', 'pos + h * 0.5 * (f0 + vel)')\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateNewtonFDSolverBody(varName, velocityExprFn, dimensions, hScale = 'h', residualRHS = null) {\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const inverseFuncName = `inverse${dimensions}`;\n    const coords = ['x', 'y', 'z', 'w'];\n\n    // Epsilon for finite differences - balanced to avoid both truncation and cancellation errors\n    const epsilon = '1e-4';\n\n    // Generate code to compute each column of the velocity Jacobian (Df)\n    let jacobianCode = '';\n    const dfColumns = [];\n\n    for (let col = 0; col < dimensions; col++) {\n        const colName = `Df_col${col}_${varName}`;\n\n        // Create perturbation vector (unit vector in dimension col)\n        const perturbation = Array.from({length: dimensions}, (_, i) =>\n            i === col ? epsilon : '0.0'\n        ).join(', ');\n\n        // Compute f(x + eps*e_col) and f(x) - this is the derivative of the velocity field\n        const velocityAtPerturbed = velocityExprFn(`${varName} + ${vecType}(${perturbation})`);\n        const velocityAtCurrent = velocityExprFn(varName);\n\n        jacobianCode += `\n        // Velocity Jacobian column ${col}: d(velocity)/d${coords[col]}\n        ${vecType} ${colName} = (${velocityAtPerturbed} - ${velocityAtCurrent}) / ${epsilon};`;\n\n        dfColumns.push(colName);\n    }\n\n    // Build the Jacobian of the velocity field\n    jacobianCode += `\n\n        // Velocity Jacobian matrix Df\n        ${matType} Df_${varName} = ${matType}(${dfColumns.join(', ')});\n\n        // Residual Jacobian: J_F = I - ${hScale} * Df\n        ${matType} J_${varName} = ${matType}(1.0) - ${hScale} * Df_${varName};`;\n\n    // Compute residual\n    const currentVel = velocityExprFn(varName);\n    const residual = residualRHS || `pos + ${hScale} * ${currentVel}`;\n\n    return `        // Finite difference Jacobian approximation (epsilon = ${epsilon})${jacobianCode}\n\n        // Compute residual: F(x) = x - RHS\n        ${vecType} F_${varName} = ${varName} - (${residual});\n\n        // Newton step: x -= J^(-1) * F\n        ${vecType} delta_${varName} = ${inverseFuncName}(J_${varName}) * F_${varName};\n        ${varName} -= delta_${varName};`;\n}\n\n/**\n * Euler integrator (1st order)\n * Simple forward step: x(t+h) = x(t) + h*f(x)\n */\nexport function eulerIntegrator(dimensions) {\n    return {\n        name: 'Euler',\n        costFactor: 1, // 1 function evaluation per step\n        code: `\n// Euler integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} velocity = get_velocity(pos);\n    return pos + h * velocity;\n}\n`\n    };\n}\n\n/**\n * Explicit Midpoint (RK2)\n * 2nd order accurate\n */\nexport function explicitMidpointIntegrator(dimensions) {\n    return {\n        name: 'Explicit Midpoint',\n        costFactor: 2, // 2 function evaluations per step\n        code: `\n// Explicit Midpoint (RK2) integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * 0.5 * k1);\n    return pos + h * k2;\n}\n`\n    };\n}\n\n/**\n * Heun's Method (Explicit Trapezoidal, RK2 variant)\n * 2nd order accurate\n * Explicit counterpart to implicit trapezoidal rule\n */\nexport function heunIntegrator(dimensions) {\n    return {\n        name: 'Heun (Explicit Trapezoidal)',\n        costFactor: 2, // 2 function evaluations per step\n        code: `\n// Heun's Method (Explicit Trapezoidal) integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * k1);\n    return pos + h * 0.5 * (k1 + k2);\n}\n`\n    };\n}\n\n/**\n * Runge-Kutta 4\n * 4th order accurate, good balance of accuracy and performance\n */\nexport function rk4Integrator(dimensions) {\n    return {\n        name: 'RK4',\n        costFactor: 4, // 4 function evaluations per step\n        code: `\n// Runge-Kutta 4 integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * 0.5 * k1);\n    vec${dimensions} k3 = get_velocity(pos + h * 0.5 * k2);\n    vec${dimensions} k4 = get_velocity(pos + h * k3);\n\n    return pos + h * (k1 / 6.0 + k2 / 3.0 + k3 / 3.0 + k4 / 6.0);\n}\n`\n    };\n}\n\n/**\n * Implicit Euler (Backward Euler)\n * Solves: x(t+h) = x(t) + h*f(x(t+h))\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * More stable than explicit Euler, especially for stiff systems\n */\nexport function implicitEulerIntegrator(dimensions, iterations = 3, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit Euler integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Problem definition for Implicit Euler: x_new = pos + h * f(x_new)\n    const initialGuess = 'pos + h * get_velocity(pos)';\n    const updateExprFn = (v) => `pos + h * get_velocity(${v})`;\n    const velocityExprFn = (v) => `get_velocity(${v})`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Implicit Euler');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * get_velocity(${v})`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - h * computeJacobian(${v})`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        // Finite difference Newton's method - no symbolic expressions needed\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit Euler');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions);\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Implicit Euler (${solverName})`,\n        costFactor: 1, // Base cost (iterations are tunable convergence parameter)\n        code: `\n${jacobianGLSL}\n// Implicit Euler integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Implicit Midpoint (Implicit RK2)\n * Solves: x(t+h) = x(t) + h*f((x(t) + x(t+h))/2)\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * 2nd order accurate, A-stable (excellent for stiff systems)\n */\nexport function implicitMidpointIntegrator(dimensions, iterations = 4, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit Midpoint integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Initial guess: explicit RK2\n    const k1Init = 'get_velocity(pos)';\n    const initialGuess = `pos + h * get_velocity(pos + h * 0.5 * ${k1Init})`;\n\n    // Problem definition for Implicit Midpoint: x_new = pos + h * f((pos + x_new)/2)\n    const updateExprFn = (v) => `pos + h * get_velocity((pos + ${v}) * 0.5)`;\n    const velocityExprFn = (v) => `get_velocity((pos + ${v}) * 0.5)`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Implicit Midpoint)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Implicit Midpoint');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * get_velocity((pos + ${v}) * 0.5)`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - (h * 0.5) * computeJacobian((pos + ${v}) * 0.5)`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Implicit Midpoint)');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit Midpoint');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions, 'h * 0.5');\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Implicit Midpoint (${solverName})`,\n        costFactor: 2, // 2nd order method (like explicit midpoint)\n        code: `\n${jacobianGLSL}\n// Implicit Midpoint integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Trapezoidal Rule (Implicit RK2)\n * Solves: x(t+h) = x(t) + h/2 * (f(x(t)) + f(x(t+h)))\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * 2nd order accurate, A-stable\n */\nexport function trapezoidalIntegrator(dimensions, iterations = 4, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Trapezoidal integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    const initialGuess = 'pos + h * f0';\n\n    // Problem definition for Trapezoidal: x_new = pos + h/2 * (f0 + f(x_new))\n    const updateExprFn = (v) => `pos + h * 0.5 * (f0 + get_velocity(${v}))`;\n    const velocityExprFn = (v) => `get_velocity(${v})`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Trapezoidal)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Trapezoidal');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * 0.5 * (f0 + get_velocity(${v}))`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - (h * 0.5) * computeJacobian(${v})`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Trapezoidal)');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Trapezoidal');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions, 'h * 0.5', 'pos + h * 0.5 * (f0 + ' + velocityExprFn('x_new') + ')');\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Trapezoidal (${solverName})`,\n        costFactor: 2, // 2nd order method (like Heun)\n        code: `\n${jacobianGLSL}\n// Trapezoidal Rule integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    ${vecType} f0 = get_velocity(pos);\n\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Implicit RK4 (Gauss-Legendre)\n * Fully implicit 4th order method, excellent stability\n * Uses simplified 2-stage Gauss-Legendre\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n *\n * Note: This uses a simplified Newton's method that treats each stage separately\n * (Gauss-Seidel style). A full Newton's method would solve the coupled 2N\u00D72N system\n * for both stages simultaneously, which is more accurate but significantly more complex.\n * The simplified approach offers a good balance of accuracy and implementation complexity.\n */\nexport function implicitRK4Integrator(dimensions, iterations = 5, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit RK4 integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Gauss-Legendre coefficients (will be inlined in GLSL)\n    const coeffsGLSL = `\n    // Gauss-Legendre coefficients for 2-stage method\n    const float a11 = 0.25;\n    const float a12 = 0.25 - sqrt(3.0) / 6.0;\n    const float a21 = 0.25 + sqrt(3.0) / 6.0;\n    const float a22 = 0.25;\n    const float b1 = 0.5;\n    const float b2 = 0.5;\n    const float c1 = 0.5 - sqrt(3.0) / 6.0;\n    const float c2 = 0.5 + sqrt(3.0) / 6.0;`;\n\n    const initialGuessGLSL = `\n    // Start with explicit RK4 as initial guess\n    ${vecType} k1_guess = get_velocity(pos);\n    ${vecType} k2_guess = get_velocity(pos + h * 0.5 * k1_guess);\n\n    ${vecType} k1 = k1_guess;\n    ${vecType} k2 = k2_guess;`;\n\n    // Problem: k1 = f(pos + h*(a11*k1 + a12*k2)), k2 = f(pos + h*(a21*k1 + a22*k2))\n    // Update functions for each stage\n    const k1_updateFn = (v) => `get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n    const k2_updateFn = (v) => `get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n    // Velocity functions for finite difference\n    const k1_velocityFn = (v) => `get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n    const k2_velocityFn = (v) => `get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n    let k1_solverBody, k2_solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Implicit RK4 - simplified)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using simplified Newton\\'s method for Implicit RK4');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n\n            // Define residual and Jacobian functions for each stage\n            // Stage 1: F1(k1) = k1 - f(pos + h*(a11*k1 + a12*k2))\n            const k1_residualFn = (v) => `${v} - get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n            const k1_jacobianFn = (v) => `${matType}(1.0) - (h * a11) * computeJacobian(pos + h * (a11 * ${v} + a12 * k2))`;\n\n            // Stage 2: F2(k2) = k2 - f(pos + h*(a21*k1 + a22*k2))\n            const k2_residualFn = (v) => `${v} - get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n            const k2_jacobianFn = (v) => `${matType}(1.0) - (h * a22) * computeJacobian(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n            k1_solverBody = generateNewtonSolverBody('k1', k1_residualFn, k1_jacobianFn, dimensions);\n            k2_solverBody = generateNewtonSolverBody('k2', k2_residualFn, k2_jacobianFn, dimensions);\n\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Implicit RK4)');\n            logger.warn('Falling back to fixed-point iteration');\n            k1_solverBody = generateFixedPointSolverBody('k1', k1_updateFn, dimensions);\n            k2_solverBody = generateFixedPointSolverBody('k2', k2_updateFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit RK4 (simplified)');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n\n        // For each stage k_i: k_i = f(pos + h*(a_i1*k1 + a_i2*k2))\n        // Residual: F(k_i) = k_i - f(...)\n        // Jacobian: J = I - h*a_ii*Df\n        k1_solverBody = generateNewtonFDSolverBody('k1', k1_velocityFn, dimensions, 'h * a11');\n        k2_solverBody = generateNewtonFDSolverBody('k2', k2_velocityFn, dimensions, 'h * a22');\n\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        k1_solverBody = generateMidpointSolverBody('k1', k1_updateFn, dimensions);\n        k2_solverBody = generateMidpointSolverBody('k2', k2_updateFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        k1_solverBody = generateFixedPointSolverBody('k1', k1_updateFn, dimensions);\n        k2_solverBody = generateFixedPointSolverBody('k2', k2_updateFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    // Build the solver loop (both stages in one loop, Gauss-Seidel style)\n    const solverCode = `\n    // Iterative solver for coupled stages (Gauss-Seidel style)\n    for (int i = 0; i < ${iterations}; i++) {\n        // Stage 1\n${k1_solverBody}\n\n        // Stage 2\n${k2_solverBody}\n    }`;\n\n    return {\n        name: `Implicit RK4 (${solverName})`,\n        costFactor: 4, // 4th order method (like explicit RK4)\n        code: `\n${jacobianGLSL}\n// Implicit RK4 (Gauss-Legendre 2-stage) integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n${coeffsGLSL}\n${initialGuessGLSL}\n${solverCode}\n\n    return pos + h * (b1 * k1 + b2 * k2);\n}\n`\n    };\n}\n\n/**\n * Get integrator by name\n */\nexport function getIntegrator(name, dimensions, params = {}) {\n    const iterations = params.iterations || 3;\n    const solutionMethod = params.solutionMethod || 'fixed-point';\n    const expressions = params.expressions || null;\n\n    switch (name) {\n        case 'euler':\n            return eulerIntegrator(dimensions);\n        case 'explicit-midpoint':\n            return explicitMidpointIntegrator(dimensions);\n        case 'heun':\n            return heunIntegrator(dimensions);\n        case 'rk4':\n            return rk4Integrator(dimensions);\n        case 'implicit-euler':\n            return implicitEulerIntegrator(dimensions, iterations, solutionMethod, expressions);\n        case 'implicit-midpoint':\n            return implicitMidpointIntegrator(dimensions, params.iterations || 4, solutionMethod, expressions);\n        case 'trapezoidal':\n            return trapezoidalIntegrator(dimensions, params.iterations || 4, solutionMethod, expressions);\n        case 'implicit-rk4':\n            return implicitRK4Integrator(dimensions, params.iterations || 5, solutionMethod, expressions);\n        // Legacy aliases\n        case 'rk2':\n            return explicitMidpointIntegrator(dimensions);\n        case 'implicit':\n            return implicitEulerIntegrator(dimensions, iterations, solutionMethod, expressions);\n        default:\n            return rk4Integrator(dimensions); // Default to RK4\n    }\n}\n\n/**\n * Create custom integrator from user GLSL code\n */\nexport function customIntegrator(glslCode, dimensions) {\n    return {\n        name: 'Custom',\n        code: glslCode\n    };\n}\n", "/**\n * 2D projection mappers for visualizing n-dimensional vector fields\n * Each mapper reduces n-dimensional position to 2D screen coordinates\n */\n\nimport { parseExpression } from './parser.js';\n\n/**\n * Select mapper - choose 2 dimensions to display (with optional depth)\n * @param {number} dim1 - First dimension index (0-based)\n * @param {number} dim2 - Second dimension index (0-based)\n * @param {number} totalDims - Total number of dimensions\n * @param {number} depthDim - Depth dimension index (optional, defaults to 2 or -1 if not available)\n */\nexport function selectMapper(dim1, dim2, totalDims, depthDim = null) {\n    // Auto-select depth dimension if not specified\n    if (depthDim === null) {\n        // Use dimension 2 if we have at least 3 dimensions, otherwise -1\n        depthDim = totalDims >= 3 ? 2 : -1;\n    }\n\n    const hasDepth = depthDim >= 0 && depthDim < totalDims;\n\n    return {\n        name: 'Select',\n        params: { dim1, dim2, depthDim },\n        code: `\n// Select 2 dimensions for display${hasDepth ? ' (with depth)' : ''}\nvec2 project_to_2d(vec${totalDims} pos) {\n    return vec2(pos[${dim1}], pos[${dim2}]);\n}\n\nvec3 project_to_3d(vec${totalDims} pos) {\n    return vec3(pos[${dim1}], pos[${dim2}], ${hasDepth ? `pos[${depthDim}]` : '0.0'});\n}\n`\n    };\n}\n\n/**\n * Linear projection mapper - apply 2\u00D7N or 3\u00D7N matrix projection\n * @param {number[][]} matrix - 2\u00D7N or 3\u00D7N projection matrix\n * @param {number} dimensions - Number of dimensions\n */\nexport function linearProjectionMapper(matrix, dimensions) {\n    // Generate GLSL code for matrix multiplication\n    const row1 = matrix[0].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ');\n    const row2 = matrix[1].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ');\n    const row3 = matrix[2] ? matrix[2].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ') : null;\n\n    return {\n        name: 'Linear Projection',\n        params: { matrix },\n        code: `\n// Linear projection matrix\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(\n        ${row1},\n        ${row2}\n    );\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(\n        ${row1},\n        ${row2},\n        ${row3 || '0.0'}\n    );\n}\n`\n    };\n}\n\n/**\n * Orthographic projection - project along a specific axis\n * @param {number} axis - Axis to project out (0-based)\n * @param {number} dimensions - Total dimensions\n */\nexport function orthographicMapper(axis, dimensions) {\n    // Project out the specified axis, take first two remaining dimensions\n    let dim1 = axis === 0 ? 1 : 0;\n    let dim2 = dim1 + 1;\n    if (dim2 === axis) dim2++;\n\n    return {\n        name: 'Orthographic',\n        params: { axis },\n        code: `\n// Orthographic projection (remove axis ${axis}, use as depth)\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(pos[${dim1}], pos[${dim2}]);\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(pos[${dim1}], pos[${dim2}], pos[${axis}]);\n}\n`\n    };\n}\n\n/**\n * Spherical projection - project from 3D spherical coordinates\n * Only works for 3D systems\n */\nexport function sphericalMapper() {\n    return {\n        name: 'Spherical',\n        params: {},\n        code: `\n// Spherical projection (3D only)\nvec2 project_to_2d(vec3 pos) {\n    float r = length(pos);\n    if (r < 0.001) return vec2(0.0, 0.0);\n\n    float theta = atan(pos.y, pos.x);\n    float phi = acos(pos.z / r);\n\n    return vec2(theta, phi);\n}\n\nvec3 project_to_3d(vec3 pos) {\n    float r = length(pos);\n    if (r < 0.001) return vec3(0.0, 0.0, 0.0);\n\n    float theta = atan(pos.y, pos.x);\n    float phi = acos(pos.z / r);\n\n    return vec3(theta, phi, r);  // Use radius as depth\n}\n`\n    };\n}\n\n/**\n * Stereographic projection - project high-dimensional sphere to 2D\n * Projects from N-sphere to 2D plane\n */\nexport function stereographicMapper(dimensions) {\n    return {\n        name: 'Stereographic',\n        params: {},\n        code: `\n// Stereographic projection\nvec2 project_to_2d(vec${dimensions} pos) {\n    float denom = 1.0 - pos[${dimensions - 1}];\n    if (abs(denom) < 0.001) denom = 0.001;\n    return vec2(pos[0] / denom, pos[1] / denom);\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    float denom = 1.0 - pos[${dimensions - 1}];\n    if (abs(denom) < 0.001) denom = 0.001;\n    return vec3(pos[0] / denom, pos[1] / denom, pos[${dimensions - 1}]);\n}\n`\n    };\n}\n\n/**\n * Get default mapper based on dimensions and type\n */\nexport function getMapper(type, dimensions, params = {}) {\n    switch (type) {\n        case 'select': {\n            const dim1 = params.dim1 !== undefined ? params.dim1 : 0;\n            const dim2 = params.dim2 !== undefined ? params.dim2 : Math.min(1, dimensions - 1);\n            const depthDim = params.depthDim !== undefined ? params.depthDim : null;\n            return selectMapper(dim1, dim2, dimensions, depthDim);\n        }\n\n        case 'project': {\n            // Default: identity-like projection for first 2 dims\n            const matrix = params.matrix || [\n                [1, 0, ...Array(Math.max(0, dimensions - 2)).fill(0)],\n                [0, 1, ...Array(Math.max(0, dimensions - 2)).fill(0)]\n            ];\n            return linearProjectionMapper(matrix, dimensions);\n        }\n\n        case 'orthographic': {\n            const axis = params.axis !== undefined ? params.axis : dimensions - 1;\n            return orthographicMapper(axis, dimensions);\n        }\n\n        case 'spherical':\n            if (dimensions === 3) {\n                return sphericalMapper();\n            }\n            // Fall back to select if not 3D\n            return selectMapper(0, 1, dimensions);\n\n        case 'stereographic':\n            if (dimensions >= 3) {\n                return stereographicMapper(dimensions);\n            }\n            return selectMapper(0, 1, dimensions);\n\n        case 'custom': {\n            const horizontalExpr = params.horizontalExpr || 'x';\n            const verticalExpr = params.verticalExpr || 'y';\n            const depthExpr = params.depthExpr || '';\n            return customMapper(horizontalExpr, verticalExpr, depthExpr, dimensions);\n        }\n\n        default:\n            return selectMapper(0, 1, dimensions);\n    }\n}\n\n/**\n * Create custom mapper from user math expressions\n * @param {string} horizontalExpr - Math expression for horizontal coordinate\n * @param {string} verticalExpr - Math expression for vertical coordinate\n * @param {string} depthExpr - Optional math expression for depth coordinate\n * @param {number} dimensions - Number of dimensions\n */\nexport function customMapper(horizontalExpr, verticalExpr, depthExpr, dimensions) {\n    // Parse expressions to GLSL\n    const horizontalGLSL = parseExpression(horizontalExpr || 'x', dimensions);\n    const verticalGLSL = parseExpression(verticalExpr || 'y', dimensions);\n    const depthGLSL = depthExpr ? parseExpression(depthExpr, dimensions) : '0.0';\n\n    return {\n        name: 'Custom',\n        params: { horizontalExpr, verticalExpr, depthExpr },\n        code: `\n// Custom mapper\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(\n        ${horizontalGLSL},\n        ${verticalGLSL}\n    );\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(\n        ${horizontalGLSL},\n        ${verticalGLSL},\n        ${depthGLSL}\n    );\n}\n`\n    };\n}\n\n/**\n * Get list of available mapper names\n */\nexport function getAvailableMappers(dimensions) {\n    const mappers = ['select', 'project'];\n\n    if (dimensions >= 3) {\n        mappers.push('orthographic', 'stereographic');\n    }\n\n    if (dimensions === 3) {\n        mappers.push('spherical');\n    }\n\n    return mappers;\n}\n", "/**\n * Domain transformations for phase space integration\n *\n * Applies a 1-to-1 transformation T(x) before integration, then transforms back with T^(-1)(y).\n * This creates a spatially-varying effective timestep without breaking convergence.\n *\n * For dx/dt = f(x), we transform to y-space:\n *   y = T(x)\n *   dy/dt = J_T(x) * f(x)\n *\n * We integrate in y-space and transform back:\n *   y(t+h) = integrate(y(t), h, J_T * f \u2218 T^(-1))\n *   x(t+h) = T^(-1)(y(t+h))\n */\n\n// Transform parameter slider constants\nconst TRANSFORM_PARAM_MIN = 0.0001;\nconst TRANSFORM_PARAM_MAX = 25.0;\nconst TRANSFORM_PARAM_STEP = 0.0001;\n\n/**\n * Base class for coordinate transformations\n */\nclass Transform {\n    constructor(name, description) {\n        this.name = name;\n        this.description = description;\n    }\n\n    /**\n     * Generate GLSL helper functions (optional)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL helper function code\n     */\n    generateHelpers(dimensions) {\n        return ''; // Default: no helpers\n    }\n\n    /**\n     * Generate GLSL code for forward transform: y = T(x)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateForward(dimensions) {\n        throw new Error('generateForward must be implemented');\n    }\n\n    /**\n     * Generate GLSL code for inverse transform: x = T^(-1)(y)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateInverse(dimensions) {\n        throw new Error('generateInverse must be implemented');\n    }\n\n    /**\n     * Generate GLSL code for Jacobian: J_T(x)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateJacobian(dimensions) {\n        throw new Error('generateJacobian must be implemented');\n    }\n\n    /**\n     * Get parameter schema for UI controls\n     * @returns {Array<{name: string, label: string, type: string, min: number, max: number, step: number, default: number}>}\n     */\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Identity transform (no transformation)\n */\nclass IdentityTransform extends Transform {\n    constructor() {\n        super('identity', 'No transformation (identity)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    return x;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    return y;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    return ${vecType}(1.0);\n}`;\n    }\n}\n\n/**\n * Power transform (component-wise)\n * T(x) = sign(x) * |x|^alpha\n *\n * alpha < 1.0: More detail near origin, compress outer regions\n * alpha > 1.0: Less detail near origin, stretch outer regions\n */\nclass PowerTransform extends Transform {\n    constructor() {\n        super('power', 'Power transform (zoom lens effect)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = sign(x.${comp}) * pow(abs(x.${comp}) + 1e-8, alpha);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    float inv_alpha = 1.0 / alpha;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = sign(y.${comp}) * pow(abs(y.${comp}) + 1e-8, inv_alpha);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = alpha * pow(abs(x.${comp}) + 1e-8, alpha - 1.0);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Exponent (\u03B1)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 0.5,\n            info: '\u03B1 < 1.0: zoom into origin; \u03B1 > 1.0: compress origin'\n        }];\n    }\n}\n\n/**\n * Hyperbolic tangent transform (component-wise)\n * T(x) = tanh(beta * x)\n *\n * Compresses infinite space into [-1, 1]\n * Higher beta = more compression near origin\n */\nclass TanhTransform extends Transform {\n    constructor() {\n        super('tanh', 'Hyperbolic tangent (compress infinity)');\n    }\n\n    generateHelpers(dimensions) {\n        return `\n// Helper: tanh(x) = (exp(2x) - 1) / (exp(2x) + 1)\nfloat tanh_scalar(float x) {\n    float e2x = exp(2.0 * x);\n    return (e2x - 1.0) / (e2x + 1.0);\n}\n`;\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float beta = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = tanh_scalar(beta * x.${comp});`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float beta = u_transform_params.x;\n    // atanh(y) = 0.5 * log((1+y)/(1-y))\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = 0.5 * log((1.0 + y_clamped) / (1.0 - y_clamped)) / beta;\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float beta = u_transform_params.x;\n    // Jacobian of tanh: d/dx tanh(x) = 1 - tanh^2(x)\n    ${vecType} tanh_vals;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `tanh_vals.${comp} = tanh_scalar(beta * x.${comp});`;\n    }).join('\\n    ')}\n    return beta * (${vecType}(1.0) - tanh_vals * tanh_vals);\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'beta',\n            label: 'Compression (\u03B2)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Higher = more compression. Maps infinite space to [-1,1]'\n        }];\n    }\n}\n\n/**\n * Logistic sigmoid transform (component-wise)\n * T(x) = 2*sigmoid(k*x) - 1 = 2/(1 + exp(-k*x)) - 1\n *\n * Compresses to [-1, 1], smoother than tanh in center region\n * Standard logistic function, centered at zero\n */\nclass SigmoidTransform extends Transform {\n    constructor() {\n        super('sigmoid', 'Logistic Sigmoid (smooth S-curve)');\n    }\n\n    generateHelpers(dimensions) {\n        return `\n// Helper: sigmoid(x) = 1 / (1 + exp(-x))\nfloat sigmoid_scalar(float x) {\n    return 1.0 / (1.0 + exp(-x));\n}\n`;\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float k = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = 2.0 * sigmoid_scalar(k * x.${comp}) - 1.0;`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float k = u_transform_params.x;\n    // Inverse: x = ln((y+1)/(1-y)) / k\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = log((y_clamped + 1.0) / (1.0 - y_clamped)) / k;\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float k = u_transform_params.x;\n    // Jacobian: d/dx [2*sigmoid(k*x) - 1] = 2k * sigmoid(k*x) * (1 - sigmoid(k*x))\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float sig = sigmoid_scalar(k * x.${comp});\n        result.${comp} = 2.0 * k * sig * (1.0 - sig);\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'k',\n            label: 'Steepness (k)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Higher = steeper transition. Maps infinite space to [-1,1] with logistic curve.'\n        }];\n    }\n}\n\n/**\n * Rational transform (component-wise)\n * T(x) = x / sqrt(x^2 + a)\n * Jacobian: a/(x^2+a)^(3/2) - bell-shaped!\n *\n * Compresses to (-\u221Aa, \u221Aa), with bell-shaped derivative\n * Parameter 'a' controls bell width: higher = wider/shallower, lower = narrower/sharper\n */\nclass RationalTransform extends Transform {\n    constructor() {\n        super('rational', 'Rational (bell-shaped Jacobian)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float a = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = x.${comp} / sqrt(x.${comp} * x.${comp} + a);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float a = u_transform_params.x;\n    // Inverse: x = y * sqrt(a / (1 - y^2))\n    // Note: y is bounded to [-1, 1] regardless of a\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        float y_sq = y_clamped * y_clamped;\n        result.${comp} = y_clamped * sqrt(a / (1.0 - y_sq));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float a = u_transform_params.x;\n    // Jacobian: d/dx [x/sqrt(x^2+a)] = a/(x^2+a)^(3/2)\n    // This is bell-shaped! Peaks at x=0, decays at infinity\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float x_sq = x.${comp} * x.${comp};\n        float denom = x_sq + a;\n        result.${comp} = a / (denom * sqrt(denom));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'a',\n            label: 'Width (a)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Controls bell curve width. Higher = wider/shallower, lower = narrower/sharper.'\n        }];\n    }\n}\n\n/**\n * Sine wave distortion (component-wise)\n * T(x) = x + amplitude * sin(frequency * x)\n *\n * Creates periodic \"speed bumps\" in integration\n */\nclass SineTransform extends Transform {\n    constructor() {\n        super('sine', 'Sine wave distortion (periodic speed bumps)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n    return x + amplitude * sin(frequency * x);\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        // Use Newton's method to solve y = x + a*sin(f*x) for x\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n\n    // Newton's method: x_{n+1} = x_n - (f(x_n) - y) / f'(x_n)\n    // where f(x) = x + a*sin(f*x)\n    // f'(x) = 1 + a*f*cos(f*x)\n    ${vecType} x = y; // Initial guess\n    for (int iter = 0; iter < 5; iter++) {\n        ${vecType} fx = x + amplitude * sin(frequency * x);\n        ${vecType} dfx = ${vecType}(1.0) + amplitude * frequency * cos(frequency * x);\n        x = x - (fx - y) / dfx;\n    }\n    return x;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n    return ${vecType}(1.0) + amplitude * frequency * cos(frequency * x);\n}`;\n    }\n\n    getParameters() {\n        return [\n            {\n                name: 'amplitude',\n                label: 'Amplitude',\n                type: 'slider',\n                min: TRANSFORM_PARAM_MIN,\n                max: TRANSFORM_PARAM_MAX,\n                step: TRANSFORM_PARAM_STEP,\n                default: 0.5,\n                info: 'Strength of distortion'\n            },\n            {\n                name: 'frequency',\n                label: 'Frequency',\n                type: 'slider',\n                min: TRANSFORM_PARAM_MIN,\n                max: TRANSFORM_PARAM_MAX,\n                step: TRANSFORM_PARAM_STEP,\n                default: 1.0,\n                info: 'Number of waves per unit length'\n            }\n        ];\n    }\n}\n\n/**\n * Radial power transform (2D and 3D)\n * In polar/spherical coordinates: r' = r^alpha, theta' = theta\n *\n * Changes integration density as function of distance from origin\n */\nclass RadialPowerTransform extends Transform {\n    constructor() {\n        super('radial_power', 'Radial power (compress/expand by distance)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        if (dimensions === 2) {\n            return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    if (r < 1e-8) return x;\n    float r_new = pow(r, alpha);\n    return x * (r_new / r);\n}`;\n        } else {\n            // For higher dimensions, apply same radial logic\n            return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    if (r < 1e-8) return x;\n    float r_new = pow(r, alpha);\n    return x * (r_new / r);\n}`;\n        }\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    float inv_alpha = 1.0 / alpha;\n    float r = length(y);\n    if (r < 1e-8) return y;\n    float r_new = pow(r, inv_alpha);\n    return y * (r_new / r);\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        // Jacobian is scalar for radial transform: J = alpha * r^(alpha-1)\n        // But we need component-wise for vector field multiplication\n        // For radial transform, Jacobian is J = alpha * r^(alpha-1) * I (identity matrix scaled)\n        // In component form: J_i = alpha * r^(alpha-1)\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    float jacobian_scalar = alpha * pow(r + 1e-8, alpha - 1.0);\n    return ${vecType}(jacobian_scalar);\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Radial Exponent (\u03B1)',\n            type: 'slider',\n            min: 0.1,\n            max: 3.0,\n            step: 0.1,\n            default: 0.5,\n            info: '\u03B1 < 1.0: zoom into origin; \u03B1 > 1.0: compress origin'\n        }];\n    }\n}\n\n/**\n * Logarithmic transform (component-wise)\n * T(x) = sign(x) * log(|x| + 1)\n *\n * Stretches near zero (large derivative), compresses at infinity\n * Maps infinite space to infinite space with logarithmic spacing\n */\nclass LogTransform extends Transform {\n    constructor() {\n        super('log', 'Logarithmic (stretch near zero)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(x.${comp}) * log(abs(x.${comp}) + 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(y.${comp}) * (exp(abs(y.${comp})) - 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    // Jacobian: d/dx [sign(x)*log(|x|+1)] = 1/(|x|+1)\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = 1.0 / (abs(x.${comp}) + 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Exponential transform (component-wise)\n * T(x) = sign(x) * (exp(\u03B1*|x|) - 1)\n *\n * Compresses near zero, stretches at infinity\n * Creates exponential growth away from origin\n */\nclass ExpTransform extends Transform {\n    constructor() {\n        super('exp', 'Exponential (compress near zero)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(x.${comp}) * (exp(alpha * abs(x.${comp})) - 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(y.${comp}) * log(abs(y.${comp}) + 1.0) / alpha;`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    // Jacobian: d/dx [sign(x)*(exp(\u03B1|x|)-1)] = \u03B1*exp(\u03B1|x|)\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = alpha * exp(alpha * abs(x.${comp}));`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Growth Rate (\u03B1)',\n            type: 'slider',\n            min: 0.1,\n            max: 2.0,\n            step: 0.1,\n            default: 0.5,\n            info: 'Higher \u03B1 = stronger exponential growth. Use small values (0.1-0.5) to avoid overflow.'\n        }];\n    }\n}\n\n/**\n * Soft-sign transform (component-wise)\n * T(x) = x / (1 + |x|)\n *\n * Compresses to [-1, 1], smooth S-curve\n * Similar to tanh but simpler, no parameters\n */\nclass SoftsignTransform extends Transform {\n    constructor() {\n        super('softsign', 'Soft-sign (smooth compression to [-1,1])');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = x.${comp} / (1.0 + abs(x.${comp}));`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = y_clamped / (1.0 - abs(y_clamped));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    // Jacobian: d/dx [x/(1+|x|)] = 1/(1+|x|)^2\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float denom = 1.0 + abs(x.${comp});\n        result.${comp} = 1.0 / (denom * denom);\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Custom transform (user-defined)\n * Requires user to provide forward, inverse, and Jacobian expressions\n */\nclass CustomTransform extends Transform {\n    constructor() {\n        super('custom', 'Custom (user-defined GLSL)');\n        this.forwardCode = '';\n        this.inverseCode = '';\n        this.jacobianCode = '';\n    }\n\n    setCode(forward, inverse, jacobian) {\n        this.forwardCode = forward;\n        this.inverseCode = inverse;\n        this.jacobianCode = jacobian;\n    }\n\n    generateForward(dimensions) {\n        return this.forwardCode || new IdentityTransform().generateForward(dimensions);\n    }\n\n    generateInverse(dimensions) {\n        return this.inverseCode || new IdentityTransform().generateInverse(dimensions);\n    }\n\n    generateJacobian(dimensions) {\n        return this.jacobianCode || new IdentityTransform().generateJacobian(dimensions);\n    }\n}\n\n/**\n * Transform registry\n */\nconst transforms = {\n    identity: new IdentityTransform(),\n    power: new PowerTransform(),\n    log: new LogTransform(),\n    exp: new ExpTransform(),\n    softsign: new SoftsignTransform(),\n    tanh: new TanhTransform(),\n    sigmoid: new SigmoidTransform(),\n    rational: new RationalTransform(),\n    sine: new SineTransform(),\n    radial_power: new RadialPowerTransform(),\n    custom: new CustomTransform()\n};\n\n/**\n * Get transform by name\n */\nfunction getTransform(name) {\n    return transforms[name] || transforms.identity;\n}\n\n/**\n * Get all transform names\n */\nfunction getTransformNames() {\n    return Object.keys(transforms);\n}\n\n/**\n * Get transform list for UI\n */\nfunction getTransformList() {\n    return Object.entries(transforms).map(([key, transform]) => ({\n        value: key,\n        label: transform.description\n    }));\n}\n\nexport {\n    Transform,\n    IdentityTransform,\n    PowerTransform,\n    TanhTransform,\n    SineTransform,\n    RadialPowerTransform,\n    CustomTransform,\n    getTransform,\n    getTransformNames,\n    getTransformList\n};\n", "/**\n * Color mode definitions for particle rendering\n */\n\nexport function getColorMode(name, dimensions) {\n    const vecType = `vec${dimensions}`;\n\n    const modes = {\n        white: {\n            name: 'Solid White',\n            code: `\n// Simple solid white particles\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    return vec3(1.0, 1.0, 1.0);\n}\n`\n        },\n        velocity_magnitude: {\n            name: 'Velocity Magnitude',\n            usesMaxVelocity: true,\n            code: `\n// Color based on speed (velocity magnitude)\n// Uses full N-dimensional velocity magnitude\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    float speed = length(velocity);\n\n    // Normalize speed to [0, 1] range using max velocity\n    // Add small epsilon to avoid division by zero\n    float normalized = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n\n    // Create color gradient: blue (slow) -> cyan -> green -> yellow -> red (fast)\n    vec3 color;\n    if (normalized < 0.25) {\n        // Blue to cyan\n        color = mix(vec3(0.0, 0.0, 1.0), vec3(0.0, 1.0, 1.0), normalized * 4.0);\n    } else if (normalized < 0.5) {\n        // Cyan to green\n        color = mix(vec3(0.0, 1.0, 1.0), vec3(0.0, 1.0, 0.0), (normalized - 0.25) * 4.0);\n    } else if (normalized < 0.75) {\n        // Green to yellow\n        color = mix(vec3(0.0, 1.0, 0.0), vec3(1.0, 1.0, 0.0), (normalized - 0.5) * 4.0);\n    } else {\n        // Yellow to red\n        color = mix(vec3(1.0, 1.0, 0.0), vec3(1.0, 0.0, 0.0), (normalized - 0.75) * 4.0);\n    }\n\n    return color;\n}\n`\n        },\n        velocity_angle: {\n            name: 'Velocity Angle',\n            code: `\n// Color based on velocity direction in projected 2D space\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    // Use angle of PROJECTED velocity in x-y plane\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n\n    // Convert angle [-\u03C0, \u03C0] to hue [0, 1]\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n\n    // HSV to RGB conversion (saturation = 1, value = 1)\n    float h = hue * 6.0;\n    float x = 1.0 - abs(mod(h, 2.0) - 1.0);\n\n    vec3 color;\n    if (h < 1.0) color = vec3(1.0, x, 0.0);\n    else if (h < 2.0) color = vec3(x, 1.0, 0.0);\n    else if (h < 3.0) color = vec3(0.0, 1.0, x);\n    else if (h < 4.0) color = vec3(0.0, x, 1.0);\n    else if (h < 5.0) color = vec3(x, 0.0, 1.0);\n    else color = vec3(1.0, 0.0, x);\n\n    return color;\n}\n`\n        },\n        velocity_combined: {\n            name: 'Velocity Angle + Magnitude',\n            usesMaxVelocity: true,\n            code: `\n// Color by projected angle, saturation by full magnitude\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    float speed = length(velocity);\n\n    // Use angle of PROJECTED velocity in x-y plane for hue\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n\n    // Normalize speed to [0, 1] for saturation\n    float saturation = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n\n    // HSV to RGB conversion with variable saturation (value = 1)\n    float h = hue * 6.0;\n    float c = saturation; // Chroma\n    float x = c * (1.0 - abs(mod(h, 2.0) - 1.0));\n\n    vec3 rgb;\n    if (h < 1.0) rgb = vec3(c, x, 0.0);\n    else if (h < 2.0) rgb = vec3(x, c, 0.0);\n    else if (h < 3.0) rgb = vec3(0.0, c, x);\n    else if (h < 4.0) rgb = vec3(0.0, x, c);\n    else if (h < 5.0) rgb = vec3(x, 0.0, c);\n    else rgb = vec3(c, 0.0, x);\n\n    // Mix with neutral grey to desaturate (slow particles \u2192 grey, fast \u2192 vibrant)\n    const vec3 grey = vec3(0.5, 0.5, 0.5);\n    vec3 color = rgb + grey * (1.0 - saturation);\n\n    return color;\n}\n`\n        },\n        expression: {\n            name: 'Expression',\n            usesMaxVelocity: false,\n            requiresExpression: true,\n            // Code will be generated dynamically based on user's expression\n            code: null\n        },\n        custom: {\n            name: 'Custom (Advanced)',\n            code: `\n// Custom color function\n// Inputs: pos (position vector), velocity (full N-D velocity), velocity_proj (projected 2D velocity)\n// Output: RGB color vec3\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    return vec3(1.0, 1.0, 1.0);\n}\n`\n        }\n    };\n\n    const mode = modes[name];\n    if (!mode) {\n        throw new Error(`Unknown color mode: ${name}`);\n    }\n\n    return mode;\n}\n\n/**\n * Generate expression-based color mode code\n * @param {number} dimensions - Number of dimensions\n * @param {string} expressionGLSL - Compiled user expression GLSL code\n * @param {string} gradientGLSL - Generated gradient function code\n * @returns {string} GLSL color function code\n */\nexport function generateExpressionColorMode(dimensions, expressionGLSL, gradientGLSL) {\n    const vecType = `vec${dimensions}`;\n\n    // Generate variable declarations for position and velocity components\n    const varDecls = [];\n    const swizzles = ['x', 'y', 'z', 'w', 'u', 'v'];\n    const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n\n    for (let i = 0; i < dimensions; i++) {\n        varDecls.push(`float ${swizzles[i]} = pos.${swizzles[i]};`);\n        varDecls.push(`float ${velocityVars[i]} = velocity.${swizzles[i]};`); // Use full N-D velocity\n    }\n\n    return `\n${gradientGLSL}\n\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    // Unpack position and FULL velocity components for user expression\n    ${varDecls.join('\\n    ')}\n\n    // Evaluate user expression\n    float value = ${expressionGLSL};\n\n    // Map through gradient\n    return evaluateGradient(value);\n}\n`;\n}\n\n/**\n * Generate gradient-based version of a preset color mode\n * @param {string} modeName - Name of the color mode\n * @param {number} dimensions - Number of dimensions\n * @param {string} gradientGLSL - Generated gradient function code\n * @returns {string} GLSL color function code\n */\nexport function generateGradientColorMode(modeName, dimensions, gradientGLSL) {\n    const vecType = `vec${dimensions}`;\n\n    let valueExpression;\n\n    switch (modeName) {\n        case 'velocity_magnitude':\n            valueExpression = `\n    // Use full N-dimensional velocity magnitude\n    float speed = length(velocity);\n    float normalized;\n    if (u_velocity_log_scale > 0.5) {\n        // Logarithmic scaling: log(1 + speed) / log(1 + max_velocity)\n        normalized = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        // Linear scaling\n        normalized = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n    return evaluateGradient(normalized);`;\n            break;\n\n        case 'velocity_angle':\n            valueExpression = `\n    // Use projected 2D velocity angle\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    return evaluateGradient(hue);`;\n            break;\n\n        case 'velocity_combined':\n            valueExpression = `\n    // Full velocity for magnitude, projected velocity for angle\n    float speed = length(velocity);\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    float saturation;\n    if (u_velocity_log_scale > 0.5) {\n        // Logarithmic scaling: log(1 + speed) / log(1 + max_velocity)\n        saturation = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        // Linear scaling\n        saturation = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n\n    // Get color from gradient based on angle\n    vec3 fullColor = evaluateGradient(hue);\n\n    // Desaturate based on speed (slow \u2192 grey, fast \u2192 full color)\n    const vec3 grey = vec3(0.5, 0.5, 0.5);\n    return mix(grey, fullColor, saturation);`;\n            break;\n\n        default:\n            throw new Error(`Cannot create gradient version of color mode: ${modeName}`);\n    }\n\n    return `\n${gradientGLSL}\n\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} velocity_proj) {\n    ${valueExpression}\n}\n`;\n}\n", "/**\n * Gradient generation for color mapping\n * Converts an array of color stops to GLSL interpolation code\n */\n\n/**\n * Generate GLSL code for a color gradient\n * @param {Array} stops - Array of {position: float [0,1], color: [r, g, b] in [0,1]}\n * @returns {string} GLSL function code\n */\nexport function generateGradientGLSL(stops) {\n    // Sort stops by position\n    const sortedStops = [...stops].sort((a, b) => a.position - b.position);\n\n    // Ensure we have at least 2 stops\n    if (sortedStops.length < 2) {\n        throw new Error('Gradient must have at least 2 color stops');\n    }\n\n    // Ensure positions are in [0, 1]\n    sortedStops.forEach(stop => {\n        if (stop.position < 0 || stop.position > 1) {\n            throw new Error(`Stop position must be in [0, 1], got ${stop.position}`);\n        }\n    });\n\n    // Generate piecewise linear interpolation code\n    let code = `vec3 evaluateGradient(float t) {\n    t = clamp(t, 0.0, 1.0);\n`;\n\n    // Generate if-else chain for each segment\n    for (let i = 0; i < sortedStops.length - 1; i++) {\n        const stop1 = sortedStops[i];\n        const stop2 = sortedStops[i + 1];\n\n        const color1 = formatColor(stop1.color);\n        const color2 = formatColor(stop2.color);\n        const pos1 = stop1.position.toFixed(6);\n        const pos2 = stop2.position.toFixed(6);\n\n        if (i === 0) {\n            code += `    if (t <= ${pos2}) {\\n`;\n        } else if (i === sortedStops.length - 2) {\n            code += `    } else {\\n`;\n        } else {\n            code += `    } else if (t <= ${pos2}) {\\n`;\n        }\n\n        // Linear interpolation between stops\n        code += `        float segmentT = (t - ${pos1}) / (${pos2} - ${pos1});\\n`;\n        code += `        return mix(${color1}, ${color2}, segmentT);\\n`;\n    }\n\n    code += `    }\\n`;\n    code += `}\\n`;\n\n    return code;\n}\n\n/**\n * Format a color array as GLSL vec3\n */\nfunction formatColor(color) {\n    return `vec3(${color[0].toFixed(6)}, ${color[1].toFixed(6)}, ${color[2].toFixed(6)})`;\n}\n\n/**\n * Create default gradient (spectrum)\n */\nexport function getDefaultGradient() {\n    return getSpectrumGradient();\n}\n\n/**\n * Create velocity magnitude gradient (blue \u2192 cyan \u2192 green \u2192 yellow \u2192 red)\n */\nexport function getVelocityMagnitudeGradient() {\n    return [\n        { position: 0.00, color: [0.0, 0.0, 1.0] }, // Blue\n        { position: 0.25, color: [0.0, 1.0, 1.0] }, // Cyan\n        { position: 0.50, color: [0.0, 1.0, 0.0] }, // Green\n        { position: 0.75, color: [1.0, 1.0, 0.0] }, // Yellow\n        { position: 1.00, color: [1.0, 0.0, 0.0] }  // Red\n    ];\n}\n\n/**\n * Create spectrum gradient (rainbow: red \u2192 orange \u2192 yellow \u2192 green \u2192 cyan \u2192 blue \u2192 violet)\n */\nexport function getSpectrumGradient() {\n    return [\n        { position: 0.00, color: [1.0, 0.0, 0.0] },   // Red\n        { position: 0.17, color: [1.0, 0.5, 0.0] },   // Orange\n        { position: 0.33, color: [1.0, 1.0, 0.0] },   // Yellow\n        { position: 0.50, color: [0.0, 1.0, 0.0] },   // Green\n        { position: 0.67, color: [0.0, 1.0, 1.0] },   // Cyan\n        { position: 0.83, color: [0.0, 0.0, 1.0] },   // Blue\n        { position: 1.00, color: [0.5, 0.0, 1.0] }    // Violet\n    ];\n}\n\n/**\n * Convert hex color string to RGB array [0,1]\n */\nexport function hexToRgb(hex) {\n    // Remove # if present\n    hex = hex.replace('#', '');\n\n    const r = parseInt(hex.substring(0, 2), 16) / 255;\n    const g = parseInt(hex.substring(2, 4), 16) / 255;\n    const b = parseInt(hex.substring(4, 6), 16) / 255;\n\n    return [r, g, b];\n}\n\n/**\n * Convert RGB array [0,1] to hex color string\n */\nexport function rgbToHex(rgb) {\n    const r = Math.round(rgb[0] * 255).toString(16).padStart(2, '0');\n    const g = Math.round(rgb[1] * 255).toString(16).padStart(2, '0');\n    const b = Math.round(rgb[2] * 255).toString(16).padStart(2, '0');\n\n    return `#${r}${g}${b}`;\n}\n", "/**\n * Tone Mapping Operators\n * Compresses HDR [0, \u221E) color values into displayable LDR [0, 1] range\n */\n\n/**\n * Get tone mapping operator by name\n * @param {string} name - Operator name\n * @returns {Object} Operator definition with name, description, code generator\n */\nexport function getToneMapper(name) {\n    const operators = {\n        linear: {\n            name: 'Linear (No Tone Mapping)',\n            description: 'Direct exposure and gamma, no compression. Values > 1 will clip.',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        reinhard: {\n            name: 'Reinhard',\n            description: 'Simple, preserves hues. Formula: color / (1 + color)',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        reinhard_extended: {\n            name: 'Reinhard Extended',\n            description: 'Reinhard with adjustable white point for highlight control',\n            usesWhitePoint: true,\n            defaultExposure: 1.0,\n            defaultWhitePoint: 2.0\n        },\n        filmic: {\n            name: 'Filmic (ACES Approximation)',\n            description: 'Film-like S-curve, industry standard look',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        uncharted2: {\n            name: 'Uncharted 2',\n            description: 'Popular in games, punchy highlights and saturated colors',\n            usesWhitePoint: true,\n            defaultExposure: 2.0,\n            defaultWhitePoint: 11.2\n        },\n        aces: {\n            name: 'ACES (Academy Color)',\n            description: 'Academy standard, natural film-like response',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        hable: {\n            name: 'Hable (Uncharted 2 Filmic)',\n            description: 'John Hable\\'s filmic curve, excellent highlight rolloff',\n            usesWhitePoint: true,\n            defaultExposure: 2.0,\n            defaultWhitePoint: 11.2\n        },\n        luminance_reinhard: {\n            name: 'Luminance Reinhard (Hue Preserving)',\n            description: 'Tone maps brightness only, preserves color hue/saturation perfectly. Ideal for attractors.',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        luminance_extended: {\n            name: 'Luminance Extended (Hue Preserving)',\n            description: 'Extended Reinhard on luminance only. Best for colorful attractor density visualization.',\n            usesWhitePoint: true,\n            defaultExposure: 1.0,\n            defaultWhitePoint: 5.0\n        }\n    };\n\n    return operators[name] || operators.linear;\n}\n\n/**\n * Generate GLSL code for tone mapping operator\n * @param {string} operatorName - Name of the operator\n * @param {Object} params - Parameters (exposure, gamma, whitePoint, luminanceGamma, etc.)\n * @returns {string} GLSL shader code\n */\nexport function generateTonemapGLSL(operatorName, params = {}) {\n    const operator = getToneMapper(operatorName);\n\n    // Default parameters\n    const exposure = params.exposure !== undefined ? params.exposure : operator.defaultExposure;\n    const gamma = params.gamma !== undefined ? params.gamma : 2.2;\n    const whitePoint = params.whitePoint !== undefined ? params.whitePoint : (operator.defaultWhitePoint || 1.0);\n    const luminanceGamma = params.luminanceGamma !== undefined ? params.luminanceGamma : 1.0;\n\n    let code = `\n// Tone mapping operator: ${operator.name}\n// ${operator.description}\n\n`;\n\n    // Generate operator-specific functions\n    switch (operatorName) {\n        case 'linear':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Simple exposure, no compression\n    return color * ${exposure.toFixed(6)};\n}\n`;\n            break;\n\n        case 'reinhard':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Reinhard tone mapping: color / (1 + color)\n    color *= ${exposure.toFixed(6)};\n    return color / (vec3(1.0) + color);\n}\n`;\n            break;\n\n        case 'reinhard_extended':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Reinhard with white point\n    color *= ${exposure.toFixed(6)};\n    float whitePoint = ${whitePoint.toFixed(6)};\n    vec3 numerator = color * (vec3(1.0) + (color / (whitePoint * whitePoint)));\n    return numerator / (vec3(1.0) + color);\n}\n`;\n            break;\n\n        case 'filmic':\n        case 'aces':\n            code += `\n// ACES approximation (simplified)\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // ACES fitted curve\n    const float a = 2.51;\n    const float b = 0.03;\n    const float c = 2.43;\n    const float d = 0.59;\n    const float e = 0.14;\n\n    return clamp((color * (a * color + b)) / (color * (c * color + d) + e), 0.0, 1.0);\n}\n`;\n            break;\n\n        case 'uncharted2':\n        case 'hable':\n            code += `\n// Uncharted 2 filmic tone mapping by John Hable\nvec3 uncharted2Curve(vec3 x) {\n    const float A = 0.15; // Shoulder strength\n    const float B = 0.50; // Linear strength\n    const float C = 0.10; // Linear angle\n    const float D = 0.20; // Toe strength\n    const float E = 0.02; // Toe numerator\n    const float F = 0.30; // Toe denominator\n    return ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Apply curve\n    vec3 curr = uncharted2Curve(color);\n\n    // White point scaling\n    float whitePoint = ${whitePoint.toFixed(6)};\n    vec3 whiteScale = vec3(1.0) / uncharted2Curve(vec3(whitePoint));\n\n    return curr * whiteScale;\n}\n`;\n            break;\n\n        case 'luminance_reinhard':\n            code += `\n// Luminance-based Reinhard (hue-preserving)\n// Tone maps brightness only, keeps color ratios intact\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Apply Reinhard to luminance only\n    float toneMappedLuma = luma / (1.0 + luma);\n\n    // Scale color to match tone-mapped luminance\n    // This preserves hue and saturation perfectly\n    return color * (toneMappedLuma / luma);\n}\n`;\n            break;\n\n        case 'luminance_extended':\n            code += `\n// Luminance-based Extended Reinhard (hue-preserving)\n// Best for attractor visualization with dense bright regions\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Extended Reinhard with white point on luminance only\n    float whitePoint = ${whitePoint.toFixed(6)};\n    float numerator = luma * (1.0 + (luma / (whitePoint * whitePoint)));\n    float toneMappedLuma = numerator / (1.0 + luma);\n\n    // Scale color to match tone-mapped luminance\n    // This preserves hue and saturation perfectly\n    return color * (toneMappedLuma / luma);\n}\n`;\n            break;\n\n        default:\n            // Fallback to linear\n            code += `\nvec3 tonemap(vec3 color) {\n    return color * ${exposure.toFixed(6)};\n}\n`;\n    }\n\n    // Add gamma correction\n    code += `\nvec3 applyGamma(vec3 color) {\n    return pow(color, vec3(1.0 / ${gamma.toFixed(6)}));\n}\n\nvec3 applyLuminanceGamma(vec3 color) {\n    // Luminance-preserving gamma: adjusts brightness only, preserves hue\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Apply gamma to luminance only\n    float gammaCorrectedLuma = pow(luma, 1.0 / ${luminanceGamma.toFixed(6)});\n\n    // Scale color to match gamma-corrected luminance\n    // This preserves hue and saturation perfectly\n    return color * (gammaCorrectedLuma / luma);\n}\n`;\n\n    return code;\n}\n\n/**\n * Get list of all available operators\n * @returns {Array} Array of {key, name, description} objects\n */\nexport function getAvailableOperators() {\n    return [\n        { key: 'linear', name: 'Linear (No Tone Mapping)', description: 'Direct mapping, clips at 1.0' },\n        { key: 'reinhard', name: 'Reinhard', description: 'Simple, preserves hues' },\n        { key: 'reinhard_extended', name: 'Reinhard Extended', description: 'With white point control' },\n        { key: 'luminance_reinhard', name: 'Luminance Reinhard', description: 'Hue-preserving, ideal for attractors' },\n        { key: 'luminance_extended', name: 'Luminance Extended', description: 'Best for colorful attractor visualization' },\n        { key: 'filmic', name: 'Filmic (ACES)', description: 'Film-like, industry standard' },\n        { key: 'uncharted2', name: 'Uncharted 2', description: 'Game-style, punchy' },\n        { key: 'aces', name: 'ACES', description: 'Academy standard' },\n        { key: 'hable', name: 'Hable Filmic', description: 'Excellent highlights' }\n    ];\n}\n\n/**\n * Calculate luminance from RGB color\n * Used for exposure adjustment\n * @param {Array} rgb - [r, g, b] in [0, 1]\n * @returns {number} Luminance value\n */\nexport function luminance(rgb) {\n    // Rec. 709 luma coefficients\n    return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2];\n}\n", "/**\n * Main WebGL renderer for N-dimensional vector field visualization\n */\n\nimport { TextureManager } from './textures.js';\nimport { FramebufferManager } from './framebuffer.js';\nimport { BloomManager } from './bloom.js';\nimport { BilateralFilterManager } from './bilateral.js';\nimport { SMAAManager } from './smaa.js';\nimport { BufferStatsManager } from './buffer-stats.js';\nimport { VelocityStatsManager } from './velocity-stats.js';\nimport { ParticleSystem } from '../particles/system.js';\nimport {\n    createProgram,\n    generateUpdateVertexShader,\n    generateUpdateFragmentShader,\n    generateDrawVertexShader,\n    generateDrawFragmentShader,\n    generateScreenVertexShader,\n    generateScreenFadeFragmentShader,\n    generateScreenCopyFragmentShader,\n    generateTonemapFragmentShader,\n    generateBloomBrightPassShader,\n    generateBloomBlurShader,\n    generateBloomCombineShader\n} from './shaders.js';\nimport { parseVectorField, createVelocityEvaluators, parseExpression } from '../math/parser.js';\nimport { getIntegrator } from '../math/integrators.js';\nimport { getMapper } from '../math/mappers.js';\nimport { getTransform } from '../math/transforms.js';\nimport { getColorMode, generateExpressionColorMode, generateGradientColorMode } from '../math/colors.js';\nimport { generateGradientGLSL, getDefaultGradient } from '../math/gradients.js';\nimport { generateTonemapGLSL, getToneMapper } from '../math/tonemapping.js';\nimport { getCartesianSystem } from '../math/coordinate-systems.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { RGBAStrategy } from './strategies/rgba-strategy.js';\nimport { FloatStrategy } from './strategies/float-strategy.js';\n\n/**\n * WebGL Renderer class\n */\nexport class Renderer {\n    constructor(canvas, config = {}) {\n        this.canvas = canvas;\n        this.gl = canvas.getContext('webgl', {\n            alpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false,\n            preserveDrawingBuffer: true\n        });\n\n        if (!this.gl) {\n            throw new Error('WebGL not supported');\n        }\n\n        const gl = this.gl;\n\n        // Disable depth and stencil tests\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.STENCIL_TEST);\n\n        // Enable blending (blend mode will be set per render pass)\n        gl.enable(gl.BLEND);\n\n        // Select coordinate storage strategy\n        const strategyType = config.storageStrategy || 'rgba';\n        try {\n            if (strategyType === 'float') {\n                this.strategy = new FloatStrategy(gl);\n                logger.info('Using Float texture strategy');\n            } else {\n                this.strategy = new RGBAStrategy(gl);\n                logger.info('Using RGBA encoded texture strategy');\n            }\n        } catch (error) {\n            logger.warn(`Failed to initialize ${strategyType} strategy: ${error.message}`);\n            logger.info('Falling back to RGBA strategy');\n            this.strategy = new RGBAStrategy(gl);\n        }\n\n        // Initialize state\n        this.dimensions = 2;\n        this.expressions = ['-y', 'x'];\n        this.coordinateSystem = getCartesianSystem(this.dimensions); // Must initialize BEFORE creating evaluators\n\n        // Create velocity evaluators for sampling\n        try {\n            const coordinateVars = this.coordinateSystem.getVariableNames();\n            this.velocityEvaluators = createVelocityEvaluators(this.expressions, coordinateVars);\n            logger.verbose('Initial velocity evaluators created', {\n                coordinateSystem: this.coordinateSystem.name,\n                variables: coordinateVars\n            });\n        } catch (error) {\n            logger.warn('Failed to create initial velocity evaluators', error);\n            this.velocityEvaluators = null;\n        }\n\n        this.integratorType = 'rk4';\n        this.integratorParams = { iterations: 3 }; // For implicit methods\n        this.integratorCostFactor = 1; // Cost factor for fair integrator comparison (set during shader compilation)\n        this.solutionMethod = 'fixed-point'; // For implicit methods: 'fixed-point' or 'newton'\n        this.transformType = 'identity'; // Domain transformation type\n        this.transformParams = {}; // Transform parameters\n        this.mapperType = 'select';\n        this.mapperParams = { dim1: 0, dim2: 1 };\n        this.colorMode = 'white';\n        this.colorExpression = 'x * y'; // Default expression for expression mode\n        this.colorGradient = getDefaultGradient(); // Default gradient\n        this.useCustomGradient = false; // Apply custom gradient to preset modes\n        this.velocityScaleMode = 'percentile95'; // 'max', 'average', 'percentile90', 'percentile95'\n        this.velocityLogScale = false; // Use logarithmic scaling for velocity colors\n\n        // HDR rendering settings\n        this.useHDR = config.useHDR !== undefined ? config.useHDR : true;\n        this.tonemapOperator = config.tonemapOperator || 'aces';\n        this.exposure = config.exposure !== undefined ? config.exposure : 1.0;\n        this.gamma = config.gamma !== undefined ? config.gamma : 2.2;\n        this.luminanceGamma = config.luminanceGamma !== undefined ? config.luminanceGamma : 1.0;\n        this.highlightCompression = config.highlightCompression !== undefined ? config.highlightCompression : 0.0;\n        this.compressionThreshold = config.compressionThreshold !== undefined ? config.compressionThreshold : 1.0;\n        this.whitePoint = config.whitePoint !== undefined ? config.whitePoint : 2.0;\n        this.particleIntensity = config.particleIntensity !== undefined ? config.particleIntensity : 1.0;\n        this.particleSize = config.particleSize !== undefined ? config.particleSize : 1.0;\n        this.particleRenderMode = config.particleRenderMode || 'points'; // 'points' or 'lines'\n\n        // Depth testing (plasma mode)\n        this.useDepthTest = config.useDepthTest !== undefined ? config.useDepthTest : false;\n        this.colorSaturation = config.colorSaturation !== undefined ? config.colorSaturation : 1.0; // 0.0 = grayscale, 1.0 = full saturation\n        this.brightnessDesaturation = config.brightnessDesaturation !== undefined ? config.brightnessDesaturation : 0.0; // 0.0 = no desat, 1.0 = full desat at bright areas\n        this.brightnessSaturation = config.brightnessSaturation !== undefined ? config.brightnessSaturation : 0.0; // 0.0 = no effect, 1.0 = dim areas fully desaturated\n\n        // Bloom settings (disabled by default - WIP)\n        this.bloomEnabled = config.bloomEnabled !== undefined ? config.bloomEnabled : false;\n        this.bloomIntensity = config.bloomIntensity !== undefined ? config.bloomIntensity : 0.3;\n        this.bloomRadius = config.bloomRadius !== undefined ? config.bloomRadius : 1.0;\n        this.bloomAlpha = config.bloomAlpha !== undefined ? config.bloomAlpha : 1.0;\n        this.currentBloomTexture = null; // Stores bloom texture for current frame\n\n        // SMAA settings (morphological antialiasing)\n        this.smaaEnabled = config.smaaEnabled !== undefined ? config.smaaEnabled : true;\n        this.smaaIntensity = config.smaaIntensity !== undefined ? config.smaaIntensity : 0.75;\n        this.smaaThreshold = config.smaaThreshold !== undefined ? config.smaaThreshold : 0.1;\n\n        // Bilateral filter settings (edge-preserving noise reduction)\n        this.bilateralEnabled = config.bilateralEnabled !== undefined ? config.bilateralEnabled : false;\n        this.bilateralSpatialSigma = config.bilateralSpatialSigma !== undefined ? config.bilateralSpatialSigma : 4.0;\n        this.bilateralIntensitySigma = config.bilateralIntensitySigma !== undefined ? config.bilateralIntensitySigma : 0.2;\n\n        // Render scale (render at different resolution, resample to canvas)\n        // Supports both downsampling (0.5x for performance) and supersampling (2x+ for quality)\n        // Validate and clamp render scale factor\n        let supersampleFactor = config.supersampleFactor !== undefined ? config.supersampleFactor : 1.0;\n        if (typeof supersampleFactor !== 'number' || isNaN(supersampleFactor) || supersampleFactor <= 0) {\n            logger.warn(`Invalid supersampleFactor: ${supersampleFactor}, using default 1.0`);\n            supersampleFactor = 1.0;\n        }\n        this.supersampleFactor = Math.max(0.5, Math.min(4.0, supersampleFactor));\n        logger.info(`Initial render scale factor set to: ${this.supersampleFactor}`);\n\n        this.timestep = 0.01;\n        this.fadeOpacity = 0.99;\n        this.dropProbability = 0.003;\n        this.dropLowVelocity = false; // Drop particles below velocity threshold\n\n        // Animation support\n        this.animationAlpha = 0.0; // Alpha parameter for animation (0.0 to 1.0)\n        this.lockShaderRecompilation = false; // Prevent shader recompilation during animation\n\n        // Debug stats (expensive GPU readbacks)\n        this.enableDebugStats = false; // Enable particle sampling and detailed logging (expensive)\n\n        // Exponential moving average for max velocity (for color scaling)\n        this.maxVelocity = 5.0; // Initial reasonable value\n        this.prevMaxVelocity = 5.0; // Previous value for change detection\n        this.velocityEMAAlpha = 0.1; // Blend factor for new samples (10% new, 90% old)\n        this.velocitySampleInterval = 10; // Adaptive sample interval\n        this.velocitySampleIntervalMin = 5; // Sample at least every 5 frames when changing\n        this.velocitySampleIntervalMax = 60; // Sample at most every 60 frames when stable\n        this.framesSinceLastSample = 0; // Track frames for adaptive sampling\n        this.lowVelocityThreshold = 0.02; // Drop particles below 2% of max velocity\n\n        // Bounding box for 2D display (with aspect ratio correction)\n        const aspectRatio = canvas.width / canvas.height;\n        const height = 10; // -5 to 5\n        const width = height * aspectRatio;\n        this.bbox = {\n            min: [-width / 2, -5],\n            max: [width / 2, 5]\n        };\n\n        // Particle system\n        this.particleSystem = new ParticleSystem(10000, this.dimensions, this.bbox, this.strategy);\n\n        // Texture manager\n        this.textureManager = new TextureManager(\n            gl,\n            this.dimensions,\n            this.particleSystem.getResolution(),\n            this.strategy\n        );\n\n        // Set line mode if configured\n        if (this.particleRenderMode === 'lines') {\n            this.textureManager.setLineMode(true);\n        }\n\n        // Create framebuffer for particle position updates (not HDR, separate from screen rendering)\n        this.updateFramebuffer = gl.createFramebuffer();\n\n        // Calculate render resolution based on supersample factor\n        // Ensure we always have valid dimensions (minimum 1x1)\n        const canvasWidth = Math.max(1, canvas.width || 800);\n        const canvasHeight = Math.max(1, canvas.height || 600);\n        this.renderWidth = Math.max(1, Math.floor(canvasWidth * this.supersampleFactor));\n        this.renderHeight = Math.max(1, Math.floor(canvasHeight * this.supersampleFactor));\n\n        logger.verbose('Render dimensions calculated', {\n            canvasSize: `${canvasWidth}x${canvasHeight}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        // Create framebuffer manager for HDR rendering\n        logger.info('Initializing HDR rendering system...', {\n            requested: this.useHDR,\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        this.framebufferManager = new FramebufferManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                useHDR: this.useHDR,\n                usePingPong: true\n            }\n        );\n\n        // Log HDR capabilities and status\n        const hdrSupport = this.framebufferManager.getHDRSupport();\n        logger.info('HDR rendering system initialized', {\n            hdrEnabled: hdrSupport.enabled,\n            hdrSupported: hdrSupport.supported,\n            textureFormat: hdrSupport.format,\n            extensions: {\n                floatColorBuffer: hdrSupport.hasFloatColorBuffer,\n                halfFloatColorBuffer: hdrSupport.hasHalfFloatColorBuffer,\n                linearFiltering: hdrSupport.hasLinearFiltering\n            },\n            exposure: this.exposure,\n            gamma: this.gamma\n        });\n\n        if (this.useHDR && !hdrSupport.supported) {\n            logger.warn('HDR rendering requested but not supported by device. Using LDR fallback.');\n        }\n\n        if (hdrSupport.enabled && !hdrSupport.hasLinearFiltering) {\n            logger.warn('Linear filtering not available for HDR textures. Bloom quality will be affected.');\n        }\n\n        // Create bloom manager (uses white point as threshold)\n        logger.info('Initializing bloom system...', {\n            enabled: this.bloomEnabled,\n            intensity: this.bloomIntensity,\n            threshold: this.whitePoint\n        });\n\n        this.bloomManager = new BloomManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                enabled: this.bloomEnabled && hdrSupport.enabled,\n                intensity: this.bloomIntensity,\n                threshold: this.whitePoint,\n                radius: this.bloomRadius\n            }\n        );\n\n        logger.info('Bloom system initialized', {\n            enabled: this.bloomManager.isEnabled(),\n            bloomSize: this.bloomManager.isEnabled() ?\n                `${this.bloomManager.getBloomSize().width}x${this.bloomManager.getBloomSize().height}` : 'N/A'\n        });\n\n        // Create SMAA manager\n        this.smaaManager = new SMAAManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                enabled: this.smaaEnabled,\n                intensity: this.smaaIntensity,\n                threshold: this.smaaThreshold\n            }\n        );\n\n        logger.info('SMAA system initialized', {\n            enabled: this.smaaManager.isEnabled(),\n            intensity: this.smaaIntensity,\n            threshold: this.smaaThreshold\n        });\n\n        // Create bilateral filter manager\n        this.bilateralManager = new BilateralFilterManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                enabled: this.bilateralEnabled,\n                spatialSigma: this.bilateralSpatialSigma,\n                intensitySigma: this.bilateralIntensitySigma\n            }\n        );\n\n        logger.info('Bilateral filter initialized', {\n            enabled: this.bilateralManager.isEnabled(),\n            spatialSigma: this.bilateralSpatialSigma,\n            intensitySigma: this.bilateralIntensitySigma\n        });\n\n        // Create dedicated LDR framebuffer for tone mapping output\n        // (prevents conflicts with SMAA's edges framebuffer)\n        this.ldrFramebuffer = gl.createFramebuffer();\n        this.ldrTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.ldrTexture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.ldrTexture, 0);\n\n        const ldrFBStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (ldrFBStatus !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('LDR framebuffer incomplete', { status: ldrFBStatus });\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        logger.info('LDR framebuffer created for tone mapping output');\n\n        // Create final output framebuffer for scaled rendering\n        // SMAA will render to this at scaled resolution, then we resample to canvas\n        this.finalFramebuffer = gl.createFramebuffer();\n        this.finalTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        // Use linear filtering (mipmaps require power-of-two textures in WebGL 1.0)\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.finalFramebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.finalTexture, 0);\n\n        const finalFBStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (finalFBStatus !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Final framebuffer incomplete', { status: finalFBStatus });\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        logger.info('Final framebuffer created for supersampling output');\n\n        // Create buffer statistics manager\n        this.bufferStatsManager = new BufferStatsManager(gl);\n        this.velocityStatsManager = new VelocityStatsManager(gl);\n        this.statsUpdateInterval = 60; // Update stats every N frames (adaptive)\n        this.statsUpdateIntervalSlow = 120; // Slower update when not running (less important)\n        this.statsCoarseMode = true; // Use coarse sampling by default\n\n        // Create full-screen quad buffer\n        this.quadBuffer = this.createBuffer(new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]));\n\n        // Share quad buffer with postprocessing managers to avoid duplication\n        this.smaaManager.setQuadBuffer(this.quadBuffer);\n        this.bilateralManager.setQuadBuffer(this.quadBuffer);\n\n        // Compile shaders\n        logger.info('Compiling shaders...', { dimensions: this.dimensions, integrator: this.integratorType });\n        const shaderError = this.compileShaders();\n        if (shaderError) {\n            logger.error('Shader compilation failed', shaderError);\n            throw new Error(`Shader compilation failed: ${shaderError}`);\n        }\n        logger.info('Shaders compiled successfully');\n\n        // Initialize textures with particle data\n        logger.info('Initializing particle textures...', {\n            resolution: this.particleSystem.getResolution(),\n            particleCount: this.particleSystem.getActualParticleCount()\n        });\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n\n        // Create particle index buffers for both modes\n        this.indexBufferPoints = this.createBuffer(this.particleSystem.getIndices());\n        this.indexBufferLines = this.createLineIndexBuffer(this.particleSystem.getActualParticleCount());\n        this.vertexIdBufferLines = this.createLineVertexIdBuffer(this.particleSystem.getActualParticleCount());\n\n        // Animation state\n        this.isRunning = false;\n        this.frame = 0;\n        this.hdrLogged = false; // Flag to log HDR info on first frame\n    }\n\n    /**\n     * Create a WebGL buffer\n     */\n    createBuffer(data) {\n        const gl = this.gl;\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n    /**\n     * Create line mode index buffer (each particle index appears twice)\n     */\n    createLineIndexBuffer(particleCount) {\n        const gl = this.gl;\n        const indices = new Float32Array(particleCount * 2);\n\n        // Each particle renders 2 vertices: [0,0,1,1,2,2,3,3,...]\n        for (let i = 0; i < particleCount; i++) {\n            indices[i * 2] = i;\n            indices[i * 2 + 1] = i;\n        }\n\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n    /**\n     * Create vertex ID buffer for line mode (alternating 0,1 for prev/current)\n     */\n    createLineVertexIdBuffer(particleCount) {\n        const gl = this.gl;\n        const vertexIds = new Float32Array(particleCount * 2);\n\n        // Alternating pattern: [0,1,0,1,0,1,...]\n        // 0 = previous position, 1 = current position\n        for (let i = 0; i < particleCount * 2; i++) {\n            vertexIds[i] = i % 2;\n        }\n\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertexIds, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n\n    /**\n     * Compile all shader programs\n     */\n    compileShaders() {\n        const gl = this.gl;\n\n        try {\n            // Get coordinate system variable names\n            const coordinateVars = this.coordinateSystem.getVariableNames();\n            const isCartesian = this.coordinateSystem.name.includes('Cartesian');\n\n            // Parse expressions to GLSL using coordinate system variables\n            // For non-Cartesian systems, use 'pos_native' as the GLSL variable name\n            const posVarName = isCartesian ? 'pos' : 'pos_native';\n            const velocityGLSL = parseVectorField(this.expressions, coordinateVars, posVarName);\n            logger.verbose('Generated velocity GLSL', {\n                expressions: this.expressions,\n                coordinateSystem: this.coordinateSystem.name,\n                variables: coordinateVars,\n                posVarName: posVarName,\n                glsl: velocityGLSL\n            });\n\n            // Generate coordinate system GLSL code (if not Cartesian)\n            let coordinateSystemCode = null;\n            if (!isCartesian) {\n                const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n                const nativeVars = this.coordinateSystem.getVariableNames();\n\n                coordinateSystemCode = {\n                    name: this.coordinateSystem.name,\n                    nativeVars: nativeVars,\n                    forwardTransform: this.coordinateSystem.generateForwardTransformGLSL(cartesianVars, (expr, vars) => {\n                        return parseExpression(expr, vars.length, vars);\n                    }),\n                    inverseTransform: this.coordinateSystem.generateInverseTransformGLSL(nativeVars, (expr, vars) => {\n                        return parseExpression(expr, vars.length, vars);\n                    })\n                    // velocityTransform removed - not needed with native-space integration\n                };\n                logger.verbose('Generated coordinate system code', {\n                    name: coordinateSystemCode.name,\n                    forward: coordinateSystemCode.forwardTransform,\n                    inverse: coordinateSystemCode.inverseTransform\n                });\n            }\n\n            // Get integrator code (pass expressions and solutionMethod for Newton's method support)\n            const integratorParams = {\n                ...this.integratorParams,\n                expressions: this.expressions,\n                solutionMethod: this.solutionMethod\n            };\n            const integrator = getIntegrator(this.integratorType, this.dimensions, integratorParams);\n\n            // Store integrator costFactor for timestep scaling\n            this.integratorCostFactor = integrator.costFactor || 1;\n\n            // Get mapper code\n            const mapper = getMapper(this.mapperType, this.dimensions, this.mapperParams);\n\n            // Get transform code (domain transformation)\n            let transformCode = null;\n            if (this.transformType !== 'identity') {\n                const transform = getTransform(this.transformType);\n                transformCode = {\n                    helpers: transform.generateHelpers(this.dimensions),\n                    forward: transform.generateForward(this.dimensions),\n                    inverse: transform.generateInverse(this.dimensions),\n                    jacobian: transform.generateJacobian(this.dimensions)\n                };\n            }\n\n            // Get color mode code\n            const colorMode = getColorMode(this.colorMode, this.dimensions);\n            let colorCode = colorMode.code;\n            let usesMaxVelocity = colorMode.usesMaxVelocity || false;\n\n            // Handle expression mode specially\n            if (this.colorMode === 'expression') {\n                // Parse color expression to GLSL\n                const expressionGLSL = parseExpression(this.colorExpression, this.dimensions);\n\n                // Generate gradient GLSL\n                const gradientGLSL = generateGradientGLSL(this.colorGradient);\n\n                // Generate complete color function\n                colorCode = generateExpressionColorMode(this.dimensions, expressionGLSL, gradientGLSL);\n            }\n            // Handle custom gradient for preset modes\n            else if (this.useCustomGradient &&\n                     (this.colorMode === 'velocity_magnitude' ||\n                      this.colorMode === 'velocity_angle' ||\n                      this.colorMode === 'velocity_combined')) {\n                // Generate gradient GLSL\n                const gradientGLSL = generateGradientGLSL(this.colorGradient);\n\n                // Generate gradient-based version of the preset mode\n                colorCode = generateGradientColorMode(this.colorMode, this.dimensions, gradientGLSL);\n\n                // These modes still use max velocity\n                usesMaxVelocity = this.colorMode === 'velocity_magnitude' || this.colorMode === 'velocity_combined';\n            }\n\n            // Create update program\n            const updateVertexShader = generateUpdateVertexShader();\n            const updateFragmentShader = generateUpdateFragmentShader(\n                this.dimensions,\n                velocityGLSL,\n                integrator.code,\n                this.strategy,\n                transformCode,\n                coordinateSystemCode\n            );\n\n            this.updateProgram = createProgram(gl, updateVertexShader, updateFragmentShader);\n\n            // Note: Age is now stored in alpha channel of u_pos_0, no separate age shader needed\n\n            // Create draw program\n            const isLineMode = this.particleRenderMode === 'lines';\n            const drawVertexShader = generateDrawVertexShader(\n                this.dimensions,\n                mapper.code,\n                velocityGLSL,\n                this.strategy,\n                isLineMode,\n                coordinateSystemCode\n            );\n            const drawFragmentShader = generateDrawFragmentShader(this.dimensions, colorCode, usesMaxVelocity);\n\n            this.drawProgram = createProgram(gl, drawVertexShader, drawFragmentShader);\n\n            // Track whether we need to compute max velocity\n            this.usesMaxVelocity = usesMaxVelocity;\n\n            // Store shader source for debugging\n            this.shaderSource = {\n                updateVertex: updateVertexShader,\n                updateFragment: updateFragmentShader,\n                drawVertex: drawVertexShader,\n                drawFragment: drawFragmentShader,\n                velocityField: velocityGLSL  // Store for velocity stats manager\n            };\n\n            // Dump shaders if flag is set\n            if (this.dumpShadersOnCompile) {\n                console.log('\\n========== SHADER DUMP ==========');\n                console.log(`Config: ${this.dimensions}D, ${this.integratorType}, ${this.mapperType}, ${this.colorMode}`);\n                console.log('\\n--- UPDATE VERTEX SHADER ---');\n                console.log(updateVertexShader);\n                console.log('\\n--- UPDATE FRAGMENT SHADER ---');\n                console.log(updateFragmentShader);\n                console.log('\\n--- DRAW VERTEX SHADER ---');\n                console.log(drawVertexShader);\n                console.log('\\n--- DRAW FRAGMENT SHADER ---');\n                console.log(drawFragmentShader);\n                console.log('\\n=================================\\n');\n                this.dumpShadersOnCompile = false; // Only dump once\n            }\n\n            // Initialize velocity stats manager with current velocity field\n            if (this.velocityStatsManager) {\n                this.velocityStatsManager.dispose(); // Clean up old instance\n                const initSuccess = this.velocityStatsManager.initialize(this.dimensions, velocityGLSL, coordinateSystemCode);\n                if (initSuccess) {\n                    logger.verbose('Velocity stats manager initialized');\n                } else {\n                    logger.warn('Failed to initialize velocity stats manager');\n                }\n            }\n\n            // Create screen programs\n            const screenVertexShader = generateScreenVertexShader();\n            const fadeFragmentShader = generateScreenFadeFragmentShader();\n\n            // Generate tone mapping shader with selected operator\n            const tonemapCode = generateTonemapGLSL(this.tonemapOperator, {\n                exposure: this.exposure,\n                gamma: this.gamma,\n                luminanceGamma: this.luminanceGamma,\n                whitePoint: this.whitePoint\n            });\n            const tonemapFragmentShader = generateTonemapFragmentShader(tonemapCode);\n\n            this.screenFadeProgram = createProgram(gl, screenVertexShader, fadeFragmentShader);\n            this.tonemapProgram = createProgram(gl, screenVertexShader, tonemapFragmentShader);\n\n            // Compile bloom shaders if bloom is enabled\n            if (this.bloomManager.isEnabled()) {\n                const bloomBrightPassShader = generateBloomBrightPassShader();\n                const bloomBlurHorizontalShader = generateBloomBlurShader(true, this.bloomRadius);\n                const bloomBlurVerticalShader = generateBloomBlurShader(false, this.bloomRadius);\n                const bloomCombineShader = generateBloomCombineShader();\n\n                this.bloomBrightPassProgram = createProgram(gl, screenVertexShader, bloomBrightPassShader);\n                this.bloomBlurHProgram = createProgram(gl, screenVertexShader, bloomBlurHorizontalShader);\n                this.bloomBlurVProgram = createProgram(gl, screenVertexShader, bloomBlurVerticalShader);\n                this.bloomCombineProgram = createProgram(gl, screenVertexShader, bloomCombineShader);\n\n                logger.verbose('Bloom shaders compiled', {\n                    threshold: this.whitePoint,\n                    intensity: this.bloomIntensity,\n                    radius: this.bloomRadius\n                });\n            }\n\n            // Store shader source for debugging\n            this.shaderSource.screenFade = fadeFragmentShader;\n            this.shaderSource.tonemap = tonemapFragmentShader;\n\n            logger.verbose('Tone mapping operator compiled', {\n                operator: this.tonemapOperator,\n                exposure: this.exposure,\n                gamma: this.gamma,\n                whitePoint: this.whitePoint\n            });\n\n            // Set flag to indicate shaders were just recompiled (for animation timing)\n            this.shadersJustRecompiled = true;\n\n            return null; // No error\n        } catch (error) {\n            return error.message;\n        }\n    }\n\n    /**\n     * Update particle positions\n     */\n    updatePositions() {\n        const gl = this.gl;\n        const program = this.updateProgram;\n\n        // Sample actual particle data every 60 frames for detailed inspection\n        // Only if debug stats enabled (expensive GPU readback)\n        if (this.enableDebugStats && this.frame % 60 === 0) {\n            this.sampleParticleData();\n        }\n\n        // Debug: log shader uniforms occasionally\n        if (this.frame % 600 === 0) {\n            logger.verbose(`Frame ${this.frame}: Shader uniforms`, {\n                u_min: [this.bbox.min[0], this.bbox.min[1]],\n                u_max: [this.bbox.max[0], this.bbox.max[1]],\n                u_h: this.timestep * (this.integratorCostFactor || 1),\n                timestep_base: this.timestep,\n                costFactor: this.integratorCostFactor || 1,\n                u_drop_rate: this.dropProbability\n            });\n        }\n\n        gl.useProgram(program);\n\n        // Bind quad for full-screen pass\n        const aPosLoc = gl.getAttribLocation(program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Bind position textures\n        this.textureManager.bindReadTextures(program);\n\n        // Set uniforms\n        const resolution = this.particleSystem.getResolution();\n        const randSeed = Math.random(); // Generate once per frame for consistency\n        gl.uniform2f(gl.getUniformLocation(program, 'u_min'), this.bbox.min[0], this.bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_max'), this.bbox.max[0], this.bbox.max[1]);\n        // Scale timestep by integrator cost factor for fair comparison\n        gl.uniform1f(gl.getUniformLocation(program, 'u_h'), this.timestep * (this.integratorCostFactor || 1));\n        gl.uniform1f(gl.getUniformLocation(program, 'u_rand_seed'), randSeed);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_drop_rate'), this.dropProbability);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particles_res'), resolution);\n        const velocityScale = this.getVelocityScale();\n        gl.uniform1f(gl.getUniformLocation(program, 'u_max_velocity'), velocityScale);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_drop_low_velocity'), this.dropLowVelocity ? 1.0 : 0.0);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_velocity_threshold'), this.lowVelocityThreshold);\n\n        // Set animation alpha parameter (for time-based expressions)\n        const alphaLoc = gl.getUniformLocation(program, 'u_alpha');\n        if (alphaLoc !== null) {\n            gl.uniform1f(alphaLoc, this.animationAlpha);\n        }\n\n        // Set transform parameters (if transform is active)\n        if (this.transformType !== 'identity') {\n            const params = this.transformParams || {};\n            // Map transform-specific parameters to vec4\n            // power: alpha, 0, 0, 0\n            // tanh: beta, 0, 0, 0\n            // sigmoid: k, 0, 0, 0\n            // exp: alpha, 0, 0, 0\n            // sine: amplitude, frequency, 0, 0\n            // radial_power: alpha, 0, 0, 0\n            const paramValues = [\n                params.alpha || params.beta || params.k || params.amplitude || 0.5,  // First param\n                params.frequency || 0.0,  // Second param (sine wave)\n                0.0,  // Reserved\n                0.0   // Reserved\n            ];\n            gl.uniform4f(gl.getUniformLocation(program, 'u_transform_params'),\n                paramValues[0], paramValues[1], paramValues[2], paramValues[3]);\n        }\n\n        // Render to each dimension texture\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            gl.uniform1i(gl.getUniformLocation(program, 'u_out_coordinate'), dim);\n\n            const writeTexture = this.textureManager.getWriteTexture(dim);\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.updateFramebuffer);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                writeTexture,\n                0\n            );\n\n            gl.viewport(0, 0, resolution, resolution);\n            gl.drawArrays(gl.TRIANGLES, 0, 6);\n        }\n\n        // Age is now stored in alpha channel of u_pos_0, no separate update needed\n\n        // Swap textures\n        this.textureManager.swap();\n\n        this.frame++;\n    }\n\n    /**\n     * Draw particles to screen\n     */\n    drawParticles() {\n        const gl = this.gl;\n        const program = this.drawProgram;\n\n        gl.useProgram(program);\n\n        // Use additive blending for HDR accumulation (allows values > 1.0)\n        // Formula: src * src_alpha + dst * 1.0\n        // This allows overlapping particles to create bright HDR values\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n\n        // Update max velocity tracker using GPU-based sampling and exponential moving average\n        this.framesSinceLastSample++;\n\n        // Adaptive sampling: sample more frequently when velocity is changing\n        if (this.framesSinceLastSample >= this.velocitySampleInterval) {\n            this.framesSinceLastSample = 0;\n\n            // GPU-based velocity sampling (much faster than CPU approach)\n            if (this.velocityStatsManager && this.velocityStatsManager.initialized) {\n                const posTextures = this.textureManager.getReadTextures();\n                const stats = this.velocityStatsManager.compute(posTextures, this.bbox, this.particleSystem.getResolution(), this.animationAlpha);\n\n                // Log occasionally for debugging\n                if (this.frame % 600 === 0 && stats.sampleCount > 0) {\n                    logger.debug(`GPU velocity stats: avg=${stats.avgVelocity.toFixed(3)}, max=${stats.maxVelocity.toFixed(3)} (${stats.sampleCount} samples)`);\n                }\n\n                // Update max velocity with exponential moving average\n                if (stats.maxVelocity > 0) {\n                    // Use asymmetric blending: faster response to increases, slower to decreases\n                    const alpha = stats.maxVelocity > this.maxVelocity ?\n                                 this.velocityEMAAlpha * 2 : // Faster tracking upward\n                                 this.velocityEMAAlpha;      // Slower decay downward\n\n                    this.prevMaxVelocity = this.maxVelocity;\n                    this.maxVelocity = alpha * stats.maxVelocity + (1 - alpha) * this.maxVelocity;\n                }\n            } else {\n                // Manager not initialized - log warning once\n                if (!this.velocityStatsWarningLogged) {\n                    logger.warn('Velocity stats manager not initialized - max velocity will not be computed');\n                    this.velocityStatsWarningLogged = true;\n                }\n            }\n\n            // Calculate relative change rate (normalized by current value)\n            const relativeChange = Math.abs(this.maxVelocity - this.prevMaxVelocity) /\n                                  Math.max(this.maxVelocity, 0.1);\n\n            // Adapt sample interval based on rate of change\n            // High change rate (>5%) \u2192 sample frequently (min interval)\n            // Low change rate (<1%) \u2192 sample infrequently (max interval)\n            // Linear interpolation between min and max based on change rate\n            const changeThresholdHigh = 0.05; // 5% change\n            const changeThresholdLow = 0.01;  // 1% change\n\n            if (relativeChange > changeThresholdHigh) {\n                // Rapidly changing: sample frequently\n                this.velocitySampleInterval = this.velocitySampleIntervalMin;\n            } else if (relativeChange < changeThresholdLow) {\n                // Stable: sample infrequently\n                this.velocitySampleInterval = this.velocitySampleIntervalMax;\n            } else {\n                // Moderate change: interpolate\n                const t = (relativeChange - changeThresholdLow) /\n                         (changeThresholdHigh - changeThresholdLow);\n                this.velocitySampleInterval = Math.round(\n                    this.velocitySampleIntervalMax * (1 - t) +\n                    this.velocitySampleIntervalMin * t\n                );\n            }\n        }\n\n        // Prevent from dropping too low\n        this.maxVelocity = Math.max(this.maxVelocity, 0.5);\n\n        // Bind particle indices (different buffer for line mode)\n        const aIndexLoc = gl.getAttribLocation(program, 'a_index');\n        const indexBuffer = this.particleRenderMode === 'lines' ? this.indexBufferLines : this.indexBufferPoints;\n        gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n        gl.enableVertexAttribArray(aIndexLoc);\n        gl.vertexAttribPointer(aIndexLoc, 1, gl.FLOAT, false, 0, 0);\n\n        // Bind vertex ID buffer for line mode (distinguishes prev vs current vertex)\n        if (this.particleRenderMode === 'lines') {\n            const aVertexIdLoc = gl.getAttribLocation(program, 'a_vertex_id');\n            if (aVertexIdLoc !== -1) {\n                gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexIdBufferLines);\n                gl.enableVertexAttribArray(aVertexIdLoc);\n                gl.vertexAttribPointer(aVertexIdLoc, 1, gl.FLOAT, false, 0, 0);\n            }\n        }\n\n        // Bind position textures (age is in alpha channel of u_pos_0)\n        this.textureManager.bindReadTextures(program);\n\n        // Bind previous position textures (always needed for velocity computation)\n        this.textureManager.bindPrevTextures(program);\n\n        // Set uniforms\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particles_res'), this.particleSystem.getResolution());\n        gl.uniform2f(gl.getUniformLocation(program, 'u_min'), this.bbox.min[0], this.bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_max'), this.bbox.max[0], this.bbox.max[1]);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particle_intensity'), this.particleIntensity);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particle_size'), this.particleSize);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_viewport_size'), this.renderWidth, this.renderHeight);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_canvas_size'), this.canvas.width, this.canvas.height);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_color_saturation'), this.colorSaturation);\n\n        // Set animation alpha parameter (for color expressions using 'a')\n        const alphaLoc = gl.getUniformLocation(program, 'u_alpha');\n        if (alphaLoc !== null) {\n            gl.uniform1f(alphaLoc, this.animationAlpha);\n        }\n\n        // Set max velocity uniform if needed\n        if (this.usesMaxVelocity) {\n            const velocityScale = this.getVelocityScale();\n            gl.uniform1f(gl.getUniformLocation(program, 'u_max_velocity'), velocityScale);\n            gl.uniform1f(gl.getUniformLocation(program, 'u_velocity_log_scale'), this.velocityLogScale ? 1.0 : 0.0);\n        }\n\n        // Draw particles (points or lines)\n        if (this.particleRenderMode === 'lines') {\n            // In line mode, we render 2 vertices per particle (previous and current position)\n            gl.drawArrays(gl.LINES, 0, this.particleSystem.getActualParticleCount() * 2);\n        } else {\n            // Point mode\n            gl.drawArrays(gl.POINTS, 0, this.particleSystem.getActualParticleCount());\n        }\n    }\n\n    /**\n     * Get velocity scale value based on selected mode\n     */\n    getVelocityScale() {\n        if (!this.velocityStatsManager || !this.velocityStatsManager.initialized) {\n            return this.maxVelocity;\n        }\n\n        const stats = this.velocityStatsManager.getCached();\n\n        switch (this.velocityScaleMode) {\n            case 'max':\n                return stats.maxVelocity || this.maxVelocity;\n            case 'average':\n                return stats.avgVelocity || this.maxVelocity;\n            case 'percentile90':\n                return stats.percentile90 || stats.avgVelocity || this.maxVelocity;\n            case 'percentile95':\n                return stats.percentile95 || stats.avgVelocity || this.maxVelocity;\n            default:\n                return this.maxVelocity;\n        }\n    }\n\n    /**\n     * Fade previous frame\n     */\n    fadeScreen() {\n        const gl = this.gl;\n\n        const currentTex = this.framebufferManager.getCurrentTexture();\n\n        // Swap to next buffer\n        this.framebufferManager.swap();\n\n        // Bind next buffer for rendering\n        this.framebufferManager.bind();\n\n        // CRITICAL: Set viewport to render size for HDR framebuffer rendering\n        // Use supersample resolution for higher quality\n        gl.viewport(0, 0, this.renderWidth, this.renderHeight);\n\n        // Disable blending for fade pass (we're doing a direct texture copy with multiplication)\n        gl.disable(gl.BLEND);\n\n        gl.useProgram(this.screenFadeProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.screenFadeProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, currentTex);\n        gl.uniform1i(gl.getUniformLocation(this.screenFadeProgram, 'u_screen'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.screenFadeProgram, 'u_fade'), this.fadeOpacity);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Re-enable blending for particle drawing\n        gl.enable(gl.BLEND);\n    }\n\n    /**\n     * Apply bloom effect\n     * Extracts bright regions, blurs them, and combines with base image\n     */\n    applyBloom() {\n        if (!this.bloomManager.isEnabled()) return;\n\n        const gl = this.gl;\n        const bloomSize = this.bloomManager.getBloomSize();\n\n        // Step 1: Extract bright pass (pixels above white point threshold)\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.bloomManager.getBrightFBO());\n        gl.viewport(0, 0, bloomSize.width, bloomSize.height);\n        gl.disable(gl.BLEND);\n\n        gl.useProgram(this.bloomBrightPassProgram);\n        const aPosLoc1 = gl.getAttribLocation(this.bloomBrightPassProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc1);\n        gl.vertexAttribPointer(aPosLoc1, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.framebufferManager.getCurrentTexture());\n        gl.uniform1i(gl.getUniformLocation(this.bloomBrightPassProgram, 'u_screen'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.bloomBrightPassProgram, 'u_threshold'), this.whitePoint);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Step 2: Blur horizontally\n        const blurFBOs = this.bloomManager.getBlurFBOs();\n        const blurTextures = this.bloomManager.getBlurTextures();\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, blurFBOs[0]);\n        gl.useProgram(this.bloomBlurHProgram);\n\n        const aPosLoc2 = gl.getAttribLocation(this.bloomBlurHProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc2);\n        gl.vertexAttribPointer(aPosLoc2, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.bloomManager.getBrightTexture());\n        gl.uniform1i(gl.getUniformLocation(this.bloomBlurHProgram, 'u_texture'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.bloomBlurHProgram, 'u_texel_size'),\n                    1.0 / bloomSize.width, 1.0 / bloomSize.height);\n        gl.uniform1f(gl.getUniformLocation(this.bloomBlurHProgram, 'u_radius'), this.bloomRadius);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Step 3: Blur vertically\n        gl.bindFramebuffer(gl.FRAMEBUFFER, blurFBOs[1]);\n        gl.useProgram(this.bloomBlurVProgram);\n\n        const aPosLoc3 = gl.getAttribLocation(this.bloomBlurVProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc3);\n        gl.vertexAttribPointer(aPosLoc3, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, blurTextures[0]);\n        gl.uniform1i(gl.getUniformLocation(this.bloomBlurVProgram, 'u_texture'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.bloomBlurVProgram, 'u_texel_size'),\n                    1.0 / bloomSize.width, 1.0 / bloomSize.height);\n        gl.uniform1f(gl.getUniformLocation(this.bloomBlurVProgram, 'u_radius'), this.bloomRadius);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // DON'T combine bloom back to HDR buffer - that causes accumulation\n        // Instead, we'll pass the bloom texture to the tone mapping shader\n        // Store bloom texture for later use in tone mapping\n        this.currentBloomTexture = blurTextures[1];\n    }\n\n    /**\n     * Resample scaled render to canvas\n     * Uses bilinear filtering for smooth resampling (both up and down)\n     */\n    downsampleToCanvas() {\n        const gl = this.gl;\n\n        // Bind canvas\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n\n        // Use simple copy shader (screenFadeProgram just samples texture)\n        gl.useProgram(this.screenFadeProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.screenFadeProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Bind final texture (SMAA output at scaled resolution)\n        // Bilinear filtering provides smooth resampling\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        gl.uniform1i(gl.getUniformLocation(this.screenFadeProgram, 'u_screen'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.screenFadeProgram, 'u_fade'), 1.0); // No fade, just copy\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    /**\n     * Render one frame\n     * @param {boolean} displayToCanvas - If false, renders to hidden buffer without displaying (for double-buffering)\n     */\n    render(displayToCanvas = true) {\n        const gl = this.gl;\n\n        // Log HDR status on first frame\n        if (!this.hdrLogged) {\n            const hdrSupport = this.framebufferManager.getHDRSupport();\n            logger.info('First frame render', {\n                renderingMode: hdrSupport.enabled ? 'HDR' : 'LDR',\n                textureFormat: hdrSupport.format,\n                exposure: this.exposure,\n                gamma: this.gamma\n            });\n            this.hdrLogged = true;\n        }\n\n        // Update positions\n        this.updatePositions();\n\n        // Fade previous frame\n        this.fadeScreen();\n\n        // Draw particles to current framebuffer\n        this.framebufferManager.bind();\n\n        // Enable depth testing if configured (plasma mode)\n        if (this.useDepthTest) {\n            gl.enable(gl.DEPTH_TEST);\n            gl.depthFunc(gl.LESS);  // Closer particles occlude farther ones\n\n            // Clear depth buffer (color is not cleared - we want trails from fade)\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n\n        this.drawParticles();\n\n        // Disable depth test after particle drawing (if it was enabled)\n        if (this.useDepthTest) {\n            gl.disable(gl.DEPTH_TEST);\n        }\n\n        // Apply bloom effect (extract bright regions, blur, combine)\n        this.applyBloom();\n\n        // Render tone mapping to dedicated LDR framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n        gl.viewport(0, 0, this.renderWidth, this.renderHeight);\n\n        // Disable blending for tone mapping pass\n        gl.disable(gl.BLEND);\n\n        // Use tone mapping shader\n        gl.useProgram(this.tonemapProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.tonemapProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Base HDR texture\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.framebufferManager.getCurrentTexture());\n        gl.uniform1i(gl.getUniformLocation(this.tonemapProgram, 'u_screen'), 0);\n\n        // Bloom texture (if enabled)\n        if (this.bloomManager.isEnabled() && this.currentBloomTexture) {\n            gl.activeTexture(gl.TEXTURE1);\n            gl.bindTexture(gl.TEXTURE_2D, this.currentBloomTexture);\n            gl.uniform1i(gl.getUniformLocation(this.tonemapProgram, 'u_bloom'), 1);\n            gl.uniform1i(gl.getUniformLocation(this.tonemapProgram, 'u_bloom_enabled'), 1);\n            gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_bloom_intensity'), this.bloomIntensity);\n            gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_bloom_alpha'), this.bloomAlpha);\n        } else {\n            gl.uniform1i(gl.getUniformLocation(this.tonemapProgram, 'u_bloom_enabled'), 0);\n        }\n\n        // Get cached buffer stats\n        const stats = this.bufferStatsManager.getCached();\n\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_exposure'), this.exposure);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_gamma'), this.gamma);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_whitePoint'), this.whitePoint);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_highlight_compression'), this.highlightCompression);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_compression_threshold'), this.compressionThreshold);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_brightness_desat'), this.brightnessDesaturation);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_brightness_sat'), this.brightnessSaturation);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_hdr_max_brightness'), stats.maxBrightness);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_hdr_avg_brightness'), stats.avgBrightness);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Apply bilateral filter for edge-preserving noise reduction\n        // Reads from LDR tone-mapped texture, writes to bilateral framebuffer\n        const filteredTexture = this.bilateralManager.apply(this.ldrTexture);\n\n        // Apply SMAA to filtered LDR image (3-pass morphological AA)\n        // SMAA reads from filtered texture and outputs to final framebuffer\n        this.smaaManager.applyToFramebuffer(filteredTexture, this.finalFramebuffer, this.quadBuffer);\n\n        // Resample to canvas (bilinear filtering for smooth scaling)\n        // Skip if we're accumulating in hidden buffer (double-buffering mode)\n        if (displayToCanvas) {\n            this.downsampleToCanvas();\n        }\n\n        // Update buffer statistics periodically\n        if (!this.frame) this.frame = 0;\n        this.frame++;\n\n        // Compute buffer stats with adaptive interval (needed for tone mapping)\n        // Use slower update rate when main loop is paused (animation is controlling rendering)\n        const currentInterval = this.isRunning ? this.statsUpdateInterval : this.statsUpdateIntervalSlow;\n        if (this.frame % currentInterval === 0) {\n            const hdrTexture = this.framebufferManager.getCurrentTexture();\n            const newStats = this.bufferStatsManager.compute(\n                hdrTexture,\n                this.renderWidth,  // Use actual render resolution, not canvas size\n                this.renderHeight,\n                true  // Always use coarse sampling for performance\n            );\n\n            // Log stats occasionally for debugging (only if debug stats enabled)\n            if (this.enableDebugStats && this.frame % (currentInterval * 10) === 0) {\n                logger.info('HDR Buffer Stats (sampled)', {\n                    avgBrightness: newStats.avgBrightness.toFixed(2),\n                    maxBrightness: newStats.maxBrightness.toFixed(2),\n                    sampledPixels: newStats.sampledPixels,\n                    sampleRate: newStats.sampleRate\n                });\n            }\n        }\n    }\n\n    /**\n     * Get current HDR buffer statistics (using cached values from BufferStatsManager)\n     */\n    getBufferStats() {\n        const stats = this.bufferStatsManager.getCached();\n        // Add velocity info from GPU-based velocity stats\n        const velStats = this.velocityStatsManager ? this.velocityStatsManager.getCached() : null;\n        stats.maxVelocity = this.maxVelocity; // EMA-smoothed max velocity\n        stats.avgVelocity = velStats ? velStats.avgVelocity : 0;\n        stats.velocitySampleCount = velStats ? velStats.sampleCount : 0; // 64 GPU samples\n        return stats;\n    }\n\n    /**\n     * Log HDR buffer statistics to console\n     */\n    logBufferStats() {\n        const stats = this.getBufferStats(); // Use getBufferStats to include velocity\n        const age = Date.now() - stats.timestamp;\n\n        logger.info('=== HDR Buffer Statistics (Sampled) ===');\n        logger.info(`Cached age: ${(age / 1000).toFixed(1)}s`);\n        logger.info(`Sample rate: every ${stats.sampleRate}th pixel (${stats.sampledPixels} total)`);\n        logger.info(`Red   - Min: ${stats.red.min.toFixed(6)}, Max: ${stats.red.max.toFixed(6)}, Avg: ${stats.red.avg.toFixed(6)}`);\n        logger.info(`Green - Min: ${stats.green.min.toFixed(6)}, Max: ${stats.green.max.toFixed(6)}, Avg: ${stats.green.avg.toFixed(6)}`);\n        logger.info(`Blue  - Min: ${stats.blue.min.toFixed(6)}, Max: ${stats.blue.max.toFixed(6)}, Avg: ${stats.blue.avg.toFixed(6)}`);\n        logger.info(`Max Brightness: ${stats.maxBrightness.toFixed(6)}`);\n        logger.info(`Avg Brightness: ${stats.avgBrightness.toFixed(6)}`);\n        logger.info(`Max Velocity: ${stats.maxVelocity.toFixed(6)} (GPU-sampled, ${stats.velocitySampleCount} particles, EMA-smoothed)`);\n        if (stats.avgVelocity) {\n            logger.info(`Avg Velocity: ${stats.avgVelocity.toFixed(6)}`);\n        }\n    }\n\n    /**\n     * DEPRECATED: Old particle statistics (removed - use BufferStatsManager instead)\n     */\n    calculateParticleStatistics_REMOVED() {\n        const resolution = this.particleSystem.getResolution();\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        const posStats = [];\n        const velStats = [];\n\n        // Decode all particle positions\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n        const positions = [];\n\n        for (let i = 0; i < this.particleSystem.getActualParticleCount(); i++) {\n            const pos = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const data = dimensionData[dim];\n                const texelIdx = i * componentsPerValue;\n\n                // Extract buffer for this value\n                const buffer = new ArrayType(componentsPerValue);\n                for (let c = 0; c < componentsPerValue; c++) {\n                    buffer[c] = data[texelIdx + c];\n                }\n\n                // Determine min/max for this dimension\n                const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n                const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n\n                // Decode using strategy\n                const worldValue = this.strategy.decodeValue(buffer, min, max);\n\n                pos.push(worldValue);\n            }\n            positions.push(pos);\n        }\n\n        // Calculate position statistics\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            let min = Infinity;\n            let max = -Infinity;\n            let sum = 0;\n\n            for (const pos of positions) {\n                min = Math.min(min, pos[dim]);\n                max = Math.max(max, pos[dim]);\n                sum += pos[dim];\n            }\n\n            const dimName = ['x', 'y', 'z', 'w'][dim] || `dim${dim}`;\n            posStats.push({\n                dim: dimName,\n                min: min.toFixed(3),\n                max: max.toFixed(3),\n                avg: (sum / positions.length).toFixed(3)\n            });\n        }\n\n        // Calculate velocity statistics\n        if (this.velocityEvaluators) {\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                let min = Infinity;\n                let max = -Infinity;\n                let sum = 0;\n\n                try {\n                    for (const pos of positions) {\n                        const velocity = this.velocityEvaluators[dim](...pos);\n                        min = Math.min(min, velocity);\n                        max = Math.max(max, velocity);\n                        sum += velocity;\n                    }\n\n                    const dimName = ['x', 'y', 'z', 'w'][dim] || `dim${dim}`;\n                    velStats.push({\n                        dim: `v${dimName}`,\n                        min: min.toFixed(3),\n                        max: max.toFixed(3),\n                        avg: (sum / positions.length).toFixed(3)\n                    });\n                } catch (error) {\n                    logger.warn(`Error computing velocity for dim ${dim}`, error);\n                }\n            }\n        }\n\n        logger.verbose(`Frame ${this.frame}: Particle statistics`, {\n            bounds: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`,\n            position: posStats,\n            velocity: velStats.length > 0 ? velStats : 'N/A'\n        });\n    }\n\n    /**\n     * Sample a single particle's velocity magnitude\n     */\n    sampleParticleVelocity() {\n        const gl = this.gl;\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n\n        // Sample a random particle\n        const particleIdx = Math.floor(Math.random() * this.particleSystem.getActualParticleCount());\n        const texelIdx = particleIdx * componentsPerValue;\n\n        // Get position for all dimensions\n        const position = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            const data = dimensionData[dim];\n            const buffer = new ArrayType(componentsPerValue);\n            for (let c = 0; c < componentsPerValue; c++) {\n                buffer[c] = data[texelIdx + c];\n            }\n\n            const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n            const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n            const worldValue = this.strategy.decodeValue(buffer, min, max);\n            position.push(worldValue);\n        }\n\n        // Compute velocity using the velocity evaluators\n        if (!this.velocityEvaluators || this.velocityEvaluators.length === 0) {\n            return 0;\n        }\n\n        try {\n            const velocity = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const vel = this.velocityEvaluators[dim](...position);\n                velocity.push(vel);\n            }\n\n            // Compute magnitude\n            const magnitudeSquared = velocity.reduce((sum, v) => sum + v * v, 0);\n            const magnitude = Math.sqrt(magnitudeSquared);\n\n            // Check for invalid values\n            if (!isFinite(magnitude)) {\n                if (!this.velocityNaNWarningLogged) {\n                    logger.warn('Invalid velocity magnitude detected', {\n                        position,\n                        velocity,\n                        magnitude\n                    });\n                    this.velocityNaNWarningLogged = true;\n                }\n                return 0;\n            }\n\n            return magnitude;\n        } catch (error) {\n            if (!this.velocityErrorLogged) {\n                logger.error('Error computing velocity', error);\n                this.velocityErrorLogged = true;\n            }\n            return 0;\n        }\n    }\n\n    /**\n     * Sample particle data for debugging\n     */\n    sampleParticleData() {\n        const sampleCount = 5;\n        const resolution = this.particleSystem.getResolution();\n        const samples = [];\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        // Age is now stored in alpha channel of dimension 0 texture\n        // We'll read it directly from dimensionData[0]\n\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n\n        // Decode a few random particles\n        for (let i = 0; i < sampleCount; i++) {\n            const particleIdx = Math.floor(Math.random() * this.particleSystem.getActualParticleCount());\n            const texelIdx = particleIdx * componentsPerValue;\n\n            const position = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const data = dimensionData[dim];\n\n                // Extract buffer for this value\n                const buffer = new ArrayType(componentsPerValue);\n                for (let c = 0; c < componentsPerValue; c++) {\n                    buffer[c] = data[texelIdx + c];\n                }\n\n                // Determine min/max for this dimension\n                const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n                const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n\n                // Decode using strategy\n                const worldValue = this.strategy.decodeValue(buffer, min, max);\n\n                position.push(worldValue.toFixed(3));\n            }\n\n            // Decode age value from alpha channel of dimension 0\n            // For RGBA textures, alpha is the 4th component (index 3)\n            const dim0Data = dimensionData[0];\n            const ageValue = componentsPerValue === 4 ? dim0Data[texelIdx + 3] : 1.0;\n\n            samples.push({\n                particle: particleIdx,\n                position: position.join(', '),\n                age: ageValue.toFixed(2)\n            });\n        }\n\n        logger.verbose(`Frame ${this.frame}: Sampled ${sampleCount} particles (with age)`, {\n            bounds: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`,\n            samples: samples\n        });\n    }\n\n    /**\n     * Decode float from RGBA (matches shader decode)\n     * Returns normalized value in [0, 1] range\n     */\n    decodeFloatRGBA(r, g, b, a) {\n        // Fixed-point decoding to [0, 1]\n        const FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n\n        // Reconstruct 32-bit integer from bytes (big-endian)\n        const intValue = (r << 24) | (g << 16) | (b << 8) | a;\n        const uintValue = intValue >>> 0; // convert to unsigned\n\n        // Map from [0, 2^32-1] back to [0, 1]\n        return uintValue / FIXED_POINT_SCALE;\n    }\n\n    /**\n     * Start animation loop\n     */\n    start() {\n        this.isRunning = true;\n        this.frameCount = 0;\n        this.totalFrames = 0; // Total frames since last screen clear\n        this.lastFpsUpdate = performance.now();\n        this.fps = 0;\n\n        // Only initialize frame limit settings if they don't exist yet\n        // (don't reset them on restart, preserve user settings)\n        if (this.frameLimitEnabled === undefined) {\n            this.frameLimitEnabled = false;\n        }\n        if (this.frameLimit === undefined) {\n            this.frameLimit = 1000;\n        }\n\n        logger.verbose(`Starting render loop (frameLimitEnabled: ${this.frameLimitEnabled}, frameLimit: ${this.frameLimit})`);\n\n        const loop = () => {\n            if (!this.isRunning) return;\n\n            // Update FPS counter\n            this.frameCount++;\n            this.totalFrames++;\n            const now = performance.now();\n            const elapsed = now - this.lastFpsUpdate;\n\n            if (elapsed >= 500) { // Update FPS every 500ms\n                this.fps = Math.round((this.frameCount * 1000) / elapsed);\n                this.frameCount = 0;\n                this.lastFpsUpdate = now;\n            }\n\n            this.render();\n\n            // Check if frame limit is reached AFTER rendering this frame\n            if (this.frameLimitEnabled && this.totalFrames >= this.frameLimit) {\n                // Update FPS one last time before stopping\n                const finalNow = performance.now();\n                const finalElapsed = finalNow - this.lastFpsUpdate;\n                if (finalElapsed > 0) {\n                    this.fps = Math.round((this.frameCount * 1000) / finalElapsed);\n                }\n                logger.info(`Frame limit reached (${this.frameLimit} frames), stopping render loop`);\n                this.stop();\n                return;\n            }\n\n            requestAnimationFrame(loop);\n        };\n        loop();\n    }\n\n    /**\n     * Stop animation\n     */\n    stop() {\n        this.isRunning = false;\n    }\n\n    /**\n     * Set animation alpha parameter (0.0 to 1.0)\n     * Used in expressions with the 'a' variable\n     */\n    setAnimationAlpha(alpha) {\n        this.animationAlpha = Math.max(0.0, Math.min(1.0, alpha));\n    }\n\n    /**\n     * Clear only the render buffer (remove trails but keep particles)\n     * Useful for animation frames where you want to reset the canvas\n     * but keep particles at their current positions\n     * @param {boolean} skipAutoRestart - Skip auto-restart of main render loop. Normally after clearing the buffer (e.g., user clicking Reset Particles after hitting frame limit), we auto-restart rendering as a convenience. Set to true during animation playback to prevent the main loop from interfering with the animation loop's manual render calls.\n     */\n    clearRenderBuffer(skipAutoRestart = false) {\n        this.framebufferManager.clearAll(0, 0, 0, 1);\n\n        // Reset frame counter since screen was cleared\n        this.totalFrames = 0;\n\n        // Restart rendering if it was stopped (e.g., from frame limit)\n        // Skip restart during animation playback to prevent interference\n        if (!this.isRunning && !skipAutoRestart) {\n            logger.info('Restarting render loop after render buffer clear');\n            this.start();\n        }\n\n        logger.verbose('Render buffer cleared (particles preserved)');\n    }\n\n    /**\n     * Reset particles to random initial positions\n     * Useful for starting a new animation frame with fresh particles\n     * @param {boolean} recompileShaders - Whether to recompile shaders after reset (default: false)\n     */\n    resetParticles(recompileShaders = false) {\n        this.particleSystem.initializeParticles();\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n        logger.verbose('Particles reinitialized to random positions');\n\n        if (recompileShaders) {\n            logger.info('Recompiling shaders after particle reset...');\n            try {\n                this.compileShaders();\n                logger.info('Shaders recompiled successfully');\n            } catch (error) {\n                logger.error('Failed to recompile shaders:', error);\n            }\n        }\n    }\n\n    /**\n     * Run N integration steps without rendering to canvas\n     * Useful for convergence/burn-in during animation\n     * @param {number} steps - Number of integration steps to execute\n     */\n    step(steps = 1) {\n        for (let i = 0; i < steps; i++) {\n            this.updatePositions();\n        }\n    }\n\n    /**\n     * Clear the screen (remove all particle trails and reinitialize particles)\n     */\n    clearScreen() {\n        // Clear all framebuffers to black\n        this.framebufferManager.clearAll(0, 0, 0, 1);\n\n        // Reinitialize all particles to random positions\n        this.particleSystem.initializeParticles();\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n\n        // Reset frame counter since screen was cleared\n        this.totalFrames = 0;\n\n        // Restart rendering if it was stopped (e.g., from frame limit)\n        if (!this.isRunning) {\n            logger.info('Restarting render loop after screen clear');\n            this.start();\n        }\n\n        logger.verbose('Screen cleared and particles reinitialized');\n    }\n\n    /**\n     * Capture the high-resolution render buffer as a PNG blob\n     * This captures the render buffer at the scaled resolution (renderWidth x renderHeight)\n     * instead of the canvas resolution, preserving full quality at higher render scales.\n     * @returns {Promise<Blob>} PNG image blob\n     */\n    captureRenderBuffer() {\n        return new Promise((resolve, reject) => {\n            const gl = this.gl;\n\n            try {\n                // Bind the final framebuffer to read from it\n                gl.bindFramebuffer(gl.FRAMEBUFFER, this.finalFramebuffer);\n\n                // Read pixels from the framebuffer\n                const pixels = new Uint8Array(this.renderWidth * this.renderHeight * 4);\n                gl.readPixels(0, 0, this.renderWidth, this.renderHeight, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n\n                // Unbind framebuffer\n                gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n                // Create a temporary canvas at render resolution\n                const tempCanvas = document.createElement('canvas');\n                tempCanvas.width = this.renderWidth;\n                tempCanvas.height = this.renderHeight;\n                const ctx = tempCanvas.getContext('2d');\n\n                // Create ImageData from the pixel array\n                const imageData = ctx.createImageData(this.renderWidth, this.renderHeight);\n                imageData.data.set(pixels);\n\n                // WebGL reads pixels from bottom-up, but canvas uses top-down\n                // We need to flip the image vertically\n                ctx.save();\n                ctx.scale(1, -1); // Flip vertically\n                ctx.translate(0, -this.renderHeight); // Translate back\n                ctx.putImageData(imageData, 0, 0);\n                ctx.restore();\n\n                // Convert to blob\n                tempCanvas.toBlob((blob) => {\n                    if (blob) {\n                        resolve(blob);\n                    } else {\n                        reject(new Error('Failed to create blob from canvas'));\n                    }\n                }, 'image/png');\n\n            } catch (error) {\n                logger.error('Failed to capture render buffer:', error);\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * Resize canvas\n     */\n    resize(width, height) {\n        const gl = this.gl;\n\n        // Validate dimensions\n        if (!width || !height || width <= 0 || height <= 0) {\n            logger.warn(`Invalid resize dimensions: ${width}x${height}, skipping resize`);\n            return;\n        }\n\n        this.canvas.width = width;\n        this.canvas.height = height;\n\n        // Recalculate render resolution\n        // Ensure we always have valid dimensions (minimum 1x1)\n        this.renderWidth = Math.max(1, Math.floor(width * this.supersampleFactor));\n        this.renderHeight = Math.max(1, Math.floor(height * this.supersampleFactor));\n\n        logger.info('Resizing renderer', {\n            canvasSize: `${width}x${height}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        this.framebufferManager.resize(this.renderWidth, this.renderHeight);\n        this.bloomManager.resize(this.renderWidth, this.renderHeight);\n        this.bilateralManager.resize(this.renderWidth, this.renderHeight);\n        this.smaaManager.resize(this.renderWidth, this.renderHeight);\n\n        // Resize LDR framebuffer\n        gl.bindTexture(gl.TEXTURE_2D, this.ldrTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        // Resize final framebuffer\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        this.gl.viewport(0, 0, width, height);\n        this.clearScreen(); // Clear on resize\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config) {\n        logger.info('Updating configuration', config);\n        let needsRecompile = false;\n\n        if (config.dimensions !== undefined && config.dimensions !== this.dimensions) {\n            logger.info(`Changing dimensions: ${this.dimensions} \u2192 ${config.dimensions}`);\n            this.dimensions = config.dimensions;\n            needsRecompile = true;\n\n            // Update particle system\n            this.particleSystem.setDimensions(this.dimensions);\n            this.textureManager.dispose();\n            this.textureManager = new TextureManager(\n                this.gl,\n                this.dimensions,\n                this.particleSystem.getResolution(),\n                this.strategy\n            );\n\n            // Restore line mode if configured\n            if (this.particleRenderMode === 'lines') {\n                this.textureManager.setLineMode(true);\n            }\n            this.textureManager.initializeData(this.particleSystem.getAllData());\n        }\n\n        // Handle coordinate system changes BEFORE expressions\n        // (so expression parsing uses the correct variables)\n        if (config.coordinateSystem !== undefined) {\n            logger.info(`Updating coordinate system: ${this.coordinateSystem.name} \u2192 ${config.coordinateSystem.name}`);\n            this.coordinateSystem = config.coordinateSystem;\n            needsRecompile = true;\n            logger.info('  needsRecompile flag set to true (coordinate system change)');\n        }\n\n        if (config.expressions !== undefined) {\n            logger.info('Updating vector field expressions', config.expressions);\n            this.expressions = config.expressions;\n            // Create velocity evaluators for computing statistics in JavaScript\n            try {\n                // Get variable names from coordinate system\n                let coordinateVars;\n                if (this.coordinateSystem && typeof this.coordinateSystem.getVariableNames === 'function') {\n                    coordinateVars = this.coordinateSystem.getVariableNames();\n                } else {\n                    // Fallback to default Cartesian variables\n                    logger.warn('coordinateSystem missing getVariableNames(), using Cartesian fallback');\n                    coordinateVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n                }\n\n                this.velocityEvaluators = createVelocityEvaluators(config.expressions, coordinateVars);\n                logger.verbose('Velocity evaluators created successfully', {\n                    coordinateSystem: this.coordinateSystem ? this.coordinateSystem.name : 'unknown',\n                    variables: coordinateVars\n                });\n            } catch (error) {\n                logger.warn('Failed to create velocity evaluators', error);\n                this.velocityEvaluators = null;\n            }\n            needsRecompile = true;\n            logger.info('  needsRecompile flag set to true (expressions change)');\n        }\n\n        if (config.integratorType !== undefined && config.integratorType !== this.integratorType) {\n            logger.info(`Changing integrator: ${this.integratorType} \u2192 ${config.integratorType}`);\n            this.integratorType = config.integratorType;\n            needsRecompile = true;\n        }\n\n        if (config.integratorParams !== undefined) {\n            logger.verbose('Updating integrator parameters', config.integratorParams);\n            this.integratorParams = { ...this.integratorParams, ...config.integratorParams };\n            needsRecompile = true;\n        }\n\n        if (config.solutionMethod !== undefined && config.solutionMethod !== this.solutionMethod) {\n            logger.info(`Changing solution method: ${this.solutionMethod} \u2192 ${config.solutionMethod}`);\n            this.solutionMethod = config.solutionMethod;\n            needsRecompile = true;\n            logger.info(`  needsRecompile flag set to true (solutionMethod change)`);\n        }\n        logger.info('Solution method update complete, continuing...');\n\n        if (config.transformType !== undefined && config.transformType !== this.transformType) {\n            logger.info(`Changing transform: ${this.transformType} \u2192 ${config.transformType}`);\n            this.transformType = config.transformType;\n            needsRecompile = true;\n        }\n\n        if (config.transformParams !== undefined) {\n            logger.verbose('Updating transform parameters', config.transformParams);\n            this.transformParams = config.transformParams;\n            needsRecompile = true;\n        }\n\n        if (config.mapperType !== undefined && config.mapperType !== this.mapperType) {\n            logger.info(`Changing mapper: ${this.mapperType} \u2192 ${config.mapperType}`);\n            this.mapperType = config.mapperType;\n            needsRecompile = true;\n        }\n\n        if (config.mapperParams !== undefined) {\n            logger.verbose('Updating mapper parameters', config.mapperParams);\n            this.mapperParams = config.mapperParams;\n            needsRecompile = true;\n        }\n\n        if (config.colorMode !== undefined && config.colorMode !== this.colorMode) {\n            logger.info(`Changing color mode: ${this.colorMode} \u2192 ${config.colorMode}`);\n            this.colorMode = config.colorMode;\n            needsRecompile = true;\n        }\n\n        if (config.colorExpression !== undefined && config.colorExpression !== this.colorExpression) {\n            logger.info(`Changing color expression: ${this.colorExpression} \u2192 ${config.colorExpression}`);\n            this.colorExpression = config.colorExpression;\n            needsRecompile = true;\n        }\n\n        if (config.colorGradient !== undefined) {\n            // Compare gradient arrays (deep comparison)\n            const gradientChanged = JSON.stringify(config.colorGradient) !== JSON.stringify(this.colorGradient);\n            if (gradientChanged) {\n                logger.info('Changing color gradient');\n                this.colorGradient = config.colorGradient;\n                needsRecompile = true;\n            }\n        }\n\n        if (config.useCustomGradient !== undefined && config.useCustomGradient !== this.useCustomGradient) {\n            logger.info(`Changing custom gradient usage: ${this.useCustomGradient} \u2192 ${config.useCustomGradient}`);\n            this.useCustomGradient = config.useCustomGradient;\n            needsRecompile = true;\n        }\n\n        if (config.velocityScaleMode !== undefined && config.velocityScaleMode !== this.velocityScaleMode) {\n            logger.info(`Changing velocity scale mode: ${this.velocityScaleMode} \u2192 ${config.velocityScaleMode}`);\n            this.velocityScaleMode = config.velocityScaleMode;\n            // No recompile needed - just changes which value we use\n        }\n\n        if (config.velocityLogScale !== undefined && config.velocityLogScale !== this.velocityLogScale) {\n            logger.info(`Changing velocity log scale: ${this.velocityLogScale} \u2192 ${config.velocityLogScale}`);\n            this.velocityLogScale = config.velocityLogScale;\n            needsRecompile = true; // Needs recompile to change shader code\n        }\n\n        if (config.timestep !== undefined) {\n            logger.verbose(`Timestep: ${this.timestep} \u2192 ${config.timestep}`);\n            this.timestep = config.timestep;\n        }\n        if (config.fadeOpacity !== undefined) {\n            logger.verbose(`Fade opacity: ${this.fadeOpacity} \u2192 ${config.fadeOpacity}`);\n            this.fadeOpacity = config.fadeOpacity;\n        }\n        if (config.dropProbability !== undefined) {\n            logger.verbose(`Drop probability: ${this.dropProbability} \u2192 ${config.dropProbability}`);\n            this.dropProbability = config.dropProbability;\n        }\n        if (config.dropLowVelocity !== undefined) {\n            logger.verbose(`Drop low velocity: ${this.dropLowVelocity} \u2192 ${config.dropLowVelocity}`);\n            this.dropLowVelocity = config.dropLowVelocity;\n        }\n\n        // Animation settings\n        if (config.lockShaderRecompilation !== undefined) {\n            logger.info(`Shader recompilation lock: ${this.lockShaderRecompilation} \u2192 ${config.lockShaderRecompilation}`);\n            this.lockShaderRecompilation = config.lockShaderRecompilation;\n        }\n\n        // HDR rendering settings (no recompile needed)\n        if (config.useHDR !== undefined && config.useHDR !== this.useHDR) {\n            logger.info(`Changing HDR rendering: ${this.useHDR} \u2192 ${config.useHDR}`);\n            this.useHDR = config.useHDR;\n\n            // Recreate framebuffer manager with new HDR setting\n            this.framebufferManager.dispose();\n            this.framebufferManager = new FramebufferManager(\n                this.gl,\n                this.canvas.width,\n                this.canvas.height,\n                {\n                    useHDR: this.useHDR,\n                    usePingPong: true\n                }\n            );\n\n            // Log new HDR status\n            const hdrSupport = this.framebufferManager.getHDRSupport();\n            logger.info('HDR rendering system reconfigured', {\n                hdrEnabled: hdrSupport.enabled,\n                hdrSupported: hdrSupport.supported,\n                textureFormat: hdrSupport.format\n            });\n\n            if (this.useHDR && !hdrSupport.supported) {\n                logger.warn('HDR requested but not supported. Falling back to LDR.');\n            }\n\n            this.clearScreen();\n        }\n        if (config.exposure !== undefined) {\n            logger.verbose(`Exposure: ${this.exposure} \u2192 ${config.exposure}`);\n            this.exposure = config.exposure;\n            needsRecompile = true; // Exposure is baked into shader\n        }\n        if (config.gamma !== undefined) {\n            logger.verbose(`Gamma: ${this.gamma} \u2192 ${config.gamma}`);\n            this.gamma = config.gamma;\n            needsRecompile = true; // Gamma is baked into shader\n        }\n        if (config.luminanceGamma !== undefined) {\n            logger.verbose(`Luminance Gamma: ${this.luminanceGamma} \u2192 ${config.luminanceGamma}`);\n            this.luminanceGamma = config.luminanceGamma;\n            needsRecompile = true; // Luminance gamma is baked into shader\n        }\n        if (config.highlightCompression !== undefined) {\n            logger.verbose(`Highlight Compression: ${this.highlightCompression} \u2192 ${config.highlightCompression}`);\n            this.highlightCompression = config.highlightCompression;\n            // No recompile needed - just a uniform\n        }\n        if (config.compressionThreshold !== undefined) {\n            logger.verbose(`Compression Threshold: ${this.compressionThreshold} \u2192 ${config.compressionThreshold}`);\n            this.compressionThreshold = config.compressionThreshold;\n            // No recompile needed - just a uniform\n        }\n        if (config.whitePoint !== undefined) {\n            logger.verbose(`White point: ${this.whitePoint} \u2192 ${config.whitePoint}`);\n            this.whitePoint = config.whitePoint;\n            needsRecompile = true; // White point is baked into shader\n            // White point is used as bloom threshold\n            this.bloomManager.updateConfig({ threshold: config.whitePoint });\n        }\n        if (config.tonemapOperator !== undefined && config.tonemapOperator !== this.tonemapOperator) {\n            logger.info(`Tone mapping operator: ${this.tonemapOperator} \u2192 ${config.tonemapOperator}`);\n            this.tonemapOperator = config.tonemapOperator;\n            needsRecompile = true;\n        }\n        if (config.particleIntensity !== undefined) {\n            logger.verbose(`Particle intensity: ${this.particleIntensity} \u2192 ${config.particleIntensity}`);\n            this.particleIntensity = config.particleIntensity;\n        }\n        if (config.particleSize !== undefined) {\n            logger.verbose(`Particle size: ${this.particleSize} \u2192 ${config.particleSize}`);\n            this.particleSize = config.particleSize;\n        }\n        if (config.particleRenderMode !== undefined && config.particleRenderMode !== this.particleRenderMode) {\n            logger.info(`Particle render mode: ${this.particleRenderMode} \u2192 ${config.particleRenderMode}`);\n            this.particleRenderMode = config.particleRenderMode;\n            // Enable/disable line mode in texture manager\n            const isLineMode = this.particleRenderMode === 'lines';\n            this.textureManager.setLineMode(isLineMode);\n            needsRecompile = true; // Shader needs to be regenerated for line mode\n        }\n        if (config.colorSaturation !== undefined) {\n            logger.verbose(`Color saturation: ${this.colorSaturation} \u2192 ${config.colorSaturation}`);\n            this.colorSaturation = config.colorSaturation;\n        }\n        if (config.brightnessDesaturation !== undefined) {\n            logger.verbose(`Brightness desaturation: ${this.brightnessDesaturation} \u2192 ${config.brightnessDesaturation}`);\n            this.brightnessDesaturation = config.brightnessDesaturation;\n        }\n        if (config.brightnessSaturation !== undefined) {\n            logger.verbose(`Brightness saturation: ${this.brightnessSaturation} \u2192 ${config.brightnessSaturation}`);\n            this.brightnessSaturation = config.brightnessSaturation;\n        }\n        if (config.useDepthTest !== undefined) {\n            logger.verbose(`Depth testing: ${this.useDepthTest} \u2192 ${config.useDepthTest}`);\n            this.useDepthTest = config.useDepthTest;\n        }\n        if (config.bloomEnabled !== undefined) {\n            logger.verbose(`Bloom enabled: ${this.bloomEnabled} \u2192 ${config.bloomEnabled}`);\n            this.bloomEnabled = config.bloomEnabled;\n            this.bloomManager.updateConfig({ enabled: config.bloomEnabled });\n        }\n        if (config.bloomIntensity !== undefined) {\n            logger.verbose(`Bloom intensity: ${this.bloomIntensity} \u2192 ${config.bloomIntensity}`);\n            this.bloomIntensity = config.bloomIntensity;\n            this.bloomManager.updateConfig({ intensity: config.bloomIntensity });\n        }\n        if (config.bloomRadius !== undefined) {\n            logger.verbose(`Bloom radius: ${this.bloomRadius} \u2192 ${config.bloomRadius}`);\n            this.bloomRadius = config.bloomRadius;\n            this.bloomManager.updateConfig({ radius: config.bloomRadius });\n            // Radius change requires shader recompile\n            needsRecompile = true;\n        }\n        if (config.bloomAlpha !== undefined) {\n            logger.verbose(`Bloom alpha: ${this.bloomAlpha} \u2192 ${config.bloomAlpha}`);\n            this.bloomAlpha = config.bloomAlpha;\n        }\n        if (config.smaaEnabled !== undefined) {\n            logger.verbose(`SMAA enabled: ${this.smaaEnabled} \u2192 ${config.smaaEnabled}`);\n            this.smaaEnabled = config.smaaEnabled;\n            this.smaaManager.updateConfig({ enabled: config.smaaEnabled });\n        }\n        if (config.smaaIntensity !== undefined) {\n            logger.verbose(`SMAA intensity: ${this.smaaIntensity} \u2192 ${config.smaaIntensity}`);\n            this.smaaIntensity = config.smaaIntensity;\n            this.smaaManager.updateConfig({ intensity: config.smaaIntensity });\n        }\n        if (config.smaaThreshold !== undefined) {\n            logger.verbose(`SMAA threshold: ${this.smaaThreshold} \u2192 ${config.smaaThreshold}`);\n            this.smaaThreshold = config.smaaThreshold;\n            this.smaaManager.updateConfig({ threshold: config.smaaThreshold });\n        }\n        if (config.bilateralEnabled !== undefined) {\n            logger.verbose(`Bilateral filter enabled: ${this.bilateralEnabled} \u2192 ${config.bilateralEnabled}`);\n            this.bilateralEnabled = config.bilateralEnabled;\n            this.bilateralManager.updateConfig({ enabled: config.bilateralEnabled });\n        }\n        if (config.bilateralSpatialSigma !== undefined) {\n            logger.verbose(`Bilateral spatial sigma: ${this.bilateralSpatialSigma} \u2192 ${config.bilateralSpatialSigma}`);\n            this.bilateralSpatialSigma = config.bilateralSpatialSigma;\n            this.bilateralManager.updateConfig({ spatialSigma: config.bilateralSpatialSigma });\n        }\n        if (config.bilateralIntensitySigma !== undefined) {\n            logger.verbose(`Bilateral intensity sigma: ${this.bilateralIntensitySigma} \u2192 ${config.bilateralIntensitySigma}`);\n            this.bilateralIntensitySigma = config.bilateralIntensitySigma;\n            this.bilateralManager.updateConfig({ intensitySigma: config.bilateralIntensitySigma });\n        }\n        if (config.supersampleFactor !== undefined && config.supersampleFactor !== this.supersampleFactor) {\n            logger.info(`Render scale factor: ${this.supersampleFactor} \u2192 ${config.supersampleFactor}`);\n\n            // Validate render scale factor\n            const validFactor = Math.max(0.5, Math.min(4.0, config.supersampleFactor));\n            if (validFactor !== config.supersampleFactor) {\n                logger.warn(`Invalid render scale factor ${config.supersampleFactor}, clamping to ${validFactor}`);\n            }\n\n            this.supersampleFactor = validFactor;\n            logger.info(`Applying render scale factor: ${this.supersampleFactor}`);\n            // Trigger resize to update all framebuffers\n            this.resize(this.canvas.width, this.canvas.height);\n        }\n\n        if (config.particleCount !== undefined && config.particleCount !== this.particleSystem.particleCount) {\n            this.particleSystem.setParticleCount(config.particleCount);\n            this.textureManager.resize(this.particleSystem.getResolution());\n            this.textureManager.initializeData(this.particleSystem.getAllData());\n\n            // Recreate both index buffers and vertex ID buffer\n            this.gl.deleteBuffer(this.indexBufferPoints);\n            this.gl.deleteBuffer(this.indexBufferLines);\n            this.gl.deleteBuffer(this.vertexIdBufferLines);\n            this.indexBufferPoints = this.createBuffer(this.particleSystem.getIndices());\n            this.indexBufferLines = this.createLineIndexBuffer(this.particleSystem.getActualParticleCount());\n            this.vertexIdBufferLines = this.createLineVertexIdBuffer(this.particleSystem.getActualParticleCount());\n        }\n\n        if (config.bbox !== undefined) {\n            this.bbox = config.bbox;\n            this.particleSystem.setBBox(this.bbox);\n\n            // Reinitialize particles if requested (e.g., on reset)\n            if (config.reinitializeParticles) {\n                this.particleSystem.initializeParticles();\n                this.textureManager.initializeData(this.particleSystem.getAllData());\n                logger.info('Particles reinitialized to new viewport bounds');\n            }\n\n            this.clearScreen(); // Clear trails when view changes\n        }\n\n        logger.info(`Checking needsRecompile flag: ${needsRecompile}`);\n\n        if (needsRecompile) {\n            if (this.lockShaderRecompilation) {\n                logger.info('Shader recompilation needed but LOCKED - skipping recompilation');\n            } else {\n                logger.info('Recompiling shaders...');\n                try {\n                    const error = this.compileShaders();\n                    if (error) {\n                        logger.error('Recompilation failed', error);\n                        // Don't throw - allow temporary error states (e.g., dimension/coordinate mismatch)\n                        logger.warn('Shader compilation failed - visualization will not render until error is resolved');\n                        return; // Skip clearing screen\n                    }\n                    this.frame = 0; // Reset frame counter\n                    logger.info('Clearing screen after recompilation...');\n                    this.clearScreen(); // Clear old particles that were computed with old vector field\n                    logger.info('Configuration updated successfully, shaders recompiled');\n                } catch (e) {\n                    logger.error('EXCEPTION during shader recompilation:', e);\n                    logger.error('Stack trace:', e.stack);\n                    // Don't throw - allow temporary error states\n                    logger.warn('Shader compilation exception - visualization will not render until error is resolved');\n                }\n            }\n        } else {\n            logger.info('Configuration updated (no recompile needed)');\n        }\n\n        // Log current applied settings\n        logger.info('Current settings applied', {\n            dimensions: this.dimensions,\n            expressions: this.expressions,\n            integrator: this.integratorType,\n            mapper: this.mapperType,\n            timestep: this.timestep,\n            particleCount: this.particleSystem.particleCount,\n            fadeOpacity: this.fadeOpacity,\n            dropProbability: this.dropProbability,\n            bbox: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`\n        });\n    }\n\n    /**\n     * Test encode/decode symmetry\n     * Tests JavaScript encode\u2192decode round-trip accuracy\n     */\n    testEncodeDecodeSymmetry() {\n        const { encodeFloatRGBA, decodeFloatRGBA } = require('../utils/float-packing.js');\n\n        // Test values covering the full [0, 1] range\n        const testValues = [0.0, 0.1, 0.25, 0.5, 0.75, 0.9, 1.0];\n\n        // Also test many random values\n        for (let i = 0; i < 100; i++) {\n            testValues.push(Math.random());\n        }\n\n        let maxError = 0;\n        let avgError = 0;\n        const errors = [];\n        const problematic = [];\n\n        logger.info('Testing encode/decode symmetry...');\n\n        for (const testVal of testValues) {\n            // Encode\n            const buffer = new Uint8Array(4);\n            encodeFloatRGBA(testVal, buffer, 0);\n\n            // Decode\n            const decoded = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n            // Calculate error\n            const error = Math.abs(testVal - decoded);\n            errors.push(error);\n            avgError += error;\n            maxError = Math.max(maxError, error);\n\n            // Track problematic values (error > 1e-6)\n            if (error > 1e-6) {\n                problematic.push({\n                    original: testVal,\n                    encoded: `[${buffer[0]}, ${buffer[1]}, ${buffer[2]}, ${buffer[3]}]`,\n                    decoded: decoded,\n                    error: error\n                });\n            }\n        }\n\n        avgError /= testValues.length;\n\n        logger.info('Encode/Decode symmetry test results:', {\n            testCount: testValues.length,\n            maxError: maxError.toExponential(3),\n            avgError: avgError.toExponential(3),\n            problematicCount: problematic.length,\n            problematicSamples: problematic.slice(0, 5) // Show first 5\n        });\n\n        // Test with world coordinate round-trip\n        logger.info('Testing world coordinate round-trip [-5, 5]...');\n        const worldTests = [-5, -4, -2.5, 0, 2.5, 4, 5];\n        const worldErrors = [];\n\n        for (const worldVal of worldTests) {\n            // Normalize\n            const normalized = (worldVal - this.bbox.min[0]) / (this.bbox.max[0] - this.bbox.min[0]);\n\n            // Encode\n            const buffer = new Uint8Array(4);\n            encodeFloatRGBA(normalized, buffer, 0);\n\n            // Decode\n            const decoded = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n            // Denormalize\n            const worldDecoded = this.bbox.min[0] + decoded * (this.bbox.max[0] - this.bbox.min[0]);\n\n            const error = Math.abs(worldVal - worldDecoded);\n            worldErrors.push({\n                world: worldVal.toFixed(3),\n                normalized: normalized.toFixed(6),\n                decoded: worldDecoded.toFixed(6),\n                error: error.toExponential(3)\n            });\n        }\n\n        logger.info('World coordinate round-trip results:', { tests: worldErrors });\n\n        return { maxError, avgError, problematic: problematic.length };\n    }\n\n    /**\n     * Log statistics about the current HDR framebuffer\n     * Reads the framebuffer pixels and computes min/max/avg values\n     */\n    logBufferStats() {\n        const gl = this.gl;\n\n        if (!this.framebufferManager) {\n            logger.warn('No framebuffer manager available');\n            return;\n        }\n\n        // Bind the current framebuffer for reading\n        const currentIndex = this.framebufferManager.currentIndex;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebufferManager.framebuffers[currentIndex]);\n\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        const pixelCount = width * height;\n\n        // Allocate buffer for pixel data\n        // Float framebuffers return Float32Array, RGBA8 returns Uint8Array\n        const isHDR = this.framebufferManager.isHDR();\n        const pixels = isHDR ?\n            new Float32Array(pixelCount * 4) :\n            new Uint8Array(pixelCount * 4);\n\n        // Read pixels from framebuffer\n        gl.readPixels(0, 0, width, height, gl.RGBA, isHDR ? gl.FLOAT : gl.UNSIGNED_BYTE, pixels);\n\n        // Initialize statistics\n        let minR = Infinity, minG = Infinity, minB = Infinity;\n        let maxR = -Infinity, maxG = -Infinity, maxB = -Infinity;\n        let sumR = 0, sumG = 0, sumB = 0;\n        let maxBrightness = -Infinity;\n        let pixelsAboveOne = 0;\n\n        // Compute statistics\n        for (let i = 0; i < pixelCount; i++) {\n            const idx = i * 4;\n            let r = pixels[idx];\n            let g = pixels[idx + 1];\n            let b = pixels[idx + 2];\n\n            // If LDR, normalize to [0,1]\n            if (!isHDR) {\n                r /= 255;\n                g /= 255;\n                b /= 255;\n            }\n\n            minR = Math.min(minR, r);\n            minG = Math.min(minG, g);\n            minB = Math.min(minB, b);\n\n            maxR = Math.max(maxR, r);\n            maxG = Math.max(maxG, g);\n            maxB = Math.max(maxB, b);\n\n            sumR += r;\n            sumG += g;\n            sumB += b;\n\n            const brightness = Math.max(r, g, b);\n            maxBrightness = Math.max(maxBrightness, brightness);\n\n            if (brightness > 1.0) {\n                pixelsAboveOne++;\n            }\n        }\n\n        const avgR = sumR / pixelCount;\n        const avgG = sumG / pixelCount;\n        const avgB = sumB / pixelCount;\n\n        // Log results\n        logger.info('=== HDR Buffer Statistics ===');\n        logger.info(`Framebuffer: ${width}x${height} (${pixelCount.toLocaleString()} pixels)`);\n        logger.info(`Format: ${isHDR ? 'HDR Float' : 'LDR RGBA8'}`);\n        logger.info(`Red   - Min: ${minR.toFixed(6)}, Max: ${maxR.toFixed(6)}, Avg: ${avgR.toFixed(6)}`);\n        logger.info(`Green - Min: ${minG.toFixed(6)}, Max: ${maxG.toFixed(6)}, Avg: ${avgG.toFixed(6)}`);\n        logger.info(`Blue  - Min: ${minB.toFixed(6)}, Max: ${maxB.toFixed(6)}, Avg: ${avgB.toFixed(6)}`);\n        logger.info(`Max Brightness (max of R/G/B): ${maxBrightness.toFixed(6)}`);\n        logger.info(`Pixels above 1.0: ${pixelsAboveOne.toLocaleString()} (${(pixelsAboveOne / pixelCount * 100).toFixed(2)}%)`);\n\n        // Restore previous framebuffer binding\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Log current shader source code to console\n     */\n    logShaders() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== UPDATE VERTEX SHADER ===');\n        console.log(this.shaderSource.updateVertex);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== UPDATE FRAGMENT SHADER ===');\n        console.log(this.shaderSource.updateFragment);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== DRAW VERTEX SHADER ===');\n        console.log(this.shaderSource.drawVertex);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== DRAW FRAGMENT SHADER ===');\n        console.log(this.shaderSource.drawFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Shaders logged to console');\n    }\n\n    /**\n     * Log update shader (contains integrator and Jacobian)\n     */\n    logUpdateShader() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== UPDATE FRAGMENT SHADER (Integrator + Jacobian) ===');\n        console.log(this.shaderSource.updateFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Update shader logged to browser console');\n    }\n\n    /**\n     * Log draw shader (contains color computations)\n     */\n    logDrawShader() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== DRAW VERTEX SHADER ===');\n        console.log(this.shaderSource.drawVertex);\n        console.log('=== END VERTEX SHADER ===');\n        console.log('');\n        console.log('=== DRAW FRAGMENT SHADER (Color Mode) ===');\n        console.log(this.shaderSource.drawFragment);\n        console.log('=== END FRAGMENT SHADER ===');\n\n        logger.info('Draw shaders (vertex + fragment) logged to browser console');\n    }\n\n    /**\n     * Log screen shader (contains tone mapping)\n     */\n    logScreenShader() {\n        if (!this.shaderSource || !this.shaderSource.screenFragment) {\n            console.warn('No screen shader source available');\n            return;\n        }\n\n        console.log('=== SCREEN FRAGMENT SHADER (Tone Mapping) ===');\n        console.log(this.shaderSource.screenFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Screen shader logged to browser console');\n    }\n\n    /**\n     * Log diagnostic stats shaders (velocity and brightness)\n     */\n    logStatsShaders() {\n        logger.info('=== DIAGNOSTIC STATS SHADERS ===');\n\n        // Log velocity stats shader\n        if (this.velocityStatsManager && this.velocityStatsManager.getShaderSource) {\n            const velShader = this.velocityStatsManager.getShaderSource();\n            if (velShader) {\n                console.log('=== VELOCITY STATS FRAGMENT SHADER ===');\n                console.log(velShader);\n                console.log('=== END SHADER ===');\n            } else {\n                console.warn('Velocity stats shader not available');\n            }\n        } else {\n            console.warn('VelocityStatsManager not initialized or no getShaderSource method');\n        }\n\n        // Log buffer stats shader (brightness histogram)\n        if (this.bufferStatsManager && this.bufferStatsManager.getShaderSource) {\n            const bufferShader = this.bufferStatsManager.getShaderSource();\n            if (bufferShader) {\n                console.log('=== BRIGHTNESS STATS FRAGMENT SHADER ===');\n                console.log(bufferShader);\n                console.log('=== END SHADER ===');\n            } else {\n                console.warn('Buffer stats shader not available');\n            }\n        } else {\n            console.warn('BufferStatsManager not initialized or no getShaderSource method');\n        }\n\n        logger.info('Stats shaders logged to browser console');\n    }\n\n    /**\n     * Read pixel values at screen coordinates\n     * Returns both HDR and LDR values without copying entire framebuffer\n     * @param {number} screenX - Screen X coordinate (canvas pixels)\n     * @param {number} screenY - Screen Y coordinate (canvas pixels)\n     * @returns {Object} { hdr: [r, g, b], ldr: [r, g, b] } or null if out of bounds\n     */\n    readPixelAt(screenX, screenY) {\n        const gl = this.gl;\n\n        // Convert to framebuffer coordinates (may be different from canvas if using devicePixelRatio)\n        const fbX = Math.floor(screenX * (this.renderWidth / this.canvas.width));\n        const fbY = Math.floor(screenY * (this.renderHeight / this.canvas.height));\n\n        // Flip Y (WebGL uses bottom-left origin)\n        const glY = this.renderHeight - fbY - 1;\n\n        // Check bounds\n        if (fbX < 0 || fbX >= this.renderWidth || glY < 0 || glY >= this.renderHeight) {\n            return null;\n        }\n\n        const result = { hdr: null, ldr: null };\n\n        // Read HDR value from current HDR framebuffer\n        if (this.useHDR && this.framebufferManager) {\n            const hdrTexture = this.framebufferManager.getCurrentTexture();\n            const hdrFramebuffer = this.framebufferManager.framebuffers[this.framebufferManager.currentIndex];\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, hdrFramebuffer);\n\n            // Read 1x1 pixel\n            if (this.framebufferManager.hdrType === gl.FLOAT) {\n                // Full float\n                const pixels = new Float32Array(4);\n                gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.FLOAT, pixels);\n                result.hdr = [pixels[0], pixels[1], pixels[2]];\n            } else {\n                // Half float or LDR fallback\n                const pixels = new Uint8Array(4);\n                gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n                result.hdr = [pixels[0] / 255, pixels[1] / 255, pixels[2] / 255];\n            }\n        }\n\n        // Read LDR value from tone-mapped texture\n        if (this.ldrFramebuffer && this.ldrTexture) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n\n            const pixels = new Uint8Array(4);\n            gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n            result.ldr = [pixels[0] / 255, pixels[1] / 255, pixels[2] / 255];\n        }\n\n        // Restore default framebuffer binding\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        return result;\n    }\n}\n", "/**\n * Base class for coordinate storage strategies\n * Defines the interface that all strategies must implement\n */\nexport class CoordinateStrategy {\n    constructor(gl) {\n        this.gl = gl;\n    }\n\n    /**\n     * Get the WebGL texture format configuration\n     * @returns {{internalFormat: number, format: number, type: number}}\n     */\n    getTextureFormat() {\n        throw new Error('getTextureFormat() must be implemented by subclass');\n    }\n\n    /**\n     * Get the JavaScript array type for storing data\n     * @returns {TypedArrayConstructor} (e.g., Uint8Array or Float32Array)\n     */\n    getArrayType() {\n        throw new Error('getArrayType() must be implemented by subclass');\n    }\n\n    /**\n     * Get the number of components per value\n     * @returns {number} (e.g., 4 for RGBA, 1 for single float)\n     */\n    getComponentsPerValue() {\n        throw new Error('getComponentsPerValue() must be implemented by subclass');\n    }\n\n    /**\n     * Check if this strategy requires a WebGL extension\n     * @returns {boolean}\n     */\n    requiresExtension() {\n        return false;\n    }\n\n    /**\n     * Get the required WebGL extension name (if any)\n     * @returns {string|null}\n     */\n    getExtensionName() {\n        return null;\n    }\n\n    /**\n     * Encode a world coordinate value for storage\n     * @param {number} worldValue - Value in world coordinates\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {TypedArray} Encoded value as array (length = getComponentsPerValue())\n     */\n    encodeValue(worldValue, min, max) {\n        throw new Error('encodeValue() must be implemented by subclass');\n    }\n\n    /**\n     * Decode a stored value back to world coordinates\n     * @param {TypedArray|Array} buffer - Encoded value\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} World coordinate value\n     */\n    decodeValue(buffer, min, max) {\n        throw new Error('decodeValue() must be implemented by subclass');\n    }\n\n    /**\n     * Normalize world coordinate to storage space\n     * For RGBA: normalize to [0, 1]\n     * For Float: might just return as-is\n     * @param {number} worldValue - Value in world coordinates\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} Normalized value\n     */\n    normalizeWorld(worldValue, min, max) {\n        throw new Error('normalizeWorld() must be implemented by subclass');\n    }\n\n    /**\n     * Denormalize from storage space to world coordinates\n     * @param {number} storageValue - Value from storage\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} World coordinate value\n     */\n    denormalizeWorld(storageValue, min, max) {\n        throw new Error('denormalizeWorld() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL constant definitions needed by this strategy\n     * @returns {string} GLSL code\n     */\n    getGLSLConstants() {\n        throw new Error('getGLSLConstants() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL decode function\n     * Converts from texture RGBA to float value\n     * @returns {string} GLSL code\n     */\n    getGLSLDecodeFunction() {\n        throw new Error('getGLSLDecodeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL encode function\n     * Converts from float value to RGBA for texture storage\n     * @returns {string} GLSL code\n     */\n    getGLSLEncodeFunction() {\n        throw new Error('getGLSLEncodeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL normalize function\n     * Converts world coordinates to storage space\n     * @returns {string} GLSL code\n     */\n    getGLSLNormalizeFunction() {\n        throw new Error('getGLSLNormalizeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL denormalize function\n     * Converts from storage space to world coordinates\n     * @returns {string} GLSL code\n     */\n    getGLSLDenormalizeFunction() {\n        throw new Error('getGLSLDenormalizeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get a human-readable name for this strategy\n     * @returns {string}\n     */\n    getName() {\n        throw new Error('getName() must be implemented by subclass');\n    }\n}\n", "/**\n * RGBA-encoded coordinate storage strategy\n * Uses 32-bit fixed-point encoding to store floats as RGBA bytes\n *\n * Provides maximum compatibility with all WebGL devices, including those\n * without floating-point texture support.\n *\n * ENCODING:\n * - World coordinates normalized to [0, 1] relative to viewport bounds\n * - Normalized value mapped to 32-bit integer using scale factor 2^32 - 1\n * - Integer split into 4 bytes (RGBA) using big-endian byte order\n * - Provides approximately 32 bits of precision per coordinate\n *\n * PRECISION:\n * - ~8 bits per RGBA channel, combined to 32-bit fixed-point\n * - Slightly lower precision than native float textures (~23 bits mantissa)\n * - Very minor quantization artifacts may appear in extreme zoom scenarios\n * - Negligible for typical visualization use cases\n *\n * PERFORMANCE:\n * - No extension requirements, works on all devices\n * - Small encoding/decoding overhead in shaders\n * - Recommended for maximum compatibility\n *\n * COMPARISON TO FLOAT STRATEGY:\n * - FloatStrategy provides higher precision (~23-bit mantissa, direct storage)\n * - RGBAStrategy has wider device compatibility (no extension required)\n * - Both strategies produce visually identical results for most systems\n */\n\nimport { CoordinateStrategy } from '../coordinate-strategy.js';\nimport { encodeFloatRGBA, decodeFloatRGBA } from '../../utils/float-packing.js';\n\nexport class RGBAStrategy extends CoordinateStrategy {\n    constructor(gl) {\n        super(gl);\n    }\n\n    getName() {\n        return 'RGBA Fixed-Point Encoding';\n    }\n\n    getTextureFormat() {\n        const gl = this.gl;\n        return {\n            internalFormat: gl.RGBA,\n            format: gl.RGBA,\n            type: gl.UNSIGNED_BYTE\n        };\n    }\n\n    getArrayType() {\n        return Uint8Array;\n    }\n\n    getComponentsPerValue() {\n        return 4; // RGBA = 4 bytes per encoded float\n    }\n\n    requiresExtension() {\n        return false; // RGBA UNSIGNED_BYTE always supported\n    }\n\n    getExtensionName() {\n        return null;\n    }\n\n    encodeValue(worldValue, min, max) {\n        // Normalize world value to [0, 1]\n        const normalized = (worldValue - min) / (max - min);\n\n        // Encode to RGBA bytes\n        const buffer = new Uint8Array(4);\n        encodeFloatRGBA(normalized, buffer, 0);\n\n        return buffer;\n    }\n\n    decodeValue(buffer, min, max) {\n        // Decode RGBA bytes to [0, 1]\n        const normalized = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n        // Denormalize to world coordinates\n        return min + normalized * (max - min);\n    }\n\n    normalizeWorld(worldValue, min, max) {\n        return (worldValue - min) / (max - min);\n    }\n\n    denormalizeWorld(normalized, min, max) {\n        return min + normalized * (max - min);\n    }\n\n    getGLSLConstants() {\n        return `\n// Map to [0, 1] range for maximum precision at any zoom level\nconst float FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n`;\n    }\n\n    getGLSLDecodeFunction() {\n        return `\n// Decode RGBA bytes back to float in [0, 1] range\nfloat decodeFloat(vec4 rgba) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    vec4 bytes = rgba * 255.0;\n    float intValue = bytes.r * 16777216.0 + bytes.g * 65536.0 + bytes.b * 256.0 + bytes.a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    return intValue / FIXED_POINT_SCALE;\n}\n`;\n    }\n\n    getGLSLEncodeFunction() {\n        return `\n// Encode float in [0, 1] range to RGBA bytes\nvec4 encodeFloat(float v) {\n    // Clamp to [0, 1]\n    v = clamp(v, 0.0, 1.0);\n\n    // Map to [0, 2^32-1]\n    float normalized = v * FIXED_POINT_SCALE;\n\n    // Split into 4 bytes (big-endian)\n    float byte0 = floor(normalized / 16777216.0);  // 2^24\n    normalized -= byte0 * 16777216.0;\n    float byte1 = floor(normalized / 65536.0);      // 2^16\n    normalized -= byte1 * 65536.0;\n    float byte2 = floor(normalized / 256.0);        // 2^8\n    normalized -= byte2 * 256.0;\n    float byte3 = floor(normalized);\n\n    return vec4(byte0, byte1, byte2, byte3) / 255.0;\n}\n`;\n    }\n\n    getGLSLNormalizeFunction() {\n        return `\n// Helper to normalize world coordinate to [0, 1] relative to viewport\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return (worldValue - minVal) / (maxVal - minVal);\n}\n`;\n    }\n\n    getGLSLDenormalizeFunction() {\n        return `\n// Helper to denormalize from [0, 1] back to world coordinates\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return minVal + normalized * (maxVal - minVal);\n}\n`;\n    }\n}\n", "/**\n * Float texture coordinate storage strategy\n * Stores coordinates directly as floats without encoding\n * Requires OES_texture_float extension (available on most modern devices)\n */\n\nimport { CoordinateStrategy } from '../coordinate-strategy.js';\nimport { logger } from '../../utils/debug-logger.js';\n\nexport class FloatStrategy extends CoordinateStrategy {\n    constructor(gl) {\n        super(gl);\n\n        // Check for float texture support\n        const ext = gl.getExtension('OES_texture_float');\n        if (!ext) {\n            throw new Error('OES_texture_float extension not supported');\n        }\n\n        logger.info('Float texture support detected', {\n            extension: 'OES_texture_float'\n        });\n    }\n\n    getName() {\n        return 'Float Textures (Direct Storage)';\n    }\n\n    getTextureFormat() {\n        const gl = this.gl;\n        return {\n            internalFormat: gl.RGBA,\n            format: gl.RGBA,\n            type: gl.FLOAT\n        };\n    }\n\n    getArrayType() {\n        return Float32Array;\n    }\n\n    getComponentsPerValue() {\n        // Store float in RGBA.r, leave g,b,a unused\n        return 4;\n    }\n\n    requiresExtension() {\n        return true;\n    }\n\n    getExtensionName() {\n        return 'OES_texture_float';\n    }\n\n    encodeValue(worldValue, min, max) {\n        // No encoding needed! Store world coordinate directly\n        // But pack into RGBA format: [worldValue, 0, 0, 1]\n        const buffer = new Float32Array(4);\n        buffer[0] = worldValue;\n        buffer[1] = 0;\n        buffer[2] = 0;\n        buffer[3] = 1;\n        return buffer;\n    }\n\n    decodeValue(buffer, min, max) {\n        // No decoding needed! Just return the value directly\n        return buffer[0];\n    }\n\n    normalizeWorld(worldValue, min, max) {\n        // No normalization needed for float textures\n        return worldValue;\n    }\n\n    denormalizeWorld(storageValue, min, max) {\n        // No denormalization needed for float textures\n        return storageValue;\n    }\n\n    getGLSLConstants() {\n        return `\n// Float strategy: no constants needed\n`;\n    }\n\n    getGLSLDecodeFunction() {\n        return `\n// Decode float from RGBA - just read the red channel directly\nfloat decodeFloat(vec4 rgba) {\n    return rgba.r;\n}\n`;\n    }\n\n    getGLSLEncodeFunction() {\n        return `\n// Encode float to RGBA - store in red channel\nvec4 encodeFloat(float v) {\n    return vec4(v, 0.0, 0.0, 1.0);\n}\n`;\n    }\n\n    getGLSLNormalizeFunction() {\n        return `\n// Float strategy: no normalization needed, pass through directly\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return worldValue;\n}\n`;\n    }\n\n    getGLSLDenormalizeFunction() {\n        return `\n// Float strategy: no denormalization needed, pass through directly\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return normalized;\n}\n`;\n    }\n}\n", "/**\n * Base classes for UI controls with automatic save/restore\n */\n\nimport { CoordinateSystem } from '../math/coordinate-systems.js';\n\n/**\n * Base Control class\n * All controls must implement getValue() and setValue()\n */\nexport class Control {\n    constructor(id, defaultValue, options = {}) {\n        this.id = id;\n        this.defaultValue = defaultValue;\n        this.settingsKey = options.settingsKey || id; // Key used in settings object\n        this.onChange = options.onChange || null; // Callback when value changes\n        this.element = null; // Will be set when attaching listeners\n    }\n\n    /**\n     * Get current value from DOM\n     * Must be implemented by subclasses\n     */\n    getValue() {\n        throw new Error('getValue() must be implemented by subclass');\n    }\n\n    /**\n     * Set value in DOM\n     * Must be implemented by subclasses\n     */\n    setValue(value) {\n        throw new Error('setValue() must be implemented by subclass');\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n\n    /**\n     * Attach event listeners\n     * Must be implemented by subclasses\n     */\n    attachListeners(callback) {\n        throw new Error('attachListeners() must be implemented by subclass');\n    }\n\n    /**\n     * Get mouse position relative to an element\n     * Converts page coordinates to element-local coordinates\n     * @param {MouseEvent} event - The mouse event\n     * @param {jQuery|HTMLElement} element - The element to get coordinates relative to\n     * @returns {{x: number, y: number}} - Position relative to element's top-left corner\n     */\n    getMousePositionInElement(event, element) {\n        const $element = $(element);\n        const offset = $element.offset();\n        return {\n            x: event.pageX - offset.left,\n            y: event.pageY - offset.top\n        };\n    }\n\n    /**\n     * Handle button action (increment/decrement)\n     * Can be overridden by subclasses for custom behavior\n     * @param {string} action - 'increase', 'decrease', 'increase-large', 'decrease-large', 'reset'\n     * @returns {boolean} True if action was handled\n     */\n    handleButtonAction(action) {\n        // Default implementation: no button support\n        return false;\n    }\n\n    /**\n     * Save current value to settings object\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore value from settings object\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] != null) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n/**\n * Linear slider control\n */\nexport class SliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0;\n        this.max = options.max || 100;\n        this.step = options.step || 1;\n        this.displayId = options.displayId || null; // Optional display element ID\n        this.displayFormat = options.displayFormat || (v => v.toFixed(2)); // Format function\n        // Transform functions for value conversion (e.g., slider value \u2192 actual value)\n        this.transform = options.transform || (v => v); // slider \u2192 setting\n        this.inverseTransform = options.inverseTransform || (v => v); // setting \u2192 slider\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        // Apply transform to get actual setting value\n        return this.transform(sliderValue);\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        // Apply inverse transform to get slider value\n        const sliderValue = this.inverseTransform(value);\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            // Display shows the actual value, not the slider value\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n        const step = parseFloat(element.attr('step')) || this.step;\n\n        let increment = step;\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = step * 10;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        } else if (action === 'reset') {\n            newValue = this.inverseTransform(this.defaultValue);\n        } else {\n            return false; // Unknown action\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        // Handle both input and change events for better browser compatibility\n        const handler = () => {\n            const value = this.getValue(); // Gets transformed value\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        };\n\n        element.on('input change', handler);\n    }\n}\n\n/**\n * Logarithmic slider control\n * Slider position is linear [0-100], but value is logarithmic [minValue-maxValue]\n */\nexport class LogSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.minValue = options.minValue || 0.01;\n        this.maxValue = options.maxValue || 100.0;\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(3));\n    }\n\n    /**\n     * Convert linear slider position [0, 100] to logarithmic value\n     */\n    linearToLog(sliderValue) {\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        return Math.exp(minLog + scale * sliderValue);\n    }\n\n    /**\n     * Convert logarithmic value to linear slider position [0, 100]\n     */\n    logToLinear(actualValue) {\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        return (Math.log(actualValue) - minLog) / scale;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        return this.linearToLog(sliderValue);\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        const sliderValue = this.logToLinear(value);\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentSliderValue = parseFloat(element.val());\n        const min = 0;\n        const max = 100;\n\n        // Increment in slider space (0-100)\n        // Use smaller increments for logarithmic sliders since they're already non-linear\n        let increment = 1.0;  // Small step\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = 10.0;  // Large step\n        }\n\n        let newSliderValue = currentSliderValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newSliderValue = Math.min(max, currentSliderValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newSliderValue = Math.max(min, currentSliderValue - increment);\n        } else if (action === 'reset') {\n            newSliderValue = this.logToLinear(this.defaultValue);\n        } else {\n            return false;\n        }\n\n        if (newSliderValue !== currentSliderValue) {\n            element.val(newSliderValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // LogSlider uses internal 0-100 range for linear slider position\n        element.attr('min', 0);\n        element.attr('max', 100);\n        element.attr('step', 0.1);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Text input control\n */\nexport class TextControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.trim = options.trim !== undefined ? options.trim : true;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        let value = element.val();\n        if (this.trim) value = value.trim();\n        return value;\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Dropdown/select control\n */\nexport class SelectControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const value = element.val();\n        // Return defaultValue if element returns null/undefined\n        return value != null ? value : this.defaultValue;\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('change', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Checkbox control\n */\nexport class CheckboxControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return element.prop('checked');\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.prop('checked', value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('change', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Percentage slider control\n * Slider shows 0-100, but value is stored as 0.0-1.0\n */\nexport class PercentSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0;\n        this.max = options.max || 100;\n        this.step = options.step || 0.1;\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(2));\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        return sliderValue / 100.0; // Convert to 0.0-1.0\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        const sliderValue = value * 100.0; // Convert to 0-100\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentSliderValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n        const step = parseFloat(element.attr('step')) || this.step;\n\n        let increment = step;\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = step * 10;\n        }\n\n        let newSliderValue = currentSliderValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newSliderValue = Math.min(max, currentSliderValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newSliderValue = Math.max(min, currentSliderValue - increment);\n        } else if (action === 'reset') {\n            newSliderValue = this.defaultValue * 100.0; // Convert to slider space\n        } else {\n            return false;\n        }\n\n        if (newSliderValue !== currentSliderValue) {\n            element.val(newSliderValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Adaptive slider control\n * Increment is always one order of magnitude less than current value\n * E.g., value=10-99 \u2192 increment=1; value=1-9.9 \u2192 increment=0.1; etc.\n */\nexport class AdaptiveSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0.001;\n        this.max = options.max || 100;\n        this.minIncrement = options.minIncrement || 0.0001; // Minimum allowed increment\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(4));\n    }\n\n    /**\n     * Calculate increment based on current value\n     * Returns 10^(floor(log10(|value|)) - 1)\n     */\n    calculateIncrement(value) {\n        const absValue = Math.abs(value);\n\n        // Handle edge cases\n        if (absValue < this.minIncrement) {\n            return this.minIncrement;\n        }\n\n        // Calculate order of magnitude\n        const orderOfMagnitude = Math.floor(Math.log10(absValue));\n        const increment = Math.pow(10, orderOfMagnitude - 1);\n\n        // Ensure we don't go below minimum\n        return Math.max(this.minIncrement, increment);\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n\n        let increment = this.calculateIncrement(currentValue);\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment *= 10;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        } else if (action === 'reset') {\n            newValue = this.defaultValue;\n        } else {\n            return false;\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return parseFloat(element.val());\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        // Adaptive sliders use a very small step for smooth adjustment\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.minIncrement);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Timestep slider control with custom increment buttons\n * Has --, -, +, ++ buttons with different increment sizes\n */\nexport class TimestepControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0.001;\n        this.max = options.max || 2.5;\n        this.step = options.step || 0.001;\n        this.smallIncrement = options.smallIncrement || 0.001;  // - and + buttons\n        this.largeIncrement = options.largeIncrement || 0.01;   // -- and ++ buttons\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(3));\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return parseFloat(element.val());\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n\n        let increment;\n        if (action === 'increase' || action === 'decrease') {\n            increment = this.smallIncrement;\n        } else if (action === 'increase-large' || action === 'decrease-large') {\n            increment = this.largeIncrement;\n        } else if (action === 'reset') {\n            const newValue = this.defaultValue;\n            if (newValue !== currentValue) {\n                element.val(newValue).trigger('input');\n                return true;\n            }\n            return false;\n        } else {\n            return false;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n/**\n * Animatable Slider Control\n * Extends SliderControl with animation bounds that interpolate with alpha\n */\nexport class AnimatableSliderControl extends SliderControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n\n        // Animation state\n        this.animationEnabled = false;\n        this.animationMin = options.animationMin !== undefined ? options.animationMin : this.transform(this.min);\n        this.animationMax = options.animationMax !== undefined ? options.animationMax : this.transform(this.max);\n        this.currentAlpha = 0.0;\n    }\n\n    /**\n     * Enable/disable animation for this control\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = min;\n        this.animationMax = max;\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n        this.setValue(value);\n\n        // Update the main slider visual state\n        const element = $(`#${this.id}`);\n        element.addClass('animating');\n    }\n\n    /**\n     * Update the UI to show/hide animation controls\n     */\n    updateAnimationUI() {\n        const boundsContainer = $(`#${this.id}-animation-bounds`);\n        const slider = $(`#${this.id}`);\n        const animBtn = $(`#${this.id}-anim-btn`);\n\n        if (this.animationEnabled) {\n            boundsContainer.slideDown(200);\n            slider.addClass('animating');\n            animBtn.addClass('active');\n            animBtn.attr('title', 'Disable animation');\n        } else {\n            boundsContainer.slideUp(200);\n            slider.removeClass('animating');\n            animBtn.removeClass('active');\n            animBtn.attr('title', 'Enable animation');\n        }\n    }\n\n    /**\n     * Override attach listeners to add animation controls\n     */\n    attachListeners(callback) {\n        // Call parent to attach basic slider listeners\n        super.attachListeners(callback);\n\n        const element = $(`#${this.id}`);\n        const container = element.closest('.slider-control');\n\n        // Add animation button\n        const animBtn = $('<button>')\n            .attr('id', `${this.id}-anim-btn`)\n            .addClass('slider-btn anim-btn')\n            .attr('title', 'Enable animation')\n            .html('\uD83C\uDFAC')\n            .on('click', (e) => {\n                e.stopPropagation();\n                this.setAnimationEnabled(!this.animationEnabled);\n            });\n\n        container.append(animBtn);\n\n        // Add animation bounds container (initially hidden)\n        const boundsHTML = `\n            <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds\" style=\"display: none;\">\n                <div class=\"bounds-row\">\n                    <label>Min: <input type=\"number\" id=\"${this.id}-anim-min\" step=\"any\" value=\"${this.animationMin}\"/></label>\n                    <label>Max: <input type=\"number\" id=\"${this.id}-anim-max\" step=\"any\" value=\"${this.animationMax}\"/></label>\n                </div>\n            </div>\n        `;\n        container.after(boundsHTML);\n\n        // Attach listeners to bound inputs\n        $(`#${this.id}-anim-min`).on('input', () => {\n            this.animationMin = parseFloat($(`#${this.id}-anim-min`).val());\n        });\n\n        $(`#${this.id}-anim-max`).on('input', () => {\n            this.animationMax = parseFloat($(`#${this.id}-anim-max`).val());\n        });\n    }\n\n    /**\n     * Save animation state to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore animation state from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            // Update UI inputs\n            $(`#${this.id}-anim-min`).val(this.animationMin);\n            $(`#${this.id}-anim-max`).val(this.animationMax);\n\n            this.updateAnimationUI();\n        }\n    }\n}\n\n/**\n * Control Manager\n * Manages a collection of controls with automatic save/restore\n */\nexport class ControlManager {\n    constructor(options = {}) {\n        this.controls = new Map(); // id -> Control instance\n        this.storageKey = options.storageKey || 'settings';\n        this.onApply = options.onApply || null; // Called when settings should be applied\n        this.debounceTime = options.debounceTime || 300;\n        this.applyTimeout = null;\n        this.renderer = options.renderer || null; // Renderer instance for coordinate system handling\n    }\n\n    /**\n     * Register a control\n     */\n    register(control) {\n        this.controls.set(control.id, control);\n        return control;\n    }\n\n    /**\n     * Register multiple controls\n     */\n    registerAll(controls) {\n        controls.forEach(control => this.register(control));\n    }\n\n    /**\n     * Initialize all controls (create DOM elements)\n     */\n    initializeControls() {\n        const debouncedCallback = () => this.debouncedApply();\n\n        for (const control of this.controls.values()) {\n            control.attachListeners(debouncedCallback);\n        }\n    }\n\n    /**\n     * Attach event listeners to all controls\n     * @deprecated Use initializeControls() instead\n     */\n    attachAllListeners() {\n        this.initializeControls();\n    }\n\n    /**\n     * Apply settings to all controls\n     */\n    applySettings(settings) {\n        this.setSettings(settings);\n    }\n\n    /**\n     * Get a control by ID\n     */\n    get(id) {\n        return this.controls.get(id);\n    }\n\n    /**\n     * Get current settings from all controls\n     */\n    getSettings() {\n        const settings = {};\n        for (const control of this.controls.values()) {\n            control.saveToSettings(settings);\n        }\n        return settings;\n    }\n\n    /**\n     * Apply settings to all controls\n     */\n    setSettings(settings) {\n        // Handle coordinate system first (if present in settings and dimensions match)\n        if (settings.coordinateSystem && settings.dimensions) {\n            try {\n                const coordSystemData = settings.coordinateSystem;\n                const coordinateSystem = CoordinateSystem.fromJSON(coordSystemData);\n\n                // Validate that coordinate system dimensions match settings dimensions\n                if (coordinateSystem.dimensions === settings.dimensions) {\n                    if (this.renderer) {\n                        this.renderer.coordinateSystem = coordinateSystem;\n                    }\n\n                    // Update dimension inputs UI to reflect coordinate variables\n                    const expressionsControl = this.get('dimension-inputs');\n                    if (expressionsControl && expressionsControl.setCoordinateSystem) {\n                        expressionsControl.setCoordinateSystem(coordinateSystem, false);\n                    }\n                }\n            } catch (error) {\n                console.error('Failed to restore coordinate system from settings:', error);\n            }\n        }\n\n        // First, restore all values\n        for (const control of this.controls.values()) {\n            control.restoreFromSettings(settings);\n        }\n\n        // Then, trigger onChange callbacks to update dependent controls\n        // This ensures all controls are in their correct state before triggering changes\n        for (const control of this.controls.values()) {\n            if (control.onChange && settings && settings[control.settingsKey] !== undefined) {\n                control.onChange(control.getValue());\n            }\n        }\n    }\n\n    /**\n     * Reset all controls to defaults\n     */\n    resetAll() {\n        for (const control of this.controls.values()) {\n            control.reset();\n        }\n    }\n\n    /**\n     * Save settings to localStorage\n     */\n    saveToStorage() {\n        const settings = this.getSettings();\n        localStorage.setItem(this.storageKey, JSON.stringify(settings));\n        return settings;\n    }\n\n    /**\n     * Load settings from localStorage\n     */\n    loadFromStorage() {\n        try {\n            const saved = localStorage.getItem(this.storageKey);\n            if (saved) {\n                const settings = JSON.parse(saved);\n                this.setSettings(settings);\n                return settings;\n            }\n        } catch (e) {\n            console.warn('Failed to load settings from localStorage:', e);\n        }\n        return null;\n    }\n\n    /**\n     * Clear settings from localStorage\n     */\n    clearStorage() {\n        localStorage.removeItem(this.storageKey);\n    }\n\n    /**\n     * Debounced apply function\n     */\n    debouncedApply() {\n        if (this.applyTimeout) {\n            clearTimeout(this.applyTimeout);\n        }\n        this.applyTimeout = setTimeout(() => {\n            if (this.onApply) {\n                const settings = this.getSettings();\n                this.onApply(settings);\n            }\n        }, this.debounceTime);\n    }\n\n    /**\n     * Immediate apply (no debounce)\n     */\n    apply() {\n        if (this.onApply) {\n            const settings = this.getSettings();\n            this.onApply(settings);\n        }\n    }\n}\n", "/**\n * Accordion utility functions\n * Handles automatic resizing of accordion sections when content changes\n */\n\n/**\n * Resize an accordion section to fit its content\n * @param {jQuery|string} selectorOrElement - jQuery element or selector for the control inside the accordion\n * @param {number} delay - Delay in ms to wait for DOM updates (default: 0)\n */\nexport function resizeAccordion(selectorOrElement, delay = 0) {\n    setTimeout(() => {\n        let $element;\n\n        // Handle both jQuery elements and selectors\n        if (typeof selectorOrElement === 'string') {\n            $element = $(selectorOrElement);\n        } else {\n            $element = selectorOrElement;\n        }\n\n        if (!$element.length) {\n            console.warn('resizeAccordion: Element not found', selectorOrElement);\n            return;\n        }\n\n        // Find the closest accordion section\n        const $accordionSection = $element.closest('.accordion-section');\n\n        if ($accordionSection.length && !$accordionSection.hasClass('collapsed')) {\n            // Set max-height to scrollHeight to accommodate new content\n            $accordionSection.css('max-height', $accordionSection[0].scrollHeight + 'px');\n        }\n    }, delay);\n}\n\n/**\n * Resize the accordion section containing a specific control ID\n * @param {string} controlId - The ID of a control inside the accordion\n * @param {number} delay - Delay in ms to wait for DOM updates (default: 0)\n */\nexport function resizeAccordionForControl(controlId, delay = 0) {\n    resizeAccordion(`#${controlId}`, delay);\n}\n\n/**\n * Create a debounced resize function for frequent updates\n * @param {number} wait - Debounce wait time in ms (default: 100)\n * @returns {Function} Debounced resize function\n */\nexport function createDebouncedResize(wait = 100) {\n    let timeout;\n\n    return function(selectorOrElement) {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => {\n            resizeAccordion(selectorOrElement, 0);\n        }, wait);\n    };\n}\n\n/**\n * Setup automatic resize observer for an element\n * Watches for size changes and automatically resizes the accordion\n * @param {jQuery|HTMLElement} element - Element to observe\n * @returns {ResizeObserver} The observer instance (call .disconnect() to stop)\n */\nexport function setupAccordionAutoResize(element) {\n    const target = element instanceof jQuery ? element[0] : element;\n\n    if (!target) {\n        console.warn('setupAccordionAutoResize: Invalid element', element);\n        return null;\n    }\n\n    // Check if ResizeObserver is available\n    if (typeof ResizeObserver === 'undefined') {\n        console.warn('ResizeObserver not available, falling back to manual resize');\n        return null;\n    }\n\n    const observer = new ResizeObserver(() => {\n        resizeAccordion($(target), 0);\n    });\n\n    observer.observe(target);\n    return observer;\n}\n\n/**\n * Resize all visible accordions\n * Useful after major layout changes\n */\nexport function resizeAllAccordions() {\n    $('.accordion-section').not('.collapsed').each(function() {\n        $(this).css('max-height', this.scrollHeight + 'px');\n    });\n}\n", "/**\n * Animatable Slider Control\n * A slider with animation bounds that can be set graphically using multiple handles\n */\n\nimport { SliderControl } from './control-base.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * AnimatableSliderControl\n * Extends SliderControl with multi-thumb slider for setting animation bounds\n */\nexport class AnimatableSliderControl extends SliderControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n\n        // Animation state\n        this.animationEnabled = false;\n        this.animationMin = options.animationMin !== undefined ? options.animationMin : this.transform(this.min);\n        this.animationMax = options.animationMax !== undefined ? options.animationMax : this.transform(this.max);\n        this.currentAlpha = 0.0;\n\n        // Track if we're currently animating\n        this.isAnimating = false;\n    }\n\n    /**\n     * Enable/disable animation for this control\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = Math.min(min, max);\n        this.animationMax = Math.max(min, max);\n        this.updateBoundsDisplay();\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n\n        this.isAnimating = true;\n        this.setValue(value);\n        this.updateCurrentIndicator(alpha);\n        this.isAnimating = false;\n    }\n\n    /**\n     * Update the current value indicator position\n     */\n    updateCurrentIndicator(alpha) {\n        const indicator = $(`#${this.id}-current-indicator`);\n        if (indicator.length) {\n            // Position as percentage\n            indicator.css('left', `${alpha * 100}%`);\n        }\n    }\n\n    /**\n     * Update bounds display\n     */\n    updateBoundsDisplay() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const minDisplay = $(`#${this.id}-min-display`);\n        const maxDisplay = $(`#${this.id}-max-display`);\n        const range = $(`#${this.id}-range`);\n\n        if (minHandle.length && maxHandle.length) {\n            // Convert values to slider positions (0-100)\n            const minSliderValue = this.inverseTransform(this.animationMin);\n            const maxSliderValue = this.inverseTransform(this.animationMax);\n\n            const minPercent = ((minSliderValue - this.min) / (this.max - this.min)) * 100;\n            const maxPercent = ((maxSliderValue - this.min) / (this.max - this.min)) * 100;\n\n            minHandle.css('left', `${minPercent}%`);\n            maxHandle.css('left', `${maxPercent}%`);\n\n            // Update range bar between handles\n            range.css({\n                'left': `${minPercent}%`,\n                'width': `${maxPercent - minPercent}%`\n            });\n\n            // Update display values\n            if (minDisplay.length) minDisplay.text(this.displayFormat(this.animationMin));\n            if (maxDisplay.length) maxDisplay.text(this.displayFormat(this.animationMax));\n        }\n    }\n\n    /**\n     * Update the UI to show/hide animation controls\n     */\n    updateAnimationUI() {\n        const boundsContainer = $(`#${this.id}-animation-bounds`);\n        const animBtn = $(`#${this.id}-anim-btn`);\n\n        if (this.animationEnabled) {\n            boundsContainer.slideDown(200, () => {\n                // Resize accordion after animation completes\n                resizeAccordion(`#${this.id}`, 0);\n            });\n            animBtn.addClass('active');\n            animBtn.attr('title', 'Disable animation (\uD83C\uDFAC)');\n            this.updateBoundsDisplay();\n        } else {\n            boundsContainer.slideUp(200, () => {\n                // Resize accordion after animation completes\n                resizeAccordion(`#${this.id}`, 0);\n            });\n            animBtn.removeClass('active');\n            animBtn.attr('title', 'Enable animation (\uD83C\uDFAC)');\n        }\n    }\n\n    /**\n     * Override attach listeners to add animation controls\n     */\n    attachListeners(callback) {\n        // Call parent to attach basic slider listeners\n        super.attachListeners(callback);\n\n        const element = $(`#${this.id}`);\n        const container = element.closest('.slider-control');\n\n        // Add animation button after the reset button\n        const animBtn = $('<button>')\n            .attr('id', `${this.id}-anim-btn`)\n            .addClass('slider-btn anim-btn')\n            .attr('title', 'Enable animation (\uD83C\uDFAC)')\n            .html('\uD83C\uDFAC')\n            .on('click', (e) => {\n                e.stopPropagation();\n                this.setAnimationEnabled(!this.animationEnabled);\n            });\n\n        container.append(animBtn);\n\n        // Add multi-thumb slider container (initially hidden)\n        const boundsHTML = `\n            <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds-slider\" style=\"display: none;\">\n                <div class=\"bounds-labels\">\n                    <span>Min: <span id=\"${this.id}-min-display\">${this.displayFormat(this.animationMin)}</span></span>\n                    <span>Max: <span id=\"${this.id}-max-display\">${this.displayFormat(this.animationMax)}</span></span>\n                </div>\n                <div class=\"multi-thumb-slider\">\n                    <div class=\"slider-track\"></div>\n                    <div id=\"${this.id}-range\" class=\"slider-range\"></div>\n                    <div id=\"${this.id}-current-indicator\" class=\"slider-current-indicator\"></div>\n                    <div id=\"${this.id}-min-handle\" class=\"slider-thumb min-thumb\" data-bound=\"min\">\n                        <span class=\"thumb-label\">MIN</span>\n                    </div>\n                    <div id=\"${this.id}-max-handle\" class=\"slider-thumb max-thumb\" data-bound=\"max\">\n                        <span class=\"thumb-label\">MAX</span>\n                    </div>\n                </div>\n            </div>\n        `;\n        container.after(boundsHTML);\n\n        // Attach drag handlers to thumbs\n        this.attachThumbDragHandlers();\n    }\n\n    /**\n     * Attach drag handlers to the min/max thumbs\n     */\n    attachThumbDragHandlers() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const track = minHandle.parent();\n\n        const handlers = [\n            { handle: minHandle, bound: 'min' },\n            { handle: maxHandle, bound: 'max' }\n        ];\n\n        handlers.forEach(({ handle, bound }) => {\n            let isDragging = false;\n\n            handle.on('mousedown', (e) => {\n                isDragging = true;\n                handle.addClass('dragging');\n                $('body').css('user-select', 'none');\n                e.preventDefault();\n            });\n\n            $(document).on('mousemove', (e) => {\n                if (!isDragging) return;\n\n                // Get mouse position relative to track element\n                const mousePos = this.getMousePositionInElement(e, track);\n                const trackWidth = track.width();\n\n                // Calculate percentage position (0-100)\n                let newPercent = (mousePos.x / trackWidth) * 100;\n\n                // Clamp to 0-100\n                newPercent = Math.max(0, Math.min(100, newPercent));\n\n                // Convert percent to slider value\n                const sliderValue = this.min + (newPercent / 100) * (this.max - this.min);\n                const actualValue = this.transform(sliderValue);\n\n                // Update the bound\n                if (bound === 'min') {\n                    // Don't let min exceed max\n                    if (actualValue <= this.animationMax) {\n                        this.animationMin = actualValue;\n                    }\n                } else {\n                    // Don't let max go below min\n                    if (actualValue >= this.animationMin) {\n                        this.animationMax = actualValue;\n                    }\n                }\n\n                this.updateBoundsDisplay();\n            });\n\n            $(document).on('mouseup', () => {\n                if (isDragging) {\n                    isDragging = false;\n                    handle.removeClass('dragging');\n                    $('body').css('user-select', '');\n                }\n            });\n        });\n    }\n\n    /**\n     * Save animation state to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore animation state from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            this.updateAnimationUI();\n        }\n    }\n\n    /**\n     * Get all animatable controls that are enabled\n     */\n    static getAllAnimatableControls(controlManager) {\n        const animatable = [];\n        controlManager.controls.forEach((control) => {\n            if (control instanceof AnimatableSliderControl && control.animationEnabled) {\n                animatable.push(control);\n            }\n        });\n        return animatable;\n    }\n}\n", "/**\n * Animatable Timestep Control\n * Combines timestep increment buttons with animation capabilities\n */\n\nimport { AnimatableSliderControl } from './animatable-slider.js';\n\n/**\n * AnimatableTimestepControl\n * Extends AnimatableSliderControl with custom timestep increment buttons\n */\nexport class AnimatableTimestepControl extends AnimatableSliderControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.smallIncrement = options.smallIncrement || 0.001;  // - and + buttons\n        this.largeIncrement = options.largeIncrement || 0.01;   // -- and ++ buttons\n    }\n\n    /**\n     * Handle button actions with timestep-specific increments\n     */\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = this.getValue();\n        const min = this.min;\n        const max = this.max;\n\n        let increment;\n        if (action === 'increase' || action === 'decrease') {\n            increment = this.smallIncrement;\n        } else if (action === 'increase-large' || action === 'decrease-large') {\n            increment = this.largeIncrement;\n        } else if (action === 'reset') {\n            const newValue = this.defaultValue;\n            if (newValue !== currentValue) {\n                this.setValue(newValue);\n                element.trigger('input');\n                return true;\n            }\n            return false;\n        } else {\n            return false;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        }\n\n        if (newValue !== currentValue) {\n            this.setValue(newValue);\n            element.trigger('input');\n            return true;\n        }\n        return false;\n    }\n}\n", "/**\n * Shared utility functions for UI controls\n * Formatting, scale inference, increment calculation, etc.\n */\n\n/**\n * Create a scientific notation formatter\n * @param {number} precision - Number of decimal places in scientific notation\n * @param {number} threshold - Threshold for switching to scientific notation (default: 10)\n * @returns {function(number): string}\n */\nexport function createScientificFormatter(precision = 2, threshold = 10) {\n    return (v) => {\n        const absV = Math.abs(v);\n        if (absV >= threshold || (absV < 1.0 / threshold && absV !== 0)) {\n            return v.toExponential(precision);\n        } else {\n            return v.toFixed(precision + 1);\n        }\n    };\n}\n\n/**\n * Create a decimal formatter\n * @param {number} precision - Number of decimal places\n * @returns {function(number): string}\n */\nexport function createDecimalFormatter(precision = 2) {\n    return (v) => v.toFixed(precision);\n}\n\n/**\n * Create an integer formatter\n * @returns {function(number): string}\n */\nexport function createIntegerFormatter() {\n    return (v) => v.toFixed(0);\n}\n\n/**\n * Infer scale type from parameter range\n * @param {number} min - Minimum value\n * @param {number} max - Maximum value\n * @param {number} step - Step size\n * @returns {'linear' | 'log' | 'adaptive'}\n */\nexport function inferScaleType(min, max, step) {\n    // If min is positive and range spans multiple orders of magnitude, use adaptive/log\n    if (min > 0 && max / min > 1000) {\n        return 'adaptive';\n    }\n    return 'linear';\n}\n\n/**\n * Calculate adaptive increment based on current value\n * For wide-range parameters, increment should scale with magnitude\n *\n * @param {number} currentValue - Current value\n * @param {number} baseStep - Base step size (minimum increment)\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Calculated increment\n */\nexport function calculateAdaptiveIncrement(currentValue, baseStep, isLarge = false) {\n    const absValue = Math.abs(currentValue);\n\n    // For very small values, use baseStep\n    let increment = absValue < baseStep\n        ? baseStep\n        : Math.pow(10, Math.floor(Math.log10(absValue)) - 1);\n\n    // Ensure we never go below baseStep\n    increment = Math.max(baseStep, increment);\n\n    // For large increments, multiply by 10\n    if (isLarge) {\n        increment *= 10;\n    }\n\n    return increment;\n}\n\n/**\n * Calculate logarithmic increment\n * For log-scale sliders, increment in slider space\n *\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Slider space increment\n */\nexport function calculateLogIncrement(isLarge = false) {\n    return isLarge ? 10 : 1;\n}\n\n/**\n * Calculate linear increment\n * @param {number} step - Step size\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Calculated increment\n */\nexport function calculateLinearIncrement(step, isLarge = false) {\n    return isLarge ? step * 10 : step;\n}\n\n/**\n * Create a formatter from parameter definition\n * @param {object} paramDef - Parameter definition\n * @returns {function(number): string}\n */\nexport function createFormatterFromDef(paramDef) {\n    // If custom formatter provided, use it\n    if (typeof paramDef.displayFormat === 'function') {\n        return paramDef.displayFormat;\n    }\n\n    const precision = paramDef.displayPrecision ?? 2;\n\n    // Parse string format types\n    switch (paramDef.displayFormat) {\n        case 'scientific':\n            return createScientificFormatter(precision, paramDef.scientificThreshold ?? 10);\n        case 'integer':\n            return createIntegerFormatter();\n        case 'decimal':\n        default:\n            return createDecimalFormatter(precision);\n    }\n}\n", "/**\n * Generic parameter control that reads metadata from parameter definitions\n * Eliminates duplication between transform definitions and UI code\n */\n\nimport { Control } from './control-base.js';\nimport {\n    createFormatterFromDef,\n    inferScaleType,\n    calculateAdaptiveIncrement,\n    calculateLogIncrement,\n    calculateLinearIncrement\n} from './control-utilities.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * ParameterControl - Generic control for any parameter with metadata\n *\n * Reads parameter definition (from transforms, integrators, mappers, etc.)\n * and creates appropriate UI controls automatically.\n *\n * Parameter definition schema:\n * {\n *   name: string,              // Parameter name (used as key in settings)\n *   label: string,             // Display label\n *   type: string,              // 'slider' | 'text' | 'checkbox' (future)\n *   min: number,               // Minimum value\n *   max: number,               // Maximum value\n *   step: number,              // Step size\n *   default: number,           // Default value\n *   info: string,              // Optional help text\n *   scale: string,             // Optional: 'linear' | 'log' | 'adaptive' (auto-inferred if not provided)\n *   displayFormat: string|fn,  // Optional: 'scientific' | 'decimal' | 'integer' | custom function\n *   displayPrecision: number,  // Optional: decimal places (default: 2)\n *   scientificThreshold: number // Optional: threshold for scientific notation (default: 10)\n * }\n */\nexport class ParameterControl extends Control {\n    constructor(id, parameterDef, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n\n        // Store parameter definition\n        this.parameterDef = parameterDef;\n\n        // Infer or use explicit scale type\n        this.scale = parameterDef.scale || inferScaleType(\n            parameterDef.min,\n            parameterDef.max,\n            parameterDef.step\n        );\n\n        // Create formatter from parameter definition\n        this.formatter = createFormatterFromDef(parameterDef);\n\n        // Store display element reference (will be set in attachListeners)\n        this.displayElement = null;\n    }\n\n    /**\n     * Calculate increment for button actions\n     * @param {number} currentValue - Current parameter value\n     * @param {boolean} isLarge - Whether this is a large increment\n     * @returns {number} Increment value\n     */\n    calculateIncrement(currentValue, isLarge = false) {\n        switch (this.scale) {\n            case 'adaptive':\n                return calculateAdaptiveIncrement(\n                    currentValue,\n                    this.parameterDef.step,\n                    isLarge\n                );\n\n            case 'log':\n                // For log scale, increment in slider space\n                return calculateLogIncrement(isLarge);\n\n            case 'linear':\n            default:\n                return calculateLinearIncrement(\n                    this.parameterDef.step,\n                    isLarge\n                );\n        }\n    }\n\n    /**\n     * Handle button actions (increment/decrement/reset)\n     * @param {string} action - 'increase', 'decrease', 'increase-large', 'decrease-large', 'reset'\n     * @returns {boolean} True if action was handled\n     */\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = this.getValue();\n        const min = this.parameterDef.min;\n        const max = this.parameterDef.max;\n\n        let newValue = currentValue;\n\n        if (action === 'reset') {\n            newValue = this.defaultValue;\n        } else {\n            const increment = this.calculateIncrement(\n                currentValue,\n                action.includes('large')\n            );\n\n            if (action.startsWith('increase')) {\n                newValue = Math.min(max, currentValue + increment);\n            } else if (action.startsWith('decrease')) {\n                newValue = Math.max(min, currentValue - increment);\n            } else {\n                return false;\n            }\n        }\n\n        if (newValue !== currentValue) {\n            this.setValue(newValue);\n            element.trigger('input');\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Render the control HTML\n     * @returns {string} HTML string\n     */\n    render() {\n        const displayId = `${this.id}-display`;\n        const currentValue = this.defaultValue;\n\n        return `\n            <div class=\"control-group\">\n                <label>\n                    ${this.parameterDef.label}:\n                    <span class=\"range-value\" id=\"${displayId}\">\n                        ${this.formatter(currentValue)}\n                    </span>\n                </label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease-large\">--</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"${this.id}\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase-large\">++</button>\n                </div>\n                ${this.parameterDef.info ? `<div class=\"info\">${this.parameterDef.info}</div>` : ''}\n            </div>\n        `;\n    }\n\n    /**\n     * Attach to DOM and set up listeners\n     * @param {function} callback - Callback to trigger when value changes\n     */\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n        this.displayElement = $(`#${this.id}-display`);\n\n        if (!element.length) {\n            console.error(`ParameterControl: Element #${this.id} not found in DOM`);\n            return;\n        }\n\n        // Set slider attributes\n        element.attr('min', this.parameterDef.min);\n        element.attr('max', this.parameterDef.max);\n        element.attr('step', this.parameterDef.step);\n        element.val(this.defaultValue);\n\n        // Update display\n        this.updateDisplay(this.defaultValue);\n\n        // Listen for changes\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Update display element with formatted value\n     * @param {number} value - Value to display\n     */\n    updateDisplay(value) {\n        if (this.displayElement && this.displayElement.length) {\n            this.displayElement.text(this.formatter(value));\n        }\n    }\n\n    /**\n     * Get current value from DOM\n     * @returns {number}\n     */\n    getValue() {\n        if (!this.element || !this.element.length) {\n            return this.defaultValue;\n        }\n        return parseFloat(this.element.val());\n    }\n\n    /**\n     * Set value in DOM\n     * @param {number} value - Value to set\n     */\n    setValue(value) {\n        if (this.element && this.element.length) {\n            this.element.val(value);\n            this.updateDisplay(value);\n        }\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n}\n\n/**\n * AnimatableParameterControl\n * Extends ParameterControl with animation bounds\n */\nexport class AnimatableParameterControl extends ParameterControl {\n    constructor(id, parameterDef, defaultValue, options = {}) {\n        super(id, parameterDef, defaultValue, options);\n\n        // Animation state\n        this.animationEnabled = false;\n        // Default to 25% and 75% of the range if not specified\n        const range = parameterDef.max - parameterDef.min;\n        this.animationMin = options.animationMin ?? (parameterDef.min + range * 0.25);\n        this.animationMax = options.animationMax ?? (parameterDef.min + range * 0.75);\n        this.currentAlpha = 0.0;\n        this.isAnimating = false;\n    }\n\n    /**\n     * Enable/disable animation\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = Math.min(min, max);\n        this.animationMax = Math.max(min, max);\n        this.updateBoundsDisplay();\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n\n        this.isAnimating = true;\n        this.setValue(value);\n        this.updateCurrentIndicator(alpha);\n        this.isAnimating = false;\n    }\n\n    /**\n     * Update current indicator position\n     */\n    updateCurrentIndicator(alpha) {\n        const indicator = $(`#${this.id}-current-indicator`);\n        if (indicator.length) {\n            indicator.css('left', `${alpha * 100}%`);\n        }\n    }\n\n    /**\n     * Update bounds display\n     */\n    updateBoundsDisplay() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const minDisplay = $(`#${this.id}-min-display`);\n        const maxDisplay = $(`#${this.id}-max-display`);\n        const range = $(`#${this.id}-range`);\n\n        if (minHandle.length && maxHandle.length) {\n            const min = this.parameterDef.min;\n            const max = this.parameterDef.max;\n\n            const minPercent = ((this.animationMin - min) / (max - min)) * 100;\n            const maxPercent = ((this.animationMax - min) / (max - min)) * 100;\n\n            minHandle.css('left', `${minPercent}%`);\n            maxHandle.css('left', `${maxPercent}%`);\n\n            range.css({\n                'left': `${minPercent}%`,\n                'width': `${maxPercent - minPercent}%`\n            });\n\n            if (minDisplay.length) minDisplay.text(this.formatter(this.animationMin));\n            if (maxDisplay.length) maxDisplay.text(this.formatter(this.animationMax));\n        }\n    }\n\n    /**\n     * Update animation UI visibility\n     */\n    updateAnimationUI() {\n        const boundsContainer = $(`#${this.id}-animation-bounds`);\n        const animBtn = $(`#${this.id}-anim-btn`);\n\n        if (this.animationEnabled) {\n            boundsContainer.slideDown(200);\n            animBtn.addClass('active');\n            animBtn.attr('title', 'Disable animation (\uD83C\uDFAC)');\n            this.updateBoundsDisplay();\n\n            // Update accordion height immediately and after animation\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 0);\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 250);\n        } else {\n            boundsContainer.slideUp(200);\n            animBtn.removeClass('active');\n            animBtn.attr('title', 'Enable animation (\uD83C\uDFAC)');\n\n            // Update accordion height after animation\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 250);\n        }\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#transform-controls', 0);\n    }\n\n    /**\n     * Override render to add animation button\n     */\n    render() {\n        const displayId = `${this.id}-display`;\n        const currentValue = this.defaultValue;\n\n        return `\n            <div class=\"control-group\">\n                <label>\n                    ${this.parameterDef.label}:\n                    <span class=\"range-value\" id=\"${displayId}\">\n                        ${this.formatter(currentValue)}\n                    </span>\n                </label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease-large\">--</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"${this.id}\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase-large\">++</button>\n                    <button class=\"slider-btn anim-btn\" id=\"${this.id}-anim-btn\" title=\"Enable animation (\uD83C\uDFAC)\">\uD83C\uDFAC</button>\n                </div>\n                ${this.parameterDef.info ? `<div class=\"info\">${this.parameterDef.info}</div>` : ''}\n            </div>\n        `;\n    }\n\n    /**\n     * Override attachListeners to add animation controls\n     */\n    attachListeners(callback) {\n        // Call parent to set up basic slider\n        super.attachListeners(callback);\n\n        // Use setTimeout to ensure DOM is fully ready for dynamically created content\n        setTimeout(() => {\n            const element = $(`#${this.id}`);\n            if (!element.length) {\n                return;\n            }\n\n            const animBtn = $(`#${this.id}-anim-btn`);\n            if (!animBtn.length) {\n                return;\n            }\n\n            // Add animation button handler\n            animBtn.on('click', (e) => {\n                e.stopPropagation();\n                this.setAnimationEnabled(!this.animationEnabled);\n            });\n\n            // Add multi-thumb slider HTML after the control group\n            const boundsHTML = `\n                <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds-slider\" style=\"display: none;\">\n                    <div class=\"bounds-labels\">\n                        <span>Min: <span id=\"${this.id}-min-display\">${this.formatter(this.animationMin)}</span></span>\n                        <span>Max: <span id=\"${this.id}-max-display\">${this.formatter(this.animationMax)}</span></span>\n                    </div>\n                    <div class=\"multi-thumb-slider\">\n                        <div class=\"slider-track\"></div>\n                        <div id=\"${this.id}-range\" class=\"slider-range\"></div>\n                        <div id=\"${this.id}-current-indicator\" class=\"slider-current-indicator\"></div>\n                        <div id=\"${this.id}-min-handle\" class=\"slider-thumb min-thumb\" data-bound=\"min\">\n                            <span class=\"thumb-label\">MIN</span>\n                        </div>\n                        <div id=\"${this.id}-max-handle\" class=\"slider-thumb max-thumb\" data-bound=\"max\">\n                            <span class=\"thumb-label\">MAX</span>\n                        </div>\n                    </div>\n                </div>\n            `;\n\n            const controlGroup = element.closest('.control-group');\n            if (controlGroup.length) {\n                controlGroup.after(boundsHTML);\n                // Attach drag handlers after inserting HTML\n                this.attachThumbDragHandlers();\n            } else {\n                console.warn(`AnimatableParameterControl: Could not find .control-group parent for #${this.id}`);\n            }\n        }, 0);\n    }\n\n    /**\n     * Attach drag handlers to thumbs\n     */\n    attachThumbDragHandlers() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const track = minHandle.parent();\n\n        const handlers = [\n            { handle: minHandle, bound: 'min' },\n            { handle: maxHandle, bound: 'max' }\n        ];\n\n        handlers.forEach(({ handle, bound }) => {\n            let isDragging = false;\n            let startX = 0;\n            let startLeft = 0;\n\n            handle.on('mousedown', (e) => {\n                isDragging = true;\n                startX = e.pageX;\n                startLeft = parseFloat(handle.css('left')) || 0;\n\n                handle.addClass('dragging');\n                // Bring this handle to front\n                minHandle.css('z-index', '10');\n                maxHandle.css('z-index', '10');\n                handle.css('z-index', '11');\n                $('body').css('user-select', 'none');\n                e.preventDefault();\n            });\n\n            $(document).on('mousemove', (e) => {\n                if (!isDragging) return;\n\n                // Get track dimensions and position\n                const trackOffset = track.offset();\n                const trackWidth = track.width();\n\n                // Calculate mouse position relative to track\n                const relativeX = e.pageX - trackOffset.left;\n\n                // Convert to percentage\n                let newPercent = (relativeX / trackWidth) * 100;\n\n                // Clamp to 0-100\n                newPercent = Math.max(0, Math.min(100, newPercent));\n\n                // Convert percent to actual value\n                const min = this.parameterDef.min;\n                const max = this.parameterDef.max;\n                const actualValue = min + (newPercent / 100) * (max - min);\n\n                // Update the bound\n                if (bound === 'min') {\n                    if (actualValue <= this.animationMax) {\n                        this.animationMin = actualValue;\n                    }\n                } else {\n                    if (actualValue >= this.animationMin) {\n                        this.animationMax = actualValue;\n                    }\n                }\n\n                this.updateBoundsDisplay();\n            });\n\n            $(document).on('mouseup', () => {\n                if (isDragging) {\n                    isDragging = false;\n                    handle.removeClass('dragging');\n                    $('body').css('user-select', '');\n                }\n            });\n        });\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            this.updateAnimationUI();\n        }\n    }\n}\n", "/**\n * Custom control classes for complex UI controls (Version 2)\n * Refactored to eliminate duplication with transform parameter definitions\n */\n\nimport { Control, CheckboxControl } from './control-base.js';\nimport { ParameterControl, AnimatableParameterControl } from './parameter-control.js';\nimport { getTransform } from '../math/transforms.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * FloatCheckboxControl - checkbox that outputs 0.0 or 1.0 instead of boolean\n * Useful for shader uniforms that expect floats\n */\nexport class FloatCheckboxControl extends CheckboxControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const checked = super.getValue();\n        return checked ? 1.0 : 0.0;\n    }\n\n    setValue(value) {\n        // Accept both boolean and numeric values\n        const checked = (typeof value === 'number') ? (value > 0.5) : value;\n        super.setValue(checked);\n    }\n}\n\n/**\n * DimensionInputsControl - manages dynamic expression inputs\n * Creates/destroys input fields based on dimension count\n */\nexport class DimensionInputsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('dimension-inputs', defaultValue, options);\n        this.dimensionsControl = null; // Will be set to the dimensions control\n        this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n        this.coordinateSystem = null; // Current coordinate system\n    }\n\n    /**\n     * Set reference to dimensions control (needed to know how many inputs to create)\n     */\n    setDimensionsControl(dimensionsControl) {\n        this.dimensionsControl = dimensionsControl;\n    }\n\n    /**\n     * Update coordinate system and refresh variable labels\n     * @param {CoordinateSystem} coordinateSystem - The new coordinate system\n     * @param {boolean} updateUI - Whether to refresh the UI (default: true)\n     */\n    setCoordinateSystem(coordinateSystem, updateUI = true) {\n        this.coordinateSystem = coordinateSystem;\n\n        // Update varNames from coordinate system\n        if (coordinateSystem && coordinateSystem.getDisplayLabels) {\n            this.varNames = coordinateSystem.getDisplayLabels();\n        } else {\n            // Fallback to Cartesian\n            this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n        }\n\n        // Refresh the inputs with new labels (preserve current values)\n        // Skip during initialization to avoid overwriting saved values\n        if (updateUI) {\n            this.updateInputs();\n        }\n    }\n\n    /**\n     * Get current dimension count\n     */\n    getDimensions() {\n        if (this.dimensionsControl) {\n            return this.dimensionsControl.getValue();\n        }\n        return parseInt($('#dimensions').val()) || 2;\n    }\n\n    /**\n     * Get current expression values\n     */\n    getValue() {\n        const dimensions = this.getDimensions();\n        const expressions = [];\n        for (let i = 0; i < dimensions; i++) {\n            let expr = $(`#expr-${i}`).val().trim();\n\n            // Convert Unicode symbols to ASCII (\u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.)\n            if (expr && window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                expr = window.UnicodeAutocomplete.unicodeToAscii(expr);\n            }\n\n            expressions.push(expr || '0');\n        }\n        return expressions;\n    }\n\n    /**\n     * Set expression values\n     */\n    setValue(expressions) {\n        if (!Array.isArray(expressions)) return;\n\n        // Ensure we have the right number of inputs first, passing the new values\n        this.updateInputs(expressions.length, expressions);\n    }\n\n    /**\n     * Update dimension inputs based on current dimension count\n     * @param {number|null} dimensions - Number of dimensions (null = use current)\n     * @param {Array|null} newValues - Optional new values to set (overrides current values)\n     */\n    updateInputs(dimensions = null, newValues = null) {\n        if (dimensions === null) {\n            dimensions = this.getDimensions();\n        }\n\n        logger.verbose('updateInputs called with dimensions:', dimensions);\n\n        const container = $('#dimension-inputs');\n        logger.verbose('Container found:', container.length);\n        if (container.length === 0) {\n            logger.error('Could not find #dimension-inputs element');\n            return;\n        }\n\n        // Determine what values to use\n        let valuesToUse;\n        if (newValues && Array.isArray(newValues)) {\n            // Use provided new values\n            valuesToUse = newValues;\n            logger.verbose('Using provided newValues');\n        } else {\n            // Get current values before clearing (check if elements exist first)\n            const firstElement = $(`#expr-0`);\n            logger.verbose('firstElement exists:', firstElement.length > 0);\n            try {\n                if (firstElement.length > 0) {\n                    valuesToUse = this.getValue();\n                    logger.verbose('Got current values from getValue()');\n                } else {\n                    valuesToUse = this.defaultValue;\n                    logger.verbose('Using defaultValue');\n                }\n            } catch (error) {\n                logger.error('Error getting values:', error);\n                valuesToUse = this.defaultValue;\n            }\n        }\n\n        logger.verbose('Values to use:', valuesToUse);\n\n        // Clear and rebuild\n        container.empty();\n        logger.verbose('Container emptied, now creating', dimensions, 'inputs');\n\n        for (let i = 0; i < dimensions; i++) {\n            const varName = this.varNames[i];\n            const defaultValue = valuesToUse[i] || this.defaultValue[i] || '0';\n\n            const div = $('<div class=\"dimension-input\"></div>');\n            div.append(`<label>d${varName}/dt =</label>`);\n            div.append(`<input type=\"text\" id=\"expr-${i}\" value=\"${defaultValue}\">`);\n\n            container.append(div);\n            logger.verbose('Created input', i, 'with value:', defaultValue);\n        }\n\n        logger.verbose('All inputs created, container now has', container.children().length, 'children');\n\n        // Reattach listeners to new inputs\n        this.attachInputListeners();\n\n        // Attach unicode autocomplete to expression inputs\n        if (window.unicodeAutocomplete) {\n            window.unicodeAutocomplete.attachToAll('[id^=\"expr-\"]');\n        }\n\n        // Update accordion height to accommodate new inputs\n        this.updateAccordionHeight();\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#dimension-inputs', 0);\n    }\n\n    /**\n     * Attach listeners to expression inputs\n     */\n    attachInputListeners() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('input', '[id^=\"expr-\"]');\n\n        // Add new listeners\n        $(document).on('input', '[id^=\"expr-\"]', () => {\n            if (this.onChange) this.onChange(this.getValue());\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n\n        // Initial setup\n        this.updateInputs();\n\n        // Attach input listeners\n        this.attachInputListeners();\n\n        // Listen for dimension changes (will be called externally)\n        // The dimensions control will call updateInputs() via onChange\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n}\n\n/**\n * MapperParamsControl - manages mapper dimension selectors\n * Creates dropdowns for selecting which dimensions to display\n */\nexport class MapperParamsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('mapper-params', defaultValue, options);\n        this.dimensionsControl = null;\n        this.mapperControl = null;\n        this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n    }\n\n    /**\n     * Set references to related controls\n     */\n    setRelatedControls(dimensionsControl, mapperControl) {\n        this.dimensionsControl = dimensionsControl;\n        this.mapperControl = mapperControl;\n    }\n\n    /**\n     * Get current dimensions and mapper type\n     */\n    getContext() {\n        const dimensions = this.dimensionsControl ? this.dimensionsControl.getValue() : 2;\n        const mapper = this.mapperControl ? this.mapperControl.getValue() : 'select';\n        return { dimensions, mapper };\n    }\n\n    /**\n     * Get current mapper params\n     */\n    getValue() {\n        const { mapper } = this.getContext();\n\n        if (mapper === 'custom') {\n            const horizontalElement = $('#mapper-horizontal-expr');\n            const verticalElement = $('#mapper-vertical-expr');\n            const depthElement = $('#mapper-depth-expr');\n\n            if (horizontalElement.length && verticalElement.length) {\n                return {\n                    horizontalExpr: horizontalElement.val() || 'x',\n                    verticalExpr: verticalElement.val() || 'y',\n                    depthExpr: depthElement.val() || ''\n                };\n            }\n            return this.currentParams || { horizontalExpr: 'x', verticalExpr: 'y', depthExpr: '' };\n        }\n\n        const dim1Element = $('#mapper-dim1');\n        const dim2Element = $('#mapper-dim2');\n\n        if (dim1Element.length && dim2Element.length) {\n            const dim1 = parseInt(dim1Element.val());\n            const dim2 = parseInt(dim2Element.val());\n\n            // Validate dimensions are valid numbers\n            if (isNaN(dim1) || isNaN(dim2)) {\n                console.warn('Invalid mapper dimensions, using defaults');\n                return this.defaultValue;\n            }\n\n            return { dim1, dim2 };\n        }\n\n        // Return default if elements don't exist yet\n        return this.defaultValue;\n    }\n\n    /**\n     * Set mapper params\n     */\n    setValue(params) {\n        // Update controls will recreate the dropdowns with these values\n        this.currentParams = params;\n        this.updateControls();\n    }\n\n    /**\n     * Update mapper controls based on mapper type and dimensions\n     */\n    updateControls() {\n        const { dimensions, mapper } = this.getContext();\n        const container = $('#mapper-controls');\n\n        if (container.length === 0) return;\n\n        container.empty();\n\n        if (mapper === 'select') {\n            const row = $('<div class=\"control-row\"></div>');\n\n            // Horizontal dimension selector\n            const group1 = $('<div class=\"control-group\" style=\"flex: 1;\"></div>');\n            group1.append(`<label>Horizontal</label>`);\n\n            const select1 = $('<select id=\"mapper-dim1\"></select>');\n            const currentDim1 = this.currentParams ? this.currentParams.dim1 : this.defaultValue.dim1;\n\n            for (let i = 0; i < dimensions; i++) {\n                const selected = i === currentDim1 ? 'selected' : '';\n                select1.append(`<option value=\"${i}\" ${selected}>${this.varNames[i]}</option>`);\n            }\n            group1.append(select1);\n\n            // Vertical dimension selector\n            const group2 = $('<div class=\"control-group\" style=\"flex: 1;\"></div>');\n            group2.append(`<label>Vertical</label>`);\n\n            const select2 = $('<select id=\"mapper-dim2\"></select>');\n            const currentDim2 = this.currentParams ? this.currentParams.dim2 : this.defaultValue.dim2;\n\n            for (let i = 0; i < dimensions; i++) {\n                const selected = i === currentDim2 ? 'selected' : '';\n                select2.append(`<option value=\"${i}\" ${selected}>${this.varNames[i]}</option>`);\n            }\n            group2.append(select2);\n\n            row.append(group1);\n            row.append(group2);\n            container.append(row);\n\n            // Attach change listeners\n            this.attachSelectListeners();\n\n        } else if (mapper === 'project') {\n            const info = $('<div class=\"info\">Linear projection uses default 2D projection</div>');\n            container.append(info);\n\n        } else if (mapper === 'custom') {\n            const varNames = this.varNames.slice(0, dimensions).join(', ');\n\n            // Horizontal expression\n            const group1 = $('<div class=\"control-group\"></div>');\n            group1.append(`<label>Horizontal (X):</label>`);\n            const currentHorizontal = this.currentParams?.horizontalExpr || 'x';\n            const input1 = $(`<input type=\"text\" id=\"mapper-horizontal-expr\" value=\"${currentHorizontal}\" placeholder=\"e.g., sin(x) + sin(y)\" style=\"font-family: monospace; width: 100%;\" />`);\n            group1.append(input1);\n            container.append(group1);\n\n            // Vertical expression\n            const group2 = $('<div class=\"control-group\"></div>');\n            group2.append(`<label>Vertical (Y):</label>`);\n            const currentVertical = this.currentParams?.verticalExpr || 'y';\n            const input2 = $(`<input type=\"text\" id=\"mapper-vertical-expr\" value=\"${currentVertical}\" placeholder=\"e.g., -cos(x) - cos(y)\" style=\"font-family: monospace; width: 100%;\" />`);\n            group2.append(input2);\n            container.append(group2);\n\n            // Depth expression (optional)\n            const group3 = $('<div class=\"control-group\"></div>');\n            group3.append(`<label>Depth (Z, optional):</label>`);\n            const currentDepth = this.currentParams?.depthExpr || '';\n            const input3 = $(`<input type=\"text\" id=\"mapper-depth-expr\" value=\"${currentDepth}\" placeholder=\"optional, e.g., z\" style=\"font-family: monospace; width: 100%;\" />`);\n            group3.append(input3);\n            container.append(group3);\n\n            const info = $('<div class=\"info\">Define math expressions using variables: ' + varNames + '. Functions: sin, cos, tan, exp, log, sqrt, abs, etc.</div>');\n            container.append(info);\n\n            // Attach change listeners\n            this.attachCustomListener();\n        }\n    }\n\n    /**\n     * Attach listeners to mapper dimension selectors\n     */\n    attachSelectListeners() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('change', '#mapper-dim1, #mapper-dim2');\n\n        // Add new listeners\n        $('#mapper-dim1, #mapper-dim2').on('change', () => {\n            this.currentParams = this.getValue();\n            if (this.onChange) this.onChange(this.currentParams);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach listeners to custom mapper text inputs\n     */\n    attachCustomListener() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('input', '#mapper-horizontal-expr, #mapper-vertical-expr, #mapper-depth-expr');\n\n        // Add new listeners\n        $('#mapper-horizontal-expr, #mapper-vertical-expr, #mapper-depth-expr').on('input', () => {\n            this.currentParams = this.getValue();\n            if (this.onChange) this.onChange(this.currentParams);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n        this.currentParams = this.defaultValue;\n\n        // Initial setup\n        this.updateControls();\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.currentParams = this.defaultValue;\n        this.updateControls();\n    }\n}\n\n/**\n * GradientControl - integrates with existing gradient editor\n * Wraps the gradient editor for use with ControlManager\n */\nexport class GradientControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('color-gradient', defaultValue, options);\n        this.gradientEditor = null;\n    }\n\n    /**\n     * Set reference to gradient editor instance\n     */\n    setGradientEditor(gradientEditor) {\n        this.gradientEditor = gradientEditor;\n    }\n\n    /**\n     * Get current gradient\n     */\n    getValue() {\n        if (this.gradientEditor && this.gradientEditor.getGradient) {\n            return this.gradientEditor.getGradient();\n        }\n        // Return stored value if editor not available\n        return this.currentGradient || this.defaultValue;\n    }\n\n    /**\n     * Set gradient value\n     */\n    setValue(gradient) {\n        this.currentGradient = gradient;\n        if (this.gradientEditor && this.gradientEditor.setGradient) {\n            this.gradientEditor.setGradient(gradient);\n        }\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        // Gradient editor has its own onChange handler\n        // We'll set this up when the editor is initialized\n        this.onChangeCallback = callback;\n    }\n\n    /**\n     * Called when gradient editor changes\n     */\n    notifyChange(newGradient) {\n        this.currentGradient = newGradient;\n        if (this.onChange) this.onChange(newGradient);\n        if (this.onChangeCallback) this.onChangeCallback();\n    }\n\n    /**\n     * Reset to default gradient\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] !== undefined) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n/**\n * TransformParamsControl - manages transform parameter sliders\n * Creates dynamic controls based on the selected transform type\n *\n * REFACTORED VERSION: No longer duplicates parameter definitions!\n * - Reads parameters from transform's getParameters() method (single source of truth)\n * - Uses ParameterControl instances for rendering and value management\n * - Eliminates ~200 lines of duplicate code\n */\nexport class TransformParamsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('transform-params', defaultValue, options);\n        this.transformControl = null;\n        this.currentParams = defaultValue || {};\n        this.parameterControls = new Map(); // Maps control ID -> ParameterControl instance\n    }\n\n    /**\n     * Set reference to transform control\n     */\n    setTransformControl(transformControl) {\n        this.transformControl = transformControl;\n    }\n\n    /**\n     * Get current transform type\n     */\n    getTransformType() {\n        return this.transformControl ? this.transformControl.getValue() : 'identity';\n    }\n\n    /**\n     * Get current parameter values\n     */\n    getValue() {\n        const values = {};\n\n        // Collect values from all parameter controls\n        for (const [controlId, paramControl] of this.parameterControls.entries()) {\n            const paramName = paramControl.settingsKey;\n            values[paramName] = paramControl.getValue();\n        }\n\n        return values;\n    }\n\n    /**\n     * Set parameter values\n     */\n    setValue(params) {\n        this.currentParams = params || {};\n        this.updateControls();\n    }\n\n    /**\n     * Update transform parameter controls based on transform type\n     * Reads parameter definitions directly from the transform instance\n     */\n    updateControls() {\n        const transformType = this.getTransformType();\n        const container = $('#transform-controls');\n\n        if (container.length === 0) return;\n\n        // Clear old controls\n        container.empty();\n        this.parameterControls.clear();\n\n        // Get transform instance\n        const transform = getTransform(transformType);\n        if (!transform) {\n            logger.warn(`Transform not found: ${transformType}`);\n            this.updateAccordionHeight();\n            return;\n        }\n\n        // Get parameter definitions from transform (single source of truth!)\n        const paramDefs = transform.getParameters();\n\n        if (paramDefs.length === 0) {\n            // No parameters for this transform\n            this.updateAccordionHeight();\n            return;\n        }\n\n        // Create AnimatableParameterControl for each parameter\n        paramDefs.forEach((paramDef, index) => {\n            const controlId = `transform-param-${index}`;\n            const defaultValue = this.currentParams[paramDef.name] ?? paramDef.default;\n\n            // Create animatable parameter control\n            const paramControl = new AnimatableParameterControl(\n                controlId,\n                paramDef,\n                defaultValue,\n                {\n                    settingsKey: paramDef.name, // Use parameter name as settings key\n                    onChange: (value) => {\n                        this.currentParams[paramDef.name] = value;\n                        if (this.onChange) this.onChange(this.currentParams);\n                    }\n                }\n            );\n\n            // Render and append to container\n            container.append(paramControl.render());\n\n            // Attach listeners\n            paramControl.attachListeners(this.onChangeCallback);\n\n            // Store reference for button handling\n            this.parameterControls.set(controlId, paramControl);\n        });\n\n        // Update accordion height to accommodate new controls\n        this.updateAccordionHeight();\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#transform-controls', 0);\n    }\n\n    /**\n     * Handle button actions for dynamically created transform parameter sliders\n     * Delegates to the appropriate ParameterControl instance\n     *\n     * @param {string} sliderId - The slider ID (e.g., 'transform-param-0')\n     * @param {string} action - The button action\n     * @returns {boolean} True if handled\n     */\n    handleTransformParamButton(sliderId, action) {\n        const control = this.parameterControls.get(sliderId);\n        if (control) {\n            return control.handleButtonAction(action);\n        }\n        return false;\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n\n        // Initial setup\n        this.updateControls();\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.currentParams = this.defaultValue;\n        this.updateControls();\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] !== undefined) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n", "/**\n * Simple gradient editor component\n * Creates a UI for editing color gradients with multiple stops\n */\n\nimport { rgbToHex, hexToRgb } from '../math/gradients.js';\n\n/**\n * Initialize gradient editor\n * @param {string} containerId - ID of container element\n * @param {Array} initialGradient - Initial gradient stops\n * @param {Function} onChange - Callback when gradient changes\n */\nexport function initGradientEditor(containerId, initialGradient, onChange) {\n    const container = $(`#${containerId}`);\n    if (!container.length) {\n        console.error(`Gradient editor container #${containerId} not found`);\n        return null;\n    }\n\n    let gradient = initialGradient.map(stop => ({...stop})); // Deep copy\n\n    function render() {\n        // Sort by position for display\n        const sorted = [...gradient].sort((a, b) => a.position - b.position);\n\n        let html = '<div class=\"gradient-stops\">';\n\n        sorted.forEach((stop, index) => {\n            const actualIndex = gradient.indexOf(stop);\n            const hex = rgbToHex(stop.color);\n\n            html += `\n                <div class=\"gradient-stop\" data-index=\"${actualIndex}\">\n                    <input type=\"color\" class=\"color-picker\" value=\"${hex}\" data-index=\"${actualIndex}\">\n                    <input type=\"number\" class=\"stop-position\" min=\"0\" max=\"1\" step=\"0.01\" value=\"${stop.position.toFixed(2)}\" data-index=\"${actualIndex}\">\n                    ${gradient.length > 2 ? `<button class=\"remove-stop\" data-index=\"${actualIndex}\">\u00D7</button>` : ''}\n                </div>\n            `;\n        });\n\n        html += '</div>';\n        html += '<button id=\"add-stop\" class=\"secondary\" style=\"margin-top: 5px;\">Add Color Stop</button>';\n        html += '<div class=\"gradient-preview\" id=\"gradient-preview\"></div>';\n\n        container.html(html);\n\n        // Render preview\n        renderPreview();\n\n        // Attach event listeners\n        attachEventListeners();\n    }\n\n    function renderPreview() {\n        const preview = $('#gradient-preview');\n        if (!preview.length) return;\n\n        // Create CSS gradient\n        const sorted = [...gradient].sort((a, b) => a.position - b.position);\n        const stops = sorted.map(stop => {\n            const hex = rgbToHex(stop.color);\n            return `${hex} ${(stop.position * 100).toFixed(1)}%`;\n        }).join(', ');\n\n        preview.css('background', `linear-gradient(to right, ${stops})`);\n    }\n\n    function attachEventListeners() {\n        // Color picker change\n        $('.color-picker').off('change').on('change', function() {\n            const index = parseInt($(this).data('index'));\n            const hex = $(this).val();\n            gradient[index].color = hexToRgb(hex);\n            renderPreview();\n            onChange(gradient);\n        });\n\n        // Position change\n        $('.stop-position').off('change').on('change', function() {\n            const index = parseInt($(this).data('index'));\n            let pos = parseFloat($(this).val());\n            pos = Math.max(0, Math.min(1, pos)); // Clamp to [0,1]\n            gradient[index].position = pos;\n            render(); // Re-render to resort\n            onChange(gradient);\n        });\n\n        // Remove stop\n        $('.remove-stop').off('click').on('click', function() {\n            const index = parseInt($(this).data('index'));\n            if (gradient.length > 2) {\n                gradient.splice(index, 1);\n                render();\n                onChange(gradient);\n            }\n        });\n\n        // Add stop\n        $('#add-stop').off('click').on('click', function() {\n            // Find middle position\n            const sorted = [...gradient].sort((a, b) => a.position - b.position);\n            let newPos = 0.5;\n\n            // Find largest gap\n            let maxGap = 0;\n            let gapPos = 0.5;\n            for (let i = 0; i < sorted.length - 1; i++) {\n                const gap = sorted[i + 1].position - sorted[i].position;\n                if (gap > maxGap) {\n                    maxGap = gap;\n                    gapPos = (sorted[i].position + sorted[i + 1].position) / 2;\n                }\n            }\n            newPos = gapPos;\n\n            // Interpolate color at that position\n            const newColor = interpolateGradient(gradient, newPos);\n\n            gradient.push({\n                position: newPos,\n                color: newColor\n            });\n\n            render();\n            onChange(gradient);\n        });\n    }\n\n    // Helper to interpolate color at a given position\n    function interpolateGradient(stops, t) {\n        const sorted = [...stops].sort((a, b) => a.position - b.position);\n\n        // Find surrounding stops\n        if (t <= sorted[0].position) return [...sorted[0].color];\n        if (t >= sorted[sorted.length - 1].position) return [...sorted[sorted.length - 1].color];\n\n        for (let i = 0; i < sorted.length - 1; i++) {\n            if (t >= sorted[i].position && t <= sorted[i + 1].position) {\n                const t1 = sorted[i].position;\n                const t2 = sorted[i + 1].position;\n                const segmentT = (t - t1) / (t2 - t1);\n\n                const c1 = sorted[i].color;\n                const c2 = sorted[i + 1].color;\n\n                return [\n                    c1[0] + (c2[0] - c1[0]) * segmentT,\n                    c1[1] + (c2[1] - c1[1]) * segmentT,\n                    c1[2] + (c2[2] - c1[2]) * segmentT\n                ];\n            }\n        }\n\n        return [0.5, 0.5, 0.5]; // Fallback\n    }\n\n    // Initial render\n    render();\n\n    // Return API\n    return {\n        getGradient: () => gradient.map(stop => ({...stop})),\n        setGradient: (newGradient) => {\n            gradient = newGradient.map(stop => ({...stop}));\n            render();\n        }\n    };\n}\n", "/**\n * Coordinate System Editor\n *\n * Provides a UI for configuring alternate coordinate systems (polar, spherical, etc.)\n * Users can select presets or define custom coordinate transformations.\n */\n\nimport { CoordinateSystem, PRESET_COORDINATE_SYSTEMS, getPresetsForDimension, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { solveInverseSymbolically } from '../math/inverse-solver.js';\n\n/**\n * Initialize coordinate editor panel\n * @param {string} containerId - ID of container element\n * @param {number} dimensions - Current number of dimensions\n * @param {Object} initialSystem - Initial coordinate system\n * @param {Function} onChange - Callback when coordinate system changes (system) => {}\n */\nexport function initCoordinateEditor(containerId, dimensions, initialSystem, onChange) {\n    const container = $(`#${containerId}`);\n    if (!container.length) {\n        console.error(`Coordinate editor container #${containerId} not found`);\n        return null;\n    }\n\n    let currentSystem = initialSystem || getCartesianSystem(dimensions);\n    let currentDimensions = dimensions;\n\n    const editor = {\n        render,\n        update,\n        getCurrentSystem: () => currentSystem,\n        setDimensions\n    };\n\n    function render() {\n        const presets = getPresetsForDimension(currentDimensions);\n\n        let html = '<div class=\"coordinate-editor-content\">';\n\n        // Preset dropdown\n        html += '<div class=\"control-group\">';\n        html += '<label for=\"coord-preset\">Preset</label>';\n        html += '<select id=\"coord-preset\">';\n\n        // Find current preset key (if any)\n        let currentPresetKey = 'custom';\n        for (const [key, system] of Object.entries(PRESET_COORDINATE_SYSTEMS)) {\n            if (system.name === currentSystem.name &&\n                system.dimensions === currentSystem.dimensions) {\n                currentPresetKey = key;\n                break;\n            }\n        }\n\n        html += '<option value=\"custom\">Custom</option>';\n        presets.forEach(({ key, system }) => {\n            const selected = key === currentPresetKey ? 'selected' : '';\n            html += `<option value=\"${key}\" ${selected}>${system.name}</option>`;\n        });\n        html += '</select>';\n        html += '</div>';\n\n        // Variable definitions\n        html += '<div class=\"coordinate-variables\">';\n        html += '<div style=\"font-weight: bold;\">Coordinate Variables:</div>';\n\n        for (let i = 0; i < currentDimensions; i++) {\n            const variable = currentSystem.variables[i] || { label: 'x', displayLabel: 'x' };\n            const transform = currentSystem.forwardTransforms[i] || 'x';\n            const cartesianVar = ['x', 'y', 'z', 'w', 'u', 'v'][i];\n\n            html += '<div class=\"coord-var-row\">';\n            html += `<input type=\"text\" class=\"coord-var-label\" data-index=\"${i}\" value=\"${variable.displayLabel}\" placeholder=\"${cartesianVar}\" title=\"Variable label (can use Greek letters like \u03B8)\">`;\n            html += '<span>=</span>';\n            html += `<input type=\"text\" class=\"coord-var-transform coord-math-input\" data-index=\"${i}\" value=\"${transform}\" placeholder=\"${cartesianVar}\" title=\"Transformation expression in Cartesian coordinates\">`;\n            html += '</div>';\n        }\n\n        html += '</div>';\n\n        // Inverse transform section\n        html += '<div class=\"coordinate-inverse\">';\n        html += '<div style=\"font-weight: bold; margin-top: 15px;\">Inverse Transform (Native \u2192 Cartesian):</div>';\n\n        const useIterative = currentSystem.useIterativeSolver || false;\n\n        for (let i = 0; i < currentDimensions; i++) {\n            const cartesianVar = ['x', 'y', 'z', 'w', 'u', 'v'][i];\n            const inverseTransform = currentSystem.inverseTransforms && currentSystem.inverseTransforms[i]\n                ? currentSystem.inverseTransforms[i]\n                : '';\n            const nativeVars = currentSystem.variables.map(v => v.label || v.displayLabel).join(', ');\n\n            html += '<div class=\"coord-var-row\">';\n            html += `<span style=\"min-width: 20px;\">${cartesianVar}</span>`;\n            html += '<span>=</span>';\n            html += `<input type=\"text\" class=\"coord-inverse-transform coord-math-input\" data-index=\"${i}\" value=\"${inverseTransform}\" placeholder=\"(e.g., r*cos(theta))\" title=\"Inverse transformation from native coordinates\" ${useIterative ? 'disabled' : ''}>`;\n            html += '</div>';\n        }\n\n        html += '</div>';\n\n        // Solve button and iterative solver checkbox\n        html += '<div class=\"coordinate-tools\" style=\"margin-top: 10px;\">';\n        html += '<button id=\"coord-solve-inverse\" class=\"secondary\" title=\"Attempt to solve inverse transforms automatically using symbolic math\">\u26A1 Solve Inverse Symbolically</button>';\n        html += '<div style=\"margin-top: 8px;\">';\n        html += '<label style=\"display: flex; align-items: center; font-size: 0.9em;\">';\n        html += `<input type=\"checkbox\" id=\"coord-use-iterative\" ${useIterative ? 'checked' : ''} style=\"margin-right: 5px;\">`;\n        html += '<span title=\"Use GPU-based Newton\\'s method to compute inverse. Slower but works for any transform.\">Use iterative Newton solver (GLSL)</span>';\n        html += '</label>';\n        html += '</div>';\n        html += '</div>';\n\n        // Info text\n        html += '<div class=\"info-text\" style=\"margin-top: 15px;\">';\n        html += '<strong>Forward Transform:</strong> Define each native coordinate in terms of Cartesian variables (x, y, z, w, ...). ';\n        html += '<strong>Inverse Transform:</strong> Define each Cartesian coordinate in terms of native variables. ';\n        html += 'Use the \"Solve\" button to attempt automatic computation, or enable iterative solver for complex transforms. ';\n        html += 'Type \"theta\", \"phi\", etc. to insert Greek letters.';\n        html += '</div>';\n\n        // Action buttons\n        html += '<div class=\"coordinate-editor-buttons\">';\n        html += '<button id=\"coord-apply\" class=\"primary\">Apply</button>';\n        html += '<button id=\"coord-cancel\" class=\"secondary\">Cancel</button>';\n        html += '</div>';\n\n        html += '</div>';\n\n        container.html(html);\n\n        // Attach event listeners\n        attachEventListeners();\n\n        // Attach unicode autocomplete to math inputs\n        if (window.unicodeAutocomplete) {\n            $('.coord-math-input').each(function() {\n                window.unicodeAutocomplete.attach(this);\n            });\n            $('.coord-var-label').each(function() {\n                window.unicodeAutocomplete.attach(this);\n            });\n        }\n    }\n\n    function attachEventListeners() {\n        // Preset selection\n        $('#coord-preset').off('change').on('change', function() {\n            const presetKey = $(this).val();\n\n            if (presetKey === 'custom') {\n                // Keep current custom system\n                return;\n            }\n\n            const preset = PRESET_COORDINATE_SYSTEMS[presetKey];\n            if (preset) {\n                currentSystem = preset;\n                render();\n            }\n        });\n\n        // Variable label change\n        $('.coord-var-label').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const label = $(this).val().trim();\n\n            // Update current system (make it custom)\n            if (!currentSystem.variables[index]) {\n                currentSystem.variables[index] = { label: '', displayLabel: '' };\n            }\n            currentSystem.variables[index].displayLabel = label;\n            currentSystem.variables[index].label = label;\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Transform expression change\n        $('.coord-var-transform').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const transform = $(this).val().trim();\n\n            // Update current system (make it custom)\n            if (!currentSystem.forwardTransforms[index]) {\n                currentSystem.forwardTransforms[index] = transform;\n            } else {\n                currentSystem.forwardTransforms[index] = transform;\n            }\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Inverse transform expression change\n        $('.coord-inverse-transform').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const transform = $(this).val().trim();\n\n            // Initialize inverseTransforms array if needed\n            if (!currentSystem.inverseTransforms) {\n                currentSystem.inverseTransforms = new Array(currentDimensions).fill('');\n            }\n\n            // Update current system (make it custom)\n            currentSystem.inverseTransforms[index] = transform;\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Solve inverse button\n        $('#coord-solve-inverse').off('click').on('click', function() {\n            const button = $(this);\n            button.prop('disabled', true);\n            const originalText = button.text();\n            button.text('Solving...');\n\n            try {\n                const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, currentDimensions);\n                const nativeVars = currentSystem.variables.map(v => v.label || v.displayLabel);\n\n                const inverseTransforms = solveInverseSymbolically(\n                    currentSystem.forwardTransforms,\n                    currentDimensions,\n                    cartesianVars,\n                    nativeVars\n                );\n\n                if (inverseTransforms) {\n                    // Success! Update the system and UI\n                    currentSystem.inverseTransforms = inverseTransforms;\n\n                    // Update input fields\n                    $('.coord-inverse-transform').each(function() {\n                        const index = parseInt($(this).data('index'));\n                        $(this).val(inverseTransforms[index]);\n                    });\n\n                    button.text('\u2713 Solved!');\n                    setTimeout(() => {\n                        button.text(originalText);\n                        button.prop('disabled', false);\n                    }, 1500);\n                } else {\n                    // Failed - show error\n                    alert('Could not solve inverse transforms symbolically. You can:\\n' +\n                          '1. Define the inverse transforms manually\\n' +\n                          '2. Enable \"Use iterative Newton solver\" checkbox');\n                    button.text(originalText);\n                    button.prop('disabled', false);\n                }\n\n                // Mark as custom\n                $('#coord-preset').val('custom');\n\n            } catch (error) {\n                console.error('Error solving inverse:', error);\n                alert('Error solving inverse: ' + error.message);\n                button.text(originalText);\n                button.prop('disabled', false);\n            }\n        });\n\n        // Iterative solver checkbox\n        $('#coord-use-iterative').off('change').on('change', function() {\n            const useIterative = $(this).is(':checked');\n            currentSystem.useIterativeSolver = useIterative;\n\n            // Enable/disable inverse transform inputs\n            $('.coord-inverse-transform').prop('disabled', useIterative);\n\n            if (useIterative) {\n                // Gray out inputs and show they're not needed\n                $('.coord-inverse-transform').css('opacity', '0.5');\n            } else {\n                $('.coord-inverse-transform').css('opacity', '1.0');\n            }\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Apply button\n        $('#coord-apply').off('click').on('click', function() {\n            const button = $(this);\n\n            // Disable button and show feedback\n            button.prop('disabled', true);\n            const originalText = button.text();\n            button.text('Applying...');\n\n            try {\n                // Validate system\n                const isValid = validateSystem();\n\n                if (isValid) {\n                    // Convert Unicode symbols to ASCII in transform expressions before applying\n                    const transformsWithAscii = currentSystem.forwardTransforms.map(transform => {\n                        // Convert \u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.\n                        if (window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                            return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                        }\n                        return transform;\n                    });\n\n                    // Convert Unicode symbols in inverse transforms too\n                    const inverseTransformsWithAscii = currentSystem.inverseTransforms\n                        ? currentSystem.inverseTransforms.map(transform => {\n                            if (window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                                return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                            }\n                            return transform;\n                        })\n                        : null;\n\n                    // Create a proper CoordinateSystem instance (not a plain object!)\n                    // This preserves methods like getVariableNames(), toJSON(), etc.\n                    const systemToApply = new CoordinateSystem(\n                        currentSystem.name,\n                        currentSystem.dimensions,\n                        currentSystem.variables,\n                        transformsWithAscii,\n                        inverseTransformsWithAscii,\n                        currentSystem.useIterativeSolver || false\n                    );\n\n                    // Brief delay for visual feedback\n                    setTimeout(() => {\n                        // Apply coordinate system - allow temporary error states\n                        // (e.g., dimension mismatch will be resolved when dimensions update)\n                        onChange(systemToApply);\n                        button.prop('disabled', false);\n                        button.text(originalText);\n                    }, 100);\n                } else {\n                    alert('Invalid coordinate system. Please check your expressions.');\n                    button.prop('disabled', false);\n                    button.text(originalText);\n                }\n            } catch (error) {\n                console.error('Error in apply handler:', error);\n                // Don't block the change with an alert - just log and reset button\n                button.prop('disabled', false);\n                button.text(originalText);\n            }\n        });\n\n        // Cancel button\n        $('#coord-cancel').off('click').on('click', function() {\n            // Close panel (handled by caller)\n            onChange(null); // null means cancelled\n        });\n    }\n\n    function validateSystem() {\n        // Check that all variables have labels\n        for (let i = 0; i < currentDimensions; i++) {\n            if (!currentSystem.variables[i] || !currentSystem.variables[i].label) {\n                return false;\n            }\n            if (!currentSystem.forwardTransforms[i] || currentSystem.forwardTransforms[i].trim() === '') {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function update(newSystem) {\n        currentSystem = newSystem;\n        render();\n    }\n\n    function setDimensions(newDimensions) {\n        if (newDimensions !== currentDimensions) {\n            currentDimensions = newDimensions;\n            // Reset to Cartesian for new dimensions\n            currentSystem = getCartesianSystem(newDimensions);\n            render();\n        }\n    }\n\n    // Initial render\n    render();\n\n    return editor;\n}\n\n/**\n * Show coordinate editor in a floating panel\n * @param {number} dimensions - Current number of dimensions\n * @param {Object} initialSystem - Initial coordinate system\n * @param {Function} onApply - Callback when system is applied\n */\nexport function showCoordinateEditor(dimensions, initialSystem, onApply) {\n    // Create floating panel if it doesn't exist\n    let panel = $('#coordinate-editor-panel');\n    if (!panel.length) {\n        $('body').append(`\n            <div id=\"coordinate-editor-panel\" class=\"floating-panel\" style=\"display: none;\">\n                <button class=\"floating-panel-close\" style=\"display: none;\">&times;</button>\n                <div class=\"floating-panel-header\">\n                    <h3>Coordinate System</h3>\n                </div>\n                <div id=\"coordinate-editor-container\" class=\"floating-panel-content\">\n                </div>\n            </div>\n        `);\n        panel = $('#coordinate-editor-panel');\n    }\n\n    // Show panel\n    panel.show();\n\n    // Initialize editor\n    const editor = initCoordinateEditor(\n        'coordinate-editor-container',\n        dimensions,\n        initialSystem,\n        (system) => {\n            if (system === null) {\n                // Cancelled\n                panel.hide();\n            } else {\n                // Applied\n                onApply(system);\n                panel.hide();\n            }\n        }\n    );\n\n    // Close button\n    $('.floating-panel-close', panel).off('click').on('click', function() {\n        panel.hide();\n    });\n\n    // Drag functionality (same as gradient editor)\n    let isDragging = false;\n    let dragOffsetX = 0;\n    let dragOffsetY = 0;\n\n    $('.panel-header', panel).off('mousedown').on('mousedown', function(e) {\n        isDragging = true;\n        dragOffsetX = e.clientX - panel.offset().left;\n        dragOffsetY = e.clientY - panel.offset().top;\n        $(document).on('mousemove.panelDrag', function(e) {\n            if (isDragging) {\n                panel.css({\n                    left: e.clientX - dragOffsetX,\n                    top: e.clientY - dragOffsetY\n                });\n            }\n        });\n    });\n\n    $(document).on('mouseup.panelDrag', function() {\n        isDragging = false;\n        $(document).off('mousemove.panelDrag');\n    });\n\n    return editor;\n}\n", "/**\n * Symbolic Inverse Transform Solver\n *\n * Attempts to solve for inverse coordinate transforms using Nerdamer's symbolic equation solver.\n * Given forward transforms (Cartesian \u2192 Native), solves for reverse transforms (Native \u2192 Cartesian).\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Attempt to solve for inverse transforms symbolically using Nerdamer\n *\n * Strategy:\n * 1. Set up equations: native_i = forwardTransform_i(cartesian vars)\n * 2. Use Nerdamer's solve() to isolate each Cartesian variable\n * 3. Simplify results\n *\n * @param {string[]} forwardTransforms - Forward transform expressions (e.g., ['sqrt(x^2+y^2)', 'atan2(y,x)'])\n * @param {number} dimensions - Number of dimensions\n * @param {string[]} cartesianVars - Cartesian variable names (e.g., ['x', 'y', 'z'])\n * @param {string[]} nativeVars - Native variable names (e.g., ['r', 'theta', 'phi'])\n * @returns {string[]|null} - Inverse transform expressions or null if failed\n */\nexport function solveInverseSymbolically(forwardTransforms, dimensions, cartesianVars, nativeVars) {\n    logger.info('=== SYMBOLIC INVERSE SOLVING ===');\n    logger.info('Forward transforms:', forwardTransforms);\n    logger.info('Cartesian vars:', cartesianVars);\n    logger.info('Native vars:', nativeVars);\n\n    if (!window.nerdamer) {\n        logger.error('Nerdamer not loaded - cannot solve inverse symbolically');\n        return null;\n    }\n\n    try {\n        // Clear Nerdamer cache\n        if (window.nerdamer.clear) {\n            window.nerdamer.clear('all');\n        }\n\n        const inverseTransforms = [];\n\n        // Strategy: For each Cartesian variable, try to solve from the equations\n        // This works well for 2D/3D coordinate systems with simple relationships\n\n        // For 2D Polar (r, \u03B8), we can solve:\n        //   From r = sqrt(x^2+y^2) and \u03B8 = atan2(y,x)\n        //   We can derive x = r*cos(\u03B8), y = r*sin(\u03B8)\n        //\n        // Approach:\n        //   1. Try substitution method for common patterns (polar, spherical)\n        //   2. Fall back to Nerdamer's solve() for individual variables\n\n        if (dimensions === 2 && isValidPolarTransform(forwardTransforms)) {\n            // Polar 2D: Use known inverse formulas\n            logger.info('Detected 2D polar coordinates - using standard inverse');\n            return [`${nativeVars[0]}*cos(${nativeVars[1]})`, `${nativeVars[0]}*sin(${nativeVars[1]})`];\n        }\n\n        if (dimensions === 3 && isValidCylindricalTransform(forwardTransforms)) {\n            // Cylindrical 3D: Use known inverse formulas\n            logger.info('Detected 3D cylindrical coordinates - using standard inverse');\n            return [\n                `${nativeVars[0]}*cos(${nativeVars[1]})`,  // x = \u03C1*cos(\u03C6)\n                `${nativeVars[0]}*sin(${nativeVars[1]})`,  // y = \u03C1*sin(\u03C6)\n                nativeVars[2]                               // z = z\n            ];\n        }\n\n        if (dimensions === 3 && isValidSphericalTransform(forwardTransforms)) {\n            // Spherical 3D: Use known inverse formulas\n            logger.info('Detected 3D spherical coordinates - using standard inverse');\n            return [\n                `${nativeVars[0]}*sin(${nativeVars[1]})*cos(${nativeVars[2]})`,  // x = r*sin(\u03B8)*cos(\u03C6)\n                `${nativeVars[0]}*sin(${nativeVars[1]})*sin(${nativeVars[2]})`,  // y = r*sin(\u03B8)*sin(\u03C6)\n                `${nativeVars[0]}*cos(${nativeVars[1]})`                          // z = r*cos(\u03B8)\n            ];\n        }\n\n        // General approach: Try to solve each equation individually\n        logger.info('Attempting general symbolic solve...');\n\n        for (let i = 0; i < dimensions; i++) {\n            const cartesianVar = cartesianVars[i];\n\n            // Try to isolate cartesian variable from each forward transform\n            let solved = null;\n\n            for (let j = 0; j < dimensions; j++) {\n                const nativeVar = nativeVars[j];\n                const forwardExpr = forwardTransforms[j];\n\n                try {\n                    // Set up equation: nativeVar = forwardExpr\n                    // Solve for cartesianVar\n                    const equation = `${nativeVar} - (${forwardExpr})`;\n                    const solutions = window.nerdamer.solve(equation, cartesianVar);\n\n                    if (solutions) {\n                        const solStr = solutions.toString();\n                        logger.verbose(`Solved ${cartesianVar} from equation ${j}:`, solStr);\n\n                        // Check if solution is valid (doesn't contain other Cartesian variables)\n                        const containsOtherVars = cartesianVars.some((v, idx) =>\n                            idx !== i && solStr.includes(v)\n                        );\n\n                        if (!containsOtherVars) {\n                            solved = solStr;\n                            break; // Found a valid solution\n                        }\n                    }\n                } catch (e) {\n                    logger.verbose(`Failed to solve ${cartesianVar} from equation ${j}:`, e.message);\n                }\n            }\n\n            if (!solved) {\n                logger.warn(`Could not solve for ${cartesianVar} - symbolic solving failed`);\n                return null;\n            }\n\n            inverseTransforms.push(solved);\n        }\n\n        logger.info('Successfully solved inverse transforms:', inverseTransforms);\n        return inverseTransforms;\n\n    } catch (error) {\n        logger.error('Symbolic inverse solving failed:', error.message);\n        return null;\n    }\n}\n\n/**\n * Check if forward transforms match standard 2D polar pattern\n */\nfunction isValidPolarTransform(transforms) {\n    if (transforms.length !== 2) return false;\n\n    const r = transforms[0];\n    const theta = transforms[1];\n\n    // Check for sqrt(x^2 + y^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2/.test(r);\n\n    // Check for atan2(y, x) pattern\n    const hasAngleTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(theta);\n\n    return hasRadialTerm && hasAngleTerm;\n}\n\n/**\n * Check if forward transforms match standard 3D cylindrical pattern\n */\nfunction isValidCylindricalTransform(transforms) {\n    if (transforms.length !== 3) return false;\n\n    const rho = transforms[0];\n    const phi = transforms[1];\n    const z = transforms[2];\n\n    // Check for sqrt(x^2 + y^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2/.test(rho);\n\n    // Check for atan2(y, x) pattern\n    const hasAngleTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(phi);\n\n    // Check for z = z identity\n    const hasZTerm = z.trim() === 'z';\n\n    return hasRadialTerm && hasAngleTerm && hasZTerm;\n}\n\n/**\n * Check if forward transforms match standard 3D spherical pattern\n */\nfunction isValidSphericalTransform(transforms) {\n    if (transforms.length !== 3) return false;\n\n    const r = transforms[0];\n    const theta = transforms[1];\n    const phi = transforms[2];\n\n    // Check for sqrt(x^2 + y^2 + z^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*z\\s*\\^?\\*?\\*?\\s*2/.test(r);\n\n    // Check for acos(...) pattern for polar angle\n    const hasPolarAngleTerm = /acos/.test(theta);\n\n    // Check for atan2(y, x) pattern for azimuthal angle\n    const hasAzimuthalTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(phi);\n\n    return hasRadialTerm && hasPolarAngleTerm && hasAzimuthalTerm;\n}\n", "/**\n * UI controls management using ControlManager system\n * Replaces legacy controls.js with composable control architecture\n */\n\nimport {\n    ControlManager,\n    SliderControl,\n    LogSliderControl,\n    PercentSliderControl,\n    AdaptiveSliderControl,\n    TimestepControl,\n    TextControl,\n    SelectControl,\n    CheckboxControl\n} from './control-base.js';\nimport { AnimatableSliderControl } from './animatable-slider.js';\nimport { AnimatableTimestepControl } from './animatable-timestep.js';\nimport { AnimatableParameterControl } from './parameter-control.js';\nimport { DimensionInputsControl, MapperParamsControl, GradientControl, TransformParamsControl } from './custom-controls.js';\nimport { initGradientEditor } from './gradient-editor.js';\nimport { showCoordinateEditor } from './coordinate-editor.js';\nimport { CoordinateSystem, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { getDefaultGradient } from '../math/gradients.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * Initialize UI controls with ControlManager\n * @param {Renderer} renderer - The renderer instance\n * @param {Function} callback - Called when initialization is complete\n */\nexport function initControls(renderer, callback) {\n    // Create the control manager\n    const manager = new ControlManager({\n        renderer: renderer,  // Pass renderer for coordinate system handling\n        storageKey: 'vectorFieldSettings',\n        debounceTime: 300,\n        onApply: (settings) => {\n            // Transform implicitIterations into integratorParams\n            if (settings.implicitIterations !== undefined) {\n                settings.integratorParams = { iterations: settings.implicitIterations };\n            }\n\n            // Apply settings directly to renderer\n            // Allow temporary error states (e.g. dimension/coordinate system mismatch)\n            // Shader compilation will fail gracefully and user can fix it\n            renderer.updateConfig(settings);\n\n            // Save to localStorage (including bbox for pan/zoom state and coordinate system)\n            const settingsToSave = manager.getSettings();\n            if (renderer && renderer.bbox) {\n                settingsToSave.bbox = {\n                    min: [...renderer.bbox.min],\n                    max: [...renderer.bbox.max]\n                };\n            }\n            if (renderer && renderer.coordinateSystem) {\n                settingsToSave.coordinateSystem = renderer.coordinateSystem.toJSON();\n            }\n            localStorage.setItem('vectorFieldSettings', JSON.stringify(settingsToSave));\n\n            // Clear any error messages\n            hideError();\n        }\n    });\n\n    // ========================================\n    // Register all controls\n    // ========================================\n\n    // === Dimension and integration controls ===\n\n    const dimensionsControl = manager.register(new SliderControl('dimensions', 2, {\n        min: 2,\n        max: 6,\n        step: 1,\n        displayId: 'dim-value',\n        displayFormat: v => v.toFixed(0),\n        onChange: (value) => {\n            logger.verbose('Dimensions changed to:', value);\n\n            // Update dimension inputs when dimensions change\n            const expressionsControl = manager.get('dimension-inputs');\n            if (expressionsControl && renderer.coordinateSystem) {\n                logger.verbose('Updating dimension inputs with dimensions:', value);\n                // Don't reset coordinate system - just update the UI\n                // If dimensions mismatch, shader compilation will fail gracefully\n                if (renderer.coordinateSystem.dimensions === value) {\n                    expressionsControl.setCoordinateSystem(renderer.coordinateSystem);\n                    expressionsControl.updateInputs(value);\n                } else {\n                    logger.warn(`Coordinate system dimension mismatch: ${renderer.coordinateSystem.dimensions}D coordinate system with ${value}D expressions - update coordinate system or expressions to match`);\n                }\n            } else {\n                logger.verbose('Preserving existing coordinate system:', renderer.coordinateSystem.name);\n            }\n\n            // Update mapper controls\n            const mapperParamsControl = manager.get('mapper-params');\n            if (mapperParamsControl) {\n                mapperParamsControl.updateControls();\n            }\n        }\n    }));\n\n    const integratorControl = manager.register(new SelectControl('integrator', 'rk2', {\n        settingsKey: 'integratorType',\n        onChange: (value) => {\n            // Show/hide implicit method controls based on integrator type\n            const isImplicit = value.startsWith('implicit-') || value === 'trapezoidal';\n            $('#implicit-iterations-group').toggle(isImplicit);\n            $('#solution-method-group').toggle(isImplicit);\n\n            // Resize accordion to accommodate shown/hidden controls\n            resizeAccordion('#integrator', 0);\n        }\n    }));\n\n    const solutionMethodControl = manager.register(new SelectControl('solution-method', 'fixed-point', {\n        settingsKey: 'solutionMethod'\n    }));\n\n    const timestepControl = manager.register(new AnimatableTimestepControl('timestep', 0.01, {\n        min: 0.001,\n        max: 2.5,\n        step: 0.001,\n        smallIncrement: 0.001,  // - and + buttons\n        largeIncrement: 0.01,   // -- and ++ buttons\n        displayId: 'timestep-value',\n        displayFormat: v => v.toFixed(4),\n        animationMin: 0.001,    // Animation range: 0.001 to 0.1\n        animationMax: 0.1\n    }));\n\n    const implicitIterationsControl = manager.register(new SliderControl('implicit-iterations', 4, {\n        settingsKey: 'implicitIterations',\n        min: 1,\n        max: 10,\n        step: 1,\n        displayId: 'implicit-iterations-value',\n        displayFormat: v => v.toFixed(0)\n    }));\n\n    // === Particle controls ===\n\n    const particleCountControl = manager.register(new SliderControl('particles', 1000, {\n        settingsKey: 'particleCount',\n        min: 100,\n        max: 5000000,\n        step: 10000,\n        displayId: 'particles-value',\n        displayFormat: v => v.toFixed(0)\n    }));\n\n    const fadeControl = manager.register(new AnimatableSliderControl('fade', 0.999, {\n        settingsKey: 'fadeOpacity',\n        min: 0,\n        max: 100,\n        step: 0.1,\n        displayId: 'fade-value',\n        displayFormat: v => v.toFixed(4),\n        // Transform slider [0-100] to log scale [0.9-0.9999]\n        transform: (sliderValue) => {\n            const minLog = Math.log(0.9);\n            const maxLog = Math.log(0.9999);\n            const scale = (maxLog - minLog) / 100;\n            return Math.exp(minLog + scale * sliderValue);\n        },\n        inverseTransform: (value) => {\n            const minLog = Math.log(0.9);\n            const maxLog = Math.log(0.9999);\n            const scale = (maxLog - minLog) / 100;\n            return (Math.log(value) - minLog) / scale;\n        },\n        animationMin: 0.95,\n        animationMax: 0.9995\n    }));\n\n    const dropControl = manager.register(new SliderControl('drop', 0.0, {\n        settingsKey: 'dropProbability',\n        min: 0,\n        max: 0.1,\n        step: 0.001,\n        displayId: 'drop-value',\n        displayFormat: v => v.toFixed(4)\n    }));\n\n    const dropLowVelocityControl = manager.register(new CheckboxControl('drop-low-velocity', false, {\n        settingsKey: 'dropLowVelocity'\n    }));\n\n    // === Transform controls ===\n\n    const transformControl = manager.register(new SelectControl('transform', 'identity', {\n        settingsKey: 'transformType',\n        onChange: (value) => {\n            // Update transform params UI when transform type changes\n            const transformParamsControl = manager.get('transform-params');\n            if (transformParamsControl) {\n                transformParamsControl.updateControls();\n            }\n        }\n    }));\n\n    const transformParamsControl = manager.register(new TransformParamsControl({}, {\n        settingsKey: 'transformParams'\n    }));\n\n    // Set up transform params cross-reference\n    transformParamsControl.setTransformControl(transformControl);\n\n    // === Mapper controls ===\n\n    const mapperControl = manager.register(new SelectControl('mapper', 'select', {\n        settingsKey: 'mapperType',\n        onChange: (value) => {\n            // Update mapper params UI when mapper type changes\n            const mapperParamsControl = manager.get('mapper-params');\n            if (mapperParamsControl) {\n                mapperParamsControl.updateControls();\n            }\n        }\n    }));\n\n    const mapperParamsControl = manager.register(new MapperParamsControl({ dim1: 0, dim2: 1 }, {\n        settingsKey: 'mapperParams'\n    }));\n\n    // Set up mapper params cross-references\n    mapperParamsControl.setRelatedControls(dimensionsControl, mapperControl);\n\n    // === Color mode controls ===\n\n    const colorModeControl = manager.register(new SelectControl('color-mode', 'velocity_angle', {\n        settingsKey: 'colorMode',\n        onChange: (value) => {\n            updateExpressionControls(value);\n            updateGradientButtonVisibility(value);\n            updateVelocityScalingVisibility(value);\n        }\n    }));\n\n    const colorExpressionControl = manager.register(new TextControl('color-expression', 'x * y', {\n        settingsKey: 'colorExpression'\n    }));\n\n    const useCustomGradientControl = manager.register(new CheckboxControl('use-custom-gradient', false, {\n        settingsKey: 'useCustomGradient'\n    }));\n\n    const gradientControl = manager.register(new GradientControl(getDefaultGradient(), {\n        settingsKey: 'colorGradient'\n    }));\n\n    const velocityScaleModeControl = manager.register(new SelectControl('velocity-scale-mode', 'percentile95', {\n        settingsKey: 'velocityScaleMode'\n    }));\n\n    const velocityLogScaleControl = manager.register(new CheckboxControl('velocity-log-scale', false, {\n        settingsKey: 'velocityLogScale'\n    }));\n\n    // === Expression inputs (custom control) ===\n\n    const expressionsControl = manager.register(new DimensionInputsControl(['-y', 'x'], {\n        settingsKey: 'expressions'\n    }));\n\n    // Set up expressions cross-reference to dimensions\n    expressionsControl.setDimensionsControl(dimensionsControl);\n\n    // Initialize coordinate system labels (don't update UI yet - values not set)\n    expressionsControl.setCoordinateSystem(renderer.coordinateSystem, false);\n\n    // === HDR and tone mapping controls ===\n\n    const useHDRControl = manager.register(new CheckboxControl('use-hdr', true, {\n        settingsKey: 'useHDR'\n    }));\n\n    const useDepthTestControl = manager.register(new CheckboxControl('use-depth-test', false, {\n        settingsKey: 'useDepthTest'\n    }));\n\n    // === Render Scale (formerly Supersampling) ===\n    // Allows rendering at different resolutions (0.5x for performance, 2x+ for quality)\n\n    const supersampleFactorControl = manager.register(new SliderControl('supersample-factor', 1.0, {\n        min: 0.5,\n        max: 4.0,\n        step: 0.5,\n        displayId: 'supersample-factor-value',\n        displayFormat: v => v.toFixed(1) + 'x',\n        settingsKey: 'supersampleFactor'\n    }));\n\n    // === SMAA antialiasing controls ===\n\n    const smaaEnabledControl = manager.register(new CheckboxControl('smaa-enabled', true, {\n        settingsKey: 'smaaEnabled'\n    }));\n\n    const smaaIntensityControl = manager.register(new PercentSliderControl('smaa-intensity', 0.75, {\n        displayId: 'smaa-intensity-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const smaaThresholdControl = manager.register(new PercentSliderControl('smaa-threshold', 0.10, {\n        displayId: 'smaa-threshold-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    // === Bilateral filter controls ===\n\n    const bilateralEnabledControl = manager.register(new CheckboxControl('bilateral-enabled', false, {\n        settingsKey: 'bilateralEnabled'\n    }));\n\n    // Spatial sigma: slider 10-100 \u2192 value 0.5-5.0 (divide by 20)\n    class BilateralSpatialControl extends SliderControl {\n        getValue() {\n            const element = $(`#${this.id}`);\n            return parseFloat(element.val()) / 20.0;\n        }\n        setValue(value) {\n            const element = $(`#${this.id}`);\n            element.val(value * 20.0);\n            this.updateDisplay(value);\n        }\n    }\n\n    const bilateralSpatialControl = manager.register(new BilateralSpatialControl('bilateral-spatial', 4.0, {\n        min: 10,\n        max: 100,\n        step: 1,\n        displayId: 'bilateral-spatial-value',\n        displayFormat: v => v.toFixed(1),\n        settingsKey: 'bilateralSpatialSigma'\n    }));\n\n    // Intensity sigma: slider 1-50 \u2192 value 0.01-0.5 (divide by 100)\n    class BilateralIntensityControl extends SliderControl {\n        getValue() {\n            const element = $(`#${this.id}`);\n            return parseFloat(element.val()) / 100.0;\n        }\n        setValue(value) {\n            const element = $(`#${this.id}`);\n            element.val(value * 100.0);\n            this.updateDisplay(value);\n        }\n    }\n\n    const bilateralIntensityControl = manager.register(new BilateralIntensityControl('bilateral-intensity', 0.20, {\n        min: 1,\n        max: 50,\n        step: 0.1,\n        displayId: 'bilateral-intensity-value',\n        displayFormat: v => v.toFixed(2),\n        settingsKey: 'bilateralIntensitySigma'\n    }));\n\n    // === Tone mapping controls ===\n\n    const tonemapOperatorControl = manager.register(new SelectControl('tonemap-operator', 'aces', {\n        settingsKey: 'tonemapOperator',\n        onChange: (value) => {\n            updateWhitePointVisibility(value);\n        }\n    }));\n\n    const exposureControl = manager.register(new LogSliderControl('exposure', 1.0, {\n        minValue: 0.0001,\n        maxValue: 10.0,\n        displayId: 'exposure-value',\n        displayFormat: v => v.toFixed(4)\n    }));\n\n    const gammaControl = manager.register(new LogSliderControl('gamma', 2.2, {\n        minValue: 0.2,\n        maxValue: 10.0,\n        displayId: 'gamma-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const luminanceGammaControl = manager.register(new LogSliderControl('luminance-gamma', 1.0, {\n        settingsKey: 'luminanceGamma',\n        minValue: 0.2,\n        maxValue: 10.0,\n        displayId: 'luminance-gamma-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const highlightCompressionControl = manager.register(new LogSliderControl('highlight-compression', 0.0, {\n        settingsKey: 'highlightCompression',\n        minValue: 0.0,\n        maxValue: 10.0,\n        displayId: 'highlight-compression-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const compressionThresholdControl = manager.register(new LogSliderControl('compression-threshold', 1.0, {\n        settingsKey: 'compressionThreshold',\n        minValue: 0.0001,\n        maxValue: 100000.0,\n        displayId: 'compression-threshold-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const whitePointControl = manager.register(new LogSliderControl('white-point', 2.0, {\n        settingsKey: 'whitePoint',\n        minValue: 1.0,\n        maxValue: 1000.0,\n        displayId: 'white-point-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const particleIntensityControl = manager.register(new LogSliderControl('particle-intensity', 1.0, {\n        settingsKey: 'particleIntensity',\n        minValue: 0.001,\n        maxValue: 100.0,\n        displayId: 'particle-intensity-value',\n        displayFormat: v => v.toFixed(3)\n    }));\n\n    const particleSizeControl = manager.register(new LogSliderControl('particle-size', 1.0, {\n        settingsKey: 'particleSize',\n        minValue: 0.1,\n        maxValue: 10.0,\n        displayId: 'particle-size-value',\n        displayFormat: v => v.toFixed(1)\n    }));\n\n    const particleRenderModeControl = manager.register(new SelectControl('particle-render-mode', 'points', {\n        settingsKey: 'particleRenderMode'\n    }));\n\n    const colorSaturationControl = manager.register(new PercentSliderControl('color-saturation', 1.0, {\n        settingsKey: 'colorSaturation',\n        displayId: 'color-saturation-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const brightnessDesatControl = manager.register(new PercentSliderControl('brightness-desat', 0.0, {\n        settingsKey: 'brightnessDesaturation',\n        displayId: 'brightness-desat-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const saturationBuildupControl = manager.register(new PercentSliderControl('saturation-buildup', 0.0, {\n        settingsKey: 'brightnessSaturation',\n        displayId: 'saturation-buildup-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    // === Bloom controls (hidden but wired) ===\n\n    const bloomEnabledControl = manager.register(new CheckboxControl('bloom-enabled', false, {\n        settingsKey: 'bloomEnabled'\n    }));\n\n    const bloomIntensityControl = manager.register(new PercentSliderControl('bloom-intensity', 0.3, {\n        settingsKey: 'bloomIntensity',\n        min: 0,\n        max: 200, // Allows 0.0-2.0 range\n        displayId: 'bloom-intensity-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    const bloomRadiusControl = manager.register(new SliderControl('bloom-radius', 1.0, {\n        settingsKey: 'bloomRadius',\n        min: 0.5,\n        max: 3.0,\n        step: 0.1,\n        displayId: 'bloom-radius-value',\n        displayFormat: v => v.toFixed(1)\n    }));\n\n    const bloomAlphaControl = manager.register(new PercentSliderControl('bloom-alpha', 1.0, {\n        settingsKey: 'bloomAlpha',\n        displayId: 'bloom-alpha-value',\n        displayFormat: v => v.toFixed(2)\n    }));\n\n    // === Frame Limit Controls (in FPS counter) ===\n\n    const frameLimitEnabledControl = manager.register(new CheckboxControl('frame-limit-enabled', false, {\n        settingsKey: 'frameLimitEnabled',\n        onChange: (enabled) => {\n            // Update renderer's frame limit enabled state\n            if (window.renderer) {\n                window.renderer.frameLimitEnabled = enabled;\n                // Also sync the current frame limit value when enabling\n                if (enabled) {\n                    const limitValue = frameLimitControl.getValue();\n                    window.renderer.frameLimit = limitValue;\n                    logger.info(`Frame limit enabled: will stop at ${limitValue} frames`);\n                }\n            }\n        }\n    }));\n\n    const frameLimitControl = manager.register(new LogSliderControl('frame-limit', 1000, {\n        minValue: 100,\n        maxValue: 100000,\n        displayId: 'frame-limit-value',\n        displayFormat: v => {\n            if (v >= 1000) {\n                return `${Math.floor(v / 1000)}k`;\n            }\n            return Math.floor(v).toString();\n        },\n        settingsKey: 'frameLimit',\n        onChange: (value) => {\n            // Update renderer's frame limit\n            if (window.renderer) {\n                window.renderer.frameLimit = value;\n                logger.verbose(`Frame limit updated to: ${value} frames`);\n            }\n        }\n    }));\n\n    // === Animation Testing Controls ===\n\n    // Animation state\n    let animationRunning = false; // Is animation currently running\n    let animationFrameId = null; // requestAnimationFrame ID\n    let animationDirection = 1; // 1 for forward, -1 for backward\n    let animationStepsPerIncrement = 10; // Number of integration steps before alpha increments\n    let animationStepCounter = 0; // Counter for integration steps\n    let shaderLockWasEnabled = false; // Track if we enabled shader lock for this animation\n\n    // Timing smoothing state - Asymmetric EMA to track high percentile (slow frames)\n    const ALPHA_STEP_TIME_TARGET_PERCENTILE = 95; // Target percentile to track (higher = smoother but slower to adapt)\n    const ALPHA_STEP_TIME_DECAY = 0.002; // Base decay rate when frames are faster than EMA\n    // Calculate upward tracking rate using rule of thumb: ratio = P/(100-P)\n    const ALPHA_STEP_TIME_UPWARD = (ALPHA_STEP_TIME_TARGET_PERCENTILE / (100 - ALPHA_STEP_TIME_TARGET_PERCENTILE)) * ALPHA_STEP_TIME_DECAY;\n    const ALPHA_STEP_TIME_WARMUP_CYCLES = 3; // Number of alpha cycles to skip before initializing EMA (warm-up period)\n    const ALPHA_STEP_TIME_DISPLAY_INTERVAL = 10; // Update step time display every N alpha cycles (reduce UI overhead)\n    let alphaStepTimeEMA = null; // Asymmetric EMA tracking ~95th percentile of step time (ms)\n    let alphaStepStartTime = null; // Timestamp when current alpha cycle started\n    let alphaStepWarmupCounter = 0; // Counter for warm-up cycles\n    let alphaStepDisplayCounter = 0; // Counter for display updates\n    let cachedAnimatableControls = null; // Cached list of animatable controls (populated when animation starts)\n    let cachedAnimatableParams = null; // Cached list of animatable parameter controls\n    let lastAppliedSettings = null; // Track last applied settings to detect changes\n    let savedLoggerVerbosity = null; // Save logger verbosity level during animation\n\n    // Settings that require shader recompilation - never apply during animation\n    const SHADER_RECOMPILE_SETTINGS = new Set([\n        'expressions',           // Vector field expressions compiled into shader\n        'dimensions',           // Changes shader structure\n        'integratorType',       // Changes shader code\n        'solutionMethod',       // Changes shader code\n        'transformType',        // Changes shader code\n        'transformParams',      // Transform params compiled into shader\n        'mapperType',           // Changes shader code\n        'mapperParams',         // Mapper params compiled into shader (e.g., projection matrix)\n        'colorMode'             // Changes shader code\n    ]);\n\n    // Create animation alpha control dynamically\n    const animAlphaContainer = $('#animation-alpha-container');\n    logger.info(`Animation alpha container found: ${animAlphaContainer.length > 0}`);\n\n    if (animAlphaContainer.length) {\n        const controlHTML = `\n            <div class=\"control-group\">\n                <label>Animation Alpha (a): <span class=\"range-value\" id=\"animation-alpha-value\">0.00%</span></label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"animation-alpha\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"animation-alpha\">\n                    <button class=\"slider-btn\" data-slider=\"animation-alpha\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"animation-alpha\" data-action=\"reset\" title=\"Reset to 0.0\">\u21BA</button>\n                    <button id=\"animation-alpha-animate-btn\" class=\"slider-btn\" style=\"margin-left: 8px; background: #4CAF50; color: white;\" title=\"Auto-animate\">\u25B6</button>\n                </div>\n                <div class=\"info\">Test time-based expressions with the 'a' variable (0.0 - 1.0). Use in expressions like: sin(x + a*PI), 0.01 + a*0.09</div>\n            </div>\n        `;\n        animAlphaContainer.html(controlHTML);\n        logger.info('Animation alpha control HTML injected');\n    } else {\n        logger.warn('Animation alpha container not found!');\n    }\n\n    // Create animation speed control\n    const animSpeedContainer = $('#animation-speed-container');\n    if (animSpeedContainer.length) {\n        const speedHTML = `\n            <div class=\"control-group\">\n                <label>Steps per Alpha Increment: <span class=\"range-value\" id=\"animation-speed-value\">10</span></label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"animation-speed\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"animation-speed\">\n                    <button class=\"slider-btn\" data-slider=\"animation-speed\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"animation-speed\" data-action=\"reset\" title=\"Reset to 10\">\u21BA</button>\n                </div>\n                <div class=\"info\">Integration steps to perform before incrementing alpha by 0.01</div>\n            </div>\n        `;\n        animSpeedContainer.html(speedHTML);\n    }\n\n    const animationAlphaControl = manager.register(new PercentSliderControl('animation-alpha', 0.0, {\n        settingsKey: 'animationAlpha',\n        displayId: 'animation-alpha-value',\n        displayFormat: v => `${(v * 100).toFixed(2)}%`,\n        onChange: (value) => {\n            // Update all animatable controls based on alpha\n            manager.controls.forEach((control) => {\n                if (control instanceof AnimatableSliderControl && control.animationEnabled) {\n                    control.updateFromAlpha(value);\n                }\n            });\n\n            // Update animatable parameter controls\n            const transformParamsControl = manager.controls.get('transform-params');\n            if (transformParamsControl && transformParamsControl.parameterControls) {\n                transformParamsControl.parameterControls.forEach((paramControl) => {\n                    if (paramControl.animationEnabled) {\n                        paramControl.updateFromAlpha(value);\n                    }\n                });\n            }\n\n            // Update renderer immediately (no debounce for animation testing)\n            if (window.renderer) {\n                window.renderer.setAnimationAlpha(value);\n\n                // Check if we should clear particles\n                if ($('#animation-clear-particles').is(':checked')) {\n                    window.renderer.resetParticles();\n                }\n\n                // Check if we should clear screen\n                if ($('#animation-clear-screen').is(':checked')) {\n                    window.renderer.clearRenderBuffer();\n                }\n            }\n        }\n    }));\n\n    // Animation speed control (linear scale for steps)\n    const animationSpeedControl = manager.register(new SliderControl('animation-speed', 10, {\n        min: 1,\n        max: 200,\n        displayId: 'animation-speed-value',\n        displayFormat: v => {\n            animationStepsPerIncrement = Math.round(v);\n            return Math.round(v).toString();\n        }\n    }));\n\n    // Animation clear checkboxes\n    manager.register(new CheckboxControl('animation-clear-particles', false, {\n        settingsKey: 'animationClearParticles'\n    }));\n\n    manager.register(new CheckboxControl('animation-clear-screen', false, {\n        settingsKey: 'animationClearScreen'\n    }));\n\n    manager.register(new CheckboxControl('animation-smooth-timing', false, {\n        settingsKey: 'animationSmoothTiming'\n    }));\n\n    manager.register(new CheckboxControl('animation-lock-shaders', false, {\n        settingsKey: 'animationLockShaders'\n        // Note: This is a UI preference only - lock is applied during animation playback\n        // Does NOT map to renderer.lockShaderRecompilation (which is runtime state only)\n    }));\n\n    logger.info('Animation alpha control registered');\n\n    // === Theme control (special handling for immediate application) ===\n\n    const themeControl = manager.register(new SelectControl('theme-selector', 'dark', {\n        settingsKey: 'theme',\n        onChange: (value) => {\n            // Apply theme immediately (no debounce)\n            if (value === 'light') {\n                $('body').addClass('light-theme');\n            } else {\n                $('body').removeClass('light-theme');\n            }\n            // Save immediately\n            manager.saveToStorage();\n        }\n    }));\n\n    // ========================================\n    // Non-managed controls (special buttons)\n    // ========================================\n\n    // Preset selector (loads presets, doesn't save)\n    $('#preset-selector').on('change', function() {\n        const presetName = $(this).val();\n        if (presetName) {\n            loadPreset(presetName, manager);\n            $(this).val(''); // Reset to placeholder\n\n            // Show delete button if it's a custom preset\n            const customPresets = loadCustomPresets();\n            if (customPresets[presetName]) {\n                $('#preset-name-input').val(presetName);\n                $('#delete-preset-btn').show();\n            } else {\n                $('#preset-name-input').val('');\n                $('#delete-preset-btn').hide();\n            }\n        }\n    });\n\n    // Save Preset button\n    $('#save-preset-btn').on('click', function() {\n        const presetName = $('#preset-name-input').val().trim();\n        if (!presetName) {\n            alert('Please enter a preset name');\n            return;\n        }\n\n        // Get current settings (using the same method as localStorage saving)\n        const settings = manager.getSettings();\n\n        // Add name to the preset\n        const preset = {\n            ...settings,\n            name: presetName\n        };\n\n        // Save to localStorage\n        saveCustomPreset(presetName, preset);\n\n        // Refresh preset dropdown\n        refreshCustomPresetsDropdown();\n\n        // Show delete button\n        $('#delete-preset-btn').show();\n\n        logger.info('Preset saved: ' + presetName);\n    });\n\n    // Delete Preset button\n    $('#delete-preset-btn').on('click', function() {\n        const presetName = $('#preset-name-input').val().trim();\n        if (!presetName) return;\n\n        if (confirm(`Delete preset \"${presetName}\"?`)) {\n            deleteCustomPreset(presetName);\n            refreshCustomPresetsDropdown();\n            $('#preset-name-input').val('');\n            $('#delete-preset-btn').hide();\n            logger.info('Preset deleted: ' + presetName);\n        }\n    });\n\n    // Load custom presets on init\n    refreshCustomPresetsDropdown();\n\n    // Default Settings button\n    $('#default-settings').on('click', function() {\n        manager.resetAll();\n        manager.clearStorage();\n        manager.apply(); // Apply immediately (no debounce)\n    });\n\n    // Share URL button\n    $('#share-url').on('click', function() {\n        const settings = manager.getSettings();\n        shareSettings(settings);\n    });\n\n    // Reset button (resets camera bbox, not settings)\n    $('#reset').on('click', function() {\n        const canvas = renderer.gl.canvas;\n        const aspectRatio = canvas.width / canvas.height;\n        const height = 10; // -5 to 5\n        const width = height * aspectRatio;\n\n        renderer.updateConfig({\n            bbox: {\n                min: [-width / 2, -5],\n                max: [width / 2, 5]\n            },\n            reinitializeParticles: true\n        });\n    });\n\n    // Reset Particles button (clears screen trails)\n    $('#reset-particles').on('click', function() {\n        renderer.clearScreen();\n    });\n\n    // Save Image button (saves render buffer at scaled resolution as PNG)\n    $('#save-image').on('click', async function() {\n        try {\n            // Capture the high-resolution render buffer\n            const blob = await renderer.captureRenderBuffer();\n\n            // Create download link\n            const url = URL.createObjectURL(blob);\n            const link = document.createElement('a');\n\n            // Generate filename with timestamp and resolution\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n            const resolution = `${renderer.renderWidth}x${renderer.renderHeight}`;\n            link.download = `vector-field-${timestamp}-${resolution}.png`;\n\n            link.href = url;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n\n            // Clean up\n            URL.revokeObjectURL(url);\n\n            logger.info('Image saved: ' + link.download);\n        } catch (error) {\n            logger.error('Failed to save image:', error);\n            alert('Failed to save image. Check console for details.');\n        }\n    });\n\n    // Storage strategy selector (requires page reload)\n    const urlParams = new URLSearchParams(window.location.search);\n    const currentStrategy = urlParams.get('storage') || 'float';\n    $('#storage-strategy').val(currentStrategy);\n\n    $('#storage-strategy').on('change', function() {\n        const newStrategy = $(this).val();\n\n        // Save current settings before reload (including bbox for pan/zoom state and coordinate system)\n        const settings = manager.getSettings();\n        if (renderer && renderer.bbox) {\n            settings.bbox = {\n                min: [...renderer.bbox.min],\n                max: [...renderer.bbox.max]\n            };\n        }\n        if (renderer && renderer.coordinateSystem) {\n            settings.coordinateSystem = renderer.coordinateSystem.toJSON();\n        }\n        localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n\n        // Reload page with new storage strategy\n        const url = new URL(window.location);\n        url.searchParams.set('storage', newStrategy);\n        window.location.href = url.toString();\n    });\n\n    // Slider +/- buttons - dispatch to control implementations\n    // Use event delegation to handle dynamically created buttons\n    $(document).on('click', '.slider-btn', function() {\n        const sliderId = $(this).data('slider');\n        const action = $(this).data('action');\n\n        // Try to get the registered control\n        const control = manager.get(sliderId);\n        if (control && control.handleButtonAction) {\n            // Dispatch to control's implementation\n            control.handleButtonAction(action);\n            return;\n        }\n\n        // Handle dynamically created transform parameter sliders\n        if (sliderId.startsWith('transform-param-')) {\n            const transformParamsControl = manager.get('transform-params');\n            if (transformParamsControl && transformParamsControl.handleTransformParamButton) {\n                transformParamsControl.handleTransformParamButton(sliderId, action);\n            }\n            return;\n        }\n\n        // Fallback: no control found, slider doesn't support buttons\n        console.warn(`No button handler found for slider: ${sliderId}`);\n    });\n\n    // ========================================\n    // Gradient editor integration\n    // ========================================\n\n    let gradientEditor = null;\n\n    function showGradientPanel() {\n        const panel = $('#gradient-panel');\n        updateGradientButtonVisibility(manager.get('color-mode').getValue());\n        panel.show();\n\n        // Initialize gradient editor if not already done\n        if (!gradientEditor) {\n            gradientEditor = initGradientEditor(\n                'main-gradient-editor',\n                gradientControl.getValue(),\n                (newGradient) => {\n                    gradientControl.notifyChange(newGradient);\n                }\n            );\n            gradientControl.setGradientEditor(gradientEditor);\n        } else {\n            // Update gradient if it changed while editor was hidden\n            gradientEditor.setGradient(gradientControl.getValue());\n        }\n    }\n\n    function hideGradientPanel() {\n        $('#gradient-panel').hide();\n    }\n\n    // Open gradient editor button\n    $('#open-gradient-editor').on('click', function() {\n        showGradientPanel();\n    });\n\n    // Configure coordinates button\n    $('#configure-coordinates').on('click', function() {\n        const currentDimensions = renderer.dimensions;\n        let currentSystem = renderer.coordinateSystem;\n\n        // Validate that coordinate system dimensions match current dimensions\n        if (!currentSystem || currentSystem.dimensions !== currentDimensions) {\n            console.warn('Coordinate system dimension mismatch, resetting to Cartesian');\n            currentSystem = getCartesianSystem(currentDimensions);\n            renderer.coordinateSystem = currentSystem;\n        }\n\n        showCoordinateEditor(currentDimensions, currentSystem, (newSystem) => {\n            // Update renderer with new coordinate system\n            renderer.updateConfig({ coordinateSystem: newSystem });\n\n            // Update dimension input labels to reflect new coordinate variables\n            expressionsControl.setCoordinateSystem(newSystem);\n\n            // Trigger apply to recompile shaders with new coordinate system\n            manager.apply();\n        });\n    });\n\n    // Close gradient panel when clicking outside\n    $(document).on('click', function(e) {\n        const panel = $('#gradient-panel');\n        const openButton = $('#open-gradient-editor');\n\n        if ($(e.target).is(openButton) ||\n            $(e.target).closest('#gradient-panel').length > 0) {\n            return;\n        }\n\n        if (panel.is(':visible')) {\n            hideGradientPanel();\n        }\n    });\n\n    // Prevent clicks inside gradient panel from closing it\n    $('#gradient-panel').on('click', function(e) {\n        e.stopPropagation();\n    });\n\n    // ========================================\n    // Rendering settings panel\n    // ========================================\n\n    function showRenderingPanel() {\n        $('#rendering-panel').show();\n        updateWhitePointVisibility(manager.get('tonemap-operator').getValue());\n    }\n\n    function hideRenderingPanel() {\n        $('#rendering-panel').hide();\n    }\n\n    $('#open-rendering-settings').on('click', function() {\n        showRenderingPanel();\n    });\n\n    // Wire up floating panel close buttons (for mobile)\n    $('#gradient-panel .floating-panel-close').on('click', function() {\n        hideGradientPanel();\n    });\n\n    $('#rendering-panel .floating-panel-close').on('click', function() {\n        // If opened via mobile menu, use mobile panel manager\n        if (window.mobilePanelManager && window.mobilePanelManager.getCurrentPanel() === 'rendering') {\n            window.mobilePanelManager.hidePanel('rendering');\n        } else {\n            // Otherwise use regular hide function\n            hideRenderingPanel();\n        }\n    });\n\n    // ========================================\n    // Modal System\n    // ========================================\n    // Modal is initialized in main.js and can be accessed via window.appModal\n\n    // Menu bar settings button\n    $(document).on('click', '#menu-settings', function() {\n        if (window.appModal) {\n            window.appModal.show();\n        }\n    });\n\n    // Menu bar docs button\n    $(document).on('click', '#menu-docs', function() {\n        if (window.appModal) {\n            window.appModal.show('docs');\n        }\n    });\n\n    // Keyboard shortcut: Ctrl+, to open settings modal\n    $(document).on('keydown', function(e) {\n        if ((e.ctrlKey || e.metaKey) && e.key === ',') {\n            e.preventDefault();\n            if (window.appModal) {\n                window.appModal.show();\n            }\n        }\n    });\n\n    // Animation section accordion toggle\n    $('#animation-section-toggle').on('click', function() {\n        const content = $('#animation-section-content');\n        const arrow = $('#animation-section-arrow');\n        const histogram = $('#histogram-panel');\n        const cursor = $('#cursor-position');\n\n        if (content.is(':visible')) {\n            content.slideUp(200);\n            arrow.text('\u25BC');\n            // Slide panels back to left\n            histogram.removeClass('shifted');\n            cursor.removeClass('shifted');\n        } else {\n            content.slideDown(200);\n            arrow.text('\u25B2');\n            // Slide panels to right to avoid overlap\n            histogram.addClass('shifted');\n            cursor.addClass('shifted');\n        }\n    });\n\n    // Frame capture state\n    let capturedFrames = [];\n    let frameCaptureMode = null; // null, 'continuous', or 'fixed'\n    let frameCaptureTotal = 0;\n    let frameCaptureCount = 0;\n    let frameCaptureAlphaIncrement = 0.01;\n\n    // Start animation function (used by both play button and create animation)\n    function startAnimation(options = {}) {\n        const {\n            captureFrames = false,\n            totalFrames = 0,\n            loops = 1,\n            halfLoops = false,\n            onProgress = null,\n            onComplete = null\n        } = options;\n\n        // Stop if already running\n        if (animationRunning) return;\n\n        // Setup frame capture if requested\n        if (captureFrames) {\n            frameCaptureMode = 'fixed';\n            frameCaptureTotal = totalFrames;\n            frameCaptureCount = 0;\n            capturedFrames = [];\n            // Calculate alpha increment based on half-loops mode\n            // halfLoops=false: each loop goes 0->1->0 (2 ranges per loop)\n            // halfLoops=true: each loop goes 0->1 (1 range per loop)\n            const rangesPerLoop = halfLoops ? 1.0 : 2.0;\n            frameCaptureAlphaIncrement = (loops * rangesPerLoop) / totalFrames;\n        } else {\n            frameCaptureMode = 'continuous';\n            frameCaptureAlphaIncrement = 0.01;\n        }\n\n        // Start animation\n        animationRunning = true;\n\n        // Pause main renderer loop so we have full control\n        if (window.renderer) {\n            window.renderer.stop();\n        }\n\n        // Reset step counter and timing state when starting animation\n        animationStepCounter = 0;\n        alphaStepTimeEMA = null;\n        alphaStepStartTime = null;\n        alphaStepWarmupCounter = 0;\n        alphaStepDisplayCounter = 0;\n        lastAppliedSettings = null;\n\n        // Lock shaders if checkbox is enabled\n        const shouldLockShaders = $('#animation-lock-shaders').is(':checked');\n        if (shouldLockShaders && renderer) {\n            renderer.lockShaderRecompilation = true;\n            shaderLockWasEnabled = true;\n            logger.info('Shader recompilation lock ENABLED (animation started)', null, false);\n        } else {\n            shaderLockWasEnabled = false;\n        }\n\n        // Buffer logs during animation (will be flushed when animation stops)\n        savedLoggerVerbosity = logger.verbosity;\n        logger.setVerbosity('silent');\n\n        // Cache animatable controls to avoid repeated DOM queries and instanceof checks\n        cachedAnimatableControls = [];\n        manager.controls.forEach((control) => {\n            if (control instanceof AnimatableSliderControl) {\n                cachedAnimatableControls.push(control);\n            }\n        });\n\n        // Cache animatable parameter controls\n        cachedAnimatableParams = [];\n        const transformParamsControl = manager.controls.get('transform-params');\n        if (transformParamsControl && transformParamsControl.parameterControls) {\n            transformParamsControl.parameterControls.forEach((paramControl) => {\n                if (paramControl instanceof AnimatableParameterControl) {\n                    cachedAnimatableParams.push(paramControl);\n                }\n            });\n        }\n\n        // Animation loop that performs integration steps\n        const animationLoop = () => {\n            if (!animationRunning) {\n                return; // Animation was stopped\n            }\n\n            const freezeScreen = $('#animation-clear-screen').is(':checked');\n            const smoothTiming = $('#animation-smooth-timing').is(':checked');\n\n            // Increment step counter\n            animationStepCounter++;\n\n            // Start timing on first step of alpha cycle\n            if (animationStepCounter === 1) {\n                // Clear shader recompilation flag (don't reset warm-up during animation)\n                if (window.renderer && window.renderer.shadersJustRecompiled) {\n                    window.renderer.shadersJustRecompiled = false;\n                }\n                alphaStepStartTime = performance.now();\n            }\n\n            // Check if we should increment alpha\n            if (animationStepCounter >= animationStepsPerIncrement) {\n                animationStepCounter = 0;\n\n                // If freeze mode: accumulate final step, display the buffer, THEN clear for next cycle\n                if (freezeScreen && window.renderer) {\n                    window.renderer.render(true);\n                }\n\n                // Calculate elapsed time for this alpha cycle\n                const alphaStepEndTime = performance.now();\n                const alphaStepElapsed = alphaStepEndTime - alphaStepStartTime;\n\n                // Update asymmetric EMA (tracks ~95th percentile) after warm-up\n                if (alphaStepWarmupCounter < ALPHA_STEP_TIME_WARMUP_CYCLES) {\n                    // Still warming up - skip this cycle and don't update EMA\n                    alphaStepWarmupCounter++;\n                } else if (alphaStepTimeEMA === null) {\n                    // Warm-up complete - initialize EMA from this cycle\n                    alphaStepTimeEMA = alphaStepElapsed;\n                } else {\n                    // Use asymmetric smoothing: fast upward tracking, slow downward decay\n                    if (alphaStepElapsed > alphaStepTimeEMA) {\n                        // Slower than EMA - track upward quickly\n                        alphaStepTimeEMA = ALPHA_STEP_TIME_UPWARD * alphaStepElapsed +\n                                          (1 - ALPHA_STEP_TIME_UPWARD) * alphaStepTimeEMA;\n                    } else {\n                        // Faster than EMA - decay slowly\n                        alphaStepTimeEMA = ALPHA_STEP_TIME_DECAY * alphaStepElapsed +\n                                          (1 - ALPHA_STEP_TIME_DECAY) * alphaStepTimeEMA;\n                    }\n                }\n\n                // Update step time display if smoothing is enabled (throttled to reduce UI overhead)\n                if (smoothTiming) {\n                    alphaStepDisplayCounter++;\n                    if (alphaStepDisplayCounter >= ALPHA_STEP_TIME_DISPLAY_INTERVAL) {\n                        alphaStepDisplayCounter = 0;\n                        if (alphaStepTimeEMA === null) {\n                            $('#step-time-counter').text(`Step: ${alphaStepElapsed.toFixed(1)}ms (warming up...)`);\n                        } else {\n                            $('#step-time-counter').text(`Step: ${alphaStepElapsed.toFixed(1)}ms (EMA: ${alphaStepTimeEMA.toFixed(1)}ms)`);\n                        }\n                        $('#step-time-counter').show();\n                    }\n                } else {\n                    $('#step-time-counter').hide();\n                }\n\n                let currentValue = animationAlphaControl.getValue();\n\n                // Update value based on direction and increment\n                currentValue += animationDirection * frameCaptureAlphaIncrement;\n\n                // Bounce at boundaries\n                if (currentValue >= 1.0) {\n                    currentValue = 1.0;\n                    animationDirection = -1;\n                } else if (currentValue <= 0.0) {\n                    currentValue = 0.0;\n                    animationDirection = 1;\n                }\n\n                // Update slider value WITHOUT triggering input event (avoid debounced apply)\n                animationAlphaControl.setValue(currentValue);\n\n                // Update all animatable controls based on alpha (use cached list)\n                for (let i = 0; i < cachedAnimatableControls.length; i++) {\n                    cachedAnimatableControls[i].updateFromAlpha(currentValue);\n                }\n\n                // Update animatable parameter controls (use cached list)\n                for (let i = 0; i < cachedAnimatableParams.length; i++) {\n                    cachedAnimatableParams[i].updateFromAlpha(currentValue);\n                }\n\n                // Manually update renderer with new alpha value and apply interpolated settings\n                if (window.renderer) {\n                    window.renderer.setAnimationAlpha(currentValue);\n\n                    // Build changed settings directly from animatable controls (avoid full getSettings() overhead)\n                    const changedSettings = {};\n\n                    // Collect values from animatable sliders\n                    for (let i = 0; i < cachedAnimatableControls.length; i++) {\n                        const control = cachedAnimatableControls[i];\n                        const newValue = control.getValue();\n                        if (lastAppliedSettings === null || newValue !== lastAppliedSettings[control.settingsKey]) {\n                            changedSettings[control.settingsKey] = newValue;\n                        }\n                    }\n\n                    // Collect values from animatable parameters\n                    for (let i = 0; i < cachedAnimatableParams.length; i++) {\n                        const paramControl = cachedAnimatableParams[i];\n                        const newValue = paramControl.getValue();\n                        const paramKey = paramControl.parameterName;\n\n                        // Build transformParams object\n                        if (!changedSettings.transformParams) {\n                            changedSettings.transformParams = lastAppliedSettings?.transformParams ? {...lastAppliedSettings.transformParams} : {};\n                        }\n\n                        if (lastAppliedSettings === null || newValue !== lastAppliedSettings.transformParams?.[paramKey]) {\n                            changedSettings.transformParams[paramKey] = newValue;\n                        }\n                    }\n\n                    // Apply changed settings to renderer (only if there are changes)\n                    if (Object.keys(changedSettings).length > 0) {\n                        try {\n                            window.renderer.updateConfig(changedSettings);\n\n                            // Update last applied settings\n                            if (lastAppliedSettings === null) {\n                                lastAppliedSettings = {};\n                            }\n                            Object.assign(lastAppliedSettings, changedSettings);\n                        } catch (error) {\n                            logger.error('Failed to apply animation settings:', error);\n                        }\n                    } else if (lastAppliedSettings === null) {\n                        // First cycle with no animatable settings - initialize tracking\n                        lastAppliedSettings = {};\n                    }\n\n                    // Check if we should clear particles\n                    if ($('#animation-clear-particles').is(':checked')) {\n                        window.renderer.resetParticles();\n                    }\n\n                    // If NOT freeze mode: render normally with display\n                    // (freeze mode already rendered and cleared earlier)\n                    if (!freezeScreen) {\n                        window.renderer.render(true);\n                    }\n\n                    if(freezeScreen) {\n                        window.renderer.clearRenderBuffer(true); // Clear without restarting main loop\n                    }\n\n                    // Capture frame if in frame capture mode\n                    if (frameCaptureMode === 'fixed') {\n                        // Capture the high-resolution render buffer\n                        window.renderer.captureRenderBuffer().then(function(blob) {\n                            capturedFrames.push(blob);\n                            frameCaptureCount++;\n\n                            // Call progress callback\n                            if (onProgress) {\n                                onProgress(frameCaptureCount, frameCaptureTotal, currentValue);\n                            }\n\n                            // Check if we're done\n                            if (frameCaptureCount >= frameCaptureTotal) {\n                                stopAnimation();\n                                if (onComplete) {\n                                    onComplete(capturedFrames);\n                                }\n                            }\n                        }).catch(function(error) {\n                            console.error('Failed to capture animation frame:', error);\n                            stopAnimation();\n                            alert('Failed to capture animation frame. Check console for details.');\n                        });\n                    }\n                }\n\n                // Alpha cycle complete - check if we need to delay for timing smoothing\n                if (smoothTiming && alphaStepTimeEMA !== null && alphaStepElapsed < alphaStepTimeEMA) {\n                    const delayNeeded = alphaStepTimeEMA - alphaStepElapsed;\n                    // Wait before starting next cycle\n                    setTimeout(() => {\n                        if (animationRunning) {\n                            animationFrameId = requestAnimationFrame(animationLoop);\n                        }\n                    }, delayNeeded);\n                    return; // Exit early, setTimeout will continue the loop\n                }\n            } else {\n                // Between alpha changes (steps 1 to N-1)\n                if (window.renderer) {\n                    if (freezeScreen) {\n                        // Freeze mode: accumulate in hidden buffer (don't display yet)\n                        window.renderer.render(false);\n                    } else {\n                        // Normal mode: render and display continuously\n                        window.renderer.render(true);\n                    }\n                }\n            }\n\n            // Continue animation loop if still running\n            if (animationRunning) {\n                animationFrameId = requestAnimationFrame(animationLoop);\n            }\n        };\n\n        // Start the animation loop\n        animationFrameId = requestAnimationFrame(animationLoop);\n    }\n\n    // Stop animation function\n    function stopAnimation() {\n        animationRunning = false;\n        if (animationFrameId !== null) {\n            cancelAnimationFrame(animationFrameId);\n            animationFrameId = null;\n        }\n\n        // Resume main renderer loop\n        if (window.renderer && !window.renderer.isRunning) {\n            window.renderer.start();\n        }\n\n        // Hide step time counter\n        $('#step-time-counter').hide();\n\n        // Clear cached controls and settings\n        cachedAnimatableControls = null;\n        cachedAnimatableParams = null;\n        lastAppliedSettings = null;\n\n        // Restore logger verbosity (this will auto-flush buffered logs)\n        if (savedLoggerVerbosity !== null) {\n            logger.setVerbosity(savedLoggerVerbosity);\n            savedLoggerVerbosity = null;\n        }\n\n        // Unlock shaders if we locked them\n        if (shaderLockWasEnabled && renderer) {\n            renderer.lockShaderRecompilation = false;\n            shaderLockWasEnabled = false;\n            logger.info('Shader recompilation lock DISABLED (animation stopped)');\n        }\n\n        // Reset frame capture mode\n        frameCaptureMode = null;\n    }\n\n    // Animation alpha animate button\n    $('#animation-alpha-animate-btn').on('click', function(e) {\n        e.stopPropagation(); // Prevent panel close\n        const btn = $(this);\n\n        if (animationRunning) {\n            // Stop animation\n            stopAnimation();\n\n            btn.text('\u25B6');\n            btn.css('background', '#4CAF50');\n            btn.attr('title', 'Auto-animate');\n        } else {\n            // Start animation\n            startAnimation();\n\n            btn.text('\u23F8');\n            btn.css('background', '#FFA726');\n            btn.attr('title', 'Stop auto-animate');\n        }\n    });\n\n    // Update loops info text based on half-loops checkbox\n    $('#animation-half-loops').on('change', function() {\n        const isHalfLoops = $(this).is(':checked');\n        const infoText = isHalfLoops\n            ? 'Number of half cycles (1 = 0.0 \u2192 1.0, 2 = 0.0 \u2192 1.0 \u2192 0.0)'\n            : 'Number of complete alpha cycles (0.0 \u2192 1.0 \u2192 0.0)';\n        $('#animation-loops-info').text(infoText);\n    });\n\n    // Create Animation button - captures frames during alpha animation\n    $('#animation-create-btn').on('click', function() {\n        const createBtn = $(this);\n\n        // Check if button is in \"stop\" mode\n        if (createBtn.data('stop-animation')) {\n            // Stop the animation early\n            stopAnimation();\n\n            // Restore button state\n            createBtn.text('\u25B6 Create Animation');\n            createBtn.css('background', '#4CAF50');\n            createBtn.data('stop-animation', false);\n\n            $('#animation-frames').prop('disabled', false);\n            $('#animation-loops').prop('disabled', false);\n            $('#animation-half-loops').prop('disabled', false);\n            $('#animation-download-btn').prop('disabled', capturedFrames.length === 0);\n\n            // Update progress to show it was stopped\n            $('#progress-text').text(`Stopped: ${capturedFrames.length} frames captured`);\n\n            logger.info(`Animation stopped early: ${capturedFrames.length} frames captured`);\n            return;\n        }\n\n        if (animationRunning) return;\n\n        const framesInput = $('#animation-frames');\n        const loopsInput = $('#animation-loops');\n        const halfLoopsCheckbox = $('#animation-half-loops');\n        const downloadBtn = $('#animation-download-btn');\n        const progressContainer = $('#animation-progress');\n        const progressBar = $('#progress-bar');\n        const progressText = $('#progress-text');\n        const progressAlpha = $('#progress-alpha');\n\n        // Get parameters\n        const totalFrames = parseInt(framesInput.val()) || 100;\n        const loops = parseInt(loopsInput.val()) || 1;\n        const isHalfLoops = halfLoopsCheckbox.is(':checked');\n\n        // Update UI - button becomes stop button\n        createBtn.prop('disabled', false);\n        createBtn.text('\u23F9 Stop Animation');\n        createBtn.css('background', '#f44336'); // Red color for stop\n        createBtn.data('stop-animation', true); // Flag to indicate it's now a stop button\n        framesInput.prop('disabled', true);\n        loopsInput.prop('disabled', true);\n        halfLoopsCheckbox.prop('disabled', true);\n        downloadBtn.prop('disabled', true);\n        progressContainer.show();\n        progressBar.css('width', '0%');\n        progressText.text(`Frame 0 / ${totalFrames}`);\n        progressAlpha.text('\u03B1: 0.00');\n\n        // Start animation with frame capture\n        startAnimation({\n            captureFrames: true,\n            totalFrames: totalFrames,\n            loops: loops,\n            halfLoops: isHalfLoops,\n            onProgress: (frameCount, totalFrames, alpha) => {\n                const progress = (frameCount / totalFrames) * 100;\n                progressBar.css('width', `${progress}%`);\n                progressText.text(`Frame ${frameCount} / ${totalFrames}`);\n                progressAlpha.text(`\u03B1: ${alpha.toFixed(2)}`);\n            },\n            onComplete: (frames) => {\n                // Restore button state\n                createBtn.prop('disabled', false);\n                createBtn.text('\u25B6 Create Animation');\n                createBtn.css('background', '#4CAF50');\n                createBtn.data('stop-animation', false);\n                framesInput.prop('disabled', false);\n                loopsInput.prop('disabled', false);\n                halfLoopsCheckbox.prop('disabled', false);\n                downloadBtn.prop('disabled', false);\n                progressBar.css('width', '100%');\n                progressText.text(`Complete: ${frames.length} frames`);\n\n                logger.info(`Animation creation complete: ${frames.length} frames captured`);\n            }\n        });\n    });\n\n    // Download Animation button\n    $('#animation-download-btn').on('click', async function() {\n        if (capturedFrames.length === 0) {\n            alert('No frames to download. Create an animation first.');\n            return;\n        }\n\n        const btn = $(this);\n        btn.prop('disabled', true);\n        btn.text('\u23F3 Creating ZIP...');\n\n        try {\n            const MAX_FRAMES_PER_ZIP = 300;\n            const totalFrames = capturedFrames.length;\n            const numParts = Math.ceil(totalFrames / MAX_FRAMES_PER_ZIP);\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n\n            logger.info(`Splitting ${totalFrames} frames into ${numParts} ZIP file(s)`);\n\n            // Create and download each ZIP part\n            for (let part = 0; part < numParts; part++) {\n                const startIdx = part * MAX_FRAMES_PER_ZIP;\n                const endIdx = Math.min((part + 1) * MAX_FRAMES_PER_ZIP, totalFrames);\n\n                btn.text(`\u23F3 Creating ZIP ${part + 1}/${numParts}...`);\n\n                // Create ZIP file using JSZip\n                const zip = new JSZip();\n                const framesFolder = zip.folder('frames');\n\n                // Add frames to this ZIP part\n                for (let i = startIdx; i < endIdx; i++) {\n                    const paddedIndex = String(i).padStart(5, '0');\n                    framesFolder.file(`frame_${paddedIndex}.png`, capturedFrames[i]);\n                }\n\n                // Generate ZIP file\n                const zipBlob = await zip.generateAsync({ type: 'blob' });\n\n                // Create download link\n                const url = URL.createObjectURL(zipBlob);\n                const link = document.createElement('a');\n                const partSuffix = numParts > 1 ? `.${part + 1}` : '';\n                link.download = `animation-${timestamp}${partSuffix}.zip`;\n                link.href = url;\n                document.body.appendChild(link);\n                link.click();\n                document.body.removeChild(link);\n\n                // Clean up\n                URL.revokeObjectURL(url);\n\n                logger.info(`Part ${part + 1}/${numParts} downloaded: frames ${startIdx}-${endIdx - 1}`);\n\n                // Small delay between downloads to avoid browser issues\n                if (part < numParts - 1) {\n                    await new Promise(resolve => setTimeout(resolve, 500));\n                }\n            }\n\n            logger.info(`Animation download complete: ${totalFrames} frames in ${numParts} ZIP file(s)`);\n            if (numParts > 1) {\n                alert(`Animation split into ${numParts} ZIP files. Use create-video.sh with the base filename (without .1, .2, etc) to reconstruct.`);\n            }\n        } catch (error) {\n            logger.error('Failed to create ZIP:', error);\n            alert('Failed to create ZIP file: ' + error.message);\n        } finally {\n            btn.prop('disabled', false);\n            btn.text('\uD83D\uDCBE Download Animation (ZIP)');\n        }\n    });\n\n    // Export Animation JSON button\n    $('#export-animation-json').on('click', function() {\n        const settings = manager.getSettings();\n\n        // Add bbox from renderer\n        if (renderer && renderer.bbox) {\n            settings.bbox = {\n                min: [renderer.bbox.min[0], renderer.bbox.min[1]],\n                max: [renderer.bbox.max[0], renderer.bbox.max[1]]\n            };\n        }\n\n        // Remove animationAlpha from export (it's test-only)\n        delete settings.animationAlpha;\n\n        // Create animation template\n        const animationTemplate = {\n            name: \"Untitled Animation\",\n            description: \"Animation created from current settings\",\n            fps: 30,\n            baseSettings: settings,\n            timeline: [\n                {\n                    time: 0.0,\n                    settings: {},\n                    easing: \"linear\"\n                },\n                {\n                    time: 10.0,\n                    settings: {\n                        // Add your parameter changes here\n                    },\n                    easing: \"linear\"\n                }\n            ],\n            frameConfig: {\n                burnInSteps: 5000,\n                clearAfterBurnIn: true,\n                accumulationSteps: 2000\n            }\n        };\n\n        // Download as JSON\n        const blob = new Blob([JSON.stringify(animationTemplate, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = 'animation-template.json';\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n\n        logger.info('Exported animation template JSON');\n    });\n\n    // Close panels when clicking outside\n    $(document).on('click', function(e) {\n        // Close rendering panel\n        const renderingPanel = $('#rendering-panel');\n        const renderingButton = $('#open-rendering-settings');\n        const mobileRenderingButton = $('#mobile-menu-rendering');\n\n        if ($(e.target).is(renderingButton) ||\n            $(e.target).is(mobileRenderingButton) ||\n            $(e.target).closest('#mobile-menu-rendering').length > 0 ||\n            $(e.target).closest('#rendering-panel').length > 0) {\n            // Don't close rendering panel\n        } else if (renderingPanel.is(':visible')) {\n            hideRenderingPanel();\n        }\n\n        // Note: Modal handles its own closing on overlay click or Escape key\n    });\n\n    // ========================================\n    // Initialization\n    // ========================================\n\n    // First, initialize controls (creates DOM elements and attaches listeners)\n    manager.initializeControls();\n\n    // Then load and apply saved settings\n    const savedSettings = loadSettingsFromURLOrStorage();\n\n    if (savedSettings) {\n        // Restore coordinate system if present and dimensions match\n        if (savedSettings.coordinateSystem && savedSettings.dimensions) {\n            try {\n                const coordSystemData = savedSettings.coordinateSystem;\n\n                // Convert Unicode symbols to ASCII in forward transforms\n                if (coordSystemData.forwardTransforms && window.UnicodeAutocomplete) {\n                    coordSystemData.forwardTransforms = coordSystemData.forwardTransforms.map(transform => {\n                        if (typeof transform === 'string' && window.UnicodeAutocomplete.unicodeToAscii) {\n                            return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                        }\n                        return transform;\n                    });\n                }\n\n                const coordinateSystem = CoordinateSystem.fromJSON(coordSystemData);\n\n                // Validate that coordinate system dimensions match saved dimensions\n                if (coordinateSystem.dimensions === savedSettings.dimensions) {\n                    renderer.coordinateSystem = coordinateSystem;\n                    expressionsControl.setCoordinateSystem(coordinateSystem, false);\n                    console.log('Restored coordinate system:', coordinateSystem.name);\n                } else {\n                    // Dimension mismatch - reset to Cartesian for the correct dimensions\n                    console.warn(`Coordinate system dimension mismatch: system has ${coordinateSystem.dimensions}D but settings use ${savedSettings.dimensions}D. Resetting to Cartesian.`);\n                    const cartesianSystem = getCartesianSystem(savedSettings.dimensions);\n                    renderer.coordinateSystem = cartesianSystem;\n                    expressionsControl.setCoordinateSystem(cartesianSystem, false);\n                }\n            } catch (error) {\n                console.warn('Failed to restore coordinate system:', error);\n                // Fall back to Cartesian\n                if (savedSettings.dimensions) {\n                    const cartesianSystem = getCartesianSystem(savedSettings.dimensions);\n                    renderer.coordinateSystem = cartesianSystem;\n                    expressionsControl.setCoordinateSystem(cartesianSystem, false);\n                }\n            }\n        }\n\n        // Convert Unicode to ASCII in expressions (\u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.)\n        if (savedSettings.expressions && Array.isArray(savedSettings.expressions) && window.UnicodeAutocomplete) {\n            savedSettings.expressions = savedSettings.expressions.map(expr => {\n                if (typeof expr === 'string' && window.UnicodeAutocomplete.unicodeToAscii) {\n                    return window.UnicodeAutocomplete.unicodeToAscii(expr);\n                }\n                return expr;\n            });\n        }\n\n        // Validate and fix mapper params if needed\n        if (savedSettings.mapperParams) {\n            const params = savedSettings.mapperParams;\n            // For select mapper, ensure dim2 is different from dim1 and defaults to 1\n            if (params.dim1 !== undefined && params.dim2 !== undefined) {\n                if (params.dim1 === params.dim2) {\n                    console.warn('Invalid mapper params: dim1 and dim2 are the same, fixing to default');\n                    savedSettings.mapperParams = { dim1: 0, dim2: 1 };\n                }\n            }\n        }\n\n        manager.applySettings(savedSettings);\n        // Trigger onApply callback to ensure all transformations happen\n        // (e.g., implicitIterations -> integratorParams)\n        manager.apply();\n    }\n\n    // Initialize frame limit settings in renderer\n    if (renderer) {\n        renderer.frameLimitEnabled = frameLimitEnabledControl.getValue();\n        renderer.frameLimit = frameLimitControl.getValue();\n    }\n\n    // Initialize special UI states\n    updateWhitePointVisibility(manager.get('tonemap-operator').getValue());\n    updateExpressionControls(manager.get('color-mode').getValue());\n    updateGradientButtonVisibility(manager.get('color-mode').getValue());\n    updateVelocityScalingVisibility(manager.get('color-mode').getValue());\n\n    // Initialize implicit method controls visibility\n    const currentIntegrator = manager.get('integrator').getValue() || 'rk2';\n    const isImplicit = currentIntegrator.startsWith('implicit-') || currentIntegrator === 'trapezoidal';\n    $('#implicit-iterations-group').toggle(isImplicit);\n    $('#solution-method-group').toggle(isImplicit);\n\n    // Apply initial theme\n    const theme = manager.get('theme-selector').getValue();\n    if (theme === 'light') {\n        $('body').addClass('light-theme');\n    }\n\n    // Load presets data\n    loadPresets();\n\n    // Initialize unicode autocomplete on all math input fields\n    if (window.unicodeAutocomplete) {\n        window.unicodeAutocomplete.setEnabled(true);\n\n        // Attach to all math input fields\n        window.unicodeAutocomplete.attachToAll('[id^=\"expr-\"]');        // Vector field expressions\n        window.unicodeAutocomplete.attachToAll('#mapper-expression');    // Custom mapper expressions\n        window.unicodeAutocomplete.attachToAll('#color-expression');     // Color expressions\n        window.unicodeAutocomplete.attachToAll('#custom-color-code');    // Custom color code\n        window.unicodeAutocomplete.attachToAll('#custom-integrator-code'); // Custom integrator code\n        // Note: custom-functions-textarea is handled by CustomFunctionsTab.onActivate()\n\n        console.log('Unicode autocomplete enabled for all math inputs');\n    }\n\n    // Create save function that includes bbox (pan/zoom state)\n    function saveAllSettings() {\n        const settings = manager.getSettings();\n\n        // Add bbox from renderer\n        if (renderer && renderer.bbox) {\n            settings.bbox = {\n                min: [...renderer.bbox.min],\n                max: [...renderer.bbox.max]\n            };\n        }\n\n        // Add coordinate system from renderer\n        if (renderer && renderer.coordinateSystem) {\n            settings.coordinateSystem = renderer.coordinateSystem.toJSON();\n        }\n\n        // Save to localStorage\n        localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n        return settings;\n    }\n\n    // ========================================\n    // Mobile Panel Manager\n    // ========================================\n    function initMobilePanelManager() {\n        const panels = {\n            'controls': $('#controls'),\n            'rendering': $('#rendering-panel')\n        };\n\n        let currentPanel = null;\n\n        function showPanel(panelName) {\n            // Hide any currently open panel\n            if (currentPanel) {\n                hidePanel(currentPanel);\n            }\n\n            const panel = panels[panelName];\n            if (!panel) {\n                logger.warn(`Mobile panel not found: ${panelName}`);\n                return;\n            }\n\n            // For floating panels (rendering), just show them\n            // For main panels (controls), add mobile overlay class\n            if (panelName === 'rendering') {\n                panel.show();\n                // Update white point visibility based on current operator\n                try {\n                    const operator = manager.get('tonemap-operator');\n                    if (operator) {\n                        updateWhitePointVisibility(operator.getValue());\n                    }\n                } catch (e) {\n                    logger.warn('Could not update white point visibility:', e);\n                }\n            } else {\n                panel.addClass('mobile-overlay active');\n                panel.find('.mobile-overlay-close').show();\n            }\n\n            // Mark menu button as active\n            $(`#mobile-menu-${panelName}`).addClass('active');\n\n            currentPanel = panelName;\n        }\n\n        function hidePanel(panelName) {\n            const panel = panels[panelName];\n            if (!panel) return;\n\n            // For floating panels, just hide them\n            // For main panels, remove mobile overlay class\n            if (panelName === 'rendering') {\n                panel.hide();\n            } else {\n                panel.removeClass('mobile-overlay active');\n                panel.find('.mobile-overlay-close').hide();\n            }\n\n            // Remove active state from menu button\n            $(`#mobile-menu-${panelName}`).removeClass('active');\n\n            if (currentPanel === panelName) {\n                currentPanel = null;\n            }\n        }\n\n        function hideAllPanels() {\n            Object.keys(panels).forEach(hidePanel);\n        }\n\n        // Wire up mobile menu buttons\n        $('#mobile-menu-controls').on('click', function() {\n            if (currentPanel === 'controls') {\n                hidePanel('controls');\n            } else {\n                showPanel('controls');\n            }\n        });\n\n        $('#mobile-menu-rendering').on('click', function() {\n            if (currentPanel === 'rendering') {\n                hidePanel('rendering');\n            } else {\n                showPanel('rendering');\n            }\n        });\n\n        // Wire up close buttons in panels\n        $('.mobile-overlay-close').on('click', function() {\n            const panel = $(this).closest('[id]');\n            const panelId = panel.attr('id');\n\n            // Map panel IDs to panel names\n            const panelMap = {\n                'controls': 'controls'\n            };\n\n            const panelName = panelMap[panelId];\n            if (panelName) {\n                hidePanel(panelName);\n            }\n        });\n\n        // Export for external access\n        return {\n            showPanel,\n            hidePanel,\n            hideAllPanels,\n            getCurrentPanel: () => currentPanel\n        };\n    }\n\n    // Initialize mobile panel manager\n    window.mobilePanelManager = initMobilePanelManager();\n\n    // Call initialization callback\n    if (callback) {\n        callback({\n            manager,\n            state: manager.getSettings(), // For compatibility\n            saveSettings: saveAllSettings // Use wrapper that includes bbox\n        });\n    }\n\n    // Restore bbox if present in saved settings\n    if (savedSettings && savedSettings.bbox) {\n        const canvas = renderer?.gl?.canvas;\n        const expandedBBox = expandBBoxForAspectRatio(savedSettings.bbox, canvas);\n        renderer.updateConfig({\n            bbox: expandedBBox,\n            reinitializeParticles: false\n        });\n        logger.verbose('Restored bbox expanded for aspect ratio');\n    }\n\n    // Return manager for external access\n    return manager;\n}\n\n// ========================================\n// Helper Functions\n// ========================================\n\n/**\n * Expand bbox to fit canvas aspect ratio (ensure WHOLE bbox is visible)\n * @param {Object} bbox - Original bbox with min/max arrays\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @returns {Object} Expanded bbox that fits aspect ratio\n */\nfunction expandBBoxForAspectRatio(bbox, canvas) {\n    if (!canvas) return bbox;\n\n    const canvasAspect = canvas.width / canvas.height;\n    const bboxWidth = bbox.max[0] - bbox.min[0];\n    const bboxHeight = bbox.max[1] - bbox.min[1];\n    const bboxAspect = bboxWidth / bboxHeight;\n\n    const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n    const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n    let newWidth = bboxWidth;\n    let newHeight = bboxHeight;\n\n    if (canvasAspect > bboxAspect) {\n        // Canvas is wider than bbox - expand width to match aspect ratio\n        newWidth = bboxHeight * canvasAspect;\n    } else {\n        // Canvas is taller than bbox - expand height to match aspect ratio\n        newHeight = bboxWidth / canvasAspect;\n    }\n\n    return {\n        min: [centerX - newWidth / 2, centerY - newHeight / 2],\n        max: [centerX + newWidth / 2, centerY + newHeight / 2]\n    };\n}\n\n/**\n * Update white point visibility based on operator\n */\nfunction updateWhitePointVisibility(operator) {\n    const operatorsWithWhitePoint = ['reinhard_extended', 'uncharted2', 'hable', 'luminance_extended'];\n    const showWhitePoint = operatorsWithWhitePoint.includes(operator);\n    $('#white-point-control').toggle(showWhitePoint);\n}\n\n/**\n * Update expression controls visibility\n */\nfunction updateExpressionControls(colorMode) {\n    if (colorMode === 'expression') {\n        $('#expression-controls').show();\n    } else {\n        $('#expression-controls').hide();\n    }\n}\n\n/**\n * Update gradient button visibility\n */\nfunction updateGradientButtonVisibility(colorMode) {\n    const supportsGradient = colorMode === 'expression' ||\n                              colorMode === 'velocity_magnitude' ||\n                              colorMode === 'velocity_angle' ||\n                              colorMode === 'velocity_combined';\n\n    if (supportsGradient) {\n        $('#gradient-button-container').show();\n    } else {\n        $('#gradient-button-container').hide();\n    }\n\n    // Show/hide preset toggle based on mode\n    if (colorMode === 'expression') {\n        $('#gradient-preset-toggle').hide();\n    } else {\n        $('#gradient-preset-toggle').show();\n    }\n}\n\n/**\n * Update velocity scaling controls visibility\n */\nfunction updateVelocityScalingVisibility(colorMode) {\n    const usesVelocity = colorMode === 'velocity_magnitude' ||\n                         colorMode === 'velocity_combined';\n\n    if (usesVelocity) {\n        $('#velocity-scaling-container').show();\n        $('#velocity-log-container').show();\n    } else {\n        $('#velocity-scaling-container').hide();\n        $('#velocity-log-container').hide();\n    }\n}\n\n/**\n * Load settings from URL parameter or localStorage\n */\nfunction loadSettingsFromURLOrStorage() {\n    try {\n        // First, check for URL parameter (?s=base64string)\n        const urlParams = new URLSearchParams(window.location.search);\n        const urlSettings = urlParams.get('s');\n\n        let settings = null;\n\n        if (urlSettings) {\n            // Decode from URL parameter\n            settings = decodeSettings(urlSettings);\n            if (settings) {\n                console.log('Loaded settings from URL parameter');\n                // Save to localStorage for future visits\n                localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n\n                // Clean URL by removing the 's' parameter (keep other params like 'storage')\n                urlParams.delete('s');\n                const newSearch = urlParams.toString();\n                const newUrl = window.location.pathname + (newSearch ? '?' + newSearch : '');\n                window.history.replaceState({}, '', newUrl);\n                console.log('URL cleaned, settings now in localStorage');\n            }\n        } else {\n            // Fall back to localStorage\n            const saved = localStorage.getItem('vectorFieldSettings');\n            if (saved) {\n                settings = JSON.parse(saved);\n                console.log('Loaded settings from localStorage');\n            }\n        }\n\n        return settings;\n    } catch (e) {\n        console.warn('Failed to load settings:', e);\n        return null;\n    }\n}\n\n/**\n * Decode settings from base64 URL string\n */\nfunction decodeSettings(base64) {\n    try {\n        // Restore standard base64 characters\n        let normalized = base64\n            .replace(/-/g, '+')\n            .replace(/_/g, '/');\n\n        // Restore padding\n        while (normalized.length % 4) {\n            normalized += '=';\n        }\n\n        const json = atob(normalized);\n        return JSON.parse(json);\n    } catch (e) {\n        console.error('Failed to decode settings:', e);\n        return null;\n    }\n}\n\n/**\n * Encode settings to base64 URL string\n */\nfunction encodeSettings(settings) {\n    try {\n        const json = JSON.stringify(settings);\n        // Use btoa for base64 encoding, with URL-safe replacements\n        const base64 = btoa(json)\n            .replace(/\\+/g, '-')\n            .replace(/\\//g, '_')\n            .replace(/=+$/, ''); // Remove padding\n        return base64;\n    } catch (e) {\n        console.error('Failed to encode settings:', e);\n        return null;\n    }\n}\n\n/**\n * Share settings via URL\n */\nfunction shareSettings(settings) {\n    const encoded = encodeSettings(settings);\n\n    if (!encoded) {\n        alert('Failed to encode settings');\n        return;\n    }\n\n    // Build URL with settings parameter\n    const url = new URL(window.location.href);\n    // Keep storage parameter if present\n    url.search = '';\n    const storageParam = new URLSearchParams(window.location.search).get('storage');\n    if (storageParam) {\n        url.searchParams.set('storage', storageParam);\n    }\n    url.searchParams.set('s', encoded);\n\n    const shareUrl = url.toString();\n\n    // Copy to clipboard (only available in secure contexts: HTTPS or localhost)\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(shareUrl).then(() => {\n            const button = $('#share-url');\n            const originalText = button.text();\n            button.text('URL Copied!');\n            setTimeout(() => {\n                button.text(originalText);\n            }, 2000);\n        }).catch(err => {\n            console.error('Failed to copy URL to clipboard:', err);\n            // Fallback: show the URL in an alert\n            alert('Share this URL:\\n\\n' + shareUrl);\n        });\n    } else {\n        // Clipboard API not available (HTTP, not HTTPS)\n        // Fallback: select the URL in a temporary input field\n        const tempInput = document.createElement('input');\n        tempInput.value = shareUrl;\n        document.body.appendChild(tempInput);\n        tempInput.select();\n        tempInput.setSelectionRange(0, 99999); // For mobile\n\n        try {\n            // Try old execCommand method\n            const success = document.execCommand('copy');\n            document.body.removeChild(tempInput);\n\n            if (success) {\n                const button = $('#share-url');\n                const originalText = button.text();\n                button.text('URL Copied!');\n                setTimeout(() => {\n                    button.text(originalText);\n                }, 2000);\n            } else {\n                throw new Error('execCommand failed');\n            }\n        } catch (err) {\n            document.body.removeChild(tempInput);\n            // Final fallback: show the URL\n            alert('Copy this URL to share:\\n\\n' + shareUrl);\n        }\n    }\n}\n\n/**\n * Show error message\n */\nfunction showError(message) {\n    $('#error-message').text(message).show();\n}\n\n/**\n * Hide error message\n */\nfunction hideError() {\n    $('#error-message').hide();\n}\n\n/**\n * Load preset examples\n */\nfunction loadPresets() {\n    window.presets = {\n        '2d_rotation': {\n            dimensions: 2,\n            expressions: ['-y', 'x'],\n            integratorType: 'rk2',\n            colorMode: 'velocity_angle',\n            name: 'Simple Rotation'\n        },\n        '2d_vortex': {\n            dimensions: 2,\n            expressions: ['-y + x*(1 - x*x - y*y)', 'x + y*(1 - x*x - y*y)'],\n            integratorType: 'rk4',\n            colorMode: 'velocity_angle',\n            bbox: {\n                min: [-3, -3],\n                max: [3, 3]\n            },\n            name: 'Vortex'\n        },\n        '2d_vanderpol': {\n            dimensions: 2,\n            expressions: ['y', '(1 - x*x)*y - x'],\n            integratorType: 'rk4',\n            colorMode: 'velocity_angle',\n            name: 'Van der Pol Oscillator'\n        },\n        '3d_lorenz': {\n            dimensions: 3,\n            expressions: ['10*(y - x)', 'x*(28 - z) - y', 'x*y - 2.67*z'],\n            integratorType: 'rk4',\n            colorMode: 'velocity_angle',\n            name: 'Lorenz Attractor'\n        },\n        '3d_rossler': {\n            dimensions: 3,\n            expressions: ['-y - z', 'x + 0.2*y', '0.2 + z*(x - 5.7)'],\n            colorMode: 'velocity_angle',\n            name: 'R\u00F6ssler Attractor'\n        },\n        '4d_hypersphere': {\n            dimensions: 4,\n            expressions: ['-y', 'x', '-w', 'z'],\n            colorMode: 'velocity_angle',\n            name: '4D Hypersphere Rotation'\n        },\n        '2d_fluid_stirring': {\n            dimensions: 2,\n            expressions: [\n                '-y + sin(x)*cos(y)*3.0 - 0.1*x',\n                'x + cos(x)*sin(y)*3.0 - 0.1*y'\n            ],\n            colorMode: 'velocity_angle',\n            name: 'Fluid Transport with Stirring'\n        },\n        '4d_double_pendulum': {\n            dimensions: 4,\n            expressions: [\n                'z',  // d\u03B8\u2081/dt = \u03C9\u2081\n                'w',  // d\u03B8\u2082/dt = \u03C9\u2082\n                '(-10*(2*sin(x) + sin(x - 2*y)) - 2*sin(x - y)*(w*w + z*z*cos(x - y))) / (3 - cos(2*x - 2*y))',  // d\u03C9\u2081/dt\n                '(2*sin(x - y)*(2*z*z + 20*cos(x) + w*w*cos(x - y))) / (3 - cos(2*x - 2*y))'  // d\u03C9\u2082/dt\n            ],\n            name: 'Double Pendulum (Chaotic)',\n            timestep: 0.005,\n            colorMode: 'velocity_angle',\n            mapperType: 'custom',\n            mapperParams: {\n                horizontalExpr: 'sin(x) + sin(y)',\n                verticalExpr: '-cos(x) - cos(y)',\n                depthExpr: ''\n            }\n        },\n        '2d_strange_attractor': {\n            dimensions: 2,\n            expressions: [\n                '-y + x*(1 - x*x*x*x - y*y*y*y)',\n                'x + y*(1 - x*x*x*x - y*y*y*y)'\n            ],\n            bbox: {\n                min: [-3.5719104227544065, -1.7259582784950003],\n                max: [3.5719104227544065, 1.7259582784950003]\n            },\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.472,\n            implicitIterations: 3,\n            particleCount: 880100,\n            fadeOpacity: 0.9999,\n            colorMode: 'velocity_angle',\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: false,\n            'smaa-intensity': 1,\n            'smaa-threshold': 1,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.01,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n            name: 'Strange Attractor (Chaotic Limit Cycle)'\n        }\n    };\n}\n\n/**\n * Load a specific preset\n */\nfunction loadPreset(name, manager) {\n    // Check built-in presets first, then custom presets\n    let preset = window.presets[name];\n    if (!preset) {\n        const customPresets = loadCustomPresets();\n        preset = customPresets[name];\n    }\n\n    if (!preset) {\n        console.error('Preset not found:', name);\n        logger.error(`Preset not found: ${name}`);\n        return;\n    }\n\n    logger.info(`Loading preset: ${preset.name || name} (dimensions=${preset.dimensions}, expressions=${preset.expressions.length})`);\n\n    // Reset coordinate system to Cartesian unless preset specifies otherwise\n    // Presets expressions are written for Cartesian coordinates by default\n    if (preset.dimensions) {\n        let coordinateSystem;\n        if (preset.coordinateSystem) {\n            // Preset specifies a coordinate system - use it\n            coordinateSystem = CoordinateSystem.fromJSON(preset.coordinateSystem);\n        } else {\n            // No coordinate system specified - use Cartesian for the preset dimensions\n            coordinateSystem = getCartesianSystem(preset.dimensions);\n        }\n\n        // Update renderer and UI\n        if (window.renderer) {\n            window.renderer.coordinateSystem = coordinateSystem;\n        }\n\n        const expressionsControl = manager.get('dimension-inputs');\n        if (expressionsControl) {\n            expressionsControl.setCoordinateSystem(coordinateSystem);\n        }\n\n        logger.info(`Preset loaded with coordinate system: ${coordinateSystem.name}`);\n    }\n\n    // Use the same loading logic as for loading settings from localStorage\n    // This ensures consistent behavior and handles all control types properly\n    manager.applySettings(preset);\n\n    // Make sure UI controls are updated after restoring settings\n    const expressionsControl = manager.get('dimension-inputs');\n    if (expressionsControl && preset.dimensions) {\n        expressionsControl.updateInputs(preset.dimensions);\n    }\n\n    const mapperParamsControl = manager.get('mapper-params');\n    if (mapperParamsControl) {\n        mapperParamsControl.updateControls();\n    }\n\n    const transformParamsControl = manager.get('transform-params');\n    if (transformParamsControl) {\n        transformParamsControl.updateControls();\n    }\n\n    // Get settings from controls and merge bbox if present in preset\n    const settings = manager.getSettings();\n\n    // Add bbox to settings if present in preset\n    if (preset.bbox) {\n        // Expand bbox to fit canvas aspect ratio (ensure WHOLE bbox is visible)\n        const canvas = window.renderer?.gl?.canvas;\n        const expandedBBox = expandBBoxForAspectRatio(preset.bbox, canvas);\n        settings.bbox = expandedBBox;\n\n        const bboxWidth = preset.bbox.max[0] - preset.bbox.min[0];\n        const bboxHeight = preset.bbox.max[1] - preset.bbox.min[1];\n        const newWidth = expandedBBox.max[0] - expandedBBox.min[0];\n        const newHeight = expandedBBox.max[1] - expandedBBox.min[1];\n\n        if (canvas) {\n            logger.info(`Preset bbox expanded from [${bboxWidth.toFixed(2)} x ${bboxHeight.toFixed(2)}] to [${newWidth.toFixed(2)} x ${newHeight.toFixed(2)}] for aspect ratio ${(canvas.width / canvas.height).toFixed(2)}`);\n        } else {\n            logger.info(`Preset bbox: min=${preset.bbox.min}, max=${preset.bbox.max}`);\n        }\n    }\n\n    // Transform implicitIterations into integratorParams (same as in onApply)\n    if (settings.implicitIterations !== undefined) {\n        settings.integratorParams = { iterations: settings.implicitIterations };\n    }\n\n    // Apply all settings at once (including bbox) to renderer\n    if (window.renderer) {\n        window.renderer.updateConfig(settings);\n    }\n\n    logger.info(`Preset ${preset.name || name} loaded successfully`);\n}\n\n/**\n * Export loadPreset for global access\n */\nexport { loadPreset };\n\n/**\n * Custom preset management\n */\nconst CUSTOM_PRESETS_KEY = 'customPresets';\n\nfunction loadCustomPresets() {\n    try {\n        const stored = localStorage.getItem(CUSTOM_PRESETS_KEY);\n        return stored ? JSON.parse(stored) : {};\n    } catch (e) {\n        console.error('Failed to load custom presets:', e);\n        return {};\n    }\n}\n\nfunction saveCustomPreset(name, preset) {\n    const presets = loadCustomPresets();\n    presets[name] = preset;\n    try {\n        localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(presets));\n    } catch (e) {\n        console.error('Failed to save custom preset:', e);\n        alert('Failed to save preset: ' + e.message);\n    }\n}\n\nfunction deleteCustomPreset(name) {\n    const presets = loadCustomPresets();\n    delete presets[name];\n    try {\n        localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(presets));\n    } catch (e) {\n        console.error('Failed to delete custom preset:', e);\n    }\n}\n\nfunction refreshCustomPresetsDropdown() {\n    const customPresets = loadCustomPresets();\n    const $group = $('#custom-presets-group');\n\n    // Clear existing options\n    $group.empty();\n\n    // Add custom presets\n    const presetNames = Object.keys(customPresets).sort();\n    if (presetNames.length > 0) {\n        $group.show();\n        presetNames.forEach(name => {\n            const preset = customPresets[name];\n            const displayName = preset.name || name;\n            $group.append(`<option value=\"${name}\">${displayName}</option>`);\n        });\n    } else {\n        $group.hide();\n    }\n}\n", "/**\n * Main entry point for N-dimensional vector field renderer\n */\n\nimport { Renderer } from './webgl/renderer.js';\nimport { initControls, loadPreset } from './ui/controls-v2.js';\nimport { logger } from './utils/debug-logger.js';\nimport { Animator } from './animation/animator.js';\nimport { setCustomFunctions, getCustomFunctions } from './math/parser.js';\nimport { initializeModal } from './ui/modal.js';\nimport { CustomFunctionsTab } from './ui/tabs/custom-functions-tab.js';\nimport { DebugTab } from './ui/tabs/debug-tab.js';\nimport { DocsTab } from './ui/tabs/docs-tab.js';\n\n// Expose MathParser API to window for use in UI controls\nwindow.MathParser = {\n    setCustomFunctions,\n    getCustomFunctions\n};\n\n// Initialize when DOM is ready\n$(document).ready(function() {\n    // Step 1: Initialize logger\n    // Make logger globally available\n    window.logger = logger;\n\n    // Hook console methods to echo to debug console\n    logger.hookConsole();\n\n    logger.info('Logger initialized');\n\n    // Step 2: Initialize renderer and canvas\n    function initRenderer(callback) {\n        const canvas = document.getElementById('canvas');\n        let renderer = null;\n\n        // Set canvas size and maintain square aspect ratio for coordinate space\n        function resizeCanvas() {\n            canvas.width = window.innerWidth;\n            canvas.height = window.innerHeight;\n            if (renderer) {\n                renderer.resize(canvas.width, canvas.height);\n\n                // Adjust bbox to maintain square coordinate grid\n                const aspectRatio = canvas.width / canvas.height;\n                const bbox = renderer.bbox;\n                const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n                const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n                const currentHeight = bbox.max[1] - bbox.min[1];\n\n                // Set width based on aspect ratio to maintain square grid\n                const newWidth = currentHeight * aspectRatio;\n\n                bbox.min[0] = centerX - newWidth / 2;\n                bbox.max[0] = centerX + newWidth / 2;\n\n                renderer.updateConfig({ bbox: bbox });\n            }\n        }\n\n        resizeCanvas();\n        window.addEventListener('resize', resizeCanvas);\n\n        // Create renderer with storage strategy from controls\n        try {\n            // Get storage strategy from URL or default to Float (best precision)\n            const urlParams = new URLSearchParams(window.location.search);\n            const storageStrategy = urlParams.get('storage') || 'float';\n\n            renderer = new Renderer(canvas, { storageStrategy });\n            callback(renderer, canvas);\n        } catch (error) {\n            logger.error('Failed to initialize renderer', error);\n            alert('Failed to initialize WebGL renderer: ' + (error.message || error));\n        }\n    }\n\n    // Step 3: Initialize UI and start rendering\n    function initUI(renderer, canvas) {\n        // Initialize UI controls\n        const manager = initControls(renderer, function(controlsData) {\n            const { manager, state, saveSettings } = controlsData;\n\n            // Get initial settings and apply to renderer\n            // ControlManager settings keys match renderer config keys exactly,\n            // so we can pass the settings object directly (no manual mapping!)\n            const settings = manager.getSettings();\n            renderer.updateConfig(settings);\n\n            // Controls are ready, start rendering\n            renderer.start();\n\n            // Setup animation panel\n            setupAnimationPanel(renderer, manager);\n\n            // Make utilities globally available for debugging\n            window.renderer = renderer;\n            window.loadPreset = loadPreset;\n            window.logger = logger;\n            window.saveSettings = saveSettings; // Make saveSettings available globally\n            window.manager = manager; // Make manager available for debugging\n\n            // Initialize modal window and tabs\n            const modal = initializeModal();\n\n            // Register tabs in display order (left to right)\n\n            // Register Debug Console tab\n            const debugTab = new DebugTab(logger);\n            modal.registerTab(debugTab);\n\n            // Register Custom Functions tab\n            const debouncedApply = manager.debouncedApply.bind(manager);\n            const customFunctionsTab = new CustomFunctionsTab(window.MathParser, debouncedApply);\n            modal.registerTab(customFunctionsTab);\n\n            // Register Documentation tab\n            const docsTab = new DocsTab();\n            modal.registerTab(docsTab);\n\n            // Make modal globally available\n            window.appModal = modal;\n\n            logger.info('N-Dimensional Vector Field Renderer initialized!');\n            logger.info('Available presets: ' + Object.keys(window.presets).join(', '));\n            logger.info('Try: loadPreset(\"3d_lorenz\")');\n        });\n    }\n\n    // Step 4: Setup pan/zoom (after renderer is created)\n    function setupPanZoom(renderer, canvas) {\n        // Pan and zoom handling\n        let isDragging = false;\n        let lastX = 0;\n        let lastY = 0;\n\n        // Debounced save for pan/zoom (saves 500ms after last interaction)\n        let saveTimeout = null;\n        function debouncedSave() {\n            if (saveTimeout) {\n                clearTimeout(saveTimeout);\n            }\n            saveTimeout = setTimeout(() => {\n                if (window.saveSettings) {\n                    window.saveSettings();\n                }\n            }, 500);\n        }\n\n        canvas.addEventListener('mousedown', (e) => {\n            if (e.target === canvas) {\n                isDragging = true;\n                lastX = e.clientX;\n                lastY = e.clientY;\n            }\n        });\n\n        canvas.addEventListener('mousemove', (e) => {\n            if (isDragging) {\n                const dx = e.clientX - lastX;\n                const dy = e.clientY - lastY;\n\n                const bbox = renderer.bbox;\n                const width = bbox.max[0] - bbox.min[0];\n                const height = bbox.max[1] - bbox.min[1];\n\n                const scale = width / canvas.width;\n\n                bbox.min[0] -= dx * scale;\n                bbox.max[0] -= dx * scale;\n                bbox.min[1] += dy * scale;\n                bbox.max[1] += dy * scale;\n\n                renderer.updateConfig({ bbox: bbox });\n\n                lastX = e.clientX;\n                lastY = e.clientY;\n            }\n        });\n\n        canvas.addEventListener('mouseup', () => {\n            isDragging = false;\n            debouncedSave(); // Save after panning ends\n        });\n\n        canvas.addEventListener('mouseleave', () => {\n            isDragging = false;\n            if (!isDragging) {\n                debouncedSave(); // Save if we were panning\n            }\n        });\n\n        canvas.addEventListener('wheel', (e) => {\n            e.preventDefault();\n\n            const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;\n\n            const rect = canvas.getBoundingClientRect();\n            const mouseX = e.clientX - rect.left;\n            const mouseY = e.clientY - rect.top;\n\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            // Zoom towards mouse position\n            const centerX = bbox.min[0] + width * (mouseX / canvas.width);\n            const centerY = bbox.max[1] - height * (mouseY / canvas.height);\n\n            const newHeight = height * zoomFactor;\n            const aspectRatio = canvas.width / canvas.height;\n            const newWidth = newHeight * aspectRatio;\n\n            const ratioX = (centerX - bbox.min[0]) / width;\n            const ratioY = (bbox.max[1] - centerY) / height;\n\n            bbox.min[0] = centerX - newWidth * ratioX;\n            bbox.max[0] = centerX + newWidth * (1 - ratioX);\n            bbox.min[1] = centerY - newHeight * (1 - ratioY);\n            bbox.max[1] = centerY + newHeight * ratioY;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave(); // Save after zoom\n        });\n\n        // Touch support for mobile\n        let lastTouchDistance = 0;\n\n        canvas.addEventListener('touchstart', (e) => {\n            if (e.touches.length === 1) {\n                isDragging = true;\n                lastX = e.touches[0].clientX;\n                lastY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                isDragging = false;\n                const dx = e.touches[1].clientX - e.touches[0].clientX;\n                const dy = e.touches[1].clientY - e.touches[0].clientY;\n                lastTouchDistance = Math.sqrt(dx * dx + dy * dy);\n            }\n            e.preventDefault();\n        });\n\n        canvas.addEventListener('touchmove', (e) => {\n            if (e.touches.length === 1 && isDragging) {\n                const dx = e.touches[0].clientX - lastX;\n                const dy = e.touches[0].clientY - lastY;\n\n                const bbox = renderer.bbox;\n                const width = bbox.max[0] - bbox.min[0];\n                const height = bbox.max[1] - bbox.min[1];\n\n                const scale = width / canvas.width;\n\n                bbox.min[0] -= dx * scale;\n                bbox.max[0] -= dx * scale;\n                bbox.min[1] += dy * scale;\n                bbox.max[1] += dy * scale;\n\n                renderer.updateConfig({ bbox: bbox });\n\n                lastX = e.touches[0].clientX;\n                lastY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                const dx = e.touches[1].clientX - e.touches[0].clientX;\n                const dy = e.touches[1].clientY - e.touches[0].clientY;\n                const distance = Math.sqrt(dx * dx + dy * dy);\n\n                if (lastTouchDistance > 0) {\n                    const zoomFactor = lastTouchDistance / distance;\n\n                    const bbox = renderer.bbox;\n                    const height = bbox.max[1] - bbox.min[1];\n\n                    const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n                    const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n                    const newHeight = height * zoomFactor;\n                    const aspectRatio = canvas.width / canvas.height;\n                    const newWidth = newHeight * aspectRatio;\n\n                    bbox.min[0] = centerX - newWidth / 2;\n                    bbox.max[0] = centerX + newWidth / 2;\n                    bbox.min[1] = centerY - newHeight / 2;\n                    bbox.max[1] = centerY + newHeight / 2;\n\n                    renderer.updateConfig({ bbox: bbox });\n                }\n\n                lastTouchDistance = distance;\n            }\n            e.preventDefault();\n        });\n\n        canvas.addEventListener('touchend', () => {\n            isDragging = false;\n            lastTouchDistance = 0;\n            debouncedSave(); // Save after touch interaction ends\n        });\n\n        // ========================================\n        // Zoom/Pan Button Controls\n        // ========================================\n\n        // Helper function to zoom towards center\n        function zoomToCenter(zoomFactor) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n            const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n            const newHeight = height * zoomFactor;\n            const aspectRatio = canvas.width / canvas.height;\n            const newWidth = newHeight * aspectRatio;\n\n            bbox.min[0] = centerX - newWidth / 2;\n            bbox.max[0] = centerX + newWidth / 2;\n            bbox.min[1] = centerY - newHeight / 2;\n            bbox.max[1] = centerY + newHeight / 2;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave();\n        }\n\n        // Helper function to pan\n        function panView(dx, dy) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            // Pan by 10% of the current view\n            const panX = width * dx * 0.1;\n            const panY = height * dy * 0.1;\n\n            bbox.min[0] += panX;\n            bbox.max[0] += panX;\n            bbox.min[1] += panY;\n            bbox.max[1] += panY;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave();\n        }\n\n        // Zoom buttons\n        $('#zoom-in').on('click', () => zoomToCenter(0.9)); // Zoom in (0.9 = 10% closer)\n        $('#zoom-out').on('click', () => zoomToCenter(1.11)); // Zoom out (1.11 = 11% farther)\n\n        // Pan buttons\n        $('#pan-up').on('click', () => panView(0, 1));\n        $('#pan-down').on('click', () => panView(0, -1));\n        $('#pan-left').on('click', () => panView(-1, 0));\n        $('#pan-right').on('click', () => panView(1, 0));\n\n        // Diagonal pan buttons\n        $('#pan-up-left').on('click', () => panView(-1, 1));\n        $('#pan-up-right').on('click', () => panView(1, 1));\n        $('#pan-down-left').on('click', () => panView(-1, -1));\n        $('#pan-down-right').on('click', () => panView(1, -1));\n\n        // Center View at Origin button - centers view at (0,0) while keeping current zoom\n        $('#pan-reset').on('click', function() {\n            const currentBBox = renderer.bbox;\n            const currentWidth = currentBBox.max[0] - currentBBox.min[0];\n            const currentHeight = currentBBox.max[1] - currentBBox.min[1];\n\n            renderer.updateConfig({\n                bbox: {\n                    min: [-currentWidth / 2, -currentHeight / 2],\n                    max: [currentWidth / 2, currentHeight / 2]\n                },\n                reinitializeParticles: false\n            });\n            debouncedSave();\n        });\n\n        // Mobile compact view controls\n        $('#mobile-zoom-in').on('click', () => zoomToCenter(0.9)); // Zoom in\n        $('#mobile-zoom-out').on('click', () => zoomToCenter(1.11)); // Zoom out\n        $('#mobile-center').on('click', function() {\n            // Center view at origin (same as pan-reset)\n            const currentBBox = renderer.bbox;\n            const currentWidth = currentBBox.max[0] - currentBBox.min[0];\n            const currentHeight = currentBBox.max[1] - currentBBox.min[1];\n\n            renderer.updateConfig({\n                bbox: {\n                    min: [-currentWidth / 2, -currentHeight / 2],\n                    max: [currentWidth / 2, currentHeight / 2]\n                },\n                reinitializeParticles: false\n            });\n            debouncedSave();\n        });\n    }\n\n    // Step 5: Setup grid and cursor display\n    function setupGridAndCursor(renderer, canvas) {\n        const gridCanvas = document.getElementById('grid-canvas');\n        const gridCtx = gridCanvas.getContext('2d');\n        const cursorDiv = $('#cursor-position');\n\n        let showGrid = $('#show-grid').is(':checked');\n        let cursorX = 0;\n        let cursorY = 0;\n\n        // Resize grid canvas to match main canvas\n        function resizeGridCanvas() {\n            gridCanvas.width = canvas.width;\n            gridCanvas.height = canvas.height;\n            drawGrid();\n        }\n\n        // Convert screen coordinates to world coordinates\n        function screenToWorld(screenX, screenY) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const worldX = bbox.min[0] + (screenX / canvas.width) * width;\n            const worldY = bbox.max[1] - (screenY / canvas.height) * height;\n\n            return { x: worldX, y: worldY };\n        }\n\n        // Convert world coordinates to screen coordinates\n        function worldToScreen(worldX, worldY) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const screenX = ((worldX - bbox.min[0]) / width) * canvas.width;\n            const screenY = ((bbox.max[1] - worldY) / height) * canvas.height;\n\n            return { x: screenX, y: screenY };\n        }\n\n        // Calculate appropriate grid spacing\n        function getGridSpacing() {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n\n            // Target ~10 grid lines across the view\n            const targetLines = 10;\n            const rawSpacing = width / targetLines;\n\n            // Round to nice numbers (1, 2, 5, 10, 20, 50, etc.)\n            const magnitude = Math.pow(10, Math.floor(Math.log10(rawSpacing)));\n            const normalized = rawSpacing / magnitude;\n\n            let spacing;\n            if (normalized < 1.5) spacing = 1 * magnitude;\n            else if (normalized < 3.5) spacing = 2 * magnitude;\n            else if (normalized < 7.5) spacing = 5 * magnitude;\n            else spacing = 10 * magnitude;\n\n            return spacing;\n        }\n\n        // Draw coordinate grid\n        function drawGrid() {\n            if (!showGrid) {\n                gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);\n                return;\n            }\n\n            gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);\n\n            const bbox = renderer.bbox;\n            const spacing = getGridSpacing();\n\n            // Draw vertical grid lines\n            const startX = Math.floor(bbox.min[0] / spacing) * spacing;\n            const endX = Math.ceil(bbox.max[0] / spacing) * spacing;\n\n            gridCtx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n            gridCtx.lineWidth = 1;\n            gridCtx.font = '10px Courier New';\n            gridCtx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n\n            for (let x = startX; x <= endX; x += spacing) {\n                const screen = worldToScreen(x, 0);\n\n                // Draw line\n                gridCtx.beginPath();\n                gridCtx.moveTo(screen.x, 0);\n                gridCtx.lineTo(screen.x, gridCanvas.height);\n                gridCtx.stroke();\n\n                // Draw label\n                if (Math.abs(x) < 0.0001) continue; // Skip zero\n                const label = x.toFixed(Math.max(0, -Math.floor(Math.log10(spacing))));\n                gridCtx.fillText(label, screen.x + 3, gridCanvas.height - 5);\n            }\n\n            // Draw horizontal grid lines\n            const startY = Math.floor(bbox.min[1] / spacing) * spacing;\n            const endY = Math.ceil(bbox.max[1] / spacing) * spacing;\n\n            for (let y = startY; y <= endY; y += spacing) {\n                const screen = worldToScreen(0, y);\n\n                // Draw line\n                gridCtx.beginPath();\n                gridCtx.moveTo(0, screen.y);\n                gridCtx.lineTo(gridCanvas.width, screen.y);\n                gridCtx.stroke();\n\n                // Draw label\n                if (Math.abs(y) < 0.0001) continue; // Skip zero\n                const label = y.toFixed(Math.max(0, -Math.floor(Math.log10(spacing))));\n                gridCtx.fillText(label, 5, screen.y - 3);\n            }\n\n            // Draw axes (thicker)\n            const origin = worldToScreen(0, 0);\n\n            gridCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';\n            gridCtx.lineWidth = 2;\n\n            // X-axis\n            if (origin.y >= 0 && origin.y <= gridCanvas.height) {\n                gridCtx.beginPath();\n                gridCtx.moveTo(0, origin.y);\n                gridCtx.lineTo(gridCanvas.width, origin.y);\n                gridCtx.stroke();\n                gridCtx.fillText('0', origin.x + 3, origin.y - 3);\n            }\n\n            // Y-axis\n            if (origin.x >= 0 && origin.x <= gridCanvas.width) {\n                gridCtx.beginPath();\n                gridCtx.moveTo(origin.x, 0);\n                gridCtx.lineTo(origin.x, gridCanvas.height);\n                gridCtx.stroke();\n            }\n        }\n\n        // Update cursor position display\n        function updateCursorDisplay() {\n            const world = screenToWorld(cursorX, cursorY);\n\n            // Read pixel values at cursor position\n            const rect = canvas.getBoundingClientRect();\n            const canvasX = cursorX - rect.left;\n            const canvasY = cursorY - rect.top;\n            const pixelData = renderer.readPixelAt(canvasX, canvasY);\n\n            let displayText = `x: ${world.x.toFixed(3)}, y: ${world.y.toFixed(3)}`;\n\n            if (pixelData) {\n                if (pixelData.hdr) {\n                    const [r, g, b] = pixelData.hdr;\n                    displayText += `\\nHDR: (${r.toFixed(3)}, ${g.toFixed(3)}, ${b.toFixed(3)})`;\n                }\n                if (pixelData.ldr) {\n                    const [r, g, b] = pixelData.ldr;\n                    displayText += `\\nLDR: (${r.toFixed(3)}, ${g.toFixed(3)}, ${b.toFixed(3)})`;\n                }\n            }\n\n            cursorDiv.html(displayText.replace(/\\n/g, '<br>'));\n        }\n\n        // Track mouse position\n        canvas.addEventListener('mousemove', (e) => {\n            cursorX = e.clientX;\n            cursorY = e.clientY;\n            updateCursorDisplay();\n        });\n\n        // Toggle grid\n        $('#show-grid').on('change', function() {\n            showGrid = $(this).is(':checked');\n            drawGrid();\n        });\n\n        // Redraw grid when window resizes\n        window.addEventListener('resize', resizeGridCanvas);\n\n        // Redraw grid periodically to catch bbox changes\n        setInterval(drawGrid, 100);\n\n        // Update FPS counter\n        const fpsDisplay = document.querySelector('#fps-counter .fps-display');\n        function formatFrameCount(count) {\n            if (count >= 1000) {\n                const k = count / 1000;\n                // Show one decimal place for values like 1.5k, but not for 1k, 2k, etc.\n                if (k % 1 === 0) {\n                    return `${Math.floor(k)}k`;\n                } else {\n                    return `${k.toFixed(1)}k`;\n                }\n            }\n            return count.toString();\n        }\n        function updateFPS() {\n            if (renderer && renderer.fps !== undefined) {\n                const framesText = renderer.totalFrames !== undefined\n                    ? ` | ${formatFrameCount(renderer.totalFrames)} frames`\n                    : '';\n                fpsDisplay.textContent = `FPS: ${renderer.fps}${framesText}`;\n            }\n        }\n        setInterval(updateFPS, 500); // Update every 500ms\n\n        // Histogram panel\n        const histogramPanel = $('#histogram-panel');\n        const histogramCanvas = document.getElementById('histogram-canvas');\n        const histogramCtx = histogramCanvas.getContext('2d');\n\n        // Make histogram panel collapsible\n        $('#histogram-header').on('click', function() {\n            histogramPanel.toggleClass('collapsed');\n            $('#histogram-expand').text(histogramPanel.hasClass('collapsed') ? '\u25B6' : '\u25BC');\n        });\n\n        // Draw histogram\n        function drawHistogram() {\n            if (!renderer) return;\n\n            const stats = renderer.getBufferStats();\n            if (!stats || !stats.histogram || stats.histogram.length === 0) return;\n\n            const canvas = histogramCanvas;\n            const ctx = histogramCtx;\n            const dpr = window.devicePixelRatio || 1;\n\n            // Set canvas resolution\n            canvas.width = canvas.clientWidth * dpr;\n            canvas.height = canvas.clientHeight * dpr;\n            ctx.scale(dpr, dpr);\n\n            const width = canvas.clientWidth;\n            const height = canvas.clientHeight;\n\n            // Clear\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\n            ctx.fillRect(0, 0, width, height);\n\n            // Find max count for scaling\n            const maxCount = Math.max(...stats.histogram);\n            if (maxCount === 0) return;\n\n            // Draw bars\n            const barWidth = width / stats.histogram.length;\n            ctx.fillStyle = '#4CAF50';\n\n            stats.histogram.forEach((count, i) => {\n                const barHeight = (count / maxCount) * (height - 4);\n                const x = i * barWidth;\n                const y = height - barHeight;\n                ctx.fillRect(x, y, barWidth - 1, barHeight);\n            });\n\n            // Update info\n            $('#hist-avg').text(stats.avgBrightness.toFixed(1));\n            $('#hist-max').text(stats.maxBrightness.toFixed(0));\n\n            // Check if velocity is available\n            if (stats.maxVelocity !== undefined && stats.maxVelocity !== null) {\n                $('#hist-vel').text(stats.maxVelocity.toFixed(2));\n            } else {\n                $('#hist-vel').text('--');\n            }\n        }\n\n        setInterval(drawHistogram, 1000); // Update every second\n\n        resizeGridCanvas();\n        updateCursorDisplay();\n    }\n\n    // Step 6: Setup keyboard shortcuts\n    function setupKeyboardShortcuts(renderer) {\n        document.addEventListener('keydown', (e) => {\n            // Close mobile panels or floating panels: Press 'Escape' key\n            if (e.key === 'Escape') {\n                // Check if mobile panel manager exists and has an open panel\n                if (window.mobilePanelManager && window.mobilePanelManager.getCurrentPanel()) {\n                    e.preventDefault();\n                    window.mobilePanelManager.hideAllPanels();\n                    logger.verbose('Mobile panel closed via Escape key');\n                    return;\n                }\n\n                // Check if any floating panels are open\n                const openFloatingPanels = $('.floating-panel:visible');\n                if (openFloatingPanels.length > 0) {\n                    e.preventDefault();\n                    openFloatingPanels.hide();\n                    logger.verbose('Floating panel closed via Escape key');\n                    return;\n                }\n            }\n\n            // Clear screen: Press 'C' key (with no modifiers to avoid conflicts)\n            if (e.key === 'c' && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {\n                // Don't trigger if user is typing in an input field\n                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\n                    return;\n                }\n\n                e.preventDefault();\n                renderer.clearScreen();\n                logger.info('Screen cleared via keyboard shortcut (C)');\n            }\n        });\n    }\n\n    // Step 7: Setup animation panel\n    function setupAnimationPanel(renderer, manager) {\n        let animator = null;\n\n        // Open/close panel\n        $('#open-animation-panel').on('click', function() {\n            $('#animation-panel').toggle();\n        });\n\n        // Load animation script\n        $('#animation-script-input').on('change', function(e) {\n            const file = e.target.files[0];\n            if (!file) return;\n\n            const reader = new FileReader();\n            reader.onload = function(event) {\n                try {\n                    const scriptData = JSON.parse(event.target.result);\n\n                    // Create animator\n                    animator = new Animator(renderer, manager);\n                    const script = animator.loadScript(scriptData);\n\n                    // Update UI with script info\n                    $('#anim-name').text(script.name);\n\n                    // Timeline-based animation (new format)\n                    const duration = script.timeline[script.timeline.length - 1].time;\n                    const totalFrames = Math.ceil(duration * script.fps);\n\n                    $('#anim-param').text(`${script.timeline.length} keyframes`);\n                    $('#anim-range').text(`0s \u2192 ${duration}s`);\n                    $('#anim-frames').text(totalFrames);\n                    $('#anim-fps').text(script.fps);\n                    $('#anim-duration').text(`${duration.toFixed(1)}s`);\n\n                    // Show info and enable run button\n                    $('#animation-info').show();\n                    $('#animation-run-btn').prop('disabled', false);\n                    $('#animation-download-btn').prop('disabled', true);\n\n                    logger.info(`Animation script loaded: ${script.name}`);\n                } catch (error) {\n                    alert('Failed to load animation script: ' + error.message);\n                    logger.error('Animation script load failed', error);\n                }\n            };\n            reader.readAsText(file);\n        });\n\n        // Run animation\n        $('#animation-run-btn').on('click', async function() {\n            if (!animator) return;\n\n            try {\n                // Disable controls\n                $('#animation-run-btn').prop('disabled', true);\n                $('#animation-pause-btn').prop('disabled', false);\n                $('#animation-stop-btn').prop('disabled', false);\n                $('#animation-script-input').prop('disabled', true);\n\n                // Show progress\n                $('#animation-progress').show();\n\n                // Run with progress callback\n                await animator.run((frameNum, totalFrames, time) => {\n                    const percent = (frameNum / totalFrames) * 100;\n                    $('#progress-bar').css('width', percent + '%');\n                    $('#progress-text').text(`Frame ${frameNum} / ${totalFrames}`);\n                    $('#progress-param').text(`Time: ${time.toFixed(2)}s`);\n                });\n\n                // Animation complete\n                logger.info('Animation complete!');\n                alert('Animation complete! ' + animator.frames.length + ' frames captured.');\n\n                // Enable download button\n                $('#animation-download-btn').prop('disabled', false);\n\n            } catch (error) {\n                logger.error('Animation failed', error);\n                alert('Animation failed: ' + error.message);\n            } finally {\n                // Re-enable controls\n                $('#animation-run-btn').prop('disabled', false);\n                $('#animation-pause-btn').prop('disabled', true);\n                $('#animation-stop-btn').prop('disabled', true);\n                $('#animation-script-input').prop('disabled', false);\n            }\n        });\n\n        // Pause animation\n        $('#animation-pause-btn').on('click', function() {\n            if (!animator) return;\n\n            if (animator.isPaused) {\n                animator.resume();\n                $(this).text('\u23F8 Pause');\n                logger.info('Animation resumed');\n            } else {\n                animator.pause();\n                $(this).text('\u25B6 Resume');\n                logger.info('Animation paused');\n            }\n        });\n\n        // Stop animation\n        $('#animation-stop-btn').on('click', function() {\n            if (!animator) return;\n\n            animator.stop();\n            logger.info('Animation stopped');\n\n            // Reset UI\n            $('#animation-run-btn').prop('disabled', false);\n            $('#animation-pause-btn').prop('disabled', true);\n            $('#animation-stop-btn').prop('disabled', true);\n            $('#animation-script-input').prop('disabled', false);\n        });\n\n        // Download frames\n        $('#animation-download-btn').on('click', async function() {\n            if (!animator || animator.frames.length === 0) return;\n\n            try {\n                $(this).prop('disabled', true);\n                $(this).text('\uD83D\uDCBE Downloading...');\n\n                await animator.downloadFrames();\n\n                $(this).text('\u2713 Downloaded');\n                setTimeout(() => {\n                    $(this).text('\uD83D\uDCBE Download Frames (ZIP)');\n                    $(this).prop('disabled', false);\n                }, 2000);\n\n            } catch (error) {\n                logger.error('Download failed', error);\n                alert('Download failed: ' + error.message);\n                $(this).text('\uD83D\uDCBE Download Frames (ZIP)');\n                $(this).prop('disabled', false);\n            }\n        });\n\n        logger.info('Animation panel initialized');\n    }\n\n    // Step 8: Initialize accordion for controls sections\n    function initAccordion() {\n        const ACCORDION_STATE_KEY = 'accordionState';\n\n        // Load saved accordion state from localStorage\n        let savedState = {};\n        try {\n            const saved = localStorage.getItem(ACCORDION_STATE_KEY);\n            if (saved) {\n                savedState = JSON.parse(saved);\n            }\n        } catch (e) {\n            console.warn('Failed to load accordion state', e);\n        }\n\n        // Get all h2 headers in the controls panel\n        $('#controls h2').each(function(index) {\n            const $header = $(this);\n            const $section = $header.next('.accordion-section');\n\n            if ($section.length === 0) return; // Skip if no accordion section follows\n\n            // Use the header text as a unique identifier\n            const sectionId = $header.text().trim();\n\n            // Determine initial state (default to expanded for first section, collapsed for others)\n            const isCollapsed = savedState.hasOwnProperty(sectionId)\n                ? savedState[sectionId]\n                : (index > 0); // First section open, rest collapsed\n\n            // Set initial state\n            if (isCollapsed) {\n                $header.addClass('collapsed');\n                $section.addClass('collapsed');\n            } else {\n                // Set max-height for smooth transition\n                $section.css('max-height', $section[0].scrollHeight + 'px');\n            }\n\n            // Add click handler\n            $header.on('click', function() {\n                const $h2 = $(this);\n                const $content = $h2.next('.accordion-section');\n                const isCurrentlyCollapsed = $h2.hasClass('collapsed');\n\n                if (isCurrentlyCollapsed) {\n                    // Expand\n                    $h2.removeClass('collapsed');\n                    $content.css('max-height', $content[0].scrollHeight + 'px');\n                    $content.removeClass('collapsed');\n                } else {\n                    // Collapse\n                    $content.css('max-height', $content[0].scrollHeight + 'px');\n                    // Force reflow\n                    $content[0].offsetHeight;\n                    $content.css('max-height', '0');\n                    $h2.addClass('collapsed');\n                    $content.addClass('collapsed');\n                }\n\n                // Save state to localStorage\n                savedState[sectionId] = !isCurrentlyCollapsed;\n                try {\n                    localStorage.setItem(ACCORDION_STATE_KEY, JSON.stringify(savedState));\n                } catch (e) {\n                    console.warn('Failed to save accordion state', e);\n                }\n            });\n\n            // Update max-height when window resizes or content changes\n            const updateMaxHeight = () => {\n                if (!$section.hasClass('collapsed')) {\n                    $section.css('max-height', $section[0].scrollHeight + 'px');\n                }\n            };\n\n            // Create a ResizeObserver to watch for content changes\n            if (typeof ResizeObserver !== 'undefined') {\n                const observer = new ResizeObserver(updateMaxHeight);\n                observer.observe($section[0]);\n            }\n        });\n\n        logger.info('Accordion initialized with ' + $('#controls h2').length + ' sections');\n    }\n\n    // Run initialization sequence in order\n    initAccordion(); // Initialize accordion early (doesn't depend on renderer)\n    initRenderer(function(renderer, canvas) {\n        setupPanZoom(renderer, canvas);\n        setupGridAndCursor(renderer, canvas);\n        setupKeyboardShortcuts(renderer);\n        initUI(renderer, canvas);\n    });\n});\n", "/**\n * Keyframe-based animation system for rendering particle flow animations\n * Supports timeline with multiple simultaneous parameter changes,\n * easing functions, and proper burn-in/accumulation workflow\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Easing functions for smooth parameter interpolation\n */\nconst EASING_FUNCTIONS = {\n    linear: t => t,\n    easeIn: t => t * t,\n    easeOut: t => 1 - Math.pow(1 - t, 2),\n    easeInOut: t => t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2,\n    easeInCubic: t => t * t * t,\n    easeOutCubic: t => 1 - Math.pow(1 - t, 3),\n    easeInOutCubic: t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2,\n    elastic: t => {\n        const c4 = (2 * Math.PI) / 3;\n        return t === 0 ? 0 : t === 1 ? 1 : -Math.pow(2, 10 * t - 10) * Math.sin((t * 10 - 10.75) * c4);\n    },\n    bounce: t => {\n        const n1 = 7.5625;\n        const d1 = 2.75;\n        if (t < 1 / d1) {\n            return n1 * t * t;\n        } else if (t < 2 / d1) {\n            return n1 * (t -= 1.5 / d1) * t + 0.75;\n        } else if (t < 2.5 / d1) {\n            return n1 * (t -= 2.25 / d1) * t + 0.9375;\n        } else {\n            return n1 * (t -= 2.625 / d1) * t + 0.984375;\n        }\n    }\n};\n\n/**\n * Animation script executor with keyframe timeline\n */\nexport class Animator {\n    constructor(renderer, controlManager) {\n        this.renderer = renderer;\n        this.manager = controlManager;\n        this.frames = [];\n        this.isRunning = false;\n        this.isPaused = false;\n        this.script = null;\n    }\n\n    /**\n     * Load and validate animation script\n     */\n    loadScript(scriptData) {\n        // Validate required fields\n        if (!scriptData.baseSettings) {\n            throw new Error('Animation script missing baseSettings');\n        }\n        if (!scriptData.timeline || !Array.isArray(scriptData.timeline)) {\n            throw new Error('Animation script missing timeline array');\n        }\n        if (scriptData.timeline.length < 2) {\n            throw new Error('Timeline must have at least 2 keyframes');\n        }\n\n        // Validate timeline is sorted by time\n        for (let i = 1; i < scriptData.timeline.length; i++) {\n            if (scriptData.timeline[i].time <= scriptData.timeline[i - 1].time) {\n                throw new Error('Timeline keyframes must be sorted by time');\n            }\n        }\n\n        // Set defaults\n        this.script = {\n            name: scriptData.name || 'Untitled Animation',\n            description: scriptData.description || '',\n            fps: scriptData.fps || 30,\n            baseSettings: scriptData.baseSettings,\n            timeline: scriptData.timeline.map(kf => ({\n                time: kf.time,\n                settings: kf.settings || {},\n                easing: kf.easing || 'linear',\n                convergenceSteps: kf.convergenceSteps || 0\n            })),\n            frameConfig: {\n                burnInSteps: scriptData.frameConfig?.burnInSteps || 5000,\n                clearAfterBurnIn: scriptData.frameConfig?.clearAfterBurnIn !== undefined\n                    ? scriptData.frameConfig.clearAfterBurnIn : true,\n                accumulationSteps: scriptData.frameConfig?.accumulationSteps || 2000\n            }\n        };\n\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        const totalFrames = Math.ceil(duration * this.script.fps);\n\n        logger.info(`Loaded animation: ${this.script.name}`);\n        logger.info(`  Duration: ${duration}s @ ${this.script.fps} fps = ${totalFrames} frames`);\n        logger.info(`  Keyframes: ${this.script.timeline.length}`);\n\n        return this.script;\n    }\n\n    /**\n     * Get keyframe indices and interpolation factor for a given time\n     */\n    getKeyframeIndices(time) {\n        const timeline = this.script.timeline;\n\n        // Handle edge cases\n        if (time <= timeline[0].time) {\n            return { prev: 0, next: 0, t: 0 };\n        }\n        if (time >= timeline[timeline.length - 1].time) {\n            return { prev: timeline.length - 1, next: timeline.length - 1, t: 1 };\n        }\n\n        // Find surrounding keyframes\n        for (let i = 1; i < timeline.length; i++) {\n            if (time <= timeline[i].time) {\n                const prev = i - 1;\n                const next = i;\n                const t = (time - timeline[prev].time) / (timeline[next].time - timeline[prev].time);\n                return { prev, next, t };\n            }\n        }\n\n        // Should never reach here\n        return { prev: timeline.length - 1, next: timeline.length - 1, t: 1 };\n    }\n\n    /**\n     * Interpolate between two values\n     */\n    interpolateValue(start, end, t, easingName = 'linear') {\n        const easingFunc = EASING_FUNCTIONS[easingName] || EASING_FUNCTIONS.linear;\n        const easedT = easingFunc(t);\n\n        // Handle different value types\n        if (typeof start === 'number' && typeof end === 'number') {\n            return start + (end - start) * easedT;\n        }\n\n        // For arrays (like expressions or bbox)\n        if (Array.isArray(start) && Array.isArray(end)) {\n            return start.map((v, i) => {\n                const endValue = end[i] !== undefined ? end[i] : v;\n                if (typeof v === 'number') {\n                    return v + (endValue - v) * easedT;\n                }\n                // For string expressions, just switch at t > 0.5\n                return easedT < 0.5 ? v : endValue;\n            });\n        }\n\n        // For objects (like mapperParams, transformParams)\n        if (typeof start === 'object' && start !== null && typeof end === 'object' && end !== null) {\n            const result = { ...start };\n            for (const key in end) {\n                if (start[key] !== undefined) {\n                    result[key] = this.interpolateValue(start[key], end[key], easedT, easingName);\n                } else {\n                    result[key] = end[key];\n                }\n            }\n            return result;\n        }\n\n        // For other types (strings, booleans), just switch at t > 0.5\n        return easedT < 0.5 ? start : end;\n    }\n\n    /**\n     * Get interpolated settings for a given time\n     */\n    getInterpolatedSettings(time) {\n        const { prev, next, t } = this.getKeyframeIndices(time);\n        const timeline = this.script.timeline;\n\n        // If at a keyframe, use its settings directly\n        if (prev === next) {\n            return { ...this.script.baseSettings, ...timeline[prev].settings };\n        }\n\n        // Interpolate between keyframes\n        const prevSettings = { ...this.script.baseSettings, ...timeline[prev].settings };\n        const nextSettings = { ...this.script.baseSettings, ...timeline[next].settings };\n        const easing = timeline[next].easing;\n\n        const interpolated = { ...prevSettings };\n\n        // Interpolate each setting that exists in next keyframe\n        for (const key in nextSettings) {\n            if (prevSettings[key] !== undefined) {\n                interpolated[key] = this.interpolateValue(\n                    prevSettings[key],\n                    nextSettings[key],\n                    t,\n                    easing\n                );\n            } else {\n                interpolated[key] = nextSettings[key];\n            }\n        }\n\n        return interpolated;\n    }\n\n    /**\n     * Calculate animation alpha (0.0-1.0) for the entire animation duration\n     */\n    getAnimationAlpha(time) {\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        return Math.max(0, Math.min(1, time / duration));\n    }\n\n    /**\n     * Wait for a single animation frame\n     */\n    waitFrame() {\n        return new Promise(resolve => requestAnimationFrame(resolve));\n    }\n\n    /**\n     * Capture current render buffer as PNG blob at scaled resolution\n     */\n    async captureFrame() {\n        return this.renderer.captureRenderBuffer();\n    }\n\n    /**\n     * Render a single animation frame with proper workflow\n     */\n    async renderAnimationFrame(time, frameNum, totalFrames) {\n        const { frameConfig } = this.script;\n\n        // Step 1: Get interpolated settings for this time\n        const settings = this.getInterpolatedSettings(time);\n        const alpha = this.getAnimationAlpha(time);\n\n        logger.info(`Frame ${frameNum + 1}/${totalFrames}: t=${time.toFixed(3)}s, alpha=${alpha.toFixed(3)}`);\n\n        // Step 2: Apply settings (may trigger shader recompilation)\n        this.manager.setSettings(settings);\n        this.renderer.setAnimationAlpha(alpha);\n        await this.waitFrame();\n\n        // Step 3: Clear render buffer and reset particles\n        this.renderer.clearRenderBuffer();\n        this.renderer.resetParticles();\n\n        // Step 4: Run burn-in steps (let particles settle into attractor)\n        if (frameConfig.burnInSteps > 0) {\n            logger.verbose(`  Burn-in: ${frameConfig.burnInSteps} steps`);\n            this.renderer.step(frameConfig.burnInSteps);\n        }\n\n        // Step 5: Optionally clear render buffer again (keep particles)\n        if (frameConfig.clearAfterBurnIn) {\n            this.renderer.clearRenderBuffer();\n        }\n\n        // Step 6: Run accumulation steps (build up trails)\n        if (frameConfig.accumulationSteps > 0) {\n            logger.verbose(`  Accumulation: ${frameConfig.accumulationSteps} steps`);\n            for (let i = 0; i < frameConfig.accumulationSteps; i++) {\n                this.renderer.updatePositions();\n                this.renderer.drawParticles();\n                this.renderer.fadeScreen();\n            }\n        }\n\n        // Step 7: Final render pass for output\n        this.renderer.render();\n        await this.waitFrame();\n\n        // Step 8: Capture frame\n        const blob = await this.captureFrame();\n\n        return blob;\n    }\n\n    /**\n     * Run the animation and capture frames\n     */\n    async run(progressCallback) {\n        if (this.isRunning) {\n            throw new Error('Animation already running');\n        }\n\n        if (!this.script) {\n            throw new Error('No animation script loaded');\n        }\n\n        this.isRunning = true;\n        this.isPaused = false;\n        this.frames = [];\n\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        const totalFrames = Math.ceil(duration * this.script.fps);\n\n        try {\n            // Apply base settings\n            logger.info('Applying base settings...');\n\n            // Apply settings (exclude coordinateSystem - will apply it after)\n            const settingsWithoutCoordSystem = { ...this.script.baseSettings };\n            delete settingsWithoutCoordSystem.coordinateSystem;\n            this.manager.setSettings(settingsWithoutCoordSystem);\n\n            // Apply coordinate system AFTER other settings (so dimension change doesn't reset it)\n            if (this.script.baseSettings.coordinateSystem) {\n                const { CoordinateSystem } = await import('../math/coordinate-systems.js');\n                const coordSystem = CoordinateSystem.fromJSON(this.script.baseSettings.coordinateSystem);\n                this.renderer.coordinateSystem = coordSystem;\n                logger.info(`Set coordinate system: ${coordSystem.name}`);\n\n                // Trigger shader recompilation with the coordinate system\n                this.renderer.compileShaders();\n                logger.info('Shaders recompiled with coordinate system');\n            }\n\n            await this.waitFrame();\n\n            // Render each frame\n            for (let frameNum = 0; frameNum < totalFrames; frameNum++) {\n                // Check for pause\n                while (this.isPaused && this.isRunning) {\n                    await new Promise(resolve => setTimeout(resolve, 100));\n                }\n\n                if (!this.isRunning) {\n                    logger.info('Animation stopped');\n                    break;\n                }\n\n                // Calculate time for this frame\n                const time = (frameNum / this.script.fps);\n\n                // Render frame\n                const blob = await this.renderAnimationFrame(time, frameNum, totalFrames);\n\n                this.frames.push({\n                    frameNum,\n                    time,\n                    blob,\n                    timestamp: Date.now()\n                });\n\n                // Progress callback\n                if (progressCallback) {\n                    progressCallback(frameNum + 1, totalFrames, time);\n                }\n            }\n\n            logger.info(`Animation complete: ${this.frames.length} frames captured`);\n            return this.frames;\n\n        } catch (error) {\n            logger.error('Animation failed:', error);\n            throw error;\n        } finally {\n            this.isRunning = false;\n        }\n    }\n\n    /**\n     * Pause animation\n     */\n    pause() {\n        this.isPaused = true;\n    }\n\n    /**\n     * Resume animation\n     */\n    resume() {\n        this.isPaused = false;\n    }\n\n    /**\n     * Stop animation\n     */\n    stop() {\n        this.isRunning = false;\n        this.isPaused = false;\n    }\n\n    /**\n     * Download all captured frames as ZIP\n     */\n    async downloadFrames() {\n        if (this.frames.length === 0) {\n            throw new Error('No frames to download');\n        }\n\n        // Use JSZip if available, otherwise download individually\n        if (window.JSZip) {\n            return await this.downloadAsZip();\n        } else {\n            return await this.downloadIndividually();\n        }\n    }\n\n    /**\n     * Download frames as ZIP archive\n     */\n    async downloadAsZip() {\n        const JSZip = window.JSZip;\n        const zip = new JSZip();\n\n        // Add frames\n        for (const { frameNum, blob } of this.frames) {\n            const filename = `frame_${String(frameNum).padStart(6, '0')}.png`;\n            zip.file(filename, blob);\n        }\n\n        // Add metadata\n        const metadata = {\n            script: this.script,\n            captureDate: new Date().toISOString(),\n            frameCount: this.frames.length\n        };\n        zip.file('metadata.json', JSON.stringify(metadata, null, 2));\n\n        // Generate ZIP\n        logger.info('Generating ZIP archive...');\n        const zipBlob = await zip.generateAsync({ type: 'blob' });\n\n        // Download\n        const filename = `${this.script.name.replace(/\\s+/g, '_')}.zip`;\n        this.downloadBlob(zipBlob, filename);\n\n        logger.info(`Downloaded ${filename}`);\n    }\n\n    /**\n     * Download frames individually\n     */\n    async downloadIndividually() {\n        for (const { frameNum, blob } of this.frames) {\n            const filename = `frame_${String(frameNum).padStart(6, '0')}.png`;\n            this.downloadBlob(blob, filename);\n\n            // Small delay to avoid overwhelming browser\n            await new Promise(resolve => setTimeout(resolve, 100));\n        }\n\n        logger.info(`Downloaded ${this.frames.length} frames`);\n    }\n\n    /**\n     * Download blob as file\n     */\n    downloadBlob(blob, filename) {\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n}\n", "/**\n * Base class for modal tabs\n *\n * Tabs are lazily loaded - their content is only rendered when activated.\n * Subclasses should override render() and optionally onActivate()/onDeactivate().\n */\nexport class Tab {\n    /**\n     * @param {string} id - Unique identifier for this tab\n     * @param {string} title - Display title for the tab button\n     */\n    constructor(id, title) {\n        this.id = id;\n        this.title = title;\n        this._isRendered = false;\n        this._isActive = false;\n        this._contentElement = null;\n    }\n\n    /**\n     * Get whether this tab has been rendered yet\n     * @returns {boolean}\n     */\n    get isRendered() {\n        return this._isRendered;\n    }\n\n    /**\n     * Get whether this tab is currently active\n     * @returns {boolean}\n     */\n    get isActive() {\n        return this._isActive;\n    }\n\n    /**\n     * Render the tab content. Called once when tab is first activated.\n     * Subclasses MUST override this method.\n     * @param {HTMLElement} container - Container element to render into\n     * @returns {HTMLElement} The rendered content element\n     */\n    render(container) {\n        throw new Error('Tab subclass must implement render() method');\n    }\n\n    /**\n     * Called when tab becomes active.\n     * Override to perform actions when tab is shown.\n     */\n    onActivate() {\n        // Override in subclass if needed\n    }\n\n    /**\n     * Called when tab becomes inactive.\n     * Override to perform cleanup when tab is hidden.\n     */\n    onDeactivate() {\n        // Override in subclass if needed\n    }\n\n    /**\n     * Internal method to activate this tab\n     * @param {HTMLElement} container - Container to render into\n     * @internal\n     */\n    _activate(container) {\n        if (!this._isRendered) {\n            this._contentElement = this.render(container);\n            this._isRendered = true;\n        }\n\n        if (this._contentElement) {\n            this._contentElement.style.display = 'block';\n        }\n\n        this._isActive = true;\n        this.onActivate();\n    }\n\n    /**\n     * Internal method to deactivate this tab\n     * @internal\n     */\n    _deactivate() {\n        if (this._contentElement) {\n            this._contentElement.style.display = 'none';\n        }\n\n        this._isActive = false;\n        this.onDeactivate();\n    }\n\n    /**\n     * Destroy this tab and clean up resources\n     */\n    destroy() {\n        if (this._contentElement && this._contentElement.parentNode) {\n            this._contentElement.parentNode.removeChild(this._contentElement);\n        }\n        this._contentElement = null;\n        this._isRendered = false;\n        this._isActive = false;\n    }\n}\n\n/**\n * Manages tabs within a modal window\n */\nexport class TabManager {\n    constructor() {\n        this._tabs = new Map();\n        this._activeTab = null;\n        this._tabBarElement = null;\n        this._contentElement = null;\n    }\n\n    /**\n     * Register a new tab\n     * @param {Tab} tab - Tab instance to register\n     */\n    register(tab) {\n        if (!(tab instanceof Tab)) {\n            throw new Error('Tab must be an instance of Tab class');\n        }\n\n        if (this._tabs.has(tab.id)) {\n            throw new Error(`Tab with id '${tab.id}' already registered`);\n        }\n\n        this._tabs.set(tab.id, tab);\n\n        // If tab bar exists, add button for this tab\n        if (this._tabBarElement) {\n            this._addTabButton(tab);\n        }\n    }\n\n    /**\n     * Unregister a tab\n     * @param {string} tabId - ID of tab to unregister\n     */\n    unregister(tabId) {\n        const tab = this._tabs.get(tabId);\n        if (!tab) return;\n\n        if (tab === this._activeTab) {\n            this._activeTab = null;\n        }\n\n        tab.destroy();\n        this._tabs.delete(tabId);\n\n        // Remove button if tab bar exists\n        if (this._tabBarElement) {\n            const button = this._tabBarElement.querySelector(`[data-tab-id=\"${tabId}\"]`);\n            if (button) {\n                button.remove();\n            }\n        }\n    }\n\n    /**\n     * Activate a tab by ID\n     * @param {string} tabId - ID of tab to activate\n     * @returns {boolean} True if tab was activated, false if not found\n     */\n    activate(tabId) {\n        const tab = this._tabs.get(tabId);\n        if (!tab) {\n            console.warn(`Tab '${tabId}' not found`);\n            return false;\n        }\n\n        // Deactivate current tab\n        if (this._activeTab && this._activeTab !== tab) {\n            this._activeTab._deactivate();\n            this._updateTabButton(this._activeTab.id, false);\n        }\n\n        // Activate new tab\n        this._activeTab = tab;\n        tab._activate(this._contentElement);\n        this._updateTabButton(tabId, true);\n\n        return true;\n    }\n\n    /**\n     * Get the currently active tab\n     * @returns {Tab|null}\n     */\n    getActiveTab() {\n        return this._activeTab;\n    }\n\n    /**\n     * Get all registered tabs\n     * @returns {Tab[]}\n     */\n    getAllTabs() {\n        return Array.from(this._tabs.values());\n    }\n\n    /**\n     * Initialize UI elements (tab bar and content container)\n     * @param {HTMLElement} tabBarElement - Element to render tab buttons into\n     * @param {HTMLElement} contentElement - Element to render tab content into\n     */\n    initializeUI(tabBarElement, contentElement) {\n        this._tabBarElement = tabBarElement;\n        this._contentElement = contentElement;\n\n        // Render buttons for all registered tabs\n        for (const tab of this._tabs.values()) {\n            this._addTabButton(tab);\n        }\n    }\n\n    /**\n     * Add a button for a tab to the tab bar\n     * @private\n     */\n    _addTabButton(tab) {\n        if (!this._tabBarElement) return;\n\n        const button = document.createElement('button');\n        button.className = 'modal-tab-button';\n        button.textContent = tab.title;\n        button.dataset.tabId = tab.id;\n\n        button.addEventListener('click', () => {\n            this.activate(tab.id);\n        });\n\n        this._tabBarElement.appendChild(button);\n    }\n\n    /**\n     * Update tab button active state\n     * @private\n     */\n    _updateTabButton(tabId, isActive) {\n        if (!this._tabBarElement) return;\n\n        const button = this._tabBarElement.querySelector(`[data-tab-id=\"${tabId}\"]`);\n        if (button) {\n            if (isActive) {\n                button.classList.add('active');\n            } else {\n                button.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Destroy all tabs and clean up\n     */\n    destroy() {\n        for (const tab of this._tabs.values()) {\n            tab.destroy();\n        }\n        this._tabs.clear();\n        this._activeTab = null;\n        this._tabBarElement = null;\n        this._contentElement = null;\n    }\n}\n", "/**\n * Modal window with tabbed interface\n *\n * Provides a full-screen overlay modal with tabs.\n * Single global modal instance - all tabs rendered in the same window.\n */\n\nimport { TabManager } from './tabs/tab-base.js';\n\nexport class Modal {\n    constructor() {\n        this.tabManager = new TabManager();\n        this._modalElement = null;\n        this._isVisible = false;\n        this._onCloseCallback = null;\n        this._wasPaused = false;\n    }\n\n    /**\n     * Initialize the modal with DOM elements\n     * Typically called after DOM is ready\n     */\n    initialize() {\n        this._modalElement = document.getElementById('modal-overlay');\n        if (!this._modalElement) {\n            console.error('Modal overlay element not found');\n            return;\n        }\n\n        const tabBar = document.getElementById('modal-tab-bar');\n        const content = document.getElementById('modal-content');\n\n        if (!tabBar || !content) {\n            console.error('Modal tab bar or content element not found');\n            return;\n        }\n\n        // Initialize tab manager UI\n        this.tabManager.initializeUI(tabBar, content);\n\n        // Setup close button\n        const closeButton = document.getElementById('modal-close');\n        if (closeButton) {\n            closeButton.addEventListener('click', () => this.hide());\n        }\n\n        // Close on overlay click (not content click)\n        this._modalElement.addEventListener('click', (e) => {\n            if (e.target === this._modalElement) {\n                this.hide();\n            }\n        });\n\n        // Close on Escape key\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && this._isVisible) {\n                this.hide();\n            }\n        });\n    }\n\n    /**\n     * Register a tab with the modal\n     * @param {Tab} tab - Tab instance to register\n     */\n    registerTab(tab) {\n        this.tabManager.register(tab);\n    }\n\n    /**\n     * Show the modal and optionally activate a specific tab\n     * @param {string} [tabId] - Optional tab ID to activate on show\n     * @param {string} [section] - Optional section ID within the tab (e.g., 'integrators')\n     */\n    show(tabId = null, section = null) {\n        if (!this._modalElement) {\n            console.error('Modal not initialized');\n            return;\n        }\n\n        // If no tab specified, activate first tab\n        if (!tabId) {\n            const tabs = this.tabManager.getAllTabs();\n            if (tabs.length > 0) {\n                tabId = tabs[0].id;\n            }\n        }\n\n        // Activate the tab\n        if (tabId) {\n            this.tabManager.activate(tabId);\n\n            // If a section is specified, navigate to it\n            if (section) {\n                const tab = this.tabManager.getAllTabs().find(t => t.id === tabId);\n                if (tab && typeof tab.openToSection === 'function') {\n                    // If tab is already rendered, open to section immediately\n                    if (tab.isRendered) {\n                        tab.openToSection(section);\n                    } else {\n                        // Otherwise, set it as pending for when tab activates\n                        if (typeof tab.setPendingSection === 'function') {\n                            tab.setPendingSection(section);\n                        }\n                    }\n                }\n            }\n        }\n\n        // Show modal\n        this._modalElement.style.display = 'flex';\n        this._isVisible = true;\n\n        // Prevent body scrolling while modal is open\n        document.body.style.overflow = 'hidden';\n\n        // Pause rendering\n        if (window.renderer && window.renderer.isRunning) {\n            window.renderer.stop();\n            this._wasPaused = false; // Renderer was running, we paused it\n        } else {\n            this._wasPaused = true; // Renderer was already paused\n        }\n    }\n\n    /**\n     * Hide the modal\n     */\n    hide() {\n        if (!this._modalElement) return;\n\n        this._modalElement.style.display = 'none';\n        this._isVisible = false;\n\n        // Re-enable body scrolling\n        document.body.style.overflow = '';\n\n        // Resume rendering if it was running before we paused it\n        if (window.renderer && !this._wasPaused) {\n            window.renderer.start();\n        }\n\n        // Call close callback if set\n        if (this._onCloseCallback) {\n            this._onCloseCallback();\n        }\n    }\n\n    /**\n     * Check if modal is currently visible\n     * @returns {boolean}\n     */\n    isVisible() {\n        return this._isVisible;\n    }\n\n    /**\n     * Set callback to be called when modal is closed\n     * @param {Function} callback\n     */\n    onClose(callback) {\n        this._onCloseCallback = callback;\n    }\n\n    /**\n     * Get the active tab\n     * @returns {Tab|null}\n     */\n    getActiveTab() {\n        return this.tabManager.getActiveTab();\n    }\n}\n\n// Global modal instance\nlet globalModal = null;\n\n/**\n * Get or create the global modal instance\n * @returns {Modal}\n */\nexport function getModal() {\n    if (!globalModal) {\n        globalModal = new Modal();\n    }\n    return globalModal;\n}\n\n/**\n * Initialize the global modal\n * Should be called after DOM is ready\n */\nexport function initializeModal() {\n    const modal = getModal();\n    modal.initialize();\n    return modal;\n}\n", "/**\n * Custom Functions tab for the modal window\n *\n * Allows users to define custom mathematical functions that can be used\n * in vector field expressions, color expressions, and mapper functions.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class CustomFunctionsTab extends Tab {\n    constructor(mathParser, debouncedApply) {\n        super('custom-functions', 'Custom Functions');\n        this.mathParser = mathParser;\n        this.debouncedApply = debouncedApply;\n\n        // UI elements (created in render())\n        this.textarea = null;\n        this.applyButton = null;\n        this.errorDiv = null;\n        this.successDiv = null;\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'custom-functions-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        content.innerHTML = `\n            <div class=\"info\" style=\"margin-bottom: 16px;\">\n                Define custom functions using mathematical syntax. Functions can be used in vector field expressions, color expressions, and mapper functions.\n            </div>\n\n            <h4 style=\"margin: 0 0 12px 0; padding: 0; font-size: 14px; color: #4CAF50;\">Syntax</h4>\n            <div class=\"info\" style=\"margin-bottom: 16px; font-family: monospace; background: #000; padding: 8px; border-radius: 4px; font-size: 11px;\">\n                functionName(arg1, arg2, ...) = expression<br>\n                <br>\n                <span style=\"color: #888;\">Examples:</span><br>\n                <span style=\"color: #4CAF50;\">smoothstep(x, a, b) = ((x-a)/(b-a))^3 * (3 - 2*((x-a)/(b-a)))</span><br>\n                <span style=\"color: #4CAF50;\">lerp(a, b, t) = a * (1-t) + b * t</span><br>\n                <span style=\"color: #4CAF50;\">sqr(x) = x * x</span><br>\n                <span style=\"color: #4CAF50;\">cube(x) = x * x * x</span>\n            </div>\n\n            <h4 style=\"margin: 0 0 8px 0; padding: 0; font-size: 14px; color: #4CAF50;\">Function Definitions</h4>\n            <div class=\"control-group\">\n                <textarea id=\"custom-functions-textarea\"\n                    rows=\"12\"\n                    style=\"width: 100%; font-family: 'Courier New', monospace; font-size: 12px; background: #1a1a1a; color: #4CAF50; border: 1px solid #444; border-radius: 4px; padding: 10px; resize: vertical;\"\n                    placeholder=\"Enter custom function definitions (one per line)...&#10;&#10;Example:&#10;smoothstep(x, a, b) = ((x-a)/(b-a))^3 * (3 - 2*((x-a)/(b-a)))\"></textarea>\n                <div class=\"info\">One function per line. Use standard math operators (+, -, *, /, ^) and built-in functions (sin, cos, exp, log, sqrt, abs, etc.)</div>\n            </div>\n\n            <div class=\"control-group\" style=\"margin-top: 12px;\">\n                <button id=\"apply-custom-functions\" style=\"width: 100%; padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;\">\n                    Apply Functions\n                </button>\n            </div>\n\n            <div id=\"custom-functions-error\" style=\"display: none; margin-top: 12px; padding: 8px; background: rgba(244, 67, 54, 0.1); border: 1px solid #f44336; border-radius: 4px; color: #f44336; font-size: 11px;\"></div>\n\n            <div id=\"custom-functions-success\" style=\"display: none; margin-top: 12px; padding: 8px; background: rgba(76, 175, 80, 0.1); border: 1px solid #4CAF50; border-radius: 4px; color: #4CAF50; font-size: 11px;\"></div>\n        `;\n\n        container.appendChild(content);\n\n        // Get references to UI elements\n        this.textarea = content.querySelector('#custom-functions-textarea');\n        this.applyButton = content.querySelector('#apply-custom-functions');\n        this.errorDiv = content.querySelector('#custom-functions-error');\n        this.successDiv = content.querySelector('#custom-functions-success');\n\n        // Setup event listeners\n        this.applyButton.addEventListener('click', () => this._applyFunctions());\n\n        // Load saved functions from localStorage\n        this._loadSavedFunctions();\n\n        return content;\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Attach unicode autocomplete if available\n        if (window.unicodeAutocomplete) {\n            window.unicodeAutocomplete.attachToAll('#custom-functions-textarea');\n        }\n    }\n\n    /**\n     * Apply the custom functions\n     * @private\n     */\n    _applyFunctions() {\n        const functionsText = this.textarea.value;\n        this.errorDiv.style.display = 'none';\n        this.successDiv.style.display = 'none';\n\n        try {\n            // Parse and validate custom functions\n            this.mathParser.setCustomFunctions(functionsText);\n\n            // Show success message\n            const functionCount = functionsText.trim()\n                ? functionsText.trim().split('\\n').filter(line => line.trim() && !line.trim().startsWith('//')).length\n                : 0;\n            this.successDiv.textContent = `\u2713 Successfully loaded ${functionCount} custom function(s)`;\n            this.successDiv.style.display = 'block';\n\n            // Save to localStorage\n            localStorage.setItem('customFunctions', functionsText);\n\n            // Trigger re-render\n            this.debouncedApply();\n        } catch (error) {\n            // Show error message\n            this.errorDiv.textContent = `Error: ${error.message}`;\n            this.errorDiv.style.display = 'block';\n        }\n    }\n\n    /**\n     * Load saved functions from localStorage\n     * @private\n     */\n    _loadSavedFunctions() {\n        const savedFunctions = localStorage.getItem('customFunctions');\n        if (savedFunctions && this.textarea) {\n            this.textarea.value = savedFunctions;\n            try {\n                this.mathParser.setCustomFunctions(savedFunctions);\n            } catch (error) {\n                console.error('Error loading saved custom functions:', error);\n            }\n        }\n    }\n}\n", "/**\n * Debug Console tab for the modal window\n *\n * Provides debug logging, shader inspection, and performance monitoring.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class DebugTab extends Tab {\n    constructor(logger) {\n        super('debug', 'Debug Console');\n        this.logger = logger;\n\n        // UI elements (created in render())\n        this.debugToggle = null;\n        this.debugVerbosity = null;\n        this.debugOutput = null;\n        this.bufferSizeSpan = null;\n        this.bufferPercentSpan = null;\n        this.bufferStatusDiv = null;\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'debug-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        content.innerHTML = `\n            <div style=\"display: flex; align-items: center; margin-bottom: 16px;\">\n                <label style=\"display: flex; align-items: center; cursor: pointer;\">\n                    <input type=\"checkbox\" id=\"debug-toggle\" checked style=\"margin-right: 8px;\">\n                    <span style=\"font-weight: bold;\">Enable Debug Logging</span>\n                </label>\n            </div>\n\n            <div id=\"debug-controls\" style=\"display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;\">\n                <select id=\"debug-verbosity\" style=\"flex: 0 0 auto;\">\n                    <option value=\"info\">Info</option>\n                    <option value=\"debug\">Debug</option>\n                    <option value=\"verbose\">Verbose</option>\n                    <option value=\"warn\">Warnings Only</option>\n                    <option value=\"error\">Errors Only</option>\n                    <option value=\"silent\">Silent (Buffer)</option>\n                </select>\n                <button id=\"debug-log-update-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Particle integration shader (updates positions each frame)\">Update Shader</button>\n                <button id=\"debug-log-draw-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Particle rendering shaders (vertex + fragment for color/display)\">Draw Shaders</button>\n                <button id=\"debug-log-screen-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Screen fade shader (trail decay)\">Fade Shader</button>\n                <button id=\"debug-log-stats-shaders\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Velocity statistics shader (max velocity tracking)\">Velocity Stats</button>\n                <button id=\"debug-buffer-stats\" class=\"secondary\" style=\"padding: 4px 8px;\">Buffer Stats</button>\n                <button id=\"debug-copy\" class=\"secondary\" style=\"padding: 4px 8px;\">Copy Log</button>\n                <button id=\"debug-clear\" class=\"secondary\" style=\"padding: 4px 8px;\">Clear</button>\n            </div>\n\n            <div id=\"debug-buffer-status\" style=\"display: none; padding: 8px; background: #2a2a2a; border-radius: 4px; margin-bottom: 12px; font-size: 11px; color: #888;\">\n                <span style=\"color: #FFA726; font-weight: bold;\">SILENT MODE:</span>\n                Buffering <span id=\"buffer-size\" style=\"color: #4CAF50;\">0</span> logs\n                (<span id=\"buffer-percent\">0</span>% of max)\n                <button id=\"debug-flush-buffer\" class=\"secondary\" style=\"padding: 2px 6px; margin-left: 8px; font-size: 10px;\">Flush Buffer</button>\n                <button id=\"debug-clear-buffer\" class=\"secondary\" style=\"padding: 2px 6px; margin-left: 4px; font-size: 10px;\">Clear Buffer</button>\n            </div>\n\n            <div style=\"padding: 8px; margin-bottom: 12px; background: #1f1f1f; border-radius: 4px;\">\n                <label style=\"display: flex; align-items: center; cursor: pointer; font-size: 11px;\" title=\"Enable particle sampling and detailed logging (expensive GPU readback). Buffer stats for tone mapping are always enabled but optimized.\">\n                    <input type=\"checkbox\" id=\"debug-enable-stats\" style=\"margin-right: 6px;\">\n                    <span>Enable Particle Sampling (expensive GPU readback)</span>\n                </label>\n            </div>\n\n            <div id=\"debug-output\" style=\"background: #0a0a0a; border: 1px solid #333; border-radius: 4px; padding: 12px; height: calc(100vh - 450px); overflow-y: auto; font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.4;\"></div>\n        `;\n\n        container.appendChild(content);\n\n        // Get references to UI elements\n        this.debugToggle = content.querySelector('#debug-toggle');\n        this.debugVerbosity = content.querySelector('#debug-verbosity');\n        this.debugOutput = content.querySelector('#debug-output');\n        this.bufferSizeSpan = content.querySelector('#buffer-size');\n        this.bufferPercentSpan = content.querySelector('#buffer-percent');\n        this.bufferStatusDiv = content.querySelector('#debug-buffer-status');\n\n        // Setup event listeners\n        this._setupEventListeners(content);\n\n        // Initialize logger with current DOM values\n        this.logger.setEnabled(this.debugToggle.checked);\n        const initialVerbosity = this.debugVerbosity.value;\n        this.logger.setVerbosity(initialVerbosity);\n\n        // Show buffer status if starting in silent mode\n        if (initialVerbosity === 'silent') {\n            this.bufferStatusDiv.style.display = 'block';\n            this._updateBufferStatus();\n        }\n\n        // Make logger output to this debug output div\n        this.logger.setOutputElement(this.debugOutput);\n\n        return content;\n    }\n\n    /**\n     * Setup event listeners for debug controls\n     * @private\n     */\n    _setupEventListeners(content) {\n        // Toggle debug logging\n        this.debugToggle.addEventListener('change', () => {\n            this.logger.setEnabled(this.debugToggle.checked);\n            this.logger.info('Debug logging ' + (this.debugToggle.checked ? 'enabled' : 'disabled'));\n        });\n\n        // Change verbosity\n        this.debugVerbosity.addEventListener('change', () => {\n            const verbosity = this.debugVerbosity.value;\n            this.logger.setVerbosity(verbosity);\n            this.logger.info('Verbosity set to: ' + verbosity);\n\n            // Show/hide buffer status indicator\n            if (verbosity === 'silent') {\n                this.bufferStatusDiv.style.display = 'block';\n                this._updateBufferStatus();\n            } else {\n                this.bufferStatusDiv.style.display = 'none';\n            }\n        });\n\n        // Copy log to clipboard\n        content.querySelector('#debug-copy').addEventListener('click', () => {\n            const logs = this.logger.getLogs();\n            let logText = 'N-Dimensional Vector Field Renderer - Debug Log\\n';\n            logText += '='.repeat(60) + '\\n\\n';\n\n            for (const log of logs) {\n                logText += `[${log.timestamp}] [${log.level.toUpperCase()}] ${log.message}`;\n                if (log.data) {\n                    const dataStr = typeof log.data === 'object' ?\n                        JSON.stringify(log.data) :\n                        String(log.data);\n                    logText += ` | Data: ${dataStr}`;\n                }\n                if (log.stack) {\n                    logText += `\\nStack Trace:\\n${log.stack}`;\n                }\n                logText += '\\n';\n            }\n\n            // Copy to clipboard\n            navigator.clipboard.writeText(logText).then(() => {\n                this.logger.info('Log copied to clipboard (' + logs.length + ' entries)');\n            }).catch(err => {\n                this.logger.error('Failed to copy log to clipboard', err);\n            });\n        });\n\n        // Clear log\n        content.querySelector('#debug-clear').addEventListener('click', () => {\n            this.logger.clear();\n        });\n\n        // Flush buffer\n        content.querySelector('#debug-flush-buffer').addEventListener('click', () => {\n            this.logger.flush();\n            this._updateBufferStatus();\n        });\n\n        // Clear buffer\n        content.querySelector('#debug-clear-buffer').addEventListener('click', () => {\n            this.logger.clearSilencedBuffer();\n            this._updateBufferStatus();\n        });\n\n        // Shader logging buttons\n        content.querySelector('#debug-log-update-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logUpdateShader === 'function') {\n                window.renderer.logUpdateShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log update shader');\n            }\n        });\n\n        content.querySelector('#debug-log-draw-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logDrawShader === 'function') {\n                window.renderer.logDrawShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log draw shader');\n            }\n        });\n\n        content.querySelector('#debug-log-screen-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logScreenShader === 'function') {\n                window.renderer.logScreenShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log screen shader');\n            }\n        });\n\n        content.querySelector('#debug-log-stats-shaders').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logStatsShaders === 'function') {\n                window.renderer.logStatsShaders();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log stats shaders');\n            }\n        });\n\n        content.querySelector('#debug-buffer-stats').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logBufferStats === 'function') {\n                window.renderer.logBufferStats();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log buffer stats');\n            }\n        });\n\n        // Enable/disable stats\n        content.querySelector('#debug-enable-stats').addEventListener('change', (e) => {\n            if (window.renderer) {\n                const enabled = e.target.checked;\n                window.renderer.enableDebugStats = enabled;\n                this.logger.info(`GPU debug stats ${enabled ? 'ENABLED' : 'DISABLED'}`);\n            }\n        });\n    }\n\n    /**\n     * Update buffer status display\n     * @private\n     */\n    _updateBufferStatus() {\n        const stats = this.logger.getBufferStats();\n        this.bufferSizeSpan.textContent = stats.bufferSize;\n        this.bufferPercentSpan.textContent = stats.bufferUsagePercent;\n\n        // Update color based on buffer usage\n        if (stats.bufferUsagePercent > 80) {\n            this.bufferSizeSpan.style.color = '#EF5350'; // Red when near full\n        } else if (stats.bufferUsagePercent > 50) {\n            this.bufferSizeSpan.style.color = '#FFA726'; // Orange when half full\n        } else {\n            this.bufferSizeSpan.style.color = '#4CAF50'; // Green when plenty of space\n        }\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Start periodic buffer status updates if in silent mode\n        if (!this._bufferUpdateInterval) {\n            this._bufferUpdateInterval = setInterval(() => {\n                if (this.logger.isSilenced() && this._isActive) {\n                    this._updateBufferStatus();\n                }\n            }, 1000);\n        }\n    }\n\n    /**\n     * Called when tab becomes inactive\n     */\n    onDeactivate() {\n        // Stop buffer status updates\n        if (this._bufferUpdateInterval) {\n            clearInterval(this._bufferUpdateInterval);\n            this._bufferUpdateInterval = null;\n        }\n    }\n\n    /**\n     * Clean up resources\n     */\n    destroy() {\n        if (this._bufferUpdateInterval) {\n            clearInterval(this._bufferUpdateInterval);\n            this._bufferUpdateInterval = null;\n        }\n        super.destroy();\n    }\n}\n", "/**\n * Documentation tab for the modal window\n *\n * Provides organized documentation with collapsible sections.\n * Can be opened to specific sections via anchor links from help icons.\n * Loads documentation from markdown files.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class DocsTab extends Tab {\n    constructor() {\n        super('docs', 'Documentation');\n        this.sections = [];\n\n        // Define documentation sections\n        this.sectionDefinitions = [\n            { id: 'display-options', title: 'Display Options & UI Controls', file: 'docs/display-options.md' },\n            { id: 'vector-fields', title: 'Vector Fields', file: 'docs/vector-fields.md' },\n            { id: 'integrators', title: 'Integration Methods', file: 'docs/integrators.md' },\n            { id: 'color-modes', title: 'Color Modes', file: 'docs/color-modes.md' },\n            { id: 'projection', title: '2D Projection', file: 'docs/projection.md' },\n            { id: 'coordinate-systems', title: 'Coordinate Systems', file: 'docs/coordinate-systems.md' },\n            { id: 'domain-transforms', title: 'Domain Transforms', file: 'docs/domain-transforms.md' },\n            { id: 'hdr-rendering', title: 'HDR & Tone Mapping', file: 'docs/hdr-rendering.md' },\n            { id: 'rendering-effects', title: 'Rendering Effects', file: 'docs/rendering-effects.md' },\n            { id: 'particle-settings', title: 'Particle Settings', file: 'docs/particle-settings.md' },\n            { id: 'animation', title: 'Animation System', file: 'docs/animation.md' },\n            { id: 'preset-management', title: 'Preset Management', file: 'docs/preset-management.md' },\n            { id: 'storage-strategy', title: 'Storage Strategy', file: 'docs/storage-strategy.md' },\n            { id: 'keyboard-shortcuts', title: 'Keyboard Shortcuts', file: 'docs/keyboard-shortcuts.md' }\n        ];\n    }\n\n    /**\n     * Load markdown file and convert to HTML\n     * @private\n     */\n    async _loadMarkdown(file) {\n        try {\n            const response = await fetch(file);\n            if (!response.ok) {\n                throw new Error(`Failed to load ${file}: ${response.statusText}`);\n            }\n            const markdown = await response.text();\n\n            // Parse markdown with marked.js\n            if (typeof marked === 'undefined') {\n                console.error('marked.js not loaded');\n                return `<p>Error: Markdown parser not available</p>`;\n            }\n\n            return marked.parse(markdown);\n        } catch (error) {\n            console.error('Error loading markdown:', error);\n            return `<p>Error loading documentation: ${error.message}</p>`;\n        }\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'docs-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        // Create container with loading message\n        content.innerHTML = `\n            <div class=\"docs-container\">\n                <p style=\"text-align: center; padding: 40px; color: #888;\">Loading documentation...</p>\n            </div>\n        `;\n\n        container.appendChild(content);\n\n        // Load all markdown files and render sections\n        this._loadAllSections(content);\n\n        return content;\n    }\n\n    /**\n     * Load all markdown sections asynchronously\n     * @private\n     */\n    async _loadAllSections(content) {\n        const docsContainer = content.querySelector('.docs-container');\n\n        // Load all sections\n        const sectionPromises = this.sectionDefinitions.map(async (def) => {\n            const html = await this._loadMarkdown(def.file);\n            return { id: def.id, title: def.title, html };\n        });\n\n        const sections = await Promise.all(sectionPromises);\n\n        // Render all sections\n        const sectionsHTML = sections.map(section =>\n            this._renderSection(section.id, section.title, section.html)\n        ).join('');\n\n        docsContainer.innerHTML = sectionsHTML;\n\n        // Setup collapsible sections\n        this._setupCollapsibles(content);\n\n        // If there's a pending section, open it now\n        if (this._pendingSection) {\n            this.openToSection(this._pendingSection);\n            this._pendingSection = null;\n        }\n    }\n\n    /**\n     * Render a collapsible documentation section\n     * @private\n     */\n    _renderSection(id, title, content) {\n        return `\n            <div class=\"docs-section collapsed\" id=\"docs-${id}\">\n                <div class=\"docs-section-header\">\n                    <h3>${title}</h3>\n                    <span class=\"docs-toggle\">\u25B6</span>\n                </div>\n                <div class=\"docs-section-content\" style=\"max-height: 0;\">\n                    ${content}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Setup collapsible section behavior\n     * @private\n     */\n    _setupCollapsibles(container) {\n        const headers = container.querySelectorAll('.docs-section-header');\n\n        headers.forEach(header => {\n            header.addEventListener('click', () => {\n                const section = header.parentElement;\n                const content = section.querySelector('.docs-section-content');\n                const toggle = header.querySelector('.docs-toggle');\n                const isCollapsed = section.classList.contains('collapsed');\n\n                if (isCollapsed) {\n                    section.classList.remove('collapsed');\n                    // Set a large initial max-height to allow content to render\n                    content.style.maxHeight = '5000px';\n                    toggle.textContent = '\u25BC';\n\n                    // After content has rendered, set to exact height for smooth future collapses\n                    setTimeout(() => {\n                        if (!section.classList.contains('collapsed')) {\n                            content.style.maxHeight = content.scrollHeight + 'px';\n                        }\n                    }, 350);\n                } else {\n                    section.classList.add('collapsed');\n                    content.style.maxHeight = '0';\n                    toggle.textContent = '\u25B6';\n                }\n            });\n        });\n    }\n\n    /**\n     * Open to a specific section\n     * @param {string} sectionId - Section ID (e.g., 'integrators')\n     */\n    openToSection(sectionId) {\n        if (!this._contentElement) return;\n\n        const section = this._contentElement.querySelector(`#docs-${sectionId}`);\n        if (!section) {\n            console.warn(`Documentation section '${sectionId}' not found`);\n            return;\n        }\n\n        // Expand the section if collapsed\n        if (section.classList.contains('collapsed')) {\n            const header = section.querySelector('.docs-section-header');\n            header.click();\n        }\n\n        // Scroll to section after expansion animation completes\n        setTimeout(() => {\n            section.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }, 400);\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Check if we need to open to a specific section\n        if (this._pendingSection) {\n            this.openToSection(this._pendingSection);\n            this._pendingSection = null;\n        }\n    }\n\n    /**\n     * Set a section to open when tab becomes active\n     * @param {string} sectionId - Section ID\n     */\n    setPendingSection(sectionId) {\n        this._pendingSection = sectionId;\n    }\n}\n"],
  "mappings": "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",
  "names": ["DebugLogger", "logger", "init_debug_logger", "__esmMin", "element", "enabled", "level", "wasSilent", "isSilent", "bufferSize", "consoleMethod", "logEntry", "consoleMsg", "count", "levels", "message", "data", "silenceable", "timestamp", "stack", "output", "log", "logDiv", "dataStr", "dataSpan", "stackBtn", "stackDiv", "self", "args", "arg", "optimizePowerExpressions", "expr", "match", "base", "exp", "n", "computeSymbolicJacobian", "expressions", "dimensions", "logger", "test1", "test2", "e", "expressionsForDiff", "replaced", "jacobian", "i", "row", "j", "variable", "VARIABLE_NAMES", "derivative", "optimized", "error", "isValidJacobian", "entry", "invertJacobian", "matrixArgs", "result", "element", "init_jacobian", "__esmMin", "init_debug_logger", "detectAtan2Patterns", "expression", "patterns", "regex", "match", "generateAlternativeChart", "forwardTransforms", "atan2Info", "numerator", "denominator", "fullMatch", "swappedAtan2", "alternativeTransforms", "expr", "generateCharts", "dimensions", "charts", "allAtan2Patterns", "index", "pattern", "azimuthalAtan2", "generateGLSLCondition", "condition", "cartesianVars", "glslCondition", "varName", "swizzle", "init_coordinate_charts", "__esmMin", "coordinate_systems_exports", "__export", "CoordinateSystem", "PRESET_COORDINATE_SYSTEMS", "createCartesianSystem", "getCartesianSystem", "getCoordinateSystem", "getPresetsForDimension", "key", "dimensions", "presets", "system", "varNames", "v", "init_coordinate_systems", "__esmMin", "init_jacobian", "init_coordinate_charts", "_CoordinateSystem", "name", "variables", "forwardTransforms", "inverseTransforms", "useIterativeSolver", "charts", "generateCharts", "cartesianVars", "parseFunc", "nativeVars", "dimType", "transformCode", "expr", "i", "glsl", "jacobian", "computeSymbolicJacobian", "inverseJacobian", "invertJacobian", "swizzles", "matrixMultCode", "terms", "entry", "j", "row", "chartData", "chart", "index", "data", "chartCases", "glslCondition", "generateGLSLCondition", "keyword", "condPart", "chartDocs", "matType", "forwardTransformCode", "jacobianCode", "parsedEntry", "json", "float_packing_exports", "__export", "decodeFloatRGBA", "encodeFloatRGBA", "getDecodeGLSL", "getEncodeGLSL", "getFixedPointConstantsGLSL", "value", "out", "offset", "intValue", "r", "g", "b", "a", "init_float_packing", "__esmMin", "TextureManager", "gl", "dimensions", "resolution", "strategy", "i", "texture", "format", "enabled", "data", "ArrayType", "componentsPerValue", "dim0Data", "program", "uniformName", "location", "textureUnit", "dimension", "temp", "newResolution", "framebuffer", "init_debug_logger", "FramebufferManager", "gl", "width", "height", "config", "logger", "i", "texture", "minFilter", "magFilter", "index", "status", "errorMsg", "r", "g", "b", "a", "framebuffer", "init_debug_logger", "BloomManager", "gl", "width", "height", "config", "logger", "texture", "filter", "name", "status", "newBloomWidth", "newBloomHeight", "init_debug_logger", "TOKEN_TYPES", "OPERATORS", "BUILTIN_FUNCTIONS", "customFunctions", "CONSTANTS", "tokenize", "expr", "tokens", "i", "lastToken", "char", "num", "token", "name", "parse", "output", "operators", "peek", "consume", "o1", "o2", "op1", "op2", "op", "toJS", "rpn", "variables", "stack", "varSet", "v", "constMap", "b", "argCount", "getFunctionArgCount", "args", "funcName", "toGLSL", "useDirectMapping", "posVarName", "varMap", "swizzles", "velocityVars", "numStr", "a", "expMatch", "n", "glslFunc", "generateGLSLFunctionDeclarations", "availableVars", "declarations", "func", "bodyTokens", "bodyRpn", "bodyGLSL", "p", "parseExpression", "expression", "dimensions", "customVariables", "error", "getGLSLFunctionDeclarations", "parseVectorField", "expressions", "createVelocityEvaluators", "funcBody", "setCustomFunctions", "functionsText", "key", "lines", "lineNum", "line", "match", "functionName", "paramsStr", "body", "params", "param", "testTokens", "getCustomFunctions", "compileShader", "gl", "type", "source", "shader", "info", "addLineNumbers", "linkProgram", "vertexShader", "fragmentShader", "program", "createProgram", "vertexSource", "fragmentSource", "line", "i", "generateUpdateVertexShader", "generateUpdateFragmentShader", "dimensions", "velocityExpressions", "integratorCode", "strategy", "transformCode", "coordinateSystemCode", "positionUniforms", "_", "vecType", "readPositions", "swizzles", "velocityComponents", "expr", "hasCoordinateSystem", "coordinateSystemFunctions", "hasTransform", "transformFunctions", "velocityFunction", "v", "s", "customFunctions", "getGLSLFunctionDeclarations", "coord", "coords", "normalizeExpr", "generateDrawVertexShader", "mapperCode", "lineMode", "prevPositionUniforms", "generateDrawFragmentShader", "colorCode", "usesMaxVelocity", "generateScreenVertexShader", "generateScreenFadeFragmentShader", "generateTonemapFragmentShader", "tonemapCode", "generateBloomBrightPassShader", "generateBloomBlurShader", "horizontal", "radius", "generateBloomCombineShader", "generateBilateralFilterShader", "BilateralFilterManager", "gl", "width", "height", "config", "logger", "quadVertices", "status", "vertexShaderSource", "fragmentShaderSource", "createProgram", "inputTexture", "aPosLoc", "buffer", "init_debug_logger", "generateSMAAEdgeDetectionShader", "generateSMAABlendingWeightShader", "generateSMAANeighborhoodBlendingShader", "SMAAManager", "gl", "width", "height", "config", "logger", "quadVertices", "texture", "framebuffer", "status", "vertexShaderSource", "createProgram", "inputTexture", "targetFramebuffer", "quadBuffer", "program", "aPosLoc", "buffer", "init_debug_logger", "BufferStatsManager", "gl", "reductionVS", "reductionFS", "logger", "vsSource", "fsSource", "vs", "fs", "program", "sourceTexture", "width", "height", "coarse", "sampleRate", "fbo", "gridSize", "regionSize", "totalPixels", "allPixels", "pixelIndex", "gy", "gx", "x", "y", "regionPixels", "minR", "maxR", "sumR", "minG", "maxG", "sumG", "minB", "maxB", "sumB", "count", "i", "idx", "r", "g", "b", "avgR", "avgG", "avgB", "numBins", "histogram", "maxBright", "logMax", "brightness", "logBrightness", "binIndex", "tex", "init_debug_logger", "VelocityStatsManager", "gl", "dimensions", "velocityExpressions", "coordinateSystemCode", "logger", "vecType", "swizzles", "velocityComponents", "expr", "i", "hasCoordinateSystem", "velocityFunction", "vertexShader", "fragmentShader", "_", "vs", "fs", "positionTextures", "bbox", "resolution", "animationAlpha", "aPosLoc", "results", "velocities", "maxVel", "sumVel", "vel", "count", "avgVel", "percentile90", "percentile95", "a", "b", "idx90", "idx95", "init_debug_logger", "ParticleSystem", "particleCount", "dimensions", "bbox", "strategy", "debugSamples", "ArrayType", "componentsPerValue", "dim", "dimData", "i", "worldValue", "min", "range", "max", "encoded", "offset", "c", "buffer", "decodedWorld", "encodedStr", "logger", "s", "dimension", "newCount", "newDimensions", "newBBox", "init_jacobian", "init_debug_logger", "VARIABLE_NAMES", "generateMatrixInverseGLSL", "matType", "funcName", "code", "col", "row", "pivot", "generateJacobianGLSL", "jacobianMatrix", "dimensions", "vecType", "varDecls", "i", "matrixElements", "symbolicExpr", "glslExpr", "parseExpression", "error", "logger", "generateFixedPointSolverBody", "varName", "updateExprFn", "updateExpr", "generateMidpointSolverBody", "predName", "midName", "updateExprPred", "updateExprMid", "generateNewtonSolverBody", "residualExprFn", "jacobianExprFn", "inverseFuncName", "residualExpr", "jacobianExpr", "generateNewtonFDSolverBody", "velocityExprFn", "hScale", "residualRHS", "coords", "epsilon", "jacobianCode", "dfColumns", "colName", "perturbation", "_", "velocityAtPerturbed", "velocityAtCurrent", "currentVel", "residual", "eulerIntegrator", "explicitMidpointIntegrator", "heunIntegrator", "rk4Integrator", "implicitEulerIntegrator", "iterations", "solutionMethod", "expressions", "initialGuess", "v", "solverBody", "solverName", "jacobianGLSL", "jacobian", "computeSymbolicJacobian", "isValidJacobian", "implicitMidpointIntegrator", "trapezoidalIntegrator", "implicitRK4Integrator", "coeffsGLSL", "initialGuessGLSL", "k1_updateFn", "k2_updateFn", "k1_velocityFn", "k2_velocityFn", "k1_solverBody", "k2_solverBody", "k1_residualFn", "k1_jacobianFn", "k2_residualFn", "k2_jacobianFn", "solverCode", "getIntegrator", "name", "params", "selectMapper", "dim1", "dim2", "totalDims", "depthDim", "hasDepth", "linearProjectionMapper", "matrix", "dimensions", "row1", "val", "i", "row2", "row3", "orthographicMapper", "axis", "sphericalMapper", "stereographicMapper", "getMapper", "type", "params", "horizontalExpr", "verticalExpr", "depthExpr", "customMapper", "horizontalGLSL", "parseExpression", "verticalGLSL", "depthGLSL", "Transform", "name", "description", "dimensions", "IdentityTransform", "vecType", "PowerTransform", "_", "i", "comp", "TanhTransform", "SigmoidTransform", "RationalTransform", "SineTransform", "RadialPowerTransform", "LogTransform", "ExpTransform", "SoftsignTransform", "CustomTransform", "forward", "inverse", "jacobian", "transforms", "getTransform", "getColorMode", "name", "dimensions", "vecType", "mode", "generateExpressionColorMode", "expressionGLSL", "gradientGLSL", "varDecls", "swizzles", "velocityVars", "i", "generateGradientColorMode", "modeName", "valueExpression", "generateGradientGLSL", "stops", "sortedStops", "a", "b", "stop", "code", "stop1", "stop2", "color1", "formatColor", "color2", "pos1", "pos2", "color", "getDefaultGradient", "getSpectrumGradient", "getSpectrumGradient", "hexToRgb", "hex", "r", "g", "b", "rgbToHex", "rgb", "getToneMapper", "name", "operators", "generateTonemapGLSL", "operatorName", "params", "operator", "exposure", "gamma", "whitePoint", "luminanceGamma", "code", "init_coordinate_systems", "init_debug_logger", "CoordinateStrategy", "gl", "worldValue", "min", "max", "buffer", "storageValue", "init_float_packing", "RGBAStrategy", "CoordinateStrategy", "gl", "worldValue", "min", "max", "normalized", "buffer", "encodeFloatRGBA", "decodeFloatRGBA", "init_debug_logger", "FloatStrategy", "CoordinateStrategy", "gl", "logger", "worldValue", "min", "max", "buffer", "storageValue", "Renderer", "canvas", "config", "gl", "strategyType", "FloatStrategy", "logger", "RGBAStrategy", "error", "getCartesianSystem", "coordinateVars", "createVelocityEvaluators", "getDefaultGradient", "supersampleFactor", "width", "ParticleSystem", "TextureManager", "canvasWidth", "canvasHeight", "FramebufferManager", "hdrSupport", "BloomManager", "SMAAManager", "BilateralFilterManager", "ldrFBStatus", "finalFBStatus", "BufferStatsManager", "VelocityStatsManager", "shaderError", "data", "buffer", "particleCount", "indices", "i", "vertexIds", "isCartesian", "posVarName", "velocityGLSL", "parseVectorField", "coordinateSystemCode", "cartesianVars", "nativeVars", "expr", "vars", "parseExpression", "integratorParams", "integrator", "getIntegrator", "mapper", "getMapper", "transformCode", "transform", "getTransform", "colorMode", "getColorMode", "colorCode", "usesMaxVelocity", "expressionGLSL", "gradientGLSL", "generateGradientGLSL", "generateExpressionColorMode", "generateGradientColorMode", "updateVertexShader", "generateUpdateVertexShader", "updateFragmentShader", "generateUpdateFragmentShader", "createProgram", "isLineMode", "drawVertexShader", "generateDrawVertexShader", "drawFragmentShader", "generateDrawFragmentShader", "screenVertexShader", "generateScreenVertexShader", "fadeFragmentShader", "generateScreenFadeFragmentShader", "tonemapCode", "generateTonemapGLSL", "tonemapFragmentShader", "generateTonemapFragmentShader", "bloomBrightPassShader", "generateBloomBrightPassShader", "bloomBlurHorizontalShader", "generateBloomBlurShader", "bloomBlurVerticalShader", "bloomCombineShader", "generateBloomCombineShader", "program", "aPosLoc", "resolution", "randSeed", "velocityScale", "alphaLoc", "params", "paramValues", "dim", "writeTexture", "posTextures", "stats", "alpha", "relativeChange", "changeThresholdHigh", "changeThresholdLow", "t", "aIndexLoc", "indexBuffer", "aVertexIdLoc", "currentTex", "bloomSize", "aPosLoc1", "blurFBOs", "blurTextures", "aPosLoc2", "aPosLoc3", "displayToCanvas", "filteredTexture", "currentInterval", "hdrTexture", "newStats", "velStats", "age", "dimensionData", "posStats", "componentsPerValue", "ArrayType", "positions", "pos", "texelIdx", "c", "min", "max", "worldValue", "sum", "dimName", "velocity", "position", "vel", "magnitudeSquared", "v", "magnitude", "samples", "particleIdx", "dim0Data", "ageValue", "r", "g", "b", "a", "loop", "now", "elapsed", "finalElapsed", "skipAutoRestart", "recompileShaders", "steps", "resolve", "reject", "pixels", "tempCanvas", "ctx", "imageData", "blob", "height", "needsRecompile", "validFactor", "e", "encodeFloatRGBA", "decodeFloatRGBA", "testValues", "maxError", "avgError", "errors", "problematic", "testVal", "decoded", "worldTests", "worldErrors", "worldVal", "normalized", "worldDecoded", "currentIndex", "pixelCount", "isHDR", "minR", "minG", "minB", "maxR", "maxG", "maxB", "sumR", "sumG", "sumB", "maxBrightness", "pixelsAboveOne", "idx", "brightness", "avgR", "avgG", "avgB", "velShader", "bufferShader", "screenX", "screenY", "fbX", "fbY", "glY", "result", "hdrFramebuffer", "init_coordinate_systems", "Control", "id", "defaultValue", "options", "value", "callback", "event", "element", "offset", "action", "settings", "SliderControl", "v", "sliderValue", "currentValue", "min", "max", "step", "increment", "newValue", "handler", "LogSliderControl", "minLog", "scale", "actualValue", "currentSliderValue", "newSliderValue", "TextControl", "SelectControl", "CheckboxControl", "PercentSliderControl", "ControlManager", "options", "control", "controls", "debouncedCallback", "settings", "id", "coordSystemData", "coordinateSystem", "CoordinateSystem", "expressionsControl", "error", "saved", "resizeAccordion", "selectorOrElement", "delay", "$element", "$accordionSection", "AnimatableSliderControl", "_AnimatableSliderControl", "SliderControl", "id", "defaultValue", "options", "enabled", "min", "max", "alpha", "value", "indicator", "minHandle", "maxHandle", "minDisplay", "maxDisplay", "range", "minSliderValue", "maxSliderValue", "minPercent", "maxPercent", "boundsContainer", "animBtn", "resizeAccordion", "callback", "container", "e", "boundsHTML", "track", "handle", "bound", "isDragging", "mousePos", "trackWidth", "newPercent", "sliderValue", "actualValue", "settings", "animData", "controlManager", "animatable", "control", "AnimatableTimestepControl", "AnimatableSliderControl", "id", "defaultValue", "options", "action", "element", "currentValue", "min", "max", "increment", "newValue", "createScientificFormatter", "precision", "threshold", "v", "absV", "createDecimalFormatter", "createIntegerFormatter", "inferScaleType", "min", "max", "step", "calculateAdaptiveIncrement", "currentValue", "baseStep", "isLarge", "absValue", "increment", "calculateLogIncrement", "calculateLinearIncrement", "createFormatterFromDef", "paramDef", "ParameterControl", "Control", "id", "parameterDef", "defaultValue", "options", "inferScaleType", "createFormatterFromDef", "currentValue", "isLarge", "calculateAdaptiveIncrement", "calculateLogIncrement", "calculateLinearIncrement", "action", "element", "min", "max", "newValue", "increment", "displayId", "callback", "value", "AnimatableParameterControl", "range", "enabled", "alpha", "indicator", "minHandle", "maxHandle", "minDisplay", "maxDisplay", "minPercent", "maxPercent", "boundsContainer", "animBtn", "resizeAccordion", "e", "boundsHTML", "controlGroup", "track", "handle", "bound", "isDragging", "startX", "startLeft", "trackOffset", "trackWidth", "newPercent", "actualValue", "settings", "animData", "init_debug_logger", "DimensionInputsControl", "Control", "defaultValue", "options", "dimensionsControl", "coordinateSystem", "updateUI", "dimensions", "expressions", "expr", "newValues", "logger", "container", "valuesToUse", "firstElement", "error", "i", "varName", "div", "resizeAccordion", "callback", "MapperParamsControl", "mapperControl", "mapper", "horizontalElement", "verticalElement", "depthElement", "dim1Element", "dim2Element", "dim1", "dim2", "params", "row", "group1", "select1", "currentDim1", "selected", "group2", "select2", "currentDim2", "info", "varNames", "currentHorizontal", "input1", "currentVertical", "input2", "group3", "currentDepth", "input3", "GradientControl", "gradientEditor", "gradient", "newGradient", "settings", "TransformParamsControl", "transformControl", "values", "controlId", "paramControl", "paramName", "transformType", "transform", "getTransform", "paramDefs", "paramDef", "index", "AnimatableParameterControl", "value", "sliderId", "action", "control", "initGradientEditor", "containerId", "initialGradient", "onChange", "container", "gradient", "stop", "render", "sorted", "a", "b", "html", "index", "actualIndex", "hex", "rgbToHex", "renderPreview", "attachEventListeners", "preview", "stops", "hexToRgb", "pos", "newPos", "maxGap", "gapPos", "i", "gap", "newColor", "interpolateGradient", "t", "t1", "t2", "segmentT", "c1", "c2", "newGradient", "init_coordinate_systems", "init_debug_logger", "solveInverseSymbolically", "forwardTransforms", "dimensions", "cartesianVars", "nativeVars", "logger", "inverseTransforms", "isValidPolarTransform", "isValidCylindricalTransform", "isValidSphericalTransform", "i", "cartesianVar", "solved", "j", "nativeVar", "forwardExpr", "equation", "solutions", "solStr", "v", "idx", "e", "error", "transforms", "r", "theta", "hasRadialTerm", "hasAngleTerm", "rho", "phi", "z", "hasZTerm", "hasPolarAngleTerm", "hasAzimuthalTerm", "initCoordinateEditor", "containerId", "dimensions", "initialSystem", "onChange", "container", "currentSystem", "getCartesianSystem", "currentDimensions", "editor", "render", "update", "setDimensions", "presets", "getPresetsForDimension", "html", "currentPresetKey", "key", "system", "PRESET_COORDINATE_SYSTEMS", "i", "variable", "transform", "cartesianVar", "useIterative", "inverseTransform", "nativeVars", "v", "attachEventListeners", "presetKey", "preset", "index", "label", "button", "originalText", "cartesianVars", "inverseTransforms", "solveInverseSymbolically", "error", "validateSystem", "transformsWithAscii", "inverseTransformsWithAscii", "systemToApply", "CoordinateSystem", "newSystem", "newDimensions", "showCoordinateEditor", "onApply", "panel", "isDragging", "dragOffsetX", "dragOffsetY", "e", "init_coordinate_systems", "init_debug_logger", "initControls", "renderer", "callback", "manager", "ControlManager", "settings", "settingsToSave", "hideError", "dimensionsControl", "SliderControl", "v", "value", "logger", "expressionsControl", "mapperParamsControl", "integratorControl", "SelectControl", "isImplicit", "resizeAccordion", "solutionMethodControl", "timestepControl", "AnimatableTimestepControl", "implicitIterationsControl", "particleCountControl", "fadeControl", "AnimatableSliderControl", "sliderValue", "minLog", "scale", "dropControl", "dropLowVelocityControl", "CheckboxControl", "transformControl", "transformParamsControl", "TransformParamsControl", "mapperControl", "MapperParamsControl", "colorModeControl", "updateExpressionControls", "updateGradientButtonVisibility", "updateVelocityScalingVisibility", "colorExpressionControl", "TextControl", "useCustomGradientControl", "gradientControl", "GradientControl", "getDefaultGradient", "velocityScaleModeControl", "velocityLogScaleControl", "DimensionInputsControl", "useHDRControl", "useDepthTestControl", "supersampleFactorControl", "smaaEnabledControl", "smaaIntensityControl", "PercentSliderControl", "smaaThresholdControl", "bilateralEnabledControl", "BilateralSpatialControl", "element", "bilateralSpatialControl", "BilateralIntensityControl", "bilateralIntensityControl", "tonemapOperatorControl", "updateWhitePointVisibility", "exposureControl", "LogSliderControl", "gammaControl", "luminanceGammaControl", "highlightCompressionControl", "compressionThresholdControl", "whitePointControl", "particleIntensityControl", "particleSizeControl", "particleRenderModeControl", "colorSaturationControl", "brightnessDesatControl", "saturationBuildupControl", "bloomEnabledControl", "bloomIntensityControl", "bloomRadiusControl", "bloomAlphaControl", "frameLimitEnabledControl", "enabled", "limitValue", "frameLimitControl", "animationRunning", "animationFrameId", "animationDirection", "animationStepsPerIncrement", "animationStepCounter", "shaderLockWasEnabled", "ALPHA_STEP_TIME_TARGET_PERCENTILE", "ALPHA_STEP_TIME_DECAY", "ALPHA_STEP_TIME_UPWARD", "ALPHA_STEP_TIME_WARMUP_CYCLES", "ALPHA_STEP_TIME_DISPLAY_INTERVAL", "alphaStepTimeEMA", "alphaStepStartTime", "alphaStepWarmupCounter", "alphaStepDisplayCounter", "cachedAnimatableControls", "cachedAnimatableParams", "lastAppliedSettings", "savedLoggerVerbosity", "SHADER_RECOMPILE_SETTINGS", "animAlphaContainer", "animSpeedContainer", "animationAlphaControl", "control", "paramControl", "animationSpeedControl", "themeControl", "presetName", "loadPreset", "loadCustomPresets", "preset", "saveCustomPreset", "refreshCustomPresetsDropdown", "deleteCustomPreset", "shareSettings", "canvas", "width", "blob", "url", "link", "timestamp", "resolution", "error", "currentStrategy", "newStrategy", "sliderId", "action", "gradientEditor", "showGradientPanel", "panel", "initGradientEditor", "newGradient", "hideGradientPanel", "currentDimensions", "currentSystem", "getCartesianSystem", "showCoordinateEditor", "newSystem", "e", "openButton", "showRenderingPanel", "hideRenderingPanel", "content", "arrow", "histogram", "cursor", "capturedFrames", "frameCaptureMode", "frameCaptureTotal", "frameCaptureCount", "frameCaptureAlphaIncrement", "startAnimation", "options", "captureFrames", "totalFrames", "loops", "halfLoops", "onProgress", "onComplete", "AnimatableParameterControl", "animationLoop", "freezeScreen", "smoothTiming", "alphaStepElapsed", "currentValue", "i", "changedSettings", "newValue", "paramKey", "stopAnimation", "delayNeeded", "btn", "infoText", "createBtn", "framesInput", "loopsInput", "halfLoopsCheckbox", "downloadBtn", "progressContainer", "progressBar", "progressText", "progressAlpha", "isHalfLoops", "frameCount", "alpha", "progress", "frames", "numParts", "part", "startIdx", "endIdx", "zip", "framesFolder", "paddedIndex", "zipBlob", "partSuffix", "resolve", "animationTemplate", "a", "renderingPanel", "renderingButton", "mobileRenderingButton", "savedSettings", "loadSettingsFromURLOrStorage", "coordSystemData", "transform", "coordinateSystem", "CoordinateSystem", "cartesianSystem", "expr", "params", "currentIntegrator", "loadPresets", "saveAllSettings", "initMobilePanelManager", "panels", "currentPanel", "showPanel", "panelName", "hidePanel", "operator", "hideAllPanels", "panelId", "expandedBBox", "expandBBoxForAspectRatio", "bbox", "canvasAspect", "bboxWidth", "bboxHeight", "bboxAspect", "centerX", "centerY", "newWidth", "newHeight", "showWhitePoint", "colorMode", "urlParams", "urlSettings", "decodeSettings", "newSearch", "newUrl", "saved", "base64", "normalized", "json", "encodeSettings", "encoded", "storageParam", "shareUrl", "button", "originalText", "err", "tempInput", "success", "hideError", "loadPresets", "loadPreset", "name", "manager", "preset", "loadCustomPresets", "logger", "coordinateSystem", "CoordinateSystem", "getCartesianSystem", "expressionsControl", "mapperParamsControl", "transformParamsControl", "settings", "canvas", "expandedBBox", "expandBBoxForAspectRatio", "bboxWidth", "bboxHeight", "newWidth", "newHeight", "CUSTOM_PRESETS_KEY", "loadCustomPresets", "stored", "e", "saveCustomPreset", "name", "preset", "presets", "deleteCustomPreset", "refreshCustomPresetsDropdown", "customPresets", "$group", "presetNames", "displayName", "init_debug_logger", "init_debug_logger", "EASING_FUNCTIONS", "t", "c4", "Animator", "renderer", "controlManager", "scriptData", "i", "kf", "duration", "totalFrames", "logger", "time", "timeline", "prev", "next", "start", "end", "easingName", "easedT", "v", "endValue", "result", "key", "prevSettings", "nextSettings", "easing", "interpolated", "resolve", "frameNum", "frameConfig", "settings", "alpha", "progressCallback", "settingsWithoutCoordSystem", "CoordinateSystem", "coordSystem", "blob", "error", "JSZip", "zip", "filename", "metadata", "zipBlob", "url", "a", "Tab", "id", "title", "container", "TabManager", "tab", "tabId", "button", "tabBarElement", "contentElement", "isActive", "Modal", "TabManager", "tabBar", "content", "closeButton", "e", "tab", "tabId", "section", "tabs", "t", "callback", "globalModal", "getModal", "initializeModal", "modal", "CustomFunctionsTab", "Tab", "mathParser", "debouncedApply", "container", "content", "functionsText", "functionCount", "line", "error", "savedFunctions", "DebugTab", "Tab", "logger", "container", "content", "initialVerbosity", "verbosity", "logs", "logText", "log", "dataStr", "err", "e", "enabled", "stats", "DocsTab", "Tab", "file", "response", "markdown", "error", "container", "content", "docsContainer", "sectionPromises", "def", "html", "sectionsHTML", "section", "id", "title", "header", "toggle", "sectionId", "setCustomFunctions", "getCustomFunctions", "logger", "initRenderer", "callback", "canvas", "renderer", "resizeCanvas", "aspectRatio", "bbox", "centerX", "centerY", "newWidth", "storageStrategy", "Renderer", "error", "initUI", "manager", "initControls", "controlsData", "state", "saveSettings", "settings", "setupAnimationPanel", "loadPreset", "modal", "initializeModal", "debugTab", "DebugTab", "debouncedApply", "customFunctionsTab", "CustomFunctionsTab", "docsTab", "DocsTab", "setupPanZoom", "isDragging", "lastX", "lastY", "saveTimeout", "debouncedSave", "e", "dx", "dy", "width", "height", "scale", "zoomFactor", "rect", "mouseX", "mouseY", "newHeight", "ratioX", "ratioY", "lastTouchDistance", "distance", "zoomToCenter", "panView", "panX", "panY", "currentBBox", "currentWidth", "currentHeight", "setupGridAndCursor", "gridCanvas", "gridCtx", "cursorDiv", "showGrid", "cursorX", "cursorY", "resizeGridCanvas", "drawGrid", "screenToWorld", "screenX", "screenY", "worldX", "worldY", "worldToScreen", "getGridSpacing", "rawSpacing", "magnitude", "normalized", "spacing", "startX", "endX", "x", "screen", "label", "startY", "endY", "y", "origin", "updateCursorDisplay", "world", "canvasX", "canvasY", "pixelData", "displayText", "r", "g", "b", "fpsDisplay", "formatFrameCount", "count", "k", "updateFPS", "framesText", "histogramPanel", "histogramCanvas", "histogramCtx", "drawHistogram", "stats", "ctx", "dpr", "maxCount", "barWidth", "i", "barHeight", "setupKeyboardShortcuts", "openFloatingPanels", "animator", "file", "reader", "event", "scriptData", "Animator", "script", "duration", "totalFrames", "frameNum", "time", "percent", "initAccordion", "ACCORDION_STATE_KEY", "savedState", "saved", "index", "$header", "$section", "sectionId", "$h2", "$content", "isCurrentlyCollapsed", "updateMaxHeight"]
}
