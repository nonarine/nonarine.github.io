{
  "version": 3,
  "sources": ["../src/utils/debug-logger.js", "../src/math/parser.js", "../src/math/jacobian.js", "../src/math/coordinate-charts.js", "../src/math/coordinate-systems.js", "../src/utils/float-packing.js", "../src/ui/mixins/control-mixin.js", "../src/ui/mixins/animatable-mixin.js", "../src/ui/mixins/accordion-aware-mixin.js", "../src/ui/mixins/shadow-dom-mixin.js", "../src/ui/mixins/composite-mixin.js", "../src/ui/mixins/index.js", "../src/ui/web-components/base.js", "../src/ui/web-components/slider.js", "../src/ui/web-components/animatable-slider.js", "../src/webgl/textures.js", "../src/webgl/framebuffer.js", "../src/webgl/bilateral.js", "../src/webgl/shaders.js", "../src/webgl/smaa.js", "../src/webgl/buffer-stats.js", "../src/webgl/velocity-stats.js", "../src/particles/system.js", "../src/webgl/renderer.js", "../src/math/integrators.js", "../src/math/mappers.js", "../src/math/transforms.js", "../src/math/colors.js", "../src/math/gradients.js", "../src/math/tonemapping.js", "../src/webgl/coordinate-strategy.js", "../src/webgl/strategies/rgba-strategy.js", "../src/webgl/strategies/float-strategy.js", "../src/ui/control-base.js", "../src/ui/control-utilities.js", "../src/ui/accordion-utils.js", "../src/ui/parameter-control.js", "../src/ui/custom-controls.js", "../src/ui/gradient-editor.js", "../src/ui/coordinate-editor.js", "../src/math/inverse-solver.js", "../src/ui/controls-registry.js", "../src/math/glsl-workflow.js", "../src/math/glsl-generator.js", "../src/math/field-equation-generator.js", "../src/math/field-equation-workflow.js", "../src/ui/web-component-registry.js", "../src/ui/equation-overlay.js", "../src/utils/math-renderer.js", "../src/animation/animation-controller.js", "../src/ui/utils/z-index.js", "../src/ui/utils/mobile.js", "../src/ui/utils/panel-manager.js", "../src/ui/visibility-manager.js", "../src/ui/settings-manager.js", "../src/ui/preset-manager.js", "../src/ui/panel-controllers/gradient-panel.js", "../src/ui/panel-controllers/rendering-panel.js", "../src/ui/animation-setup.js", "../src/ui/panel-controllers/mobile-panel-manager.js", "../src/main.js", "../src/animation/animator.js", "../src/ui/tabs/tab-base.js", "../src/ui/modal.js", "../src/ui/tabs/notebook-debug-tab.js", "../src/ui/tabs/debug-tab.js", "../src/ui/tabs/docs-tab.js", "../src/ui/web-components/index.js", "../src/ui/web-components/log-slider.js", "../src/ui/web-components/percent-slider.js", "../src/ui/web-components/animatable-timestep.js", "../src/ui/web-components/animation-alpha.js", "../src/ui/web-components/animation-speed.js", "../src/ui/web-components/number-input.js", "../src/ui/web-components/action-button.js", "../src/ui/web-components/checkbox.js", "../src/ui/web-components/select-control.js", "../src/ui/web-components/mobile-controls.js", "../src/ui/notebook-editor.js", "../src/ui/components/notebook-modal.js", "../src/ui/components/notebook-repl.js", "../src/ui/components/notebook-cell.js", "../src/math/cas/cas-interface.js", "../src/math/cas/nerdamer-engine.js", "../src/math/cas/cas-factory.js", "../src/math/notebook.js", "../src/ui/components/math-to-glsl-control.js", "../src/ui/components/field-equations-editor.js"],
  "sourcesContent": ["/**\n * Debug logging utility\n */\n\nclass DebugLogger {\n    constructor() {\n        this.enabled = true;\n        this.verbosity = 'info'; // verbose, debug, info, warn, error\n        this.maxLogs = 100; // Display buffer size\n        this.logs = [];\n        this.consoleHooked = false;\n        this.originalConsole = {};\n        this.outputElement = null; // Can be set to a specific element, defaults to $('#debug-output')\n\n        // Restore line numbers setting from localStorage\n        this.showLineNumbers = false;\n        try {\n            const saved = localStorage.getItem('debugShowLineNumbers');\n            this.showLineNumbers = saved === 'true';\n        } catch (e) {\n            // Ignore localStorage errors\n        }\n\n        // Silent mode buffering\n        this.silenced = false;\n        this.silencedBuffer = [];\n        this.maxSilencedLogs = 5000; // Buffer more logs during silent mode\n    }\n\n    /**\n     * Set whether to show line numbers\n     */\n    setShowLineNumbers(show) {\n        this.showLineNumbers = show;\n        // Persist to localStorage\n        try {\n            localStorage.setItem('debugShowLineNumbers', show ? 'true' : 'false');\n        } catch (e) {\n            // Ignore localStorage errors\n        }\n    }\n\n    /**\n     * Extract caller information from stack trace\n     * @returns {string|null} Formatted caller info like \"renderer.js:123\"\n     */\n    _getCallerInfo() {\n        if (!this.showLineNumbers) return null;\n\n        try {\n            const stack = new Error().stack;\n            if (!stack) return null;\n\n            // Split stack into lines\n            const lines = stack.split('\\n');\n\n            // Find the first line that's NOT in debug-logger.js\n            // Stack typically looks like:\n            // Error\n            //   at DebugLogger.log (debug-logger.js:144)\n            //   at DebugLogger.info (debug-logger.js:200)\n            //   at SomeClass.someMethod (some-file.js:42)  <- This is the caller we want\n            for (let i = 0; i < lines.length; i++) {\n                const line = lines[i];\n                if (line.includes('debug-logger.js')) continue; // Skip logger itself\n\n                // Extract file:line from stack line\n                // Format: \"    at ClassName.methodName (http://localhost:8000/src/path/file.js:123:45)\"\n                const match = line.match(/([^\\/]+\\.js):(\\d+):\\d+\\)?$/);\n                if (match) {\n                    return `${match[1]}:${match[2]}`;\n                }\n            }\n            return null;\n        } catch (e) {\n            return null; // Stack trace extraction failed\n        }\n    }\n\n    /**\n     * Set the output element for log display\n     */\n    setOutputElement(element) {\n        this.outputElement = element;\n    }\n\n    /**\n     * Set whether logging is enabled\n     */\n    setEnabled(enabled) {\n        this.enabled = enabled;\n    }\n\n    /**\n     * Set verbosity level\n     */\n    setVerbosity(level) {\n        const wasSilent = this.verbosity === 'silent';\n        this.verbosity = level;\n        const isSilent = level === 'silent';\n\n        // If transitioning from silent to non-silent, flush buffer\n        if (wasSilent && !isSilent) {\n            this.unsilence();\n        } else if (!wasSilent && isSilent) {\n            this.silence();\n        }\n    }\n\n    /**\n     * Enter silent mode (buffer logs instead of displaying)\n     */\n    silence() {\n        if (this.silenced) return;\n        this.silenced = true;\n        this.info('Entering silent mode - logs will be buffered', null, false); // Not silenceable\n    }\n\n    /**\n     * Exit silent mode and flush buffered logs\n     */\n    unsilence() {\n        if (!this.silenced) return;\n        const bufferSize = this.silencedBuffer.length;\n        this.silenced = false;\n        this.flush();\n        this.info(`Exited silent mode - flushed ${bufferSize} buffered logs`, null, false); // Not silenceable\n    }\n\n    /**\n     * Flush silenced buffer to main logs and UI\n     */\n    flush() {\n        if (this.silencedBuffer.length === 0) return;\n\n        const bufferSize = this.silencedBuffer.length;\n        this.info(`Flushing ${bufferSize} silenced logs...`, null, false); // Not silenceable\n\n        // Output all buffered logs to console\n        const consoleMethod = this.consoleHooked ? this.originalConsole.log : console.log;\n        for (const logEntry of this.silencedBuffer) {\n            const callerPrefix = logEntry.caller ? `[${logEntry.caller}] ` : '';\n            const consoleMsg = `[${logEntry.timestamp}] ${callerPrefix}${logEntry.message}`;\n            if (logEntry.data) {\n                consoleMethod(consoleMsg, logEntry.data);\n            } else {\n                consoleMethod(consoleMsg);\n            }\n            if (logEntry.stack) {\n                consoleMethod('Stack trace:', logEntry.stack);\n            }\n        }\n\n        // Add ALL buffered logs to main logs\n        this.logs.push(...this.silencedBuffer);\n\n        // Then truncate to keep only the last maxLogs entries\n        if (this.logs.length > this.maxLogs) {\n            this.logs = this.logs.slice(-this.maxLogs);\n        }\n\n        // Clear buffer\n        this.silencedBuffer = [];\n\n        // Update UI with all logs\n        this.updateUI();\n    }\n\n    /**\n     * Clear silenced buffer without flushing\n     */\n    clearSilencedBuffer() {\n        const count = this.silencedBuffer.length;\n        this.silencedBuffer = [];\n        this.info(`Cleared ${count} buffered logs`, null, false); // Not silenceable\n    }\n\n    /**\n     * Check if a log level should be displayed\n     * Note: In silent mode, logs still pass this check but are buffered instead of displayed\n     */\n    shouldLog(level) {\n        if (!this.enabled) return false;\n\n        const levels = {\n            verbose: 0,\n            debug: 1,\n            info: 2,\n            warn: 3,\n            error: 4,\n            silent: 0  // Silent mode - accept all logs but buffer them\n        };\n\n        return levels[level] >= levels[this.verbosity];\n    }\n\n    /**\n     * Log a message\n     * @param {string} level - Log level (verbose, debug, info, warn, error)\n     * @param {string} message - Log message\n     * @param {*} data - Optional data to log\n     * @param {boolean} silenceable - If true, log can be silenced (buffered); if false, always outputs immediately\n     */\n    log(level, message, data = null, silenceable = true) {\n        if (!this.shouldLog(level)) return;\n\n        const timestamp = new Date().toLocaleTimeString();\n\n        // Extract caller info (file:line)\n        const caller = this._getCallerInfo();\n\n        // Extract stack trace for errors\n        let stack = null;\n        if (data instanceof Error) {\n            stack = data.stack;\n            data = {\n                message: data.message,\n                name: data.name,\n                stack: data.stack\n            };\n        }\n\n        const logEntry = {\n            timestamp,\n            level,\n            message,\n            data,\n            stack,\n            caller\n        };\n\n        // If in silent mode and this log is silenceable, buffer it instead of displaying\n        if (this.silenced && silenceable) {\n            this.silencedBuffer.push(logEntry);\n\n            // Keep only last maxSilencedLogs entries in buffer\n            if (this.silencedBuffer.length > this.maxSilencedLogs) {\n                this.silencedBuffer.shift();\n            }\n\n            // Don't output to console or UI\n            return;\n        }\n\n        // Normal logging (not silenced or not silenceable)\n        this.logs.push(logEntry);\n\n        // Keep only last maxLogs entries\n        if (this.logs.length > this.maxLogs) {\n            this.logs.shift();\n        }\n\n        // Also log to console for debugging (use original console to avoid infinite loop)\n        const consoleMethod = this.consoleHooked ? this.originalConsole.log : console.log;\n        const callerPrefix = caller ? `[${caller}] ` : '';\n        const consoleMsg = `[${timestamp}] ${callerPrefix}${message}`;\n        if (data) {\n            consoleMethod(consoleMsg, data);\n        } else {\n            consoleMethod(consoleMsg);\n        }\n        if (stack) {\n            consoleMethod('Stack trace:', stack);\n        }\n\n        // Trigger UI update\n        this.updateUI();\n    }\n\n    /**\n     * Convenience methods\n     * @param {string} message - Log message\n     * @param {*} data - Optional data to log\n     * @param {boolean} silenceable - If true (default), log can be buffered in silent mode\n     */\n    verbose(message, data = null, silenceable = true) {\n        this.log('verbose', message, data, silenceable);\n    }\n\n    debug(message, data = null, silenceable = true) {\n        this.log('debug', message, data, silenceable);\n    }\n\n    info(message, data = null, silenceable = true) {\n        this.log('info', message, data, silenceable);\n    }\n\n    warn(message, data = null, silenceable = true) {\n        this.log('warn', message, data, silenceable);\n    }\n\n    error(message, data = null, silenceable = true) {\n        this.log('error', message, data, silenceable);\n    }\n\n    /**\n     * Clear all logs\n     */\n    clear() {\n        this.logs = [];\n        this.updateUI();\n    }\n\n    /**\n     * Update the UI with current logs\n     */\n    updateUI() {\n        // Use configured output element or fallback to default selector\n        const output = this.outputElement ? $(this.outputElement) : $('#debug-output');\n        if (!output || output.length === 0) return;\n\n        output.empty();\n\n        for (const log of this.logs) {\n            const logDiv = $('<div class=\"debug-log\"></div>')\n                .addClass(log.level);\n\n            const timestamp = $('<span class=\"debug-timestamp\"></span>')\n                .text(log.timestamp);\n\n            // Add caller info if available\n            if (log.caller) {\n                const caller = $('<span class=\"debug-caller\"></span>')\n                    .text(`[${log.caller}] `)\n                    .css({\n                        'color': '#64B5F6',\n                        'font-family': 'monospace',\n                        'font-size': '11px'\n                    });\n                logDiv.append(timestamp).append(caller);\n            } else {\n                logDiv.append(timestamp);\n            }\n\n            const message = $('<span></span>').text(log.message);\n            logDiv.append(message);\n\n            if (log.data) {\n                const dataStr = typeof log.data === 'object' ?\n                    JSON.stringify(log.data, null, 2) :\n                    String(log.data);\n                const dataSpan = $('<span></span>')\n                    .text(' | ' + dataStr)\n                    .css('color', '#888');\n                logDiv.append(dataSpan);\n            }\n\n            // Show stack trace for errors (collapsed by default)\n            if (log.stack) {\n                const stackBtn = $('<span></span>')\n                    .text(' [stack]')\n                    .css({\n                        'color': '#ff6b6b',\n                        'cursor': 'pointer',\n                        'text-decoration': 'underline'\n                    });\n\n                const stackDiv = $('<pre></pre>')\n                    .text(log.stack)\n                    .css({\n                        'display': 'none',\n                        'color': '#ff6b6b',\n                        'font-size': '9px',\n                        'margin': '4px 0 0 20px',\n                        'padding': '4px',\n                        'background': '#2a0000',\n                        'border-left': '2px solid #ff6b6b',\n                        'overflow-x': 'auto'\n                    });\n\n                stackBtn.on('click', function() {\n                    stackDiv.toggle();\n                });\n\n                logDiv.append(stackBtn);\n                logDiv.append(stackDiv);\n            }\n\n            output.append(logDiv);\n        }\n\n        // Auto-scroll to bottom\n        output.scrollTop(output[0].scrollHeight);\n    }\n\n    /**\n     * Get all logs\n     */\n    getLogs() {\n        return this.logs;\n    }\n\n    /**\n     * Get silenced buffer\n     */\n    getSilencedBuffer() {\n        return this.silencedBuffer;\n    }\n\n    /**\n     * Get silenced state\n     */\n    isSilenced() {\n        return this.silenced;\n    }\n\n    /**\n     * Get buffer stats\n     */\n    getBufferStats() {\n        return {\n            silenced: this.silenced,\n            bufferSize: this.silencedBuffer.length,\n            maxBufferSize: this.maxSilencedLogs,\n            bufferUsagePercent: Math.round((this.silencedBuffer.length / this.maxSilencedLogs) * 100)\n        };\n    }\n\n    /**\n     * Hook browser console methods to echo to debug console\n     */\n    hookConsole() {\n        if (this.consoleHooked) {\n            this.warn('Console already hooked');\n            return;\n        }\n\n        // Store original console methods\n        this.originalConsole = {\n            log: console.log,\n            info: console.info,\n            warn: console.warn,\n            error: console.error\n        };\n\n        const self = this;\n\n        // Override console.log\n        console.log = function(...args) {\n            self.originalConsole.log.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.debug('[console.log] ' + message);\n        };\n\n        // Override console.info\n        console.info = function(...args) {\n            self.originalConsole.info.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.debug('[console.info] ' + message);\n        };\n\n        // Override console.warn\n        console.warn = function(...args) {\n            self.originalConsole.warn.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.warn('[console] ' + message);\n        };\n\n        // Override console.error\n        console.error = function(...args) {\n            self.originalConsole.error.apply(console, args);\n            const message = args.map(arg =>\n                typeof arg === 'object' ? JSON.stringify(arg) : String(arg)\n            ).join(' ');\n            self.error('[console] ' + message);\n        };\n\n        this.consoleHooked = true;\n        this.info('Console hooked - browser console calls will echo to debug console');\n    }\n\n    /**\n     * Unhook browser console methods (restore original behavior)\n     */\n    unhookConsole() {\n        if (!this.consoleHooked) {\n            this.warn('Console not hooked');\n            return;\n        }\n\n        console.log = this.originalConsole.log;\n        console.info = this.originalConsole.info;\n        console.warn = this.originalConsole.warn;\n        console.error = this.originalConsole.error;\n\n        this.consoleHooked = false;\n        this.info('Console unhooked - restored original behavior');\n    }\n}\n\n// Create singleton instance\nexport const logger = new DebugLogger();\n", "/**\n * Math expression parser that converts user expressions to GLSL code\n * Supports standard math operations and functions\n *\n * ARCHITECTURE:\n * 1. Parse user input string to AST (Abstract Syntax Tree)\n * 2. Keep original AST for display (LaTeX) - preserves user intent (x/y, not x*y^-1)\n * 3. Clone AST for manipulation:\n *    - Substitute custom function calls with their definitions\n *    - Apply algebraic transformations (done externally via CAS)\n * 4. Generate code from AST:\n *    - toGLSL(): With GLSL-specific optimizations (x^2 \u2192 x*x)\n *    - toTeX(): Preserves mathematical notation (x/y \u2192 \\frac{x}{y})\n *    - toJS(): Standard JavaScript Math library calls\n *\n * IMPORTANT:\n * - Optimizations like integer power expansion are ONLY in toGLSL()\n * - LaTeX and JS generation preserve the original expression structure\n * - Function substitution happens on the AST before code generation\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n// ============================================================================\n// Expression Interface\n// ============================================================================\n\n/**\n * Abstract interface for mathematical expressions\n * This allows us to swap implementations (native AST, Maxima, etc.)\n * without changing calling code\n */\nclass IExpression {\n    /**\n     * Convert to GLSL code\n     * @param {string[]} variables - Available variable names\n     * @param {object} options - Options for code generation\n     * @returns {string} GLSL code\n     */\n    toGLSL(variables, options = {}) {\n        throw new Error('Must implement toGLSL()');\n    }\n\n    /**\n     * Convert to LaTeX notation\n     * @param {string[]} variables - Available variable names\n     * @returns {string} LaTeX code\n     */\n    toTeX(variables) {\n        throw new Error('Must implement toTeX()');\n    }\n\n    /**\n     * Convert to JavaScript code\n     * @param {string[]} variables - Available variable names\n     * @returns {string} JavaScript code\n     */\n    toJS(variables) {\n        throw new Error('Must implement toJS()');\n    }\n\n    /**\n     * Clone this expression (deep copy)\n     * @returns {IExpression} Cloned expression\n     */\n    clone() {\n        throw new Error('Must implement clone()');\n    }\n\n    /**\n     * Substitute custom function calls with their definitions\n     * @param {object} functionDefs - Map of function name -> IExpression\n     * @returns {IExpression} New expression with substitutions applied\n     */\n    substitute(functionDefs) {\n        throw new Error('Must implement substitute()');\n    }\n}\n\n// ============================================================================\n// Native Expression Implementation (wraps AST)\n// ============================================================================\n\n/**\n * Native expression implementation using our internal AST\n */\nclass NativeExpression extends IExpression {\n    constructor(ast) {\n        super();\n        this.ast = ast;\n    }\n\n    toGLSL(variables, options = {}) {\n        return astToGLSL(this.ast, variables, options.useDirectMapping || false, options.posVarName || 'pos');\n    }\n\n    toTeX(variables) {\n        return astToTeX(this.ast, variables);\n    }\n\n    toJS(variables) {\n        return astToJS(this.ast, variables);\n    }\n\n    clone() {\n        return new NativeExpression(cloneAST(this.ast));\n    }\n\n    substitute(functionDefs) {\n        // Convert IExpression function definitions to AST format\n        const astFunctionDefs = {};\n        for (const [name, expr] of Object.entries(functionDefs)) {\n            if (expr instanceof NativeExpression) {\n                // Extract params from custom function registry\n                if (customFunctions[name]) {\n                    astFunctionDefs[name] = {\n                        params: customFunctions[name].params,\n                        bodyAST: expr.ast\n                    };\n                }\n            }\n        }\n\n        const substitutedAST = substituteAST(this.ast, astFunctionDefs);\n        return new NativeExpression(substitutedAST);\n    }\n}\n\n// ============================================================================\n// AST Node Definitions (Internal)\n// ============================================================================\n\n/**\n * AST Node base class (internal - not part of public API)\n */\nclass ASTNode {\n    constructor(type) {\n        this.type = type;\n    }\n}\n\n/**\n * Number literal node\n */\nclass NumberNode extends ASTNode {\n    constructor(value, isConstant = false) {\n        super('number');\n        this.value = value;\n        this.isConstant = isConstant;\n    }\n}\n\n/**\n * Variable reference node\n */\nclass VariableNode extends ASTNode {\n    constructor(name) {\n        super('variable');\n        this.name = name;\n    }\n}\n\n/**\n * Binary operation node (+, -, *, /, ^, %)\n */\nclass BinaryOpNode extends ASTNode {\n    constructor(operator, left, right) {\n        super('binaryOp');\n        this.operator = operator;\n        this.left = left;\n        this.right = right;\n    }\n}\n\n/**\n * Unary operation node (currently just unary minus)\n */\nclass UnaryOpNode extends ASTNode {\n    constructor(operator, operand) {\n        super('unaryOp');\n        this.operator = operator;\n        this.operand = operand;\n    }\n}\n\n/**\n * Function call node\n */\nclass FunctionCallNode extends ASTNode {\n    constructor(name, args) {\n        super('functionCall');\n        this.name = name;\n        this.args = args;\n    }\n}\n\n// ============================================================================\n// Tokenizer\n// ============================================================================\n\nconst TOKEN_TYPES = {\n    NUMBER: 'NUMBER',\n    VARIABLE: 'VARIABLE',\n    FUNCTION: 'FUNCTION',\n    OPERATOR: 'OPERATOR',\n    UNARY_MINUS: 'UNARY_MINUS',\n    LPAREN: 'LPAREN',\n    RPAREN: 'RPAREN',\n    COMMA: 'COMMA',\n    EOF: 'EOF'\n};\n\nconst OPERATORS = {\n    '+': { precedence: 1, associativity: 'L' },\n    '-': { precedence: 1, associativity: 'L' },\n    '*': { precedence: 2, associativity: 'L' },\n    '/': { precedence: 2, associativity: 'L' },\n    '^': { precedence: 3, associativity: 'R' },\n    '%': { precedence: 2, associativity: 'L' }\n};\n\nconst BUILTIN_FUNCTIONS = new Set([\n    'sin', 'cos', 'tan', 'asin', 'acos', 'atan', 'atan2',\n    'sinh', 'cosh', 'tanh',\n    'exp', 'log', 'log2', 'sqrt', 'abs',\n    'floor', 'ceil', 'fract', 'sign',\n    'min', 'max', 'pow', 'mod',\n    'length', 'normalize', 'dot'\n]);\n\n// Custom function registry\n// Format: { functionName: { params: ['x', 'y', ...], body: 'expression' } }\nconst customFunctions = {};\n\nconst CONSTANTS = {\n    'pi': 'PI',\n    'e': 'E',\n    'PI': 'PI',\n    'E': 'E'\n};\n\n/**\n * Tokenize an expression string\n */\nfunction tokenize(expr) {\n    const tokens = [];\n    let i = 0;\n    let lastToken = null;\n\n    while (i < expr.length) {\n        let char = expr[i];\n\n        // Skip whitespace\n        if (/\\s/.test(char)) {\n            i++;\n            continue;\n        }\n\n        // Numbers\n        if (/\\d/.test(char) || (char === '.' && /\\d/.test(expr[i + 1]))) {\n            let num = '';\n            while (i < expr.length && /[\\d.]/.test(expr[i])) {\n                num += expr[i++];\n            }\n            const token = { type: TOKEN_TYPES.NUMBER, value: parseFloat(num) };\n            tokens.push(token);\n            lastToken = token;\n            continue;\n        }\n\n        // Variables, functions, and constants\n        if (/[a-zA-Z_]/.test(char)) {\n            let name = '';\n            while (i < expr.length && /[a-zA-Z_0-9]/.test(expr[i])) {\n                name += expr[i++];\n            }\n\n            let token;\n            if (BUILTIN_FUNCTIONS.has(name) || customFunctions.hasOwnProperty(name)) {\n                token = { type: TOKEN_TYPES.FUNCTION, value: name };\n            } else if (CONSTANTS.hasOwnProperty(name)) {\n                token = { type: TOKEN_TYPES.NUMBER, value: CONSTANTS[name], isConstant: true };\n            } else {\n                token = { type: TOKEN_TYPES.VARIABLE, value: name };\n            }\n            tokens.push(token);\n            lastToken = token;\n            continue;\n        }\n\n        // Operators (handle unary minus)\n        if (OPERATORS.hasOwnProperty(char)) {\n            // Check if this is a unary minus\n            if (char === '-' && (lastToken === null ||\n                lastToken.type === TOKEN_TYPES.OPERATOR ||\n                lastToken.type === TOKEN_TYPES.UNARY_MINUS ||\n                lastToken.type === TOKEN_TYPES.LPAREN ||\n                lastToken.type === TOKEN_TYPES.COMMA)) {\n                // This is a unary minus\n                const token = { type: TOKEN_TYPES.UNARY_MINUS };\n                tokens.push(token);\n                lastToken = token;\n                i++;\n                continue;\n            }\n            const token = { type: TOKEN_TYPES.OPERATOR, value: char };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        // Parentheses\n        if (char === '(') {\n            const token = { type: TOKEN_TYPES.LPAREN };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n        if (char === ')') {\n            const token = { type: TOKEN_TYPES.RPAREN };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        // Comma\n        if (char === ',') {\n            const token = { type: TOKEN_TYPES.COMMA };\n            tokens.push(token);\n            lastToken = token;\n            i++;\n            continue;\n        }\n\n        throw new Error(`Unexpected character: ${char} at position ${i}`);\n    }\n\n    tokens.push({ type: TOKEN_TYPES.EOF });\n    return tokens;\n}\n\n/**\n * Parse tokens into an AST using Shunting Yard algorithm\n */\nfunction parse(tokens) {\n    const output = [];\n    const operators = [];\n    let i = 0;\n\n    const peek = () => tokens[i];\n    const consume = () => tokens[i++];\n\n    while (peek().type !== TOKEN_TYPES.EOF) {\n        const token = consume();\n\n        if (token.type === TOKEN_TYPES.NUMBER) {\n            output.push(token);\n        } else if (token.type === TOKEN_TYPES.VARIABLE) {\n            output.push(token);\n        } else if (token.type === TOKEN_TYPES.FUNCTION) {\n            operators.push(token);\n        } else if (token.type === TOKEN_TYPES.UNARY_MINUS) {\n            // Unary minus has high precedence (higher than ^, right-associative)\n            // Pop operators with higher or equal precedence\n            while (operators.length > 0) {\n                const o2 = operators[operators.length - 1];\n                // Only pop other unary minus operators (right-associative)\n                // Don't pop binary operators or functions\n                if (o2.type === TOKEN_TYPES.UNARY_MINUS) {\n                    output.push(operators.pop());\n                } else {\n                    break;\n                }\n            }\n            operators.push(token);\n        } else if (token.type === TOKEN_TYPES.COMMA) {\n            while (operators.length > 0 && operators[operators.length - 1].type !== TOKEN_TYPES.LPAREN) {\n                output.push(operators.pop());\n            }\n        } else if (token.type === TOKEN_TYPES.OPERATOR) {\n            const o1 = token;\n            while (operators.length > 0) {\n                const o2 = operators[operators.length - 1];\n                if (o2.type === TOKEN_TYPES.OPERATOR) {\n                    const op1 = OPERATORS[o1.value];\n                    const op2 = OPERATORS[o2.value];\n                    if ((op1.associativity === 'L' && op1.precedence <= op2.precedence) ||\n                        (op1.associativity === 'R' && op1.precedence < op2.precedence)) {\n                        output.push(operators.pop());\n                    } else {\n                        break;\n                    }\n                } else if (o2.type === TOKEN_TYPES.UNARY_MINUS) {\n                    // Unary minus has precedence 2.5 (between * and ^)\n                    // -x^2 should parse as -(x^2), so ^ has higher precedence\n                    // 2*-x should parse as 2*(-x), so * pops unary minus\n                    const op1 = OPERATORS[o1.value];\n                    if (op1.precedence <= 2) {\n                        // Current operator is + or - or * or /\n                        // Pop unary minus (it has higher precedence, so it evaluates first)\n                        output.push(operators.pop());\n                    } else {\n                        // Current operator is ^\n                        // Don't pop unary minus (^ binds tighter than unary minus)\n                        break;\n                    }\n                } else {\n                    break;\n                }\n            }\n            operators.push(o1);\n        } else if (token.type === TOKEN_TYPES.LPAREN) {\n            operators.push(token);\n        } else if (token.type === TOKEN_TYPES.RPAREN) {\n            while (operators.length > 0 && operators[operators.length - 1].type !== TOKEN_TYPES.LPAREN) {\n                output.push(operators.pop());\n            }\n            if (operators.length === 0) {\n                throw new Error('Mismatched parentheses');\n            }\n            operators.pop(); // Remove the LPAREN\n\n            // If there's a function on top, pop it to output\n            if (operators.length > 0 && operators[operators.length - 1].type === TOKEN_TYPES.FUNCTION) {\n                output.push(operators.pop());\n            }\n        }\n    }\n\n    while (operators.length > 0) {\n        const op = operators.pop();\n        if (op.type === TOKEN_TYPES.LPAREN) {\n            throw new Error('Mismatched parentheses');\n        }\n        output.push(op);\n    }\n\n    return rpnToAST(output);\n}\n\n/**\n * Convert RPN token stream to AST\n * @param {Array} rpn - RPN token array from Shunting Yard\n * @returns {ASTNode} - Root node of AST\n */\nfunction rpnToAST(rpn) {\n    const stack = [];\n\n    for (const token of rpn) {\n        if (token.type === TOKEN_TYPES.NUMBER) {\n            stack.push(new NumberNode(token.value, token.isConstant));\n        } else if (token.type === TOKEN_TYPES.VARIABLE) {\n            stack.push(new VariableNode(token.value));\n        } else if (token.type === TOKEN_TYPES.UNARY_MINUS) {\n            if (stack.length < 1) throw new Error('Invalid expression');\n            const operand = stack.pop();\n            stack.push(new UnaryOpNode('-', operand));\n        } else if (token.type === TOKEN_TYPES.OPERATOR) {\n            if (stack.length < 2) throw new Error('Invalid expression');\n            const right = stack.pop();\n            const left = stack.pop();\n            stack.push(new BinaryOpNode(token.value, left, right));\n        } else if (token.type === TOKEN_TYPES.FUNCTION) {\n            const argCount = getFunctionArgCount(token.value);\n            if (stack.length < argCount) throw new Error(`Not enough arguments for ${token.value}`);\n\n            const args = [];\n            for (let i = 0; i < argCount; i++) {\n                args.unshift(stack.pop());\n            }\n            stack.push(new FunctionCallNode(token.value, args));\n        }\n    }\n\n    if (stack.length !== 1) {\n        throw new Error('Invalid expression');\n    }\n\n    return stack[0];\n}\n\n/**\n * Clone an AST (deep copy)\n * @param {ASTNode} node - AST node to clone\n * @returns {ASTNode} Cloned node\n */\nfunction cloneAST(node) {\n    if (node.type === 'number') {\n        return new NumberNode(node.value, node.isConstant);\n    } else if (node.type === 'variable') {\n        return new VariableNode(node.name);\n    } else if (node.type === 'unaryOp') {\n        return new UnaryOpNode(node.operator, cloneAST(node.operand));\n    } else if (node.type === 'binaryOp') {\n        return new BinaryOpNode(node.operator, cloneAST(node.left), cloneAST(node.right));\n    } else if (node.type === 'functionCall') {\n        return new FunctionCallNode(node.name, node.args.map(arg => cloneAST(arg)));\n    }\n    throw new Error(`Unknown node type: ${node.type}`);\n}\n\n/**\n * Substitute variables in an AST\n * @param {ASTNode} node - AST node\n * @param {Object} substitutions - Map of variable name -> ASTNode\n * @returns {ASTNode} New AST with substitutions applied\n */\nfunction substituteVariables(node, substitutions) {\n    if (node.type === 'number') {\n        return cloneAST(node);\n    } else if (node.type === 'variable') {\n        // If this variable should be substituted, return the substitution (cloned)\n        if (substitutions[node.name]) {\n            return cloneAST(substitutions[node.name]);\n        } else {\n            return cloneAST(node);\n        }\n    } else if (node.type === 'unaryOp') {\n        return new UnaryOpNode(node.operator, substituteVariables(node.operand, substitutions));\n    } else if (node.type === 'binaryOp') {\n        return new BinaryOpNode(\n            node.operator,\n            substituteVariables(node.left, substitutions),\n            substituteVariables(node.right, substitutions)\n        );\n    } else if (node.type === 'functionCall') {\n        // Recursively substitute in arguments\n        const newArgs = node.args.map(arg => substituteVariables(arg, substitutions));\n        return new FunctionCallNode(node.name, newArgs);\n    }\n    throw new Error(`Unknown node type: ${node.type}`);\n}\n\n/**\n * Substitute function calls in AST with their definitions\n * @param {ASTNode} node - AST node\n * @param {Object} functionDefs - Map of function name -> {params: string[], bodyAST: ASTNode}\n * @returns {ASTNode} New AST with function calls replaced by their bodies\n */\nfunction substituteAST(node, functionDefs) {\n    if (node.type === 'number' || node.type === 'variable') {\n        return cloneAST(node);\n    } else if (node.type === 'unaryOp') {\n        return new UnaryOpNode(node.operator, substituteAST(node.operand, functionDefs));\n    } else if (node.type === 'binaryOp') {\n        return new BinaryOpNode(\n            node.operator,\n            substituteAST(node.left, functionDefs),\n            substituteAST(node.right, functionDefs)\n        );\n    } else if (node.type === 'functionCall') {\n        // Check if this is a custom function that should be substituted\n        if (functionDefs[node.name]) {\n            const funcDef = functionDefs[node.name];\n\n            // Recursively substitute in the arguments first\n            const evalArgs = node.args.map(arg => substituteAST(arg, functionDefs));\n\n            // Build substitution map: parameter name -> argument AST\n            const substitutions = {};\n            funcDef.params.forEach((param, i) => {\n                substitutions[param] = evalArgs[i];\n            });\n\n            // Substitute parameters with arguments in the function body\n            return substituteVariables(funcDef.bodyAST, substitutions);\n        } else {\n            // Built-in function or unknown - just substitute in arguments\n            const newArgs = node.args.map(arg => substituteAST(arg, functionDefs));\n            return new FunctionCallNode(node.name, newArgs);\n        }\n    }\n    throw new Error(`Unknown node type: ${node.type}`);\n}\n\n/**\n * Pretty-print AST tree for debugging\n * @param {ASTNode} node - AST node to print\n * @param {number} indent - Indentation level\n * @returns {string} Pretty-printed tree\n */\nfunction prettyPrintAST(node, indent = 0) {\n    const indentStr = '  '.repeat(indent);\n\n    if (node.type === 'number') {\n        if (node.isConstant) {\n            return `${indentStr}NumberNode(${node.value} [constant])`;\n        } else {\n            return `${indentStr}NumberNode(${node.value})`;\n        }\n    } else if (node.type === 'variable') {\n        return `${indentStr}VariableNode(${node.name})`;\n    } else if (node.type === 'unaryOp') {\n        const operandStr = prettyPrintAST(node.operand, indent + 1);\n        return `${indentStr}UnaryOpNode(${node.operator})\\n${operandStr}`;\n    } else if (node.type === 'binaryOp') {\n        const leftStr = prettyPrintAST(node.left, indent + 1);\n        const rightStr = prettyPrintAST(node.right, indent + 1);\n        return `${indentStr}BinaryOpNode(${node.operator})\\n${leftStr}\\n${rightStr}`;\n    } else if (node.type === 'functionCall') {\n        const argsStr = node.args.map(arg => prettyPrintAST(arg, indent + 1)).join('\\n');\n        return `${indentStr}FunctionCallNode(${node.name})\\n${argsStr}`;\n    }\n    return `${indentStr}Unknown(${node.type})`;\n}\n\n/**\n * Convert AST to JavaScript code\n * @param {ASTNode} node - AST node\n * @param {string[]} variables - Available variable names\n * @returns {string} JavaScript code\n */\nfunction astToJS(node, variables) {\n    const varSet = new Set(variables);\n    const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n    velocityVars.forEach(v => varSet.add(v));\n    varSet.add('a'); // Animation alpha\n\n    function walk(node) {\n        if (node.type === 'number') {\n            if (node.isConstant) {\n                const constMap = { 'PI': 'Math.PI', 'E': 'Math.E' };\n                return constMap[node.value] || node.value.toString();\n            } else {\n                return node.value.toString();\n            }\n        } else if (node.type === 'variable') {\n            if (varSet.has(node.name)) {\n                return node.name;\n            } else {\n                throw new Error(`Unknown variable: ${node.name}. Available: ${variables.join(', ')}, dx, dy, dz, dw, du, dv, a`);\n            }\n        } else if (node.type === 'unaryOp') {\n            const operand = walk(node.operand);\n            return `(-${operand})`;\n        } else if (node.type === 'binaryOp') {\n            const left = walk(node.left);\n            const right = walk(node.right);\n            if (node.operator === '^') {\n                return `Math.pow(${left}, ${right})`;\n            } else {\n                return `(${left} ${node.operator} ${right})`;\n            }\n        } else if (node.type === 'functionCall') {\n            const args = node.args.map(arg => walk(arg));\n            const funcMap = {\n                'mod': '%',\n                'fract': '(x => x - Math.floor(x))',\n                'mix': '(a, b, t) => a * (1 - t) + b * t'\n            };\n            const funcName = funcMap[node.name] || `Math.${node.name}`;\n            return `${funcName}(${args.join(', ')})`;\n        }\n        throw new Error(`Unknown node type: ${node.type}`);\n    }\n\n    return walk(node);\n}\n\n/**\n * GLSL optimization: expand small integer powers to multiplication\n * e.g., x^2 -> x*x, x^3 -> x*x*x (avoids pow() call)\n * @param {string} base - Base expression (already GLSL code)\n * @param {string} exponent - Exponent expression (already GLSL code)\n * @returns {string} Optimized GLSL code\n */\nfunction optimizeIntegerPower(base, exponent) {\n    // Check for negative exponents (convert back to division)\n    if (exponent === '(-1.0)' || exponent === '-1.0') {\n        // x^(-1) becomes (1.0 / x)\n        return `(1.0 / ${base})`;\n    }\n\n    // Check if exponent is a small integer literal\n    const expMatch = exponent.match(/^(\\d+)\\.0$/);\n    if (expMatch) {\n        const n = parseInt(expMatch[1]);\n        if (n === 0) {\n            return '1.0';\n        } else if (n === 1) {\n            return base;\n        } else if (n <= 4) {\n            // Expand x^n as x*x*... (faster than pow() for small n)\n            return `(${Array(n).fill(base).join(' * ')})`;\n        }\n    }\n    // Use pow() for non-integer or large exponents\n    return `pow(${base}, ${exponent})`;\n}\n\n/**\n * Convert AST to GLSL code\n * @param {ASTNode} node - AST node\n * @param {string[]} variables - Available variable names\n * @param {boolean} useDirectMapping - Use direct variable mapping\n * @param {string} posVarName - GLSL position variable name\n * @returns {string} GLSL code\n */\nfunction astToGLSL(node, variables, useDirectMapping = false, posVarName = 'pos') {\n    const varMap = {};\n\n    if (useDirectMapping) {\n        // Direct mapping for custom functions - variables map to themselves\n        variables.forEach(v => {\n            varMap[v] = v;\n        });\n    } else {\n        // Map variable names to swizzle notation (for vector fields)\n        const swizzles = ['x', 'y', 'z', 'w', 'u', 'v'];\n        const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n\n        // Map position variables (x, y, z, w, u, v) or custom variables (r, theta, etc.)\n        variables.forEach((v, i) => {\n            if (i < 6) {\n                varMap[v] = `${posVarName}.${swizzles[i]}`;\n            } else {\n                varMap[v] = `${posVarName}[${i}]`;\n            }\n        });\n\n        // Map velocity variables (dx, dy, dz, dw, du, dv)\n        velocityVars.forEach((v, i) => {\n            if (i < 6) {\n                varMap[v] = `velocity.${swizzles[i]}`;\n            } else {\n                varMap[v] = `velocity[${i}]`;\n            }\n        });\n\n        // Map animation alpha variable to uniform\n        varMap['a'] = 'u_alpha';\n    }\n\n    function walk(node) {\n        if (node.type === 'number') {\n            if (node.isConstant) {\n                // Constants like PI, E\n                const constMap = { 'PI': '3.14159265359', 'E': '2.71828182846' };\n                return constMap[node.value] || node.value.toString();\n            } else {\n                // Convert to GLSL float literal (ensure .0 suffix for integers)\n                let numStr = node.value.toString();\n                if (!numStr.includes('.') && !numStr.includes('e') && !numStr.includes('E')) {\n                    numStr += '.0';\n                }\n                return numStr;\n            }\n        } else if (node.type === 'variable') {\n            if (varMap.hasOwnProperty(node.name)) {\n                return varMap[node.name];\n            } else {\n                throw new Error(`Unknown variable: ${node.name}. Available: ${variables.join(', ')}`);\n            }\n        } else if (node.type === 'unaryOp') {\n            const operand = walk(node.operand);\n            return `(-${operand})`;\n        } else if (node.type === 'binaryOp') {\n            const left = walk(node.left);\n            const right = walk(node.right);\n\n            if (node.operator === '^') {\n                // GLSL-specific optimization: expand small integer powers\n                return optimizeIntegerPower(left, right);\n            } else if (node.operator === '%') {\n                return `mod(${left}, ${right})`;\n            } else {\n                return `(${left} ${node.operator} ${right})`;\n            }\n        } else if (node.type === 'functionCall') {\n            const args = node.args.map(arg => walk(arg));\n\n            // Map function names to GLSL equivalents\n            let glslFunc = node.name;\n            if (node.name === 'atan2') {\n                // GLSL uses atan(y, x) instead of atan2(y, x)\n                glslFunc = 'atan';\n            }\n\n            return `${glslFunc}(${args.join(', ')})`;\n        }\n        throw new Error(`Unknown node type: ${node.type}`);\n    }\n\n    return walk(node);\n}\n\n/**\n * Convert AST to LaTeX code\n * @param {ASTNode} node - AST node\n * @param {string[]} variables - Available variable names\n * @returns {string} LaTeX code\n */\nfunction astToTeX(node, variables) {\n    const varSet = new Set(variables);\n\n    // Add velocity variables to allowed set\n    const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n    velocityVars.forEach(v => varSet.add(v));\n\n    // Add animation alpha variable\n    varSet.add('a');\n\n    /**\n     * Check if a node needs parentheses when used as base of power\n     */\n    function needsParensForPower(node) {\n        // Binary operations and unary minus need parens: (x+2)^2, (-x)^2\n        // Simple values don't: x^2, sin(x)^2\n        return node.type === 'binaryOp' || node.type === 'unaryOp';\n    }\n\n    /**\n     * Check if a node needs parentheses for multiplication\n     * Addition/subtraction have lower precedence than multiplication\n     */\n    function needsParensForMultiply(node) {\n        return node.type === 'binaryOp' && (node.operator === '+' || node.operator === '-');\n    }\n\n    function walk(node) {\n        if (node.type === 'number') {\n            if (node.isConstant) {\n                // Constants like PI, E\n                const constMap = { 'PI': '\\\\pi', 'E': 'e' };\n                return constMap[node.value] || node.value.toString();\n            } else {\n                return node.value.toString();\n            }\n        } else if (node.type === 'variable') {\n            if (varSet.has(node.name)) {\n                return node.name;\n            } else {\n                throw new Error(`Unknown variable: ${node.name}`);\n            }\n        } else if (node.type === 'unaryOp') {\n            const operand = walk(node.operand);\n            // Wrap in parens if complex expression\n            if (operand.includes(' ') || operand.includes('+') || operand.includes('-')) {\n                return `-(${operand})`;\n            } else {\n                return `-${operand}`;\n            }\n        } else if (node.type === 'binaryOp') {\n            const left = walk(node.left);\n            const right = walk(node.right);\n\n            if (node.operator === '^') {\n                // Power: a^b\n                // Add parentheses around base if it's a complex expression\n                // e.g., (x+2)^2 not x+2^2\n                const base = needsParensForPower(node.left) ? `\\\\left(${left}\\\\right)` : left;\n                return `{${base}}^{${right}}`;\n            } else if (node.operator === '*') {\n                // Multiplication: use \\cdot\n                // Add parentheses around operands with lower precedence (addition/subtraction)\n                const leftParen = needsParensForMultiply(node.left) ? `\\\\left(${left}\\\\right)` : left;\n                const rightParen = needsParensForMultiply(node.right) ? `\\\\left(${right}\\\\right)` : right;\n                return `${leftParen} \\\\cdot ${rightParen}`;\n            } else if (node.operator === '/') {\n                // Division: use \\frac\n                return `\\\\frac{${left}}{${right}}`;\n            } else if (node.operator === '-') {\n                // Subtraction\n                return `${left} - ${right}`;\n            } else if (node.operator === '+') {\n                // Addition\n                return `${left} + ${right}`;\n            } else {\n                // Other operators\n                return `${left} ${node.operator} ${right}`;\n            }\n        } else if (node.type === 'functionCall') {\n            const args = node.args.map(arg => walk(arg));\n\n            // Map functions to LaTeX notation\n            if (node.name === 'sqrt') {\n                return `\\\\sqrt{${args[0]}}`;\n            } else if (node.name === 'sin') {\n                return `\\\\sin(${args[0]})`;\n            } else if (node.name === 'cos') {\n                return `\\\\cos(${args[0]})`;\n            } else if (node.name === 'tan') {\n                return `\\\\tan(${args[0]})`;\n            } else if (node.name === 'exp') {\n                return `\\\\exp(${args[0]})`;\n            } else if (node.name === 'log') {\n                return `\\\\log(${args[0]})`;\n            } else if (node.name === 'abs') {\n                return `\\\\left|${args[0]}\\\\right|`;\n            } else {\n                // Other functions: use regular notation\n                return `${node.name}(${args.join(', ')})`;\n            }\n        }\n        throw new Error(`Unknown node type: ${node.type}`);\n    }\n\n    return walk(node);\n}\n\n/**\n * Get the number of arguments a function expects\n */\nfunction getFunctionArgCount(funcName) {\n    // Check custom functions first\n    if (customFunctions.hasOwnProperty(funcName)) {\n        return customFunctions[funcName].params.length;\n    }\n    // Check built-in functions\n    const multiArg = new Set(['min', 'max', 'pow', 'mod', 'dot', 'atan2']);\n    return multiArg.has(funcName) ? 2 : 1;\n}\n\n/**\n * Generate GLSL function declarations for all custom functions\n * @param {string[]} availableVars - Variables available in the current context\n * @returns {string} GLSL function declarations\n */\nfunction generateGLSLFunctionDeclarations(availableVars) {\n    let declarations = '';\n\n    for (const [funcName, func] of Object.entries(customFunctions)) {\n        // Parse the function body into an AST\n        const bodyTokens = tokenize(func.body);\n        const bodyAST = parse(bodyTokens);\n\n        // Convert body to GLSL using function parameters as variables\n        // Use direct mapping so parameters are used as-is (not mapped to pos.x, etc.)\n        const bodyGLSL = astToGLSL(bodyAST, func.params, true);\n\n        // Generate GLSL function declaration\n        declarations += `float ${funcName}(`;\n        declarations += func.params.map(p => `float ${p}`).join(', ');\n        declarations += `) {\\n`;\n        declarations += `    return ${bodyGLSL};\\n`;\n        declarations += `}\\n\\n`;\n    }\n\n    return declarations;\n}\n\n/**\n * Parse expression and return IExpression object\n * @param {string} expression - Math expression to parse\n * @param {number} dimensions - Number of dimensions\n * @param {Array<string>} customVariables - Optional custom variable names\n * @returns {IExpression} Expression object with toGLSL(), toTeX(), toJS() methods\n */\nexport function parseToExpression(expression, dimensions, customVariables = null) {\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n\n    try {\n        const tokens = tokenize(expression);\n        const ast = parse(tokens);\n\n        // Verbose logging: output AST tree\n        logger.verbose(`Parsed expression: \"${expression}\"`);\n        logger.verbose('AST tree:\\n' + prettyPrintAST(ast));\n\n        return new NativeExpression(ast);\n    } catch (error) {\n        throw new Error(`Parse error: ${error.message}`);\n    }\n}\n\n/**\n * Main parser function - parses expression to GLSL\n * @param {string} expression - Math expression to parse\n * @param {number} dimensions - Number of dimensions\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @param {string} posVarName - Optional GLSL position variable name (default: 'pos')\n * @returns {string} GLSL code\n */\nexport function parseExpression(expression, dimensions, customVariables = null, posVarName = 'pos') {\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n    const expr = parseToExpression(expression, dimensions, customVariables);\n    return expr.toGLSL(variables, { useDirectMapping: false, posVarName });\n}\n\n/**\n * Get GLSL function declarations for custom functions\n * This should be prepended to shaders that use custom functions\n * @returns {string} GLSL function declarations\n */\nexport function getGLSLFunctionDeclarations() {\n    return generateGLSLFunctionDeclarations([]);\n}\n\n/**\n * Parse all dimension expressions\n * @param {string[]} expressions - Array of expressions, one per dimension\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @param {string} posVarName - Optional GLSL position variable name (default: 'pos')\n * @returns {string[]} Array of GLSL code strings\n */\nexport function parseVectorField(expressions, customVariables = null, posVarName = 'pos') {\n    const dimensions = expressions.length;\n    return expressions.map((expr, i) => {\n        try {\n            return parseExpression(expr.trim(), dimensions, customVariables, posVarName);\n        } catch (error) {\n            throw new Error(`Error in dimension ${i}: ${error.message}`);\n        }\n    });\n}\n\n/**\n * Create JavaScript velocity evaluator functions\n * @param {string[]} expressions - Array of expressions, one per dimension\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @returns {Function[]} Array of evaluator functions\n */\nexport function createVelocityEvaluators(expressions, customVariables = null) {\n    const dimensions = expressions.length;\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n\n    return expressions.map((expr, i) => {\n        try {\n            const tokens = tokenize(expr.trim());\n            const ast = parse(tokens);\n            const jsCode = astToJS(ast, variables);\n\n            // Create a function that takes position components as arguments\n            // e.g., for 2D: (x, y) => expression\n            const funcBody = `return ${jsCode};`;\n            return new Function(...variables, funcBody);\n        } catch (error) {\n            throw new Error(`Error creating evaluator for dimension ${i}: ${error.message}`);\n        }\n    });\n}\n\n/**\n * Parse expression and convert to LaTeX notation\n * @param {string} expression - Math expression to parse\n * @param {number} dimensions - Number of dimensions\n * @param {Array<string>} customVariables - Optional custom variable names (e.g., ['r', 'theta'])\n * @returns {string} LaTeX code\n */\nexport function parseExpressionToTeX(expression, dimensions, customVariables = null) {\n    const variables = customVariables || ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n    const expr = parseToExpression(expression, dimensions, customVariables);\n    return expr.toTeX(variables);\n}\n\n/**\n * Parse and register custom function definitions\n * @param {string} functionsText - Multi-line text with function definitions\n * Format: functionName(arg1, arg2, ...) = expression\n */\nexport function setCustomFunctions(functionsText) {\n    // Clear existing custom functions\n    for (const key in customFunctions) {\n        delete customFunctions[key];\n    }\n\n    if (!functionsText || !functionsText.trim()) {\n        return; // Empty input, just cleared functions\n    }\n\n    const lines = functionsText.split('\\n');\n\n    for (let lineNum = 0; lineNum < lines.length; lineNum++) {\n        const line = lines[lineNum].trim();\n\n        // Skip empty lines and comments\n        if (!line || line.startsWith('//') || line.startsWith('#')) {\n            continue;\n        }\n\n        // Parse function definition: functionName(arg1, arg2) = expression\n        const match = line.match(/^([a-zA-Z_][a-zA-Z_0-9]*)\\s*\\(([^)]*)\\)\\s*=\\s*(.+)$/);\n\n        if (!match) {\n            throw new Error(`Line ${lineNum + 1}: Invalid function definition syntax. Expected: functionName(arg1, arg2) = expression`);\n        }\n\n        const [, functionName, paramsStr, body] = match;\n\n        // Check if function name conflicts with built-in functions\n        if (BUILTIN_FUNCTIONS.has(functionName)) {\n            throw new Error(`Line ${lineNum + 1}: Cannot override built-in function '${functionName}'`);\n        }\n\n        // Check if function name conflicts with constants\n        if (CONSTANTS.hasOwnProperty(functionName)) {\n            throw new Error(`Line ${lineNum + 1}: Cannot use constant name '${functionName}' as function name`);\n        }\n\n        // Parse parameters\n        const params = paramsStr.split(',').map(p => p.trim()).filter(p => p);\n\n        // Validate parameters are valid identifiers\n        for (const param of params) {\n            if (!/^[a-zA-Z_][a-zA-Z_0-9]*$/.test(param)) {\n                throw new Error(`Line ${lineNum + 1}: Invalid parameter name '${param}'`);\n            }\n        }\n\n        // Validate the function body can be parsed\n        try {\n            const testTokens = tokenize(body);\n            parse(testTokens);\n        } catch (error) {\n            throw new Error(`Line ${lineNum + 1}: Error parsing function body: ${error.message}`);\n        }\n\n        // Store the function definition\n        customFunctions[functionName] = {\n            params: params,\n            body: body\n        };\n    }\n}\n\n/**\n * Get current custom function definitions\n * @returns {object} Custom functions registry\n */\nexport function getCustomFunctions() {\n    return { ...customFunctions };\n}\n", "/**\n * Jacobian matrix computation using symbolic differentiation\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Notebook instance (injected from main.js)\n * @type {import('./notebook.js').Notebook}\n */\nlet notebook = null;\n\n/**\n * Set the Notebook to use for Jacobian computation\n * @param {import('./notebook.js').Notebook} nb\n */\nexport function setNotebook(nb) {\n    notebook = nb;\n    logger.info('Jacobian: Notebook set (CAS engine:', notebook.casEngine.getName() + ')');\n}\n\n/**\n * Variable names for each dimension (matches parser.js)\n */\nconst VARIABLE_NAMES = ['x', 'y', 'z', 'w', 'u', 'v'];\n\n/**\n * Optimize power expressions: replace pow(x, n) with x*x*... for small integers\n * Also cleans up other common patterns\n *\n * @param {string} expr - Expression to optimize\n * @returns {string} - Optimized expression\n */\nfunction optimizePowerExpressions(expr) {\n    // Replace pow(var, integer) with repeated multiplication for n <= 4\n    expr = expr.replace(/([a-z]+)\\^(\\d+)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        // if (n <= 4) {\n            return Array(n).fill(base).join('*');\n        // }\n        return match; // Keep pow for larger exponents\n    });\n\n    // Nerdamer uses ^ for exponentiation, but also handle pow() format\n    expr = expr.replace(/pow\\(([a-z]+),\\s*(\\d+)\\)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        if (n <= 4) {\n            return Array(n).fill(base).join('*');\n        }\n        return match;\n    });\n\n    return expr;\n}\n\n/**\n * Compute the Jacobian matrix symbolically\n *\n * For a vector field f = [f_0, f_1, ..., f_n], computes the matrix:\n * J[i][j] = \u2202f_i/\u2202x_j\n *\n * BUG: This function sometimes produces inconsistent results on initial page load\n * (possibly due to Nerdamer initialization timing issues or internal caching bugs).\n * Workaround: Always start with fixed-point iteration and switch to Newton's method\n * after a 3-second delay (see controls-v2.js).\n *\n * @param {string[]} expressions - Array of expression strings (one per dimension)\n * @param {number} dimensions - Number of dimensions\n * @returns {string[][]|null} - 2D array of symbolic derivative strings, or null if failed\n */\nexport function computeSymbolicJacobian(expressions, dimensions) {\n\n    logger.verbosity = 'verbose';\n\n    logger.info('=== JACOBIAN COMPUTATION START ===');\n    logger.info('Timestamp:', new Date().toISOString());\n    logger.info('Notebook:', notebook ? 'set' : 'not set');\n    logger.info('CAS Engine:', notebook ? notebook.casEngine.getName() : 'not available');\n    logger.info('Input expressions:', expressions.toString());\n    logger.info('Dimensions:', dimensions);\n\n    if (!notebook) {\n        logger.error('Notebook not set - cannot compute Jacobian');\n        return null;\n    }\n\n    if (!notebook.casEngine.isReady()) {\n        logger.error('CAS engine not ready - cannot compute Jacobian');\n        return null;\n    }\n\n    try {\n        // NOTE: We do NOT clear cache here because:\n        // 1. We parse expressions fresh on each differentiation call\n        // 2. No state is reused between Jacobian computations\n        // 3. The original cache clear was a workaround for a nerdamer initialization bug\n        //    that may no longer be necessary with proper async initialization\n        // If we see inconsistent results, we can add cache clearing back with proper justification\n\n        // WORKAROUND: Nerdamer doesn't support atan2(y, x) differentiation\n        // Replace atan2(A, B) with atan(A/B) for differentiation\n        // The derivatives are mathematically identical:\n        //   d/dB[atan2(A,B)] = -A/(A\u00B2+B\u00B2) = d/dB[atan(A/B)]\n        //   d/dA[atan2(A,B)] = B/(A\u00B2+B\u00B2) = d/dA[atan(A/B)]\n        // Multi-chart approach handles singularities: Chart 2 swaps arguments so\n        // atan2(y,x) becomes atan2(x,y) \u2192 atan(x/y), moving singularity from x=0 to y=0\n        const expressionsForDiff = expressions.map(expr => {\n            const replaced = expr.replace(/atan2\\s*\\(\\s*([^,]+)\\s*,\\s*([^)]+)\\s*\\)/g, 'atan(($1)/($2))');\n            if (replaced !== expr) {\n                logger.verbose(`Replaced atan2 for differentiation: \"${expr}\" \u2192 \"${replaced}\"`);\n            }\n            return replaced;\n        });\n\n        const jacobian = [];\n\n        // For each output dimension i\n        for (let i = 0; i < dimensions; i++) {\n            const row = [];\n            const expr = expressionsForDiff[i]; // Use preprocessed expression\n            logger.verbose(`Row ${i}: differentiating expression \"${expr}\"`);\n\n            // For each input variable j\n            for (let j = 0; j < dimensions; j++) {\n                const variable = VARIABLE_NAMES[j];\n\n                try {\n                    // Compute symbolic derivative \u2202f_i/\u2202x_j using Notebook\n                    // Notebook ensures context is applied before calling CAS engine\n                    logger.verbose(`  Computing \u2202(${expr})/\u2202${variable}...`);\n                    const derivative = notebook.differentiate(expr, variable);\n                    logger.verbose(`  Derivative: ${derivative}`);\n\n                    // Note: differentiate() already handles optimization internally\n                    row.push(derivative);\n                } catch (error) {\n                    logger.warn(`Failed to differentiate expression \"${expr}\" w.r.t. ${variable}: ${error.message}`);\n                    // Default to zero if differentiation fails\n                    row.push('0');\n                }\n            }\n\n            jacobian.push(row);\n        }\n\n        logger.info('=== JACOBIAN COMPUTATION COMPLETE ===');\n        logger.info('Final Jacobian matrix:');\n        for (let i = 0; i < jacobian.length; i++) {\n            logger.info(`  Row ${i}: [${jacobian[i].join(', ')}]`);\n        }\n\n        // Simplify the forward Jacobian BEFORE inversion to help with complex sqrt terms\n        // logger.verbose('Simplifying forward Jacobian before inversion...');\n        // const simplifiedJacobian = jacobian.map((row, i) => {\n        //     return row.map((element, j) => {\n        //         try {\n        //             const simplified = window.nerdamer(`simplify(${element})`).toString();\n        //             if (simplified !== element) {\n        //                 logger.verbose(`  J[${i},${j}]: \"${element}\" \u2192 \"${simplified}\"`);\n        //             }\n        //             return simplified;\n        //         } catch (e) {\n        //             logger.warn(`Failed to simplify J[${i},${j}]: ${e.message}`);\n        //             return element;\n        //         }\n        //     });\n        // });\n\n        return jacobian;\n\n    } catch (error) {\n        logger.error('Failed to compute Jacobian matrix', error);\n        return null;\n    }\n}\n\n/**\n * Test if a Jacobian matrix is valid (no undefined/null entries)\n *\n * @param {string[][]|null} jacobian - Jacobian matrix to test\n * @returns {boolean} - True if valid\n */\nexport function isValidJacobian(jacobian) {\n    if (!jacobian || !Array.isArray(jacobian)) {\n        return false;\n    }\n\n    for (const row of jacobian) {\n        if (!Array.isArray(row)) {\n            return false;\n        }\n        for (const entry of row) {\n            if (typeof entry !== 'string' || entry === '') {\n                return false;\n            }\n        }\n    }\n\n    return true;\n}\n\n/**\n * Format Jacobian matrix for display\n *\n * @param {string[][]} jacobian - Jacobian matrix\n * @returns {string} - Formatted string representation\n */\nexport function formatJacobian(jacobian) {\n    if (!jacobian) return 'null';\n\n    const maxLen = Math.max(...jacobian.flat().map(s => s.length));\n\n    let result = '[\\n';\n    for (const row of jacobian) {\n        result += '  [' + row.map(s => s.padEnd(maxLen)).join(', ') + ']\\n';\n    }\n    result += ']';\n\n    return result;\n}\n\n/**\n * Invert a symbolic Jacobian matrix using Nerdamer\n * Supports 2x2, 3x3, and 4x4 matrices\n *\n * @param {string[][]} jacobian - Jacobian matrix to invert\n * @returns {string[][]|null} - Inverted matrix or null if failed\n */\nexport function invertJacobian(jacobian) {\n    if (!jacobian || !Array.isArray(jacobian)) {\n        logger.error('Invalid Jacobian for inversion');\n        return null;\n    }\n\n    if (!notebook) {\n        logger.error('Notebook not set - cannot invert Jacobian');\n        return null;\n    }\n\n    const n = jacobian.length;\n    if (n < 2 || n > 4) {\n        logger.error(`Jacobian inversion only supported for 2x2, 3x3, and 4x4 matrices (got ${n}x${n})`);\n        return null;\n    }\n\n    try {\n        logger.verbose('Inverting Jacobian matrix using', notebook.casEngine.getName());\n\n        // Use Notebook's matrix inversion (ensures context is applied)\n        const result = notebook.invertMatrix(jacobian);\n\n        if (result) {\n            logger.verbose('Inverted Jacobian:');\n            for (let i = 0; i < result.length; i++) {\n                logger.verbose(`  Row ${i}: [${result[i].join(', ')}]`);\n            }\n        }\n\n        return result;\n\n    } catch (error) {\n        logger.error('Failed to invert Jacobian:', error.message);\n        return null;\n    }\n}\n", "/**\n * Coordinate Chart Generation\n *\n * Automatically detects singularities in coordinate transforms (primarily atan2)\n * and generates multiple coordinate charts to avoid numerical issues near singularities.\n *\n * Uses the \"atlas\" approach from differential geometry: cover the space with\n * multiple charts, each with singularities in different locations.\n */\n\n/**\n * Detect atan2(A, B) patterns in an expression\n * @param {string} expression - Math expression to analyze\n * @returns {Array<{numerator, denominator, fullMatch}>} - Array of atan2 patterns found\n */\nexport function detectAtan2Patterns(expression) {\n    const patterns = [];\n    const regex = /atan2\\s*\\(\\s*([^,]+)\\s*,\\s*([^)]+)\\s*\\)/g;\n\n    let match;\n    while ((match = regex.exec(expression)) !== null) {\n        patterns.push({\n            fullMatch: match[0],\n            numerator: match[1].trim(),\n            denominator: match[2].trim()\n        });\n    }\n\n    return patterns;\n}\n\n/**\n * Generate an alternative chart by swapping atan2 arguments\n * For atan2(y, x) \u2192 generate chart with \u03C0/2 - atan2(x, y)\n *\n * @param {Array<string>} forwardTransforms - Original coordinate transforms\n * @param {Object} atan2Info - {numerator, denominator, fullMatch}\n * @returns {Object} - {condition, forwardTransforms}\n */\nexport function generateAlternativeChart(forwardTransforms, atan2Info) {\n    const {numerator, denominator, fullMatch} = atan2Info;\n\n    // Swap arguments and adjust angle\n    // \u03B8 = atan2(y, x) becomes \u03B8 = \u03C0/2 - atan2(x, y)\n    const swappedAtan2 = `PI/2 - atan2(${denominator}, ${numerator})`;\n\n    // Replace in all transforms\n    const alternativeTransforms = forwardTransforms.map(expr =>\n        expr.replace(fullMatch, swappedAtan2)\n    );\n\n    // Condition: use this chart when |denominator| <= |numerator|\n    // (i.e., when the original chart would have small denominator)\n    const condition = `abs(${denominator}) <= abs(${numerator})`;\n\n    return {\n        condition,\n        forwardTransforms: alternativeTransforms\n    };\n}\n\n/**\n * Generate multiple coordinate charts to handle singularities\n *\n * Strategy:\n * - For 2D/cylindrical with atan2(y, x): Generate 2 charts (x-dominant vs y-dominant)\n * - For spherical with multiple atan2s: Generate 4-6 charts as needed\n *\n * @param {Array<string>} forwardTransforms - Original coordinate transform expressions\n * @param {number} dimensions - Number of dimensions\n * @returns {Array<{condition, forwardTransforms}>} - Array of charts\n */\nexport function generateCharts(forwardTransforms, dimensions) {\n    const charts = [];\n\n    // Find all atan2 patterns across all transforms\n    const allAtan2Patterns = [];\n    forwardTransforms.forEach((expr, index) => {\n        const patterns = detectAtan2Patterns(expr);\n        patterns.forEach(pattern => {\n            allAtan2Patterns.push({...pattern, transformIndex: index});\n        });\n    });\n\n    // No atan2 found - single chart covers everything\n    if (allAtan2Patterns.length === 0) {\n        return [{\n            condition: 'true',\n            forwardTransforms\n        }];\n    }\n\n    // Handle 2D/3D-cylindrical case (single atan2)\n    if (dimensions === 2 || (dimensions === 3 && allAtan2Patterns.length === 1)) {\n        const atan2Info = allAtan2Patterns[0];\n\n        // Chart 1: Original (good when denominator is large)\n        charts.push({\n            condition: `abs(${atan2Info.denominator}) >= abs(${atan2Info.numerator})`,\n            forwardTransforms: forwardTransforms\n        });\n\n        // Chart 2: Swapped (good when numerator is large)\n        charts.push(generateAlternativeChart(forwardTransforms, atan2Info));\n\n        return charts;\n    }\n\n    // Handle spherical case (multiple atan2s or complex patterns)\n    if (dimensions === 3 && allAtan2Patterns.length >= 2) {\n        // For standard spherical (r, \u03B8, \u03C6) with atan2 in azimuthal angle\n        // We need to consider both polar angle regions AND azimuthal regions\n\n        // Find the azimuthal atan2 (usually the last one, typically atan2(y, x))\n        const azimuthalAtan2 = allAtan2Patterns[allAtan2Patterns.length - 1];\n\n        // Simple strategy: Generate 2 charts based on azimuthal angle\n        // More sophisticated approach would handle polar angle singularities too\n\n        // Chart 1: Original\n        charts.push({\n            condition: `abs(${azimuthalAtan2.denominator}) >= abs(${azimuthalAtan2.numerator})`,\n            forwardTransforms: forwardTransforms\n        });\n\n        // Chart 2: Swapped azimuthal\n        charts.push(generateAlternativeChart(forwardTransforms, azimuthalAtan2));\n\n        return charts;\n    }\n\n    // Fallback: single chart\n    return [{\n        condition: 'true',\n        forwardTransforms\n    }];\n}\n\n/**\n * Generate GLSL condition expression from JavaScript condition string\n * Converts variable names to GLSL pos.x, pos.y, pos.z format\n *\n * @param {string} condition - Condition like \"abs(x) >= abs(y)\"\n * @param {Array<string>} cartesianVars - Variable names ['x', 'y', 'z']\n * @returns {string} - GLSL condition like \"abs(pos.x) >= abs(pos.y)\"\n */\nexport function generateGLSLCondition(condition, cartesianVars) {\n    if (condition === 'true') {\n        return 'true';\n    }\n\n    let glslCondition = condition;\n\n    // Replace each Cartesian variable with pos.x, pos.y, etc.\n    cartesianVars.forEach((varName, index) => {\n        const swizzle = ['x', 'y', 'z', 'w'][index];\n        // Use word boundaries to avoid replacing 'x' in 'exp'\n        const regex = new RegExp(`\\\\b${varName}\\\\b`, 'g');\n        glslCondition = glslCondition.replace(regex, `pos.${swizzle}`);\n    });\n\n    // Convert PI to 3.14159265359\n    glslCondition = glslCondition.replace(/\\bPI\\b/g, '3.14159265359');\n\n    return glslCondition;\n}\n", "/**\n * Coordinate Systems Module\n *\n * Defines alternate coordinate systems (polar, spherical, etc.) and handles\n * conversion between user-defined coordinates and Cartesian coordinates.\n *\n * Flow:\n * 1. User defines vector field in alternate coordinates (e.g., dr/dt, d\u03B8/dt)\n * 2. System converts position from Cartesian to native coordinates\n * 3. Evaluates velocity in native coordinates\n * 4. Converts velocity back to Cartesian using Jacobian\n * 5. Integration happens in Cartesian space (all existing integrators work)\n */\n\nimport { computeSymbolicJacobian, invertJacobian } from './jacobian.js';\nimport { generateCharts, generateGLSLCondition } from './coordinate-charts.js';\n\n/**\n * Base class for coordinate systems\n */\nclass CoordinateSystem {\n    constructor(name, dimensions, variables, forwardTransforms, inverseTransforms = null, useIterativeSolver = false, charts = null) {\n        this.name = name;\n        this.dimensions = dimensions;\n        this.variables = variables; // Array of { label: \"r\", displayLabel: \"r\" }\n        this.forwardTransforms = forwardTransforms; // Array of expressions: Cartesian \u2192 Native\n        this.inverseTransforms = inverseTransforms; // Array of expressions: Native \u2192 Cartesian (optional)\n        this.useIterativeSolver = useIterativeSolver; // Use Newton's method in GLSL to compute inverse\n\n        // Auto-generate charts to handle singularities if not explicitly provided\n        // Charts allow us to use different coordinate representations in different regions\n        // NOTE: Charts will be deprecated once we switch to native-space integration\n        this.charts = charts || generateCharts(forwardTransforms, dimensions);\n    }\n\n    /**\n     * Get variable names for this coordinate system\n     * @returns {Array<string>} - Variable names (e.g., ['r', 'theta'])\n     */\n    getVariableNames() {\n        return this.variables.map(v => v.label);\n    }\n\n    /**\n     * Get display labels (may include unicode symbols)\n     * @returns {Array<string>} - Display labels (e.g., ['r', '\u03B8'])\n     */\n    getDisplayLabels() {\n        return this.variables.map(v => v.displayLabel);\n    }\n\n    /**\n     * Generate GLSL code for forward transform (Cartesian \u2192 Native)\n     * @param {Array<string>} cartesianVars - Cartesian variable names (e.g., ['x', 'y'])\n     * @returns {string} - GLSL function code\n     */\n    generateForwardTransformGLSL(cartesianVars, parseFunc) {\n        const nativeVars = this.getVariableNames();\n        const dimType = `vec${this.dimensions}`;\n\n        // Parse each transform expression to GLSL\n        const transformCode = this.forwardTransforms.map((expr, i) => {\n            const glsl = parseFunc(expr, cartesianVars);\n            return `    result.${['x', 'y', 'z', 'w'][i]} = ${glsl};`;\n        }).join('\\n');\n\n        return `\n// Forward transform: Cartesian \u2192 ${this.name}\n${dimType} transformToNative(${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${['x', 'y', 'z', 'w'][i]}`).join(', ')};\n${transformCode}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for velocity transform using Jacobian\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateVelocityTransformGLSL(cartesianVars, parseFunc) {\n        // If we have multiple charts, use chart-aware generation\n        if (this.charts && this.charts.length > 1) {\n            return this.generateMultiChartVelocityTransformGLSL(cartesianVars, parseFunc);\n        }\n\n        // Single chart - use original logic\n        const forwardTransforms = this.charts && this.charts.length === 1\n            ? this.charts[0].forwardTransforms\n            : this.forwardTransforms;\n\n        // Compute forward Jacobian matrix: J_forward = \u2202(native)/\u2202(cartesian)\n        const jacobian = computeSymbolicJacobian(forwardTransforms, this.dimensions);\n\n        if (!jacobian) {\n            console.error('Failed to compute Jacobian for coordinate system:', this.name);\n            // Fallback: identity transform (incorrect but prevents crashes)\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (IDENTITY FALLBACK - ERROR)\n// WARNING: Jacobian computation failed, using identity transform\nvec${this.dimensions} transformVelocityToCartesian(vec${this.dimensions} vel_native, vec${this.dimensions} pos) {\n    return vel_native; // INCORRECT: Should use inverse Jacobian\n}`;\n        }\n\n        // CRITICAL FIX: Invert the Jacobian matrix\n        // By chain rule: vel_cartesian = J_inverse * vel_native\n        // where J_inverse = (J_forward)^(-1)\n        const inverseJacobian = invertJacobian(jacobian);\n\n        if (!inverseJacobian) {\n            console.error('Failed to invert Jacobian for coordinate system:', this.name);\n            console.error('Forward Jacobian was:', jacobian);\n            // Fallback: identity transform (incorrect but prevents crashes)\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (IDENTITY FALLBACK - ERROR)\n// WARNING: Jacobian inversion failed, using identity transform\n// This will produce INCORRECT results for non-Cartesian coordinates!\nvec${this.dimensions} transformVelocityToCartesian(vec${this.dimensions} vel_native, vec${this.dimensions} pos) {\n    return vel_native; // INCORRECT: Jacobian inversion failed\n}`;\n        }\n\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Generate matrix multiplication code: vel_cartesian = J_inverse * vel_native\n        const matrixMultCode = [];\n        for (let i = 0; i < this.dimensions; i++) {\n            const row = inverseJacobian[i];\n            const terms = row.map((entry, j) => {\n                const parsedEntry = parseFunc(entry, cartesianVars);\n                return `(${parsedEntry}) * vel_native.${swizzles[j]}`;\n            });\n            matrixMultCode.push(`    result.${swizzles[i]} = ${terms.join(' + ')};`);\n        }\n\n        return `\n// Velocity transform: ${this.name} \u2192 Cartesian via Inverse Jacobian\n// J_forward = [${jacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//             ')}]\n// J_inverse = [${inverseJacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//             ')}]\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${swizzles[i]}`).join(', ')};\n${matrixMultCode.join('\\n')}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for velocity transform using multiple charts\n     * Each chart has different coordinate singularities, allowing robust computation\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code with chart selection\n     */\n    generateMultiChartVelocityTransformGLSL(cartesianVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Compute Jacobian and inverse for each chart\n        const chartData = this.charts.map((chart, index) => {\n            const jacobian = computeSymbolicJacobian(chart.forwardTransforms, this.dimensions);\n\n            if (!jacobian) {\n                console.warn(`Failed to compute Jacobian for chart ${index} of ${this.name}`);\n                return null;\n            }\n\n            const inverseJacobian = invertJacobian(jacobian);\n\n            if (!inverseJacobian) {\n                console.warn(`Failed to invert Jacobian for chart ${index} of ${this.name}`);\n                return null;\n            }\n\n            // Generate matrix multiplication code for this chart\n            const matrixMultCode = [];\n            for (let i = 0; i < this.dimensions; i++) {\n                const row = inverseJacobian[i];\n                const terms = row.map((entry, j) => {\n                    const parsedEntry = parseFunc(entry, cartesianVars);\n                    return `(${parsedEntry}) * vel_native.${swizzles[j]}`;\n                });\n                matrixMultCode.push(`        result.${swizzles[i]} = ${terms.join(' + ')};`);\n            }\n\n            return {\n                condition: chart.condition,\n                jacobian,\n                inverseJacobian,\n                matrixMultCode\n            };\n        }).filter(data => data !== null);\n\n        if (chartData.length === 0) {\n            console.error('All charts failed for coordinate system:', this.name);\n            return `\n// Velocity transform: ${this.name} \u2192 Cartesian (ERROR: All charts failed)\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    return vel_native; // FALLBACK: All charts failed\n}`;\n        }\n\n        // Generate GLSL with if/else chain for chart selection\n        const chartCases = chartData.map((data, index) => {\n            const glslCondition = generateGLSLCondition(data.condition, cartesianVars);\n            const keyword = index === 0 ? 'if' : 'else if';\n            const condPart = glslCondition === 'true' ? '' : ` (${glslCondition})`;\n\n            return `    ${keyword}${condPart} {\n        // Chart ${index + 1}: Avoid singularities when ${data.condition}\n${data.matrixMultCode.join('\\n')}\n    }`;\n        }).join(' ');\n\n        // Add documentation comments\n        const chartDocs = chartData.map((data, index) => {\n            return `// Chart ${index + 1}: condition=${data.condition}\n//   J_forward = [${data.jacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//               ')}]\n//   J_inverse = [${data.inverseJacobian.map(row => '[' + row.join(', ') + ']').join(',\\n//               ')}]`;\n        }).join('\\n');\n\n        return `\n// Velocity transform: ${this.name} \u2192 Cartesian via Multiple Charts\n// Using ${chartData.length} charts to handle coordinate singularities\n${chartDocs}\n${dimType} transformVelocityToCartesian(${dimType} vel_native, ${dimType} pos) {\n    ${dimType} result;\n    float ${cartesianVars.map((v, i) => `${v} = pos.${swizzles[i]}`).join(', ')};\n${chartCases}\n    return result;\n}`;\n    }\n\n    /**\n     * Generate GLSL code for inverse transform (Native \u2192 Cartesian)\n     * Uses three-tier strategy:\n     *   Tier 1: Explicit inverse transforms (if provided)\n     *   Tier 3: Newton's method iterative solver (if useIterativeSolver is true)\n     * @param {Array<string>} nativeVars - Native variable names (e.g., ['r', 'theta'])\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateInverseTransformGLSL(nativeVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n        const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n\n        // Tier 1: Use explicit inverse transforms if provided\n        if (this.inverseTransforms && this.inverseTransforms.length === this.dimensions) {\n            const transformCode = this.inverseTransforms.map((expr, i) => {\n                // Inverse transforms are simple expressions using native variable names\n                // Don't parse them - use directly since we extract variables first\n                return `    result.${swizzles[i]} = ${expr};`;\n            }).join('\\n');\n\n            return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// Using explicit inverse transform (Tier 1)\n${dimType} transformToCartesian(${dimType} native_pos) {\n    ${dimType} result;\n    float ${nativeVars.map((v, i) => `${v} = native_pos.${swizzles[i]}`).join(', ')};\n${transformCode}\n    return result;\n}`;\n        }\n\n        // Tier 3: Use Newton's method iterative solver\n        if (this.useIterativeSolver) {\n            return this.generateNewtonSolverGLSL(cartesianVars, nativeVars, parseFunc);\n        }\n\n        // Fallback: Identity transform (should not reach here in production)\n        console.warn(`No inverse transform defined for ${this.name}, using identity`);\n        return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// WARNING: Using identity fallback - no inverse defined!\n${dimType} transformToCartesian(${dimType} native_pos) {\n    return native_pos; // INCORRECT: Identity fallback\n}`;\n    }\n\n    /**\n     * Generate GLSL code for Newton's method iterative solver\n     * Solves: F(cartesian) = native_target\n     * Using: cartesian_new = cartesian_old - inverse(J) * (F(cartesian_old) - native_target)\n     * @param {Array<string>} cartesianVars - Cartesian variable names\n     * @param {Array<string>} nativeVars - Native variable names\n     * @param {Function} parseFunc - Parser function\n     * @returns {string} - GLSL function code\n     */\n    generateNewtonSolverGLSL(cartesianVars, nativeVars, parseFunc) {\n        const dimType = `vec${this.dimensions}`;\n        const matType = `mat${this.dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n\n        // Generate forward transform code (used inside Newton iteration)\n        const forwardTransformCode = this.forwardTransforms.map((expr, i) => {\n            const glsl = parseFunc(expr, cartesianVars);\n            return `        native.${swizzles[i]} = ${glsl};`;\n        }).join('\\n');\n\n        // Compute Jacobian for Newton's method\n        const jacobian = computeSymbolicJacobian(this.forwardTransforms, this.dimensions);\n\n        if (!jacobian) {\n            console.error('Failed to compute Jacobian for Newton solver:', this.name);\n            return `\n// Newton solver failed: could not compute Jacobian\n${dimType} transformToCartesian(${dimType} native_pos) {\n    return native_pos; // ERROR FALLBACK\n}`;\n        }\n\n        // Generate Jacobian matrix construction code\n        const jacobianCode = [];\n        for (let i = 0; i < this.dimensions; i++) {\n            for (let j = 0; j < this.dimensions; j++) {\n                const parsedEntry = parseFunc(jacobian[i][j], cartesianVars);\n                jacobianCode.push(`        J[${i}][${j}] = ${parsedEntry};`);\n            }\n        }\n\n        return `\n// Inverse transform: ${this.name} (Native \u2192 Cartesian)\n// Using Newton's method iterative solver (Tier 3)\n${dimType} transformToCartesian(${dimType} native_target) {\n    // Use previous position as initial guess (stored in global)\n    ${dimType} guess = vec${this.dimensions}(0.0); // TODO: Use previous frame position\n\n    const int MAX_ITERATIONS = 10;\n    const float TOLERANCE = 1e-6;\n\n    for(int iter = 0; iter < MAX_ITERATIONS; iter++) {\n        // Evaluate forward transform at current guess\n        ${dimType} native;\n        float ${cartesianVars.map((v, i) => `${v} = guess.${swizzles[i]}`).join(', ')};\n${forwardTransformCode}\n\n        // Compute error\n        ${dimType} error = native - native_target;\n        if(length(error) < TOLERANCE) {\n            break; // Converged\n        }\n\n        // Build Jacobian matrix J = \u2202(native)/\u2202(cartesian)\n        ${matType} J;\n${jacobianCode.join('\\n')}\n\n        // Newton step: guess -= inverse(J) * error\n        guess -= inverse(J) * error;\n    }\n\n    return guess;\n}`;\n    }\n\n    /**\n     * Serialize to JSON for storage\n     */\n    toJSON() {\n        return {\n            name: this.name,\n            dimensions: this.dimensions,\n            variables: this.variables,\n            forwardTransforms: this.forwardTransforms,\n            inverseTransforms: this.inverseTransforms,\n            useIterativeSolver: this.useIterativeSolver\n        };\n    }\n\n    /**\n     * Deserialize from JSON\n     */\n    static fromJSON(json) {\n        return new CoordinateSystem(\n            json.name,\n            json.dimensions,\n            json.variables,\n            json.forwardTransforms,\n            json.inverseTransforms || null,\n            json.useIterativeSolver || false\n        );\n    }\n}\n\n/**\n * Preset coordinate systems\n */\nconst PRESET_COORDINATE_SYSTEMS = {\n    // 2D Systems\n    'cartesian2d': new CoordinateSystem(\n        'Cartesian 2D',\n        2,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' }\n        ],\n        ['x', 'y'], // Forward: Identity transform\n        ['x', 'y']  // Inverse: Identity transform\n    ),\n\n    'polar2d': new CoordinateSystem(\n        'Polar 2D',\n        2,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' }\n        ],\n        [\n            'sqrt(x^2 + y^2)',  // r = \u221A(x\u00B2 + y\u00B2)\n            'atan2(y, x)'       // \u03B8 = atan2(y, x)\n        ],\n        [\n            'r*cos(theta)',     // x = r\u00B7cos(\u03B8)\n            'r*sin(theta)'      // y = r\u00B7sin(\u03B8)\n        ]\n    ),\n\n    // 3D Systems\n    'cartesian3d': new CoordinateSystem(\n        'Cartesian 3D',\n        3,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' },\n            { label: 'z', displayLabel: 'z' }\n        ],\n        ['x', 'y', 'z'], // Forward: Identity\n        ['x', 'y', 'z']  // Inverse: Identity\n    ),\n\n    'cylindrical3d': new CoordinateSystem(\n        'Cylindrical 3D',\n        3,\n        [\n            { label: 'rho', displayLabel: '\u03C1' },\n            { label: 'phi', displayLabel: '\u03C6' },\n            { label: 'z', displayLabel: 'z' }\n        ],\n        [\n            'sqrt(x^2 + y^2)',   // \u03C1 = \u221A(x\u00B2 + y\u00B2)\n            'atan2(y, x)',       // \u03C6 = atan2(y, x)\n            'z'                  // z = z\n        ],\n        [\n            'rho*cos(phi)',      // x = \u03C1\u00B7cos(\u03C6)\n            'rho*sin(phi)',      // y = \u03C1\u00B7sin(\u03C6)\n            'z'                  // z = z\n        ]\n    ),\n\n    'spherical3d': new CoordinateSystem(\n        'Spherical 3D',\n        3,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' },\n            { label: 'phi', displayLabel: '\u03C6' }\n        ],\n        [\n            'sqrt(x^2 + y^2 + z^2)',              // r = \u221A(x\u00B2 + y\u00B2 + z\u00B2)\n            'acos(z / sqrt(x^2 + y^2 + z^2))',   // \u03B8 = acos(z/r) - polar angle from z-axis\n            'atan2(y, x)'                         // \u03C6 = atan2(y, x) - azimuthal angle\n        ],\n        [\n            'r*sin(theta)*cos(phi)',              // x = r\u00B7sin(\u03B8)\u00B7cos(\u03C6)\n            'r*sin(theta)*sin(phi)',              // y = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\n            'r*cos(theta)'                        // z = r\u00B7cos(\u03B8)\n        ]\n    ),\n\n    // 4D Systems\n    'cartesian4d': new CoordinateSystem(\n        'Cartesian 4D',\n        4,\n        [\n            { label: 'x', displayLabel: 'x' },\n            { label: 'y', displayLabel: 'y' },\n            { label: 'z', displayLabel: 'z' },\n            { label: 'w', displayLabel: 'w' }\n        ],\n        ['x', 'y', 'z', 'w'], // Forward: Identity\n        ['x', 'y', 'z', 'w']  // Inverse: Identity\n    ),\n\n    'hyperspherical4d': new CoordinateSystem(\n        'Hyperspherical 4D',\n        4,\n        [\n            { label: 'r', displayLabel: 'r' },\n            { label: 'theta', displayLabel: '\u03B8' },\n            { label: 'phi', displayLabel: '\u03C6' },\n            { label: 'psi', displayLabel: '\u03C8' }\n        ],\n        [\n            'sqrt(x^2 + y^2 + z^2 + w^2)',                           // r = \u221A(x\u00B2 + y\u00B2 + z\u00B2 + w\u00B2)\n            'acos(w / sqrt(x^2 + y^2 + z^2 + w^2))',                // \u03B8 = acos(w/r)\n            'acos(z / sqrt(x^2 + y^2 + z^2))',                      // \u03C6 = acos(z/\u221A(x\u00B2+y\u00B2+z\u00B2))\n            'atan2(y, x)'                                            // \u03C8 = atan2(y, x)\n        ],\n        [\n            'r*sin(theta)*sin(phi)*cos(psi)',                        // x = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\u00B7cos(\u03C8)\n            'r*sin(theta)*sin(phi)*sin(psi)',                        // y = r\u00B7sin(\u03B8)\u00B7sin(\u03C6)\u00B7sin(\u03C8)\n            'r*sin(theta)*cos(phi)',                                 // z = r\u00B7sin(\u03B8)\u00B7cos(\u03C6)\n            'r*cos(theta)'                                           // w = r\u00B7cos(\u03B8)\n        ]\n    )\n};\n\n/**\n * Get coordinate system by key\n */\nfunction getCoordinateSystem(key) {\n    return PRESET_COORDINATE_SYSTEMS[key] || null;\n}\n\n/**\n * Get preset coordinate systems for a given dimension\n */\nfunction getPresetsForDimension(dimensions) {\n    const presets = [];\n    for (const [key, system] of Object.entries(PRESET_COORDINATE_SYSTEMS)) {\n        if (system.dimensions === dimensions) {\n            presets.push({ key, system });\n        }\n    }\n    return presets;\n}\n\n/**\n * Get default Cartesian coordinate system for given dimensions\n */\nfunction getCartesianSystem(dimensions) {\n    const key = `cartesian${dimensions}d`;\n    return PRESET_COORDINATE_SYSTEMS[key] || createCartesianSystem(dimensions);\n}\n\n/**\n * Create a Cartesian coordinate system for arbitrary dimensions\n */\nfunction createCartesianSystem(dimensions) {\n    const varNames = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, dimensions);\n    return new CoordinateSystem(\n        `Cartesian ${dimensions}D`,\n        dimensions,\n        varNames.map(v => ({ label: v, displayLabel: v })),\n        varNames\n    );\n}\n\n// Export for use in other modules\nexport {\n    CoordinateSystem,\n    PRESET_COORDINATE_SYSTEMS,\n    getCoordinateSystem,\n    getPresetsForDimension,\n    getCartesianSystem,\n    createCartesianSystem\n};\n", "/**\n * Float packing utilities for encoding/decoding floats into RGBA bytes\n * This allows high-precision storage in WebGL textures without requiring\n * floating point texture support.\n *\n * Uses fixed-point encoding for simplicity and reliability\n */\n\n// Fixed point scale for encoding [0, 1] values to 32-bit integers\nconst FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n\n/**\n * Encode a float into 4 bytes (RGBA) using fixed-point encoding\n * Expects value in [0, 1] range (viewport-normalized)\n * @param {number} value - Float value to encode (should be in [0, 1])\n * @param {Uint8Array} out - Output array\n * @param {number} offset - Offset in output array\n */\nexport function encodeFloatRGBA(value, out, offset) {\n    // Clamp to [0, 1] range\n    value = Math.max(0, Math.min(1, value));\n\n    // Map to [0, 2^32-1]\n    const intValue = Math.floor(value * FIXED_POINT_SCALE);\n\n    // Split 32-bit integer into 4 bytes (big-endian)\n    out[offset + 0] = (intValue >>> 24) & 0xFF;\n    out[offset + 1] = (intValue >>> 16) & 0xFF;\n    out[offset + 2] = (intValue >>> 8) & 0xFF;\n    out[offset + 3] = intValue & 0xFF;\n}\n\n/**\n * Decode RGBA bytes into a float using fixed-point decoding\n * Returns value in [0, 1] range (viewport-normalized)\n * @param {number} r - Red channel (0-255)\n * @param {number} g - Green channel (0-255)\n * @param {number} b - Blue channel (0-255)\n * @param {number} a - Alpha channel (0-255)\n * @returns {number} Decoded float value in [0, 1]\n */\nexport function decodeFloatRGBA(r, g, b, a) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    const intValue = (r << 24) | (g << 16) | (b << 8) | a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    // Handle unsigned to avoid sign issues\n    const uintValue = intValue >>> 0; // convert to unsigned\n    return uintValue / FIXED_POINT_SCALE;\n}\n\n/**\n * GLSL shader code for fixed-point constants (shared by encode/decode)\n * @returns {string} GLSL constant definitions\n */\nexport function getFixedPointConstantsGLSL() {\n    return `\n// Map to [0, 1] range for maximum precision at any zoom level\nconst float FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n`;\n}\n\n/**\n * GLSL shader code for encoding float to RGBA\n * Now uses viewport-relative encoding for dimensions 0 and 1 (x, y)\n * @returns {string} GLSL function code\n */\nexport function getEncodeGLSL() {\n    return `\n// Encode float in [0, 1] range to RGBA bytes\nvec4 encodeFloat(float v) {\n    // Clamp to [0, 1]\n    v = clamp(v, 0.0, 1.0);\n\n    // Map to [0, 2^32-1]\n    float normalized = v * FIXED_POINT_SCALE;\n\n    // Split into 4 bytes (big-endian)\n    float byte0 = floor(normalized / 16777216.0);  // 2^24\n    normalized -= byte0 * 16777216.0;\n    float byte1 = floor(normalized / 65536.0);      // 2^16\n    normalized -= byte1 * 65536.0;\n    float byte2 = floor(normalized / 256.0);        // 2^8\n    normalized -= byte2 * 256.0;\n    float byte3 = floor(normalized);\n\n    return vec4(byte0, byte1, byte2, byte3) / 255.0;\n}\n\n// Helper to normalize world coordinate to [0, 1] relative to viewport\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return (worldValue - minVal) / (maxVal - minVal);\n}\n\n// Helper to denormalize from [0, 1] back to world coordinates\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return minVal + normalized * (maxVal - minVal);\n}\n`;\n}\n\n/**\n * GLSL shader code for decoding RGBA to float\n * @returns {string} GLSL function code\n */\nexport function getDecodeGLSL() {\n    return `\n// Decode RGBA bytes back to float in [0, 1] range\nfloat decodeFloat(vec4 rgba) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    vec4 bytes = rgba * 255.0;\n    float intValue = bytes.r * 16777216.0 + bytes.g * 65536.0 + bytes.b * 256.0 + bytes.a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    return intValue / FIXED_POINT_SCALE;\n}\n`;\n}\n", "/**\n * Control Mixins - Reusable control interface for ControlManager integration\n *\n * These mixins provide the standard Control interface that ControlManager expects,\n * allowing any class (not just ControlElement) to integrate with the control system.\n */\n\n/**\n * ControlMixin - Core ControlManager interface\n *\n * Provides save/load/apply integration with ControlManager.\n * Makes any class compatible with ControlManager's registration system.\n *\n * Required methods to implement in subclass:\n * - getValue() - Return current value\n * - setValue(value) - Set value and update UI\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with control interface\n */\nexport const ControlMixin = (Base) => class extends Base {\n    constructor() {\n        super();\n\n        // Control interface properties\n        this.settingsKey = null;\n        this.defaultValue = null;\n        this.onChange = null;\n        this._callback = null;\n    }\n\n    /**\n     * Initialize settingsKey from attribute or id\n     * Call this from connectedCallback or initializeProperties\n     */\n    initializeControlProperties() {\n        this.settingsKey = this.getAttribute('settings-key') || this.id;\n\n        // Read default value if provided as attribute\n        const defaultAttr = this.getAttribute('default');\n        if (defaultAttr !== null && this.defaultValue === null) {\n            this.defaultValue = parseFloat(defaultAttr);\n        }\n    }\n\n    /**\n     * ABSTRACT: Get current control value\n     * Must be implemented by subclass\n     */\n    getValue() {\n        throw new Error('getValue() must be implemented by subclass');\n    }\n\n    /**\n     * ABSTRACT: Set control value and update UI\n     * Must be implemented by subclass\n     */\n    setValue(value) {\n        throw new Error('setValue() must be implemented by subclass');\n    }\n\n    /**\n     * Reset control to default value\n     */\n    reset() {\n        if (this.defaultValue !== null && this.defaultValue !== undefined) {\n            this.setValue(this.defaultValue);\n        }\n    }\n\n    /**\n     * Attach change callback from ControlManager\n     * @param {Function} callback - Callback to trigger on value change (usually manager.debouncedApply)\n     */\n    attachListeners(callback) {\n        this._callback = callback;\n    }\n\n    /**\n     * Trigger onChange callback and ControlManager callback\n     * Call this whenever the control value changes\n     */\n    triggerChange() {\n        const value = this.getValue();\n\n        // Call custom onChange handler if provided\n        if (this.onChange && typeof this.onChange === 'function') {\n            this.onChange(value);\n        }\n\n        // Call ControlManager callback (debounced apply)\n        if (this._callback && typeof this._callback === 'function') {\n            this._callback();\n        }\n\n        // Dispatch custom event for other listeners\n        this.dispatchEvent(new CustomEvent('control-change', {\n            detail: { value },\n            bubbles: true\n        }));\n    }\n\n    /**\n     * Save control value to settings object\n     * Called by ControlManager.getSettings()\n     * @param {Object} settings - Settings object to populate\n     */\n    saveToSettings(settings) {\n        if (this.settingsKey) {\n            settings[this.settingsKey] = this.getValue();\n        }\n    }\n\n    /**\n     * Restore control value from settings object\n     * Called by ControlManager.applySettings()\n     * @param {Object} settings - Settings object to read from\n     */\n    restoreFromSettings(settings) {\n        if (settings && this.settingsKey && settings[this.settingsKey] != null) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n};\n\n/**\n * ButtonActionMixin - Add +/- button support\n *\n * Provides automatic button registration and action handling.\n * Looks for buttons with action attributes: [increase], [decrease], [reset], etc.\n *\n * Methods to optionally override in subclass:\n * - handleButtonAction(action) - Handle button clicks\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with button action support\n */\nexport const ButtonActionMixin = (Base) => class extends Base {\n    /**\n     * Handle button action\n     * Override in subclass to implement specific button behaviors\n     * @param {string} action - Action name (increase, decrease, reset, etc.)\n     * @returns {boolean} True if action was handled, false otherwise\n     */\n    handleButtonAction(action) {\n        // Default implementation for reset\n        if (action === 'reset') {\n            this.reset();\n            return true;\n        }\n\n        // Subclass should override to handle other actions\n        return false;\n    }\n\n    /**\n     * Auto-register buttons with action attributes\n     * Call this from attachInternalListeners or connectedCallback\n     * @param {Array<string>} actions - Array of action names to register\n     */\n    registerActionButtons(actions) {\n        for (const action of actions) {\n            // Find all buttons with this action attribute\n            const buttons = this.querySelectorAll(`[${action}]`);\n            for (const button of buttons) {\n                button.addEventListener('click', () => {\n                    const handled = this.handleButtonAction(action);\n                    if (handled && typeof this.triggerChange === 'function') {\n                        // Note: triggerChange is called by the action handler if needed\n                        // This is here as a fallback in case subclass forgot\n                    }\n                });\n            }\n        }\n    }\n};\n\n/**\n * AttributeHelpersMixin - Convenience attribute readers\n *\n * Provides helper methods for reading typed attributes from HTML.\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with attribute helpers\n */\nexport const AttributeHelpersMixin = (Base) => class extends Base {\n    /**\n     * Read number attribute with default fallback\n     * @param {string} name - Attribute name\n     * @param {number} defaultValue - Default value if attribute not found\n     * @returns {number} Parsed number or default\n     */\n    getNumberAttribute(name, defaultValue = 0) {\n        const value = this.getAttribute(name);\n        if (value === null) return defaultValue;\n        const parsed = parseFloat(value);\n        return isNaN(parsed) ? defaultValue : parsed;\n    }\n\n    /**\n     * Read boolean attribute with default fallback\n     * Supports: attribute present = true, \"true\", \"false\", attribute name as value\n     * @param {string} name - Attribute name\n     * @param {boolean} defaultValue - Default value if attribute not found\n     * @returns {boolean} Boolean value\n     */\n    getBooleanAttribute(name, defaultValue = false) {\n        const value = this.getAttribute(name);\n        if (value === null) return defaultValue;\n\n        // Empty attribute or attribute=attribute means true\n        if (value === '' || value === name) return true;\n\n        // Explicit true/false\n        return value === 'true';\n    }\n};\n\n/**\n * Compose multiple mixins together\n * Helper function to make mixin composition more readable\n *\n * @example\n * class MyControl extends composeMixins(\n *   HTMLElement,\n *   ControlMixin,\n *   ButtonActionMixin,\n *   AttributeHelpersMixin\n * ) { ... }\n *\n * @param {Class} Base - Base class\n * @param {...Function} mixins - Mixins to apply (right to left)\n * @returns {Class} Composed class\n */\nexport function composeMixins(Base, ...mixins) {\n    return mixins.reduce((acc, mixin) => mixin(acc), Base);\n}\n", "/**\n * AnimatableSliderMixin - Add animation bounds UI to sliders\n *\n * Provides multi-thumb slider UI for setting animation min/max bounds,\n * animation state management, and interpolation during animation playback.\n *\n * Note: Accordion resizing is handled automatically by AccordionAwareMixin.\n * This mixin just calls triggerAccordionResize() when showing/hiding UI.\n */\n\n/**\n * AnimatableSliderMixin\n *\n * Adds animation capabilities to any slider control:\n * - Animation enable/disable button (\uD83C\uDFAC)\n * - Multi-thumb bounds slider (MIN/MAX handles)\n * - Current value indicator (orange line during playback)\n * - Animation state save/restore\n *\n * @param {Class} Base - Base class to extend (should be a slider with getValue/setValue)\n * @returns {Class} Extended class with animation capabilities\n */\nexport const AnimatableSliderMixin = (Base) => class extends Base {\n    constructor() {\n        super();\n\n        // Animation state\n        this.animationEnabled = false;\n        this.animationMin = null; // Set in connectedCallback\n        this.animationMax = null;\n        this.currentAlpha = 0.0;\n        this.isAnimating = false;\n    }\n\n    /**\n     * Override connectedCallback to initialize animation bounds\n     */\n    connectedCallback() {\n        super.connectedCallback();\n\n        // Initialize animation bounds from attributes or defaults\n        const animMinAttr = this.getAttribute('animation-min');\n        const animMaxAttr = this.getAttribute('animation-max');\n\n        if (animMinAttr !== null) {\n            this.animationMin = parseFloat(animMinAttr);\n        }\n        if (animMaxAttr !== null) {\n            this.animationMax = parseFloat(animMaxAttr);\n        }\n\n        // Default to full range if not specified\n        if (this.animationMin === null) {\n            this.animationMin = this.min || 0;\n        }\n        if (this.animationMax === null) {\n            this.animationMax = this.max || 100;\n        }\n    }\n\n    /**\n     * Override attachInternalListeners to add animation UI\n     */\n    attachInternalListeners() {\n        super.attachInternalListeners();\n\n        // Add animation button after other controls\n        this.addAnimationButton();\n\n        // Add multi-thumb slider UI (initially hidden)\n        this.addAnimationBoundsUI();\n\n        // Attach drag handlers to thumbs\n        this.attachThumbDragHandlers();\n    }\n\n    /**\n     * Add animation enable/disable button\n     */\n    addAnimationButton() {\n        const container = this.querySelector('.slider-control');\n        if (!container) return;\n\n        const animBtn = document.createElement('button');\n        animBtn.id = `${this.id}-anim-btn`;\n        animBtn.className = 'slider-btn anim-btn';\n        animBtn.title = 'Enable animation (\uD83C\uDFAC)';\n        animBtn.textContent = '\uD83C\uDFAC';\n        animBtn.addEventListener('click', (e) => {\n            e.stopPropagation();\n            this.setAnimationEnabled(!this.animationEnabled);\n        });\n\n        container.appendChild(animBtn);\n    }\n\n    /**\n     * Add multi-thumb slider UI for animation bounds\n     */\n    addAnimationBoundsUI() {\n        const container = this.querySelector('.slider-control');\n        if (!container) return;\n\n        const boundsHTML = `\n            <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds-slider\" style=\"display: none;\">\n                <div class=\"bounds-labels\">\n                    <span>Min: <span id=\"${this.id}-min-display\">${this.formatValue(this.animationMin)}</span></span>\n                    <span>Max: <span id=\"${this.id}-max-display\">${this.formatValue(this.animationMax)}</span></span>\n                </div>\n                <div class=\"multi-thumb-slider\">\n                    <div class=\"slider-track\"></div>\n                    <div id=\"${this.id}-range\" class=\"slider-range\"></div>\n                    <div id=\"${this.id}-current-indicator\" class=\"slider-current-indicator\"></div>\n                    <div id=\"${this.id}-min-handle\" class=\"slider-thumb min-thumb\" data-bound=\"min\">\n                        <span class=\"thumb-label\">MIN</span>\n                    </div>\n                    <div id=\"${this.id}-max-handle\" class=\"slider-thumb max-thumb\" data-bound=\"max\">\n                        <span class=\"thumb-label\">MAX</span>\n                    </div>\n                </div>\n            </div>\n        `;\n\n        container.insertAdjacentHTML('afterend', boundsHTML);\n    }\n\n    /**\n     * Enable/disable animation for this control\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Update the UI to show/hide animation controls\n     */\n    updateAnimationUI() {\n        const boundsContainer = document.getElementById(`${this.id}-animation-bounds`);\n        const animBtn = document.getElementById(`${this.id}-anim-btn`);\n\n        if (!boundsContainer || !animBtn) return;\n\n        if (this.animationEnabled) {\n            // Use jQuery slideDown for smooth animation\n            if (typeof $ !== 'undefined') {\n                $(boundsContainer).slideDown(200, () => {\n                    // Trigger accordion resize (handled by AccordionAwareMixin)\n                    if (this.triggerAccordionResize) {\n                        this.triggerAccordionResize();\n                    }\n                });\n            } else {\n                boundsContainer.style.display = 'block';\n                if (this.triggerAccordionResize) {\n                    this.triggerAccordionResize();\n                }\n            }\n\n            animBtn.classList.add('active');\n            animBtn.title = 'Disable animation (\uD83C\uDFAC)';\n            this.updateBoundsDisplay();\n        } else {\n            // Use jQuery slideUp for smooth animation\n            if (typeof $ !== 'undefined') {\n                $(boundsContainer).slideUp(200, () => {\n                    // Trigger accordion resize (handled by AccordionAwareMixin)\n                    if (this.triggerAccordionResize) {\n                        this.triggerAccordionResize();\n                    }\n                });\n            } else {\n                boundsContainer.style.display = 'none';\n                if (this.triggerAccordionResize) {\n                    this.triggerAccordionResize();\n                }\n            }\n\n            animBtn.classList.remove('active');\n            animBtn.title = 'Enable animation (\uD83C\uDFAC)';\n        }\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = Math.min(min, max);\n        this.animationMax = Math.max(min, max);\n        this.updateBoundsDisplay();\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     * Called during animation playback\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n\n        this.isAnimating = true;\n        this.setValue(value);\n        this.updateCurrentIndicator(alpha);\n        this.isAnimating = false;\n    }\n\n    /**\n     * Update the current value indicator position\n     */\n    updateCurrentIndicator(alpha) {\n        const indicator = document.getElementById(`${this.id}-current-indicator`);\n        if (indicator) {\n            indicator.style.left = `${alpha * 100}%`;\n        }\n    }\n\n    /**\n     * Update bounds display (handle positions and labels)\n     */\n    updateBoundsDisplay() {\n        const minHandle = document.getElementById(`${this.id}-min-handle`);\n        const maxHandle = document.getElementById(`${this.id}-max-handle`);\n        const minDisplay = document.getElementById(`${this.id}-min-display`);\n        const maxDisplay = document.getElementById(`${this.id}-max-display`);\n        const range = document.getElementById(`${this.id}-range`);\n\n        if (!minHandle || !maxHandle) return;\n\n        // Get min/max as percentages of the full slider range\n        const minPercent = this.valueToPercent(this.animationMin);\n        const maxPercent = this.valueToPercent(this.animationMax);\n\n        minHandle.style.left = `${minPercent}%`;\n        maxHandle.style.left = `${maxPercent}%`;\n\n        if (range) {\n            range.style.left = `${minPercent}%`;\n            range.style.width = `${maxPercent - minPercent}%`;\n        }\n\n        if (minDisplay) minDisplay.textContent = this.formatValue(this.animationMin);\n        if (maxDisplay) maxDisplay.textContent = this.formatValue(this.animationMax);\n    }\n\n    /**\n     * Convert value to percentage position on slider\n     * Override if slider uses non-linear scaling\n     */\n    valueToPercent(value) {\n        // Default linear scaling\n        const minValue = this.min || 0;\n        const maxValue = this.max || 100;\n        return ((value - minValue) / (maxValue - minValue)) * 100;\n    }\n\n    /**\n     * Convert percentage position to value\n     * Override if slider uses non-linear scaling\n     */\n    percentToValue(percent) {\n        // Default linear scaling\n        const minValue = this.min || 0;\n        const maxValue = this.max || 100;\n        return minValue + (percent / 100) * (maxValue - minValue);\n    }\n\n    /**\n     * Attach drag handlers to the min/max thumbs\n     */\n    attachThumbDragHandlers() {\n        const minHandle = document.getElementById(`${this.id}-min-handle`);\n        const maxHandle = document.getElementById(`${this.id}-max-handle`);\n\n        if (!minHandle || !maxHandle) return;\n\n        const track = minHandle.parentElement;\n\n        [\n            { handle: minHandle, bound: 'min' },\n            { handle: maxHandle, bound: 'max' }\n        ].forEach(({ handle, bound }) => {\n            let isDragging = false;\n\n            handle.addEventListener('mousedown', (e) => {\n                isDragging = true;\n                handle.classList.add('dragging');\n                document.body.style.userSelect = 'none';\n                e.preventDefault();\n            });\n\n            document.addEventListener('mousemove', (e) => {\n                if (!isDragging) return;\n\n                // Get mouse position relative to track\n                const rect = track.getBoundingClientRect();\n                const mouseX = e.clientX - rect.left;\n                const trackWidth = rect.width;\n\n                // Calculate percentage position (0-100)\n                let newPercent = (mouseX / trackWidth) * 100;\n                newPercent = Math.max(0, Math.min(100, newPercent));\n\n                // Convert to value\n                const value = this.percentToValue(newPercent);\n\n                // Update bound (with constraints)\n                if (bound === 'min') {\n                    if (value <= this.animationMax) {\n                        this.animationMin = value;\n                    }\n                } else {\n                    if (value >= this.animationMin) {\n                        this.animationMax = value;\n                    }\n                }\n\n                this.updateBoundsDisplay();\n            });\n\n            document.addEventListener('mouseup', () => {\n                if (isDragging) {\n                    isDragging = false;\n                    handle.classList.remove('dragging');\n                    document.body.style.userSelect = '';\n                }\n            });\n        });\n    }\n\n    /**\n     * Save animation state to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore animation state from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings && settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            // Update UI after DOM is ready\n            requestAnimationFrame(() => {\n                this.updateAnimationUI();\n            });\n        }\n    }\n};\n", "/**\n * AccordionAwareMixin - Automatic accordion resize on content changes\n *\n * Detects if a control is inside an accordion section and automatically\n * resizes the accordion when the control's size changes.\n *\n * Uses ResizeObserver for automatic detection - no manual calls needed!\n */\n\n/**\n * AccordionAwareMixin\n *\n * Automatically handles accordion resizing when control content changes.\n * Just apply this mixin to any control that might be in an accordion.\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with automatic accordion resize\n */\nexport const AccordionAwareMixin = (Base) => class extends Base {\n    constructor() {\n        super();\n        this._resizeObserver = null;\n        this._accordionSection = null;\n    }\n\n    /**\n     * Setup automatic accordion resize on connection\n     */\n    connectedCallback() {\n        super.connectedCallback();\n\n        // Wait for element to be fully initialized\n        requestAnimationFrame(() => {\n            this.setupAccordionResize();\n        });\n    }\n\n    /**\n     * Clean up observer on disconnect\n     */\n    disconnectedCallback() {\n        if (super.disconnectedCallback) {\n            super.disconnectedCallback();\n        }\n\n        if (this._resizeObserver) {\n            this._resizeObserver.disconnect();\n            this._resizeObserver = null;\n        }\n    }\n\n    /**\n     * Setup ResizeObserver to automatically resize accordion\n     */\n    setupAccordionResize() {\n        // Check if we're inside an accordion section\n        this._accordionSection = this.closest('.accordion-section');\n\n        if (!this._accordionSection) {\n            // Not in an accordion, nothing to do\n            return;\n        }\n\n        // Check if ResizeObserver is available\n        if (typeof ResizeObserver === 'undefined') {\n            console.warn('ResizeObserver not available, accordion auto-resize disabled');\n            return;\n        }\n\n        // Create observer to watch for size changes\n        this._resizeObserver = new ResizeObserver((entries) => {\n            // Debounce rapid changes\n            if (this._resizeTimeout) {\n                clearTimeout(this._resizeTimeout);\n            }\n\n            this._resizeTimeout = setTimeout(() => {\n                this.resizeAccordion();\n            }, 50);\n        });\n\n        // Observe this element for size changes\n        this._resizeObserver.observe(this);\n    }\n\n    /**\n     * Resize the parent accordion section\n     */\n    resizeAccordion() {\n        if (!this._accordionSection) return;\n\n        // Don't resize if accordion is collapsed\n        if (this._accordionSection.classList.contains('collapsed')) return;\n\n        // Set max-height to scrollHeight to fit content\n        const newHeight = this._accordionSection.scrollHeight + 'px';\n        this._accordionSection.style.maxHeight = newHeight;\n    }\n\n    /**\n     * Trigger an immediate accordion resize\n     * Call this when you know content has changed (e.g., show/hide elements)\n     */\n    triggerAccordionResize() {\n        if (!this._accordionSection) return;\n\n        // Force layout recalculation\n        requestAnimationFrame(() => {\n            this.resizeAccordion();\n        });\n    }\n};\n", "/**\n * ShadowDOMMixin - Adds shadow DOM support to ControlElement\n *\n * Provides shadow DOM creation and helper methods for querying shadow root.\n * Components using this mixin should:\n * 1. Call renderToShadow(htmlString) instead of setting innerHTML\n * 2. Use getShadowRoot() to access the shadow root\n * 3. Use shadowQuery() and shadowQueryAll() for element selection\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with shadow DOM support\n */\nexport const ShadowDOMMixin = (Base) => class extends Base {\n    constructor() {\n        super();\n        this._shadowRoot = null;\n    }\n\n    /**\n     * Create shadow DOM (called automatically if needed)\n     */\n    ensureShadowRoot() {\n        if (!this._shadowRoot) {\n            this._shadowRoot = this.attachShadow({ mode: 'open' });\n        }\n        return this._shadowRoot;\n    }\n\n    /**\n     * Get shadow root (creates if needed)\n     */\n    getShadowRoot() {\n        return this.ensureShadowRoot();\n    }\n\n    /**\n     * Render HTML to shadow DOM\n     * @param {string} htmlString - HTML to render\n     */\n    renderToShadow(htmlString) {\n        const shadow = this.ensureShadowRoot();\n        shadow.innerHTML = htmlString;\n    }\n\n    /**\n     * Query single element from shadow root\n     * @param {string} selector - CSS selector\n     * @returns {Element|null}\n     */\n    shadowQuery(selector) {\n        return this._shadowRoot ? this._shadowRoot.querySelector(selector) : null;\n    }\n\n    /**\n     * Query all elements from shadow root\n     * @param {string} selector - CSS selector\n     * @returns {NodeList}\n     */\n    shadowQueryAll(selector) {\n        return this._shadowRoot ? this._shadowRoot.querySelectorAll(selector) : [];\n    }\n\n    /**\n     * Override querySelector to use shadow root if available\n     * This makes the component work transparently with shadow DOM\n     */\n    querySelector(selector) {\n        if (this._shadowRoot) {\n            return this._shadowRoot.querySelector(selector);\n        }\n        return super.querySelector(selector);\n    }\n\n    /**\n     * Override querySelectorAll to use shadow root if available\n     */\n    querySelectorAll(selector) {\n        if (this._shadowRoot) {\n            return this._shadowRoot.querySelectorAll(selector);\n        }\n        return super.querySelectorAll(selector);\n    }\n};\n", "/**\n * CompositeMixin - Adds multi-child control management\n *\n * Provides the ability to compose multiple sub-controls into a single control\n * with an object-based getValue/setValue interface.\n *\n * Overrides ControlMixin's abstract getValue/setValue/reset to delegate to children.\n *\n * Subclasses must implement initializeChildren() to register child controls.\n *\n * Example:\n * ```\n * class MyComposite extends composeMixins(HTMLElement, ControlMixin, CompositeMixin) {\n *     initializeChildren() {\n *         const input1 = this.querySelector('#input1');\n *         const input2 = this.querySelector('#input2');\n *\n *         this.registerChildControl('foo',\n *             () => input1.value,\n *             (v) => { input1.value = v; },\n *             () => { input1.value = 'default'; }\n *         );\n *\n *         this.registerChildControl('bar',\n *             () => input2.value,\n *             (v) => { input2.value = v; },\n *             () => { input2.value = 'default'; }\n *         );\n *     }\n * }\n *\n * // getValue() returns: { foo: '...', bar: '...' }\n * // setValue({ foo: 'x', bar: 'y' }) updates both\n * ```\n *\n * @param {Class} Base - Base class to extend\n * @returns {Class} Extended class with composite control support\n */\nexport const CompositeMixin = (Base) => class extends Base {\n    constructor() {\n        super();\n\n        // Map of child control keys -> { getValue, setValue, reset }\n        this._childControls = new Map();\n    }\n\n    /**\n     * Register a child control\n     * @param {string} key - Key for this child in the composite value object\n     * @param {Function} getValue - Function to get child's current value\n     * @param {Function} setValue - Function to set child's value\n     * @param {Function} reset - Function to reset child to default\n     */\n    registerChildControl(key, getValue, setValue, reset) {\n        this._childControls.set(key, { getValue, setValue, reset });\n    }\n\n    /**\n     * Get current value (object with all child values)\n     * Overrides ControlMixin's abstract getValue()\n     */\n    getValue() {\n        const value = {};\n        for (const [key, control] of this._childControls.entries()) {\n            value[key] = control.getValue();\n        }\n        return value;\n    }\n\n    /**\n     * Set value (accepts object with child values)\n     * Overrides ControlMixin's abstract setValue()\n     */\n    setValue(value) {\n        if (typeof value !== 'object' || value === null) return;\n\n        for (const [key, control] of this._childControls.entries()) {\n            if (value[key] !== undefined) {\n                control.setValue(value[key]);\n            }\n        }\n    }\n\n    /**\n     * Reset all children to default values\n     * Overrides ControlMixin's reset()\n     */\n    reset() {\n        for (const control of this._childControls.values()) {\n            control.reset();\n        }\n    }\n\n    /**\n     * ABSTRACT: Initialize child controls (must be implemented by subclass)\n     * Call registerChildControl() for each child here\n     */\n    initializeChildren() {\n        throw new Error('Subclass must implement initializeChildren()');\n    }\n};\n", "/**\n * Mixins - Reusable control behaviors\n *\n * Centralized export point for all mixin modules.\n */\n\nexport {\n    ControlMixin,\n    ButtonActionMixin,\n    AttributeHelpersMixin,\n    composeMixins\n} from './control-mixin.js';\n\nexport {\n    AnimatableSliderMixin\n} from './animatable-mixin.js';\n\nexport {\n    AccordionAwareMixin\n} from './accordion-aware-mixin.js';\n\nexport {\n    ShadowDOMMixin\n} from './shadow-dom-mixin.js';\n\nexport {\n    CompositeMixin\n} from './composite-mixin.js';\n", "/**\n * Base class for all Web Component controls\n * Provides reactive binding system with {{variable}} syntax\n */\n\nimport { composeMixins, ControlMixin, ButtonActionMixin, AttributeHelpersMixin, AccordionAwareMixin } from '../mixins/index.js';\n\n/**\n * ControlElement - Base class for reactive Web Component controls\n *\n * Uses mixins to implement Control interface compatible with ControlManager.\n * Mixins provide:\n * - ControlMixin: getValue/setValue/reset/attachListeners/saveToSettings/restoreFromSettings/triggerChange\n * - ButtonActionMixin: handleButtonAction/registerActionButtons\n * - AttributeHelpersMixin: getNumberAttribute/getBooleanAttribute\n * - AccordionAwareMixin: Automatic accordion resize on content changes\n *\n * ControlElement adds:\n * - Reactive binding system with {{variable}} template syntax\n * - Template processing (inline, external, or direct innerHTML)\n * - Helper methods for element finding and listener attachment\n */\nexport class ControlElement extends composeMixins(\n    HTMLElement,\n    ControlMixin,\n    ButtonActionMixin,\n    AttributeHelpersMixin,\n    AccordionAwareMixin\n) {\n    constructor() {\n        super();\n\n        // Transform support for linear scaling (e.g., slider 0-100 \u2192 value 0.0-1.0)\n        this.transform = 1.0;\n\n        // Binding system\n        this._bindings = new Map(); // variable name -> Set of {element, type, attr}\n        this._boundProperties = new Set(); // properties exposed via bind-* attributes\n\n        // Internal state\n        this._initialized = false;\n    }\n\n    /**\n     * Called when element is connected to DOM\n     */\n    connectedCallback() {\n        if (this._initialized) return;\n\n        // Set id if not present (HTMLElement.id is automatically synced with attribute)\n        if (!this.id) {\n            this.id = this.generateId();\n        }\n\n        // Initialize control properties from mixins (settingsKey, defaultValue)\n        this.initializeControlProperties();\n\n        // Initialize properties from attributes\n        this.initializeProperties();\n\n        // Discover which properties are exposed via bind-* attributes\n        this.discoverBoundProperties();\n\n        // Process innerHTML: replace {{placeholders}} and register bindings\n        this.processTemplate();\n\n        // Attach event listeners\n        this.attachInternalListeners();\n\n        this._initialized = true;\n    }\n\n    /**\n     * Generate unique ID\n     */\n    generateId() {\n        return `control-${Math.random().toString(36).substr(2, 9)}`;\n    }\n\n    /**\n     * Initialize properties from attributes (override in subclasses)\n     */\n    initializeProperties() {\n        // Override in subclasses to read attributes and set properties\n    }\n\n    /**\n     * Discover which properties are bound via bind-* attributes\n     */\n    discoverBoundProperties() {\n        for (const attr of this.attributes) {\n            if (attr.name.startsWith('bind-')) {\n                const propName = attr.value; // e.g., bind-label=\"label\" -> \"label\"\n                this._boundProperties.add(propName);\n            }\n        }\n    }\n\n    /**\n     * Process template: replace {{placeholders}} and register bind-* elements\n     * Supports three modes:\n     * 1. <template> child element\n     * 2. External template via template=\"id\" attribute\n     * 3. Direct innerHTML\n     */\n    processTemplate() {\n        let templateContent = null;\n\n        // Check for external template reference\n        const templateId = this.getAttribute('template');\n        if (templateId) {\n            const externalTemplate = document.getElementById(templateId);\n            if (externalTemplate && externalTemplate.tagName === 'TEMPLATE') {\n                templateContent = externalTemplate.content.cloneNode(true);\n            }\n        }\n\n        // Check for inline <template> child\n        if (!templateContent) {\n            const inlineTemplate = this.querySelector(':scope > template');\n            if (inlineTemplate) {\n                templateContent = inlineTemplate.content.cloneNode(true);\n            }\n        }\n\n        // If we have template content, use it; otherwise use innerHTML\n        let workingRoot;\n        if (templateContent) {\n            // Clear existing content and use template\n            this.innerHTML = '';\n            this.appendChild(templateContent);\n            workingRoot = this;\n        } else {\n            // Use existing innerHTML\n            workingRoot = this;\n        }\n\n        // First pass: process attributes with {{variable}} syntax\n        const walker = document.createTreeWalker(\n            workingRoot,\n            NodeFilter.SHOW_ELEMENT,\n            null,\n            false\n        );\n\n        const attributeBindings = []; // Store for processing after innerHTML update\n        let node;\n\n        while (node = walker.nextNode()) {\n            if (node === this) continue;\n\n            for (const attr of Array.from(node.attributes)) {\n                const matches = attr.value.match(/\\{\\{(\\w+)\\}\\}/g);\n                if (matches) {\n                    // Replace {{variable}} with actual value\n                    let newValue = attr.value;\n                    matches.forEach(match => {\n                        const varName = match.slice(2, -2); // Remove {{ and }}\n                        // Check if property exists (works with getters/setters)\n                        if (varName in this && this[varName] !== undefined) {\n                            const value = this[varName];\n                            newValue = newValue.replace(match, value);\n\n                            // Store binding info for later registration\n                            attributeBindings.push({\n                                element: node,\n                                attrName: attr.name,\n                                varName: varName\n                            });\n                        }\n                    });\n                    attr.value = newValue;\n                }\n            }\n        }\n\n        // Second pass: replace {{variable}} in text content\n        let html = this.innerHTML;\n        html = html.replace(/\\{\\{(\\w+)\\}\\}/g, (match, varName) => {\n            // Check if property exists (works with getters/setters)\n            if (varName in this && this[varName] !== undefined) {\n                return this.formatValue(this[varName]);\n            }\n            return match; // Leave unchanged if property doesn't exist\n        });\n\n        // Update innerHTML with replaced placeholders\n        this.innerHTML = html;\n\n        // Register attribute bindings from first pass\n        // We need to re-query elements since innerHTML was replaced\n        for (const binding of attributeBindings) {\n            // Find the element again (it was recreated by innerHTML assignment)\n            // Use a more robust selector based on tag name and position\n            this.registerAttributeBinding(binding.varName, binding.attrName);\n        }\n\n        // Find all elements with bind-* attributes and register them\n        this.registerBindings(this);\n    }\n\n    /**\n     * Register attribute bindings for all elements with a specific attribute\n     */\n    registerAttributeBinding(varName, attrName) {\n        const elements = this.querySelectorAll(`[${attrName}]`);\n        for (const element of elements) {\n            // Check if this attribute's value references our variable\n            // (it should, since we found it in the first pass)\n            if (!this._bindings.has(varName)) {\n                this._bindings.set(varName, new Set());\n            }\n\n            const bindings = this._bindings.get(varName);\n            bindings.add({ element, type: 'attr', attr: attrName });\n        }\n    }\n\n    /**\n     * Recursively find and register all bind-* attributes in children\n     */\n    registerBindings(root) {\n        const walker = document.createTreeWalker(\n            root,\n            NodeFilter.SHOW_ELEMENT,\n            null,\n            false\n        );\n\n        let node;\n        while (node = walker.nextNode()) {\n            // Skip the root element itself\n            if (node === this) continue;\n\n            for (const attr of node.attributes) {\n                if (attr.name.startsWith('bind-')) {\n                    this.registerBinding(node, attr.name, attr.value);\n                }\n            }\n        }\n    }\n\n    /**\n     * Register a single binding\n     * @param {Element} element - The element to bind\n     * @param {string} bindAttr - The bind attribute name (e.g., \"bind-text\", \"bind-attr-value\")\n     * @param {string} varName - The variable name to bind to\n     */\n    registerBinding(element, bindAttr, varName) {\n        if (!this._bindings.has(varName)) {\n            this._bindings.set(varName, new Set());\n        }\n\n        const bindings = this._bindings.get(varName);\n\n        if (bindAttr === 'bind-text') {\n            bindings.add({ element, type: 'text', attr: null });\n        } else if (bindAttr.startsWith('bind-attr-')) {\n            const attrName = bindAttr.substring('bind-attr-'.length);\n            bindings.add({ element, type: 'attr', attr: attrName });\n        } else if (bindAttr === 'bind-value') {\n            bindings.add({ element, type: 'value', attr: null });\n        } else if (bindAttr.startsWith('bind-class-')) {\n            const className = bindAttr.substring('bind-class-'.length);\n            bindings.add({ element, type: 'class', attr: className });\n        } else if (bindAttr === 'bind-show') {\n            bindings.add({ element, type: 'show', attr: null });\n        }\n    }\n\n    /**\n     * Update all bindings for a given property\n     */\n    updateBindings(propName, value) {\n        if (!this._bindings.has(propName)) return;\n\n        const bindings = this._bindings.get(propName);\n        for (const binding of bindings) {\n            switch (binding.type) {\n                case 'text':\n                    binding.element.textContent = this.formatValue(value);\n                    break;\n                case 'attr':\n                    binding.element.setAttribute(binding.attr, value);\n                    break;\n                case 'value':\n                    binding.element.value = value;\n                    break;\n                case 'class':\n                    binding.element.classList.toggle(binding.attr, !!value);\n                    break;\n                case 'show':\n                    binding.element.style.display = value ? '' : 'none';\n                    break;\n            }\n        }\n    }\n\n    /**\n     * Format a value for display (can be overridden)\n     */\n    formatValue(value) {\n        if (value == null) return '';\n        return String(value);\n    }\n\n    /**\n     * Attach internal event listeners (override in subclasses)\n     */\n    attachInternalListeners() {\n        // Override in subclasses\n    }\n\n    /**\n     * Get current value from control (override in subclasses)\n     */\n    getValue() {\n        throw new Error('getValue() must be implemented by subclass');\n    }\n\n    /**\n     * Set value in control (override in subclasses)\n     */\n    setValue(value) {\n        throw new Error('setValue() must be implemented by subclass');\n    }\n\n    /**\n     * Note: reset(), handleButtonAction(), attachListeners(), saveToSettings(),\n     * restoreFromSettings(), triggerChange(), getNumberAttribute(), and\n     * getBooleanAttribute() are provided by mixins (ControlMixin, ButtonActionMixin,\n     * AttributeHelpersMixin).\n     */\n\n    /**\n     * Helper: Find input element\n     * Looks for data-role=\"input\" or specific type, or any input\n     */\n    findInput(type = null, role = 'input') {\n        // Try data-role first\n        let input = this.querySelector(`[data-role=\"${role}\"]`);\n        if (input) return input;\n\n        // Try by type\n        if (type) {\n            input = this.querySelector(`input[type=\"${type}\"]`);\n            if (input) return input;\n        }\n\n        // Fallback to any input\n        return this.querySelector('input');\n    }\n\n    /**\n     * Note: registerActionButtons() is provided by ButtonActionMixin\n     */\n\n    /**\n     * Helper: Create reactive property\n     * Creates a getter/setter that automatically calls updateBindings()\n     *\n     * @param {string} name - Property name\n     * @param {*} defaultValue - Initial value\n     *\n     * Example:\n     * this.createReactiveProperty('value', 50);\n     * // Creates this._value = 50 and this.value getter/setter\n     */\n    createReactiveProperty(name, defaultValue) {\n        const privateName = `_${name}`;\n        this[privateName] = defaultValue;\n\n        Object.defineProperty(this, name, {\n            get() {\n                return this[privateName];\n            },\n            set(newValue) {\n                this[privateName] = newValue;\n                this.updateBindings(name, newValue);\n            },\n            enumerable: true,\n            configurable: true\n        });\n    }\n\n    /**\n     * Helper: Create multiple reactive properties from config\n     *\n     * @param {Object} config - Object mapping property names to default values\n     *\n     * Example:\n     * this.createReactiveProperties({\n     *   label: 'Value',\n     *   value: 50,\n     *   min: 0,\n     *   max: 100\n     * });\n     */\n    createReactiveProperties(config) {\n        for (const [name, defaultValue] of Object.entries(config)) {\n            this.createReactiveProperty(name, defaultValue);\n        }\n    }\n\n    /**\n     * Helper: Add input listener with debouncing\n     *\n     * @param {HTMLElement} element - Element to listen to\n     * @param {Function} callback - Callback function\n     * @param {number} debounce - Debounce time in ms (0 = no debounce)\n     */\n    addInputListener(element, callback, debounce = 0) {\n        if (!element) return;\n\n        if (debounce > 0) {\n            let timeout;\n            element.addEventListener('input', () => {\n                clearTimeout(timeout);\n                timeout = setTimeout(callback, debounce);\n            });\n        } else {\n            element.addEventListener('input', callback);\n        }\n    }\n\n    /**\n     * Helper: Find element by role\n     * Uses data-role attribute or CSS selector fallback\n     *\n     * @param {string} role - Role name\n     * @param {string} fallback - Fallback CSS selector\n     *\n     * Example:\n     * this.findByRole('slider', 'input[type=\"range\"]');\n     */\n    findByRole(role, fallback = null) {\n        let element = this.querySelector(`[data-role=\"${role}\"]`);\n        if (!element && fallback) {\n            element = this.querySelector(fallback);\n        }\n        return element;\n    }\n\n    /**\n     * Helper: Find all elements by role\n     *\n     * @param {string} role - Role name\n     *\n     * Example:\n     * this.findAllByRole('option'); // Returns all [data-role=\"option\"]\n     */\n    findAllByRole(role) {\n        return this.querySelectorAll(`[data-role=\"${role}\"]`);\n    }\n}\n", "/**\n * Linear Slider Web Component\n */\n\nimport { ControlElement } from './base.js';\n\n/**\n * LinearSlider - Linear slider control with reactive binding\n *\n * Usage:\n * <linear-slider\n *   id=\"dimensions\"\n *   label=\"Dimensions\"\n *   default=\"2\"\n *   min=\"0\"\n *   max=\"6\"\n *   step=\"1\"\n *   display-format=\"0\"\n *   transform=\"1.0\"\n *   bind-label=\"label\"\n *   bind-value=\"value\"\n *   bind-min=\"min\"\n *   bind-max=\"max\">\n *   <label>\n *     <span>{{label}}</span>: <span bind-text=\"value\">{{value}}</span>\n *   </label>\n *   <input type=\"range\" min=\"{{min}}\" max=\"{{max}}\" step=\"{{step}}\" value=\"{{value}}\">\n * </linear-slider>\n *\n * The 'transform' attribute enables linear scaling:\n * - transform=\"100\" \u2192 slider 0-100 maps to value 0.0-1.0 (PercentSlider behavior)\n * - transform=\"20\" \u2192 slider 10-100 maps to value 0.5-5.0 (BilateralSpatial behavior)\n */\nexport class LinearSlider extends ControlElement {\n    constructor() {\n        super();\n\n        // Create reactive properties (automatic getters/setters with updateBindings)\n        this.createReactiveProperties({\n            label: 'Value',\n            value: 50,\n            min: 0,\n            max: 100,\n            step: 1\n        });\n\n        this._displayFormat = null;\n        this._displayMultiplier = 1.0;\n        this._displaySuffix = '';\n        this.sliderInput = null;\n    }\n\n    initializeProperties() {\n        // Read configuration from attributes\n        this.label = this.getAttribute('label') || 'Value';\n        this.min = this.getNumberAttribute('min', 0);\n        this.max = this.getNumberAttribute('max', 100);\n        this.step = this.getNumberAttribute('step', 1);\n        this.transform = this.getNumberAttribute('transform', 1.0);\n        this.defaultValue = this.getNumberAttribute('default', 50);\n\n        // Display formatting options\n        this._displayMultiplier = this.getNumberAttribute('display-multiplier', 1.0);\n        this._displaySuffix = this.getAttribute('display-suffix') || '';\n\n        // Parse display format BEFORE setting value (since setter triggers formatValue)\n        const formatAttr = this.getAttribute('display-format');\n        if (formatAttr !== null) {\n            const decimals = parseInt(formatAttr);\n            this._displayFormat = (v) => (v != null ? v.toFixed(decimals) : '0');\n        } else {\n            this._displayFormat = (v) => (v != null ? v.toFixed(2) : '0');\n        }\n\n        // Set value after _displayFormat is ready\n        this.value = this.defaultValue;\n    }\n\n    formatValue(value) {\n        // Only use _displayFormat for numeric values (not strings like labels)\n        // This allows animation bounds to be formatted correctly too\n        if (this._displayFormat && typeof value === 'number') {\n            // Apply multiplier and suffix for display\n            const displayValue = value * this._displayMultiplier;\n            return this._displayFormat(displayValue) + this._displaySuffix;\n        }\n        return super.formatValue(value);\n    }\n\n    attachInternalListeners() {\n        // Find the slider input using helper\n        this.sliderInput = this.findByRole('slider', 'input[type=\"range\"]');\n        if (!this.sliderInput) return;\n\n        const updateValue = () => {\n            this.value = parseFloat(this.sliderInput.value) / this.transform;\n            this.triggerChange();\n        };\n\n        // Add input listener (fires during drag)\n        this.addInputListener(this.sliderInput, updateValue);\n\n        // Add change listener (fires on click and after drag ends)\n        this.sliderInput.addEventListener('change', updateValue);\n\n        // Add click listener to handle clicks on the track\n        this.sliderInput.addEventListener('click', (e) => {\n            // The browser will update the slider value automatically on click,\n            // but we need to trigger our update function\n            updateValue();\n        });\n\n        // Register action buttons using helper\n        this.registerActionButtons(['decrease', 'increase', 'decrease-large', 'increase-large', 'reset']);\n    }\n\n    getValue() {\n        // Read from actual DOM input if available\n        if (this.sliderInput) {\n            return parseFloat(this.sliderInput.value) / this.transform;\n        }\n        return this.value;\n    }\n\n    setValue(newValue) {\n        this.value = newValue;\n        if (this.sliderInput) {\n            this.sliderInput.value = newValue * this.transform;\n        }\n    }\n\n    handleButtonAction(action) {\n        const currentValue = this.value;\n        let newValue = currentValue;\n\n        // Convert slider units to value units using transform\n        // For PercentSlider (transform=100): slider 0-100, value 0.0-1.0\n        const valueStep = this.step / this.transform;\n        const valueMin = this.min / this.transform;\n        const valueMax = this.max / this.transform;\n\n        if (action === 'increase') {\n            newValue = Math.min(valueMax, currentValue + valueStep);\n        } else if (action === 'decrease') {\n            newValue = Math.max(valueMin, currentValue - valueStep);\n        } else if (action === 'increase-large') {\n            newValue = Math.min(valueMax, currentValue + valueStep * 10);\n        } else if (action === 'decrease-large') {\n            newValue = Math.max(valueMin, currentValue - valueStep * 10);\n        } else if (action === 'reset') {\n            newValue = this.defaultValue;\n        } else {\n            return false;\n        }\n\n        if (newValue !== currentValue) {\n            this.setValue(newValue);\n            this.triggerChange();\n            return true;\n        }\n\n        return false;\n    }\n}\n", "/**\n * Animatable Slider Web Component\n * Extends LinearSlider with animation bounds UI\n */\n\nimport { LinearSlider } from './slider.js';\nimport { AnimatableSliderMixin } from '../mixins/index.js';\n\n/**\n * AnimatableSlider - Linear slider with animation bounds\n *\n * Usage:\n * <animatable-slider\n *   id=\"fade\"\n *   label=\"Fade Speed\"\n *   default=\"0.999\"\n *   min=\"0\"\n *   max=\"100\"\n *   step=\"0.1\"\n *   animation-min=\"0.95\"\n *   animation-max=\"0.9995\"\n *   display-format=\"4\">\n *   <!-- Standard slider HTML -->\n * </animatable-slider>\n *\n * Features:\n * - All LinearSlider features (transform support, reactive binding)\n * - Animation enable/disable button (\uD83C\uDFAC)\n * - Multi-thumb bounds slider (MIN/MAX handles)\n * - Current value indicator during animation playback\n * - Animation state save/restore\n */\nexport class AnimatableSlider extends AnimatableSliderMixin(LinearSlider) {\n    constructor() {\n        super();\n    }\n\n    /**\n     * Override valueToPercent for custom transforms\n     * Handles log scale and other non-linear transforms\n     */\n    valueToPercent(value) {\n        // If we have custom transform functions, use them\n        if (this._customTransform && this._customInverseTransform) {\n            // value is in actual space, need to convert to slider space then to percent\n            const sliderValue = this._customInverseTransform(value);\n            const minSlider = this.min || 0;\n            const maxSlider = this.max || 100;\n            return ((sliderValue - minSlider) / (maxSlider - minSlider)) * 100;\n        }\n\n        // Otherwise use parent's implementation (handles linear transform attribute)\n        return super.valueToPercent ? super.valueToPercent(value) : ((value - this.min) / (this.max - this.min)) * 100;\n    }\n\n    /**\n     * Override percentToValue for custom transforms\n     */\n    percentToValue(percent) {\n        // If we have custom transform functions, use them\n        if (this._customTransform && this._customInverseTransform) {\n            // Convert percent to slider value, then apply transform\n            const minSlider = this.min || 0;\n            const maxSlider = this.max || 100;\n            const sliderValue = minSlider + (percent / 100) * (maxSlider - minSlider);\n            return this._customTransform(sliderValue);\n        }\n\n        // Otherwise use parent's implementation\n        return super.percentToValue ? super.percentToValue(percent) : this.min + (percent / 100) * (this.max - this.min);\n    }\n\n    /**\n     * Override getValue to use custom transform if available\n     */\n    getValue() {\n        if (this._customTransform && this.sliderInput) {\n            const sliderValue = parseFloat(this.sliderInput.value);\n            return this._customTransform(sliderValue);\n        }\n        // Otherwise use parent's implementation\n        return super.getValue();\n    }\n\n    /**\n     * Override setValue to use custom transform if available\n     */\n    setValue(newValue) {\n        if (this._customInverseTransform && this.sliderInput) {\n            // Use custom transform\n            this.value = newValue;\n            const sliderValue = this._customInverseTransform(newValue);\n            this.sliderInput.value = sliderValue;\n        } else {\n            // Use parent's implementation\n            super.setValue(newValue);\n        }\n    }\n\n    /**\n     * Set custom transform functions (for fade slider's log scale)\n     * @param {Function} transform - Function to convert slider value to actual value\n     * @param {Function} inverseTransform - Function to convert actual value to slider value\n     */\n    setCustomTransform(transform, inverseTransform) {\n        this._customTransform = transform;\n        this._customInverseTransform = inverseTransform;\n\n        // Re-apply current value with new transform\n        if (this.value !== undefined && this.sliderInput) {\n            const sliderValue = this._customInverseTransform(this.value);\n            this.sliderInput.value = sliderValue;\n        }\n\n        // Update bounds display if animation UI is already created\n        if (this.animationEnabled) {\n            this.updateBoundsDisplay();\n        }\n    }\n}\n\n/**\n * Helper function to create fade slider's logarithmic transform\n * Maps slider [0-100] to exponential fade values [0.9-0.9999]\n * Inverted: 0 = no fade (0.9999), 100 = maximum fade (0.9)\n */\nexport function createFadeTransform() {\n    const minFade = 0.9;      // Maximum fade speed (slider at 100)\n    const maxFade = 0.9999;   // No fade (slider at 0)\n    const minLog = Math.log(minFade);\n    const maxLog = Math.log(maxFade);\n    const scale = (maxLog - minLog) / 100;\n\n    return {\n        transform: (sliderValue) => {\n            // Invert: 0 \u2192 0.9999 (no fade), 100 \u2192 0.9 (max fade)\n            const inverted = 100 - sliderValue;\n            return Math.exp(minLog + scale * inverted);\n        },\n        inverseTransform: (fadeValue) => {\n            // Invert back: 0.9999 \u2192 0, 0.9 \u2192 100\n            const position = (Math.log(fadeValue) - minLog) / scale;\n            return 100 - position;\n        }\n    };\n}\n", "/**\n * Texture manager for N-dimensional particle positions\n * Uses ping-pong textures to update positions on GPU\n */\n\n/**\n * Create a collection of textures for storing N-dimensional positions\n */\nexport class TextureManager {\n    constructor(gl, dimensions, resolution, strategy) {\n        this.gl = gl;\n        this.dimensions = dimensions;\n        this.resolution = resolution;\n        this.strategy = strategy;\n\n        // Create read and write texture pairs for each dimension (dual buffering for point mode)\n        this.readTextures = [];\n        this.writeTextures = [];\n\n        for (let i = 0; i < dimensions; i++) {\n            this.readTextures.push(this.createTexture());\n            this.writeTextures.push(this.createTexture());\n        }\n\n        // Triple buffering (always active for velocity computation and line rendering)\n        this.lineMode = false; // Render mode: false = points, true = lines\n        this.prevTextures = [];\n        for (let i = 0; i < dimensions; i++) {\n            this.prevTextures.push(this.createTexture());\n        }\n\n        // Note: Age is stored in alpha channel of dimension 0, no separate age textures needed\n\n        // Texture units start from 0\n        this.textureUnitOffset = 0;\n    }\n\n    /**\n     * Create a single texture using the configured strategy\n     */\n    createTexture() {\n        const gl = this.gl;\n        const texture = gl.createTexture();\n        const format = this.strategy.getTextureFormat();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n\n        // Create empty texture using strategy's format\n        gl.texImage2D(\n            gl.TEXTURE_2D,\n            0,\n            format.internalFormat,\n            this.resolution,\n            this.resolution,\n            0,\n            format.format,\n            format.type,\n            null\n        );\n\n        return texture;\n    }\n\n    /**\n     * Set line rendering mode (affects draw call only, not texture management)\n     * @param {boolean} enabled - Whether to render lines (true) or points (false)\n     */\n    setLineMode(enabled) {\n        this.lineMode = enabled; // Only affects rendering, prevTextures always exist\n    }\n\n    /**\n     * Enable previous textures (no-op, textures always exist now)\n     * @param {boolean} enabled - Whether previous textures are needed\n     */\n    setNeedsPrevTextures(enabled) {\n        // No-op: prevTextures are always created now\n    }\n\n    /**\n     * Initialize textures with particle data\n     * @param {TypedArray[]} data - Array of encoded particle positions (one per dimension)\n     */\n    initializeData(data) {\n        const gl = this.gl;\n        const format = this.strategy.getTextureFormat();\n\n        for (let i = 0; i < this.dimensions; i++) {\n            // Initialize read texture with data\n            gl.bindTexture(gl.TEXTURE_2D, this.readTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                data[i]\n            );\n\n            // Write texture stays empty (will be written to in first frame)\n            gl.bindTexture(gl.TEXTURE_2D, this.writeTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                null\n            );\n\n            // Initialize previous texture with same data\n            gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[i]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                data[i]\n            );\n        }\n\n        // Initialize alpha channel of dimension 0 to age = 1.0 so particles render immediately\n        // Age is stored in alpha channel of u_pos_0\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        // For float textures (RGBA format), set alpha channel to 1.0\n        if (format.format === gl.RGBA) {\n            // Re-read the data[0] texture to modify alpha channel\n            const dim0Data = data[0];\n            for (let i = 0; i < this.resolution * this.resolution; i++) {\n                // Alpha is the 4th component (index 3) in RGBA\n                if (componentsPerValue === 4) {\n                    dim0Data[i * 4 + 3] = 1.0; // Set age = 1.0\n                }\n            }\n\n            // Re-upload dimension 0 with modified alpha\n            gl.bindTexture(gl.TEXTURE_2D, this.readTextures[0]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                dim0Data\n            );\n\n            // Also upload to previous texture\n            gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[0]);\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                format.internalFormat,\n                this.resolution,\n                this.resolution,\n                0,\n                format.format,\n                format.type,\n                dim0Data\n            );\n        }\n    }\n\n    /**\n     * Bind read textures to shader uniforms\n     * @param {WebGLProgram} program - Shader program\n     */\n    bindReadTextures(program) {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            const uniformName = `u_pos_${i}`;\n            const location = gl.getUniformLocation(program, uniformName);\n\n            if (location !== null) {\n                gl.activeTexture(gl.TEXTURE0 + this.textureUnitOffset + i);\n                gl.bindTexture(gl.TEXTURE_2D, this.readTextures[i]);\n                gl.uniform1i(location, this.textureUnitOffset + i);\n            }\n        }\n    }\n\n    /**\n     * Bind previous frame textures to shader uniforms (always available)\n     * @param {WebGLProgram} program - Shader program\n     */\n    bindPrevTextures(program) {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            const uniformName = `u_prev_pos_${i}`;\n            const location = gl.getUniformLocation(program, uniformName);\n\n            if (location !== null) {\n                // Use texture units after the current position textures\n                const textureUnit = this.textureUnitOffset + this.dimensions + i;\n                gl.activeTexture(gl.TEXTURE0 + textureUnit);\n                gl.bindTexture(gl.TEXTURE_2D, this.prevTextures[i]);\n                gl.uniform1i(location, textureUnit);\n            }\n        }\n    }\n\n    /**\n     * Get write texture for a specific dimension\n     * @param {number} dimension - Dimension index\n     */\n    getWriteTexture(dimension) {\n        return this.writeTextures[dimension];\n    }\n\n    /**\n     * Swap read and write textures (ping-pong for points, triple-buffer rotation for lines)\n     */\n    swap() {\n        // Triple buffer rotation: prev <- read <- write <- prev\n        const temp = this.prevTextures;\n        this.prevTextures = this.readTextures;\n        this.readTextures = this.writeTextures;\n        this.writeTextures = temp;\n\n        // Age is now in alpha channel of dimension 0, swapped with position textures\n    }\n\n    /**\n     * Resize textures\n     */\n    resize(newResolution) {\n        const gl = this.gl;\n        this.resolution = newResolution;\n\n        // Delete old textures\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.deleteTexture(this.readTextures[i]);\n            gl.deleteTexture(this.writeTextures[i]);\n            gl.deleteTexture(this.prevTextures[i]);\n        }\n\n        // Create new ones\n        this.readTextures = [];\n        this.writeTextures = [];\n        this.prevTextures = [];\n\n        for (let i = 0; i < this.dimensions; i++) {\n            this.readTextures.push(this.createTexture());\n            this.writeTextures.push(this.createTexture());\n            this.prevTextures.push(this.createTexture());\n        }\n    }\n\n    /**\n     * Clean up resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.deleteTexture(this.readTextures[i]);\n            gl.deleteTexture(this.writeTextures[i]);\n            gl.deleteTexture(this.prevTextures[i]);\n        }\n\n        this.readTextures = [];\n        this.writeTextures = [];\n        this.prevTextures = [];\n    }\n\n    /**\n     * Get current read textures (for debugging)\n     */\n    getReadTextures() {\n        return this.readTextures;\n    }\n\n    /**\n     * Read back texture data (for debugging/analysis)\n     */\n    readTexture(dimension) {\n        const gl = this.gl;\n        const format = this.strategy.getTextureFormat();\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        const data = new ArrayType(this.resolution * this.resolution * componentsPerValue);\n\n        const framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n        gl.framebufferTexture2D(\n            gl.FRAMEBUFFER,\n            gl.COLOR_ATTACHMENT0,\n            gl.TEXTURE_2D,\n            this.readTextures[dimension],\n            0\n        );\n\n        gl.readPixels(0, 0, this.resolution, this.resolution, format.format, format.type, data);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.deleteFramebuffer(framebuffer);\n\n        return data;\n    }\n}\n", "/**\n * HDR Framebuffer Management\n * Handles creation and management of floating-point render targets for HDR rendering\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * FramebufferManager class\n * Manages HDR framebuffers with float texture attachments\n */\nexport class FramebufferManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.useHDR = config.useHDR !== undefined ? config.useHDR : true;\n        this.usePingPong = config.usePingPong !== undefined ? config.usePingPong : true;\n\n        // Check for required extensions\n        this.checkExtensions();\n\n        // Create framebuffers and textures\n        this.initialize();\n\n        logger.info('FramebufferManager initialized', {\n            width,\n            height,\n            useHDR: this.useHDR,\n            hdrSupported: this.hdrSupported,\n            textureFormat: this.getTextureFormatName()\n        });\n    }\n\n    /**\n     * Check for required WebGL extensions\n     */\n    checkExtensions() {\n        const gl = this.gl;\n\n        logger.verbose('Checking WebGL extensions for HDR support...');\n\n        // Check for float texture support (needed for particle positions, already checked elsewhere)\n        this.floatTextureExt = gl.getExtension('OES_texture_float');\n\n        // Check for half-float texture support\n        this.halfFloatTextureExt = gl.getExtension('OES_texture_half_float');\n\n        // Check for float color buffer (WebGL 1.0)\n        this.floatColorBufferExt = gl.getExtension('WEBGL_color_buffer_float') ||\n                                    gl.getExtension('EXT_color_buffer_float');\n\n        // Check for half-float color buffer (WebGL 1.0)\n        this.halfFloatColorBufferExt = gl.getExtension('EXT_color_buffer_half_float');\n\n        // Check for linear filtering of float textures\n        this.floatLinearExt = gl.getExtension('OES_texture_float_linear');\n        this.halfFloatLinearExt = gl.getExtension('OES_texture_half_float_linear');\n\n        // Check for float blending (needed for additive blending with float framebuffers)\n        this.floatBlendExt = gl.getExtension('EXT_float_blend');\n\n        logger.verbose('WebGL extension support:', {\n            OES_texture_float: !!this.floatTextureExt,\n            OES_texture_half_float: !!this.halfFloatTextureExt,\n            WEBGL_color_buffer_float: !!this.floatColorBufferExt,\n            EXT_color_buffer_half_float: !!this.halfFloatColorBufferExt,\n            OES_texture_float_linear: !!this.floatLinearExt,\n            OES_texture_half_float_linear: !!this.halfFloatLinearExt,\n            EXT_float_blend: !!this.floatBlendExt\n        });\n\n        // Determine HDR support\n        this.hdrSupported = !!(this.floatColorBufferExt || this.halfFloatColorBufferExt);\n\n        logger.verbose(`HDR support determined: ${this.hdrSupported ? 'SUPPORTED' : 'NOT SUPPORTED'}`);\n\n        // If HDR requested but not supported, fall back to LDR\n        if (this.useHDR && !this.hdrSupported) {\n            logger.warn('HDR rendering requested but not supported by device. Falling back to LDR.');\n            this.useHDR = false;\n        }\n\n        // Prefer full float, fall back to half float\n        if (this.useHDR) {\n            if (this.floatColorBufferExt) {\n                this.hdrType = gl.FLOAT;\n                this.hdrTypeExt = this.floatTextureExt;\n                this.linearExt = this.floatLinearExt;\n                logger.info('Selected RGBA32F (full float) for HDR framebuffers');\n            } else if (this.halfFloatColorBufferExt) {\n                this.hdrType = this.halfFloatTextureExt.HALF_FLOAT_OES;\n                this.hdrTypeExt = this.halfFloatTextureExt;\n                this.linearExt = this.halfFloatLinearExt;\n                logger.info('Selected RGBA16F (half float) for HDR framebuffers');\n            }\n        } else {\n            logger.verbose('Using LDR (RGBA8) framebuffers');\n        }\n    }\n\n    /**\n     * Initialize framebuffers and textures\n     */\n    initialize() {\n        const gl = this.gl;\n\n        logger.verbose(`Creating ${this.usePingPong ? 'ping-pong' : 'single'} framebuffers...`);\n\n        // Create two framebuffers for ping-pong rendering\n        if (this.usePingPong) {\n            this.framebuffers = [\n                gl.createFramebuffer(),\n                gl.createFramebuffer()\n            ];\n\n            this.textures = [\n                this.createTexture(),\n                this.createTexture()\n            ];\n\n            // Create shared depth buffer for both framebuffers\n            this.depthBuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n\n            // Attach textures and depth buffer to framebuffers\n            for (let i = 0; i < 2; i++) {\n                gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n                gl.framebufferTexture2D(\n                    gl.FRAMEBUFFER,\n                    gl.COLOR_ATTACHMENT0,\n                    gl.TEXTURE_2D,\n                    this.textures[i],\n                    0\n                );\n\n                // Attach depth buffer\n                gl.framebufferRenderbuffer(\n                    gl.FRAMEBUFFER,\n                    gl.DEPTH_ATTACHMENT,\n                    gl.RENDERBUFFER,\n                    this.depthBuffer\n                );\n\n                // Check framebuffer status\n                this.checkFramebufferStatus(i);\n            }\n\n            // Track current buffer index\n            this.currentIndex = 0;\n        } else {\n            // Single framebuffer\n            this.framebuffers = [gl.createFramebuffer()];\n            this.textures = [this.createTexture()];\n\n            // Create depth buffer\n            this.depthBuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, this.width, this.height);\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[0]);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                this.textures[0],\n                0\n            );\n\n            // Attach depth buffer\n            gl.framebufferRenderbuffer(\n                gl.FRAMEBUFFER,\n                gl.DEPTH_ATTACHMENT,\n                gl.RENDERBUFFER,\n                this.depthBuffer\n            );\n\n            this.checkFramebufferStatus(0);\n            this.currentIndex = 0;\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Create a texture (HDR or LDR depending on configuration)\n     */\n    createTexture() {\n        const gl = this.gl;\n        const texture = gl.createTexture();\n\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        // Use linear filtering if supported, otherwise nearest\n        const minFilter = (this.useHDR && this.linearExt) ? gl.LINEAR : gl.NEAREST;\n        const magFilter = (this.useHDR && this.linearExt) ? gl.LINEAR : gl.NEAREST;\n\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\n\n        // Allocate texture storage\n        if (this.useHDR) {\n            // HDR: use float or half-float texture\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA,\n                this.width,\n                this.height,\n                0,\n                gl.RGBA,\n                this.hdrType,\n                null\n            );\n        } else {\n            // LDR: use standard RGBA8 texture\n            gl.texImage2D(\n                gl.TEXTURE_2D,\n                0,\n                gl.RGBA,\n                this.width,\n                this.height,\n                0,\n                gl.RGBA,\n                gl.UNSIGNED_BYTE,\n                null\n            );\n        }\n\n        return texture;\n    }\n\n    /**\n     * Check framebuffer completeness\n     */\n    checkFramebufferStatus(index) {\n        const gl = this.gl;\n\n        // Check if WebGL context is lost\n        if (gl.isContextLost()) {\n            throw new Error('WebGL context lost');\n        }\n\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            const errorMsg = this.getFramebufferStatusString(status);\n            logger.error(`Framebuffer ${index} is not complete: ${errorMsg}`, {\n                format: this.getTextureFormatName(),\n                size: `${this.width}x${this.height}`,\n                status: status,\n                contextLost: gl.isContextLost()\n            });\n            throw new Error(`Framebuffer ${index} incomplete: ${errorMsg}`);\n        }\n\n        logger.verbose(`Framebuffer ${index} created successfully: ${this.getTextureFormatName()} at ${this.width}x${this.height}`);\n    }\n\n    /**\n     * Get human-readable framebuffer status string\n     */\n    getFramebufferStatusString(status) {\n        const gl = this.gl;\n        switch (status) {\n            case gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:\n                return 'INCOMPLETE_ATTACHMENT';\n            case gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:\n                return 'INCOMPLETE_MISSING_ATTACHMENT';\n            case gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:\n                return 'INCOMPLETE_DIMENSIONS';\n            case gl.FRAMEBUFFER_UNSUPPORTED:\n                return 'UNSUPPORTED';\n            default:\n                return `UNKNOWN (${status})`;\n        }\n    }\n\n    /**\n     * Get human-readable texture format name\n     */\n    getTextureFormatName() {\n        if (!this.useHDR) return 'RGBA8 (LDR)';\n        if (this.hdrType === this.gl.FLOAT) return 'RGBA32F (Full HDR)';\n        return 'RGBA16F (Half HDR)';\n    }\n\n    /**\n     * Bind current framebuffer for rendering\n     */\n    bind() {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[this.currentIndex]);\n        gl.viewport(0, 0, this.width, this.height);\n    }\n\n    /**\n     * Bind to canvas (unbind framebuffer)\n     */\n    bindCanvas() {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Get current texture\n     */\n    getCurrentTexture() {\n        return this.textures[this.currentIndex];\n    }\n\n    /**\n     * Get previous texture (for ping-pong rendering)\n     */\n    getPreviousTexture() {\n        if (!this.usePingPong) return this.textures[0];\n        return this.textures[1 - this.currentIndex];\n    }\n\n    /**\n     * Swap ping-pong buffers\n     */\n    swap() {\n        if (this.usePingPong) {\n            this.currentIndex = 1 - this.currentIndex;\n        }\n    }\n\n    /**\n     * Clear current framebuffer\n     */\n    clear(r = 0, g = 0, b = 0, a = 1) {\n        const gl = this.gl;\n        this.bind();\n        gl.clearColor(r, g, b, a);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n\n    /**\n     * Clear all framebuffers (used for reset/resize)\n     */\n    clearAll(r = 0, g = 0, b = 0, a = 1) {\n        const gl = this.gl;\n        for (let i = 0; i < this.framebuffers.length; i++) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n            gl.clearColor(r, g, b, a);\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Resize framebuffers\n     */\n    resize(width, height) {\n        if (width === this.width && height === this.height) return;\n\n        logger.info('Resizing HDR framebuffers', {\n            from: `${this.width}x${this.height}`,\n            to: `${width}x${height}`,\n            format: this.getTextureFormatName()\n        });\n\n        this.width = width;\n        this.height = height;\n\n        const gl = this.gl;\n\n        // Delete old textures\n        for (const texture of this.textures) {\n            gl.deleteTexture(texture);\n        }\n\n        // Delete old depth buffer\n        if (this.depthBuffer) {\n            gl.deleteRenderbuffer(this.depthBuffer);\n        }\n\n        // Recreate depth buffer with new size\n        this.depthBuffer = gl.createRenderbuffer();\n        gl.bindRenderbuffer(gl.RENDERBUFFER, this.depthBuffer);\n        gl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, width, height);\n\n        // Recreate textures\n        this.textures = [];\n        for (let i = 0; i < this.framebuffers.length; i++) {\n            this.textures.push(this.createTexture());\n\n            // Reattach to framebuffer\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffers[i]);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                this.textures[i],\n                0\n            );\n\n            // Reattach depth buffer\n            gl.framebufferRenderbuffer(\n                gl.FRAMEBUFFER,\n                gl.DEPTH_ATTACHMENT,\n                gl.RENDERBUFFER,\n                this.depthBuffer\n            );\n\n            this.checkFramebufferStatus(i);\n        }\n\n        this.gl.bindFramebuffer(this.gl.FRAMEBUFFER, null);\n\n        // Clear all buffers after resize\n        this.clearAll();\n    }\n\n    /**\n     * Dispose of all resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        for (const framebuffer of this.framebuffers) {\n            gl.deleteFramebuffer(framebuffer);\n        }\n\n        for (const texture of this.textures) {\n            gl.deleteTexture(texture);\n        }\n\n        this.framebuffers = [];\n        this.textures = [];\n\n        logger.verbose('FramebufferManager disposed');\n    }\n\n    /**\n     * Check if HDR is enabled and supported\n     */\n    isHDR() {\n        return this.useHDR && this.hdrSupported;\n    }\n\n    /**\n     * Get HDR support status\n     */\n    getHDRSupport() {\n        return {\n            supported: this.hdrSupported,\n            enabled: this.useHDR,\n            format: this.getTextureFormatName(),\n            hasFloatColorBuffer: !!this.floatColorBufferExt,\n            hasHalfFloatColorBuffer: !!this.halfFloatColorBufferExt,\n            hasLinearFiltering: !!this.linearExt\n        };\n    }\n}\n", "/**\n * Bilateral Filter Manager\n * Edge-preserving noise filter that smooths flat areas while preserving sharp edges\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { createProgram } from './shaders.js';\n\n/**\n * Generate Bilateral Filter Shader\n * Blurs based on both spatial distance AND intensity difference\n */\nfunction generateBilateralFilterShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform vec2 u_resolution;\nuniform float u_spatialSigma;   // Spatial blur radius\nuniform float u_intensitySigma; // Edge preservation threshold\n\nvarying vec2 v_uv;\n\n// Gaussian function\nfloat gaussian(float x, float sigma) {\n    return exp(-(x * x) / (2.0 * sigma * sigma));\n}\n\n// Luminance for edge detection\nfloat luminance(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvoid main() {\n    vec2 texelSize = 1.0 / u_resolution;\n\n    vec3 centerColor = texture2D(u_screen, v_uv).rgb;\n    float centerLum = luminance(centerColor);\n\n    // Single-pass noise detection using simple statistics\n    const float brightnessThreshold = 0.05;\n\n    // Sample 3x3 neighborhood (unrolled - no arrays)\n    float s0 = luminance(texture2D(u_screen, v_uv + vec2(-1.0, -1.0) * texelSize).rgb);\n    float s1 = luminance(texture2D(u_screen, v_uv + vec2( 0.0, -1.0) * texelSize).rgb);\n    float s2 = luminance(texture2D(u_screen, v_uv + vec2( 1.0, -1.0) * texelSize).rgb);\n    float s3 = luminance(texture2D(u_screen, v_uv + vec2(-1.0,  0.0) * texelSize).rgb);\n    float s4 = luminance(texture2D(u_screen, v_uv + vec2( 0.0,  0.0) * texelSize).rgb);\n    float s5 = luminance(texture2D(u_screen, v_uv + vec2( 1.0,  0.0) * texelSize).rgb);\n    float s6 = luminance(texture2D(u_screen, v_uv + vec2(-1.0,  1.0) * texelSize).rgb);\n    float s7 = luminance(texture2D(u_screen, v_uv + vec2( 0.0,  1.0) * texelSize).rgb);\n    float s8 = luminance(texture2D(u_screen, v_uv + vec2( 1.0,  1.0) * texelSize).rgb);\n\n    // Compute statistics\n    float sum = s0 + s1 + s2 + s3 + s4 + s5 + s6 + s7 + s8;\n    float sumSquares = s0*s0 + s1*s1 + s2*s2 + s3*s3 + s4*s4 + s5*s5 + s6*s6 + s7*s7 + s8*s8;\n\n    float brightCount = 0.0;\n    if (s0 > brightnessThreshold) brightCount += 1.0;\n    if (s1 > brightnessThreshold) brightCount += 1.0;\n    if (s2 > brightnessThreshold) brightCount += 1.0;\n    if (s3 > brightnessThreshold) brightCount += 1.0;\n    if (s4 > brightnessThreshold) brightCount += 1.0;\n    if (s5 > brightnessThreshold) brightCount += 1.0;\n    if (s6 > brightnessThreshold) brightCount += 1.0;\n    if (s7 > brightnessThreshold) brightCount += 1.0;\n    if (s8 > brightnessThreshold) brightCount += 1.0;\n\n    float mean = sum / 9.0;\n    float variance = (sumSquares / 9.0) - (mean * mean);\n\n    // Simple edge detection: check gradient magnitude\n    float gradX = abs(s5 - s3); // right - left\n    float gradY = abs(s7 - s1); // bottom - top\n    float gradient = gradX + gradY;\n\n    // Noise detection: sparse scattered particles\n    // If there's ANY variance in a dark region with low gradient, it's probably noise\n\n    bool isDarkAndSparse = (mean < 0.2) && (brightCount < 5.0);\n    bool hasNoEdges = (gradient < 0.15);\n\n    // Apply blur to dark sparse regions with no strong edges\n    bool shouldBlur = isDarkAndSparse && hasNoEdges;\n\n    if (!shouldBlur) {\n        // Structured region - pass through unchanged\n        gl_FragColor = vec4(centerColor, 1.0);\n        return;\n    }\n\n    // Sparse region - apply aggressive gaussian blur\n    vec3 colorSum = vec3(0.0);\n    float weightSum = 0.0;\n\n    // Larger kernel radius for stronger smoothing\n    const int radius = 5; // 11x11 kernel\n\n    for (int x = -radius; x <= radius; x++) {\n        for (int y = -radius; y <= radius; y++) {\n            vec2 offset = vec2(float(x), float(y)) * texelSize;\n            vec3 sampleColor = texture2D(u_screen, v_uv + offset).rgb;\n\n            // Only spatial weight (pure gaussian blur in sparse regions)\n            float spatialDist = length(vec2(float(x), float(y)));\n            float weight = gaussian(spatialDist, u_spatialSigma);\n\n            colorSum += sampleColor * weight;\n            weightSum += weight;\n        }\n    }\n\n    // Normalize\n    vec3 result = colorSum / weightSum;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n\n/**\n * BilateralFilterManager class\n * Single-pass edge-preserving blur\n */\nexport class BilateralFilterManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.enabled = config.enabled !== undefined ? config.enabled : false; // Disabled by default\n        this.spatialSigma = config.spatialSigma !== undefined ? config.spatialSigma : 4.0;\n        this.intensitySigma = config.intensitySigma !== undefined ? config.intensitySigma : 0.2;\n\n        // Framebuffer for filter output\n        this.framebuffer = null;\n        this.texture = null;\n\n        // Shader program\n        this.program = null;\n\n        // Vertex buffer (shared with renderer)\n        this.quadBuffer = null;\n\n        this.initialize();\n\n        logger.info('BilateralFilterManager initialized', {\n            size: `${width}x${height}`,\n            enabled: this.enabled,\n            spatialSigma: this.spatialSigma,\n            intensitySigma: this.intensitySigma\n        });\n    }\n\n    /**\n     * Initialize bilateral filter resources\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create framebuffer\n        this.createFramebuffer();\n\n        // Compile shader\n        this.compileShader();\n\n        // Create quad buffer if not provided\n        if (!this.quadBuffer) {\n            const quadVertices = new Float32Array([\n                0, 0,  1, 0,  0, 1,\n                0, 1,  1, 0,  1, 1\n            ]);\n            this.quadBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n        }\n    }\n\n    /**\n     * Create framebuffer for filter output\n     */\n    createFramebuffer() {\n        const gl = this.gl;\n\n        // Create texture (LDR format)\n        this.texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        // Create framebuffer\n        this.framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture, 0);\n\n        // Check framebuffer status\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Bilateral filter framebuffer incomplete', { status });\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Compile bilateral filter shader\n     */\n    compileShader() {\n        const gl = this.gl;\n\n        const vertexShaderSource = `\nattribute vec2 a_pos;\nvarying vec2 v_uv;\n\nvoid main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const fragmentShaderSource = generateBilateralFilterShader();\n\n        this.program = createProgram(gl, vertexShaderSource, fragmentShaderSource);\n\n        if (!this.program) {\n            logger.error('Failed to compile bilateral filter shader');\n        }\n    }\n\n    /**\n     * Apply bilateral filter\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @returns {WebGLTexture} - Filtered texture (or original if disabled)\n     */\n    apply(inputTexture) {\n        if (!this.enabled) {\n            // Pass through without filtering\n            return inputTexture;\n        }\n\n        const gl = this.gl;\n\n        // Bind framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n\n        // Use bilateral filter shader\n        gl.useProgram(this.program);\n\n        // Bind input texture\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.program, 'u_screen'), 0);\n\n        // Set uniforms\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_spatialSigma'), this.spatialSigma);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_intensitySigma'), this.intensitySigma);\n\n        // Bind quad buffer\n        const aPosLoc = gl.getAttribLocation(this.program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Draw fullscreen quad\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Unbind framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Return filtered texture\n        return this.texture;\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config) {\n        if (config.enabled !== undefined) {\n            this.enabled = config.enabled;\n        }\n        if (config.spatialSigma !== undefined) {\n            this.spatialSigma = config.spatialSigma;\n        }\n        if (config.intensitySigma !== undefined) {\n            this.intensitySigma = config.intensitySigma;\n        }\n    }\n\n    /**\n     * Check if bilateral filter is enabled\n     */\n    isEnabled() {\n        return this.enabled;\n    }\n\n    /**\n     * Resize resources\n     */\n    resize(width, height) {\n        this.width = width;\n        this.height = height;\n\n        // Recreate framebuffer with new size\n        this.cleanup();\n        this.createFramebuffer();\n    }\n\n    /**\n     * Clean up WebGL resources\n     */\n    cleanup() {\n        const gl = this.gl;\n\n        if (this.framebuffer) {\n            gl.deleteFramebuffer(this.framebuffer);\n            this.framebuffer = null;\n        }\n\n        if (this.texture) {\n            gl.deleteTexture(this.texture);\n            this.texture = null;\n        }\n    }\n\n    /**\n     * Set quad buffer (share with renderer)\n     */\n    setQuadBuffer(buffer) {\n        this.quadBuffer = buffer;\n    }\n}\n", "/**\n * Shader templates and compilation utilities\n */\n\nimport { getGLSLFunctionDeclarations } from '../math/parser.js';\n\n/**\n * Compile a shader\n */\nexport function compileShader(gl, type, source) {\n    const shader = gl.createShader(type);\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n        const info = gl.getShaderInfoLog(shader);\n        gl.deleteShader(shader);\n        throw new Error(`Shader compilation error: ${info}\\n\\nSource:\\n${addLineNumbers(source)}`);\n    }\n\n    return shader;\n}\n\n/**\n * Link a shader program\n */\nexport function linkProgram(gl, vertexShader, fragmentShader) {\n    const program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n        const info = gl.getProgramInfoLog(program);\n        gl.deleteProgram(program);\n        throw new Error(`Program linking error: ${info}`);\n    }\n\n    return program;\n}\n\n/**\n * Create a complete shader program\n */\nexport function createProgram(gl, vertexSource, fragmentSource) {\n    const vertexShader = compileShader(gl, gl.VERTEX_SHADER, vertexSource);\n    const fragmentShader = compileShader(gl, gl.FRAGMENT_SHADER, fragmentSource);\n    const program = linkProgram(gl, vertexShader, fragmentShader);\n\n    // Clean up shaders (they're now in the program)\n    gl.deleteShader(vertexShader);\n    gl.deleteShader(fragmentShader);\n\n    return program;\n}\n\n/**\n * Add line numbers to source for error reporting\n */\nfunction addLineNumbers(source) {\n    return source.split('\\n').map((line, i) => `${i + 1}: ${line}`).join('\\n');\n}\n\n/**\n * Generate position update vertex shader\n */\nexport function generateUpdateVertexShader() {\n    return `\nprecision highp float;\n\nattribute vec2 a_pos;\n\nvoid main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * Generate position update fragment shader\n * @param {number} dimensions - Number of dimensions\n * @param {string[]} velocityExpressions - GLSL expressions for velocity (one per dimension)\n * @param {string} integratorCode - Integration method code\n * @param {CoordinateStrategy} strategy - Coordinate storage strategy\n * @param {object} transformCode - Transform GLSL code {forward, inverse, jacobian}\n * @param {object} coordinateSystemCode - Coordinate system GLSL code {forwardTransform, velocityTransform}\n */\nexport function generateUpdateFragmentShader(dimensions, velocityExpressions, integratorCode, strategy, transformCode = null, coordinateSystemCode = null) {\n    // Generate uniforms for position textures\n    const positionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_pos_${i};`\n    ).join('\\n');\n\n    // Note: Age is stored in alpha channel of u_pos_0 texture\n\n    // Generate vector constructor from texture reads\n    const vecType = `vec${dimensions}`;\n    const readPositions = Array.from({ length: dimensions }, (_, i) =>\n        `decodeFloat(texture2D(u_pos_${i}, v_texcoord))`\n    ).join(', ');\n\n    // Generate velocity function\n    const swizzles = ['x', 'y', 'z', 'w'];\n    const velocityComponents = velocityExpressions.map((expr, i) =>\n        `    result.${swizzles[i]} = ${expr};`\n    ).join('\\n');\n\n    // Add coordinate system functions if provided\n    const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n    const coordinateSystemFunctions = hasCoordinateSystem ? `\n// Coordinate system transformation functions (native-space integration)\n${coordinateSystemCode.forwardTransform}\n${coordinateSystemCode.inverseTransform}\n// Note: velocityTransform not needed with native-space integration\n` : '';\n\n    // Add transform functions if provided\n    const hasTransform = transformCode && transformCode.forward;\n    const transformFunctions = hasTransform ? `\n// Domain transformation functions\n${transformCode.helpers || ''}\n${transformCode.forward}\n${transformCode.inverse}\n${transformCode.jacobian}\n` : '';\n\n    // Modify velocity function to include coordinate system and/or domain transform\n    // Priority: Coordinate system wraps the velocity definition, domain transform wraps integration\n    const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates (${coordinateSystemCode.name || 'custom'})\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n    // Extract native coordinates for use in expressions\n    float ${coordinateSystemCode.nativeVars ? coordinateSystemCode.nativeVars.map((v, i) => `${v} = pos_native.${swizzles[i]}`).join(', ') : swizzles.slice(0, dimensions).map((s, i) => `${s} = pos_native.${s}`).join(', ')};\n${velocityComponents}\n    return result;\n}\n\n// Velocity function in Cartesian (redirects to native, for use by integrator)\n${vecType} get_velocity(${vecType} pos_native) {\n    return get_velocity_native(pos_native);\n}\n` : hasTransform ? `\n// Original velocity field in world coordinates\n${vecType} get_velocity_original(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n\n// Transformed velocity field: dy/dt = J_T(x) * f(x)\n// where y = T(x)\n${vecType} get_velocity(${vecType} pos_transformed) {\n    // Transform back to world coordinates\n    ${vecType} pos = transform_inverse(pos_transformed);\n\n    // Evaluate original velocity field\n    ${vecType} vel_original = get_velocity_original(pos);\n\n    // Apply Jacobian: component-wise multiplication\n    ${vecType} jacobian = transform_jacobian(pos);\n    return vel_original * jacobian;\n}\n` : `\n// User-defined velocity field (no transform)\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${strategy.getGLSLConstants()}\n${strategy.getGLSLDecodeFunction()}\n${strategy.getGLSLEncodeFunction()}\n${strategy.getGLSLNormalizeFunction()}\n${strategy.getGLSLDenormalizeFunction()}\n\n${customFunctions}\n\n${positionUniforms}\n\nuniform vec2 u_min;\nuniform vec2 u_max;\nuniform float u_h;\nuniform float u_rand_seed;\nuniform float u_drop_rate;\nuniform float u_respawn_margin;\nuniform int u_out_coordinate;\nuniform float u_particles_res;\nuniform float u_max_velocity;\nuniform float u_alpha;\n${hasTransform ? 'uniform vec4 u_transform_params;' : ''}\n\n${coordinateSystemFunctions}\n\n${transformFunctions}\n\n${velocityFunction}\n\n${integratorCode}\n\n// High-quality hash-based random number generator\n// Returns value in [0, 1] with good distribution\nfloat rand(vec2 co) {\n    // Hash the input\n    vec2 p = co + vec2(u_rand_seed, u_rand_seed * 1.61803398875);\n    // Use a better hash function\n    p = fract(p * vec2(443.897, 441.423));\n    p += dot(p.yx, p.xy + vec2(19.19, 17.17));\n    return fract(p.x * p.y);\n}\n\n// Secondary independent random function\nfloat rand2(vec2 co) {\n    vec2 p = co + vec2(u_rand_seed * 2.71828, u_rand_seed * 3.14159);\n    p = fract(p * vec2(269.5, 271.3));\n    p += dot(p.yx, p.xy + vec2(23.23, 29.29));\n    return fract(p.x * p.y);\n}\n\nvoid main() {\n    vec2 texcoord = gl_FragCoord.xy / u_particles_res;\n\n    // Read current age from alpha channel of u_pos_0\n    float current_age = texture2D(u_pos_0, texcoord).a;\n\n    // Read current position from textures\n    // Positions are stored as normalized [0,1] values, denormalize to world coords\n    ${vecType} pos;\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            // Higher dimensions use fixed range [-10, 10]\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n\n    // Integrate to get new position\n    ${vecType} new_pos;\n    ${hasCoordinateSystem ? `\n    // NATIVE-SPACE INTEGRATION:\n    // 1. Transform position to native coordinates\n    // 2. Integrate in native space (using velocity defined in native coords)\n    // 3. Transform result back to Cartesian\n    ${vecType} pos_native = transformToNative(pos);\n    ${vecType} new_pos_native = integrate(pos_native, u_h);\n    new_pos = transformToCartesian(new_pos_native);\n    ` : hasTransform ? `\n    // Transform to y-space, integrate, then transform back to x-space\n    ${vecType} pos_transformed = transform_forward(pos);\n    ${vecType} new_pos_transformed = integrate(pos_transformed, u_h);\n    new_pos = transform_inverse(new_pos_transformed);\n    ` : `\n    // Direct integration (no transform)\n    new_pos = integrate(pos, u_h);\n    `}\n\n    // Check if particle is outside viewport bounds with configurable margin\n    // Margin allows particles to flow off-screen before respawning\n    float width = u_max.x - u_min.x;\n    float height = u_max.y - u_min.y;\n    bool outside = new_pos.x < (u_min.x - width * u_respawn_margin) || new_pos.x > (u_max.x + width * u_respawn_margin) ||\n                   new_pos.y < (u_min.y - height * u_respawn_margin) || new_pos.y > (u_max.y + height * u_respawn_margin);\n\n    // Random drop: reset particle to random position with small probability\n    // Also reset if particle exits the viewport\n    float drop_chance = rand(texcoord);\n    bool should_respawn = drop_chance < u_drop_rate || outside;\n    if (should_respawn) {\n        // Spawn particles 2% OUTSIDE viewport for natural flow-in effect (negative margin)\n        // Use texcoord + rand_seed for truly independent random values per particle per frame\n        const float margin = -0.02;\n        ${dimensions === 2 ? `new_pos.x = u_min.x + width * margin + rand(texcoord * 1.234 + vec2(u_rand_seed)) * width * (1.0 - 2.0 * margin);\n        new_pos.y = u_min.y + height * margin + rand2(texcoord * 5.678 + vec2(u_rand_seed * 2.345)) * height * (1.0 - 2.0 * margin);` :\n        Array.from({ length: dimensions }, (_, i) => {\n            const coords = ['x', 'y', 'z', 'w'];\n            if (i === 0) return `new_pos.x = u_min.x + width * margin + rand(texcoord * 1.234 + vec2(u_rand_seed)) * width * (1.0 - 2.0 * margin);`;\n            if (i === 1) return `new_pos.y = u_min.y + height * margin + rand2(texcoord * 5.678 + vec2(u_rand_seed * 2.345)) * height * (1.0 - 2.0 * margin);`;\n            // For higher dimensions, use varied seeds for better distribution\n            return `new_pos.${coords[i]} = -10.4 + rand(texcoord * ${i + 1}.37 + vec2(u_rand_seed * ${i + 3}.5)) * 20.8;`;\n        }).join('\\n        ')}\n    }\n\n    // Calculate new age (based on all spawn conditions)\n    float new_age;\n    if (should_respawn) {\n        new_age = 0.0; // Reset age for newly spawned particles\n    } else {\n        new_age = min(current_age + 0.5, 1.0); // Increment age, cap at 1.0\n    }\n\n    // Output the selected coordinate\n    // Normalize world coords back to [0, 1] before encoding\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        let normalizeExpr;\n        if (i === 0) {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, u_min.x, u_max.x)`;\n        } else if (i === 1) {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, u_min.y, u_max.y)`;\n        } else {\n            normalizeExpr = `normalizeToViewport(new_pos.${coord}, -10.0, 10.0)`;\n        }\n\n        if (i === 0) {\n            return `if (u_out_coordinate == ${i}) {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n        gl_FragColor.a = new_age; // Store age in alpha channel\n    }`;\n        } else if (i === dimensions - 1) {\n            return ` else {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n    }`;\n        } else {\n            return ` else if (u_out_coordinate == ${i}) {\n        gl_FragColor = encodeFloat(${normalizeExpr});\n    }`;\n        }\n    }).join('')}\n}\n`;\n}\n\n/**\n * Generate particle rendering vertex shader\n */\nexport function generateDrawVertexShader(dimensions, mapperCode, velocityExpressions, strategy, lineMode = false, coordinateSystemCode = null) {\n    const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n\n    const positionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_pos_${i};`\n    ).join('\\n');\n\n    // Previous position uniforms (always included)\n    const prevPositionUniforms = Array.from({ length: dimensions }, (_, i) =>\n        `uniform sampler2D u_prev_pos_${i};`\n    ).join('\\n');\n\n    const vecType = `vec${dimensions}`;\n\n    // Generate velocity function\n    const swizzles = ['x', 'y', 'z', 'w'];\n    const velocityComponents = velocityExpressions.map((expr, i) =>\n        `    result.${swizzles[i]} = ${expr};`\n    ).join('\\n');\n\n    // Add coordinate system functions if provided (hasCoordinateSystem already declared at function start)\n    const coordinateSystemFunctions = hasCoordinateSystem ? `\n// Coordinate system transformation functions\n${coordinateSystemCode.forwardTransform}\n${coordinateSystemCode.inverseTransform}\n// Note: inverseTransform needed for computing Cartesian velocity via finite differences\n` : '';\n\n    // Velocity function with coordinate system support\n    const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n${velocityComponents}\n    return result;\n}\n\n// Velocity field for visualization (no Cartesian transform needed with native-space integration)\n${vecType} get_velocity(${vecType} pos_cartesian) {\n    ${vecType} pos_native = transformToNative(pos_cartesian);\n    return get_velocity_native(pos_native);\n}\n` : `\n// User-defined velocity field\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${strategy.getGLSLConstants()}\n${strategy.getGLSLDecodeFunction()}\n${strategy.getGLSLDenormalizeFunction()}\n\n${customFunctions}\n\nattribute float a_index;\n${lineMode ? 'attribute float a_vertex_id; // 0 = prev, 1 = current' : ''}\n\n${positionUniforms}\n${prevPositionUniforms}\n\nuniform float u_particles_res;\nuniform vec2 u_min;\nuniform vec2 u_max;\nuniform float u_alpha;\nuniform float u_particle_size;\nuniform vec2 u_viewport_size;  // Actual render resolution (renderWidth, renderHeight)\nuniform vec2 u_canvas_size;    // Canvas resolution (canvas.width, canvas.height)\n\nvarying vec${dimensions} v_pos;\nvarying vec${dimensions} v_velocity;          // Actual particle velocity (pos - prev_pos)\nvarying vec${dimensions} v_field_velocity;    // Vector field at particle position\nvarying vec${dimensions} v_velocity_projected; // Projected 2D velocity (for angle-based color modes)\n\n${mapperCode}\n\n${coordinateSystemFunctions}\n\n${velocityFunction}\n\nvoid main() {\n    ${lineMode ? `\n    // Line mode: index buffer has [0,0,1,1,2,2,3,3,...], vertex ID buffer has [0,1,0,1,0,1,...]\n    // a_vertex_id = 0 means previous position, 1 means current position\n    float particle_index = a_index;\n    bool is_current = a_vertex_id > 0.5;\n    ` : `\n    // Point mode: one vertex per particle\n    float particle_index = a_index;\n    `}\n\n    // Calculate texture coordinate from particle index\n    // Add 0.5 to sample from texel centers\n    vec2 texcoord = vec2(\n        (mod(particle_index, u_particles_res) + 0.5) / u_particles_res,\n        (floor(particle_index / u_particles_res) + 0.5) / u_particles_res\n    );\n\n    // Read age from alpha channel of u_pos_0\n    float age = texture2D(u_pos_0, texcoord).a;\n\n    // Read position from textures and denormalize to world coordinates\n    ${vecType} pos;\n    ${lineMode ? `\n    if (is_current) {\n        // Current position\n        ${Array.from({ length: dimensions }, (_, i) => {\n            const coord = ['x', 'y', 'z', 'w'][i];\n            if (i === 0) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n            } else if (i === 1) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n            } else {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n            }\n        }).join('\\n        ')}\n    } else {\n        // Previous position\n        ${Array.from({ length: dimensions }, (_, i) => {\n            const coord = ['x', 'y', 'z', 'w'][i];\n            if (i === 0) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n            } else if (i === 1) {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n            } else {\n                return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), -10.0, 10.0);`;\n            }\n        }).join('\\n        ')}\n    }\n    ` : `\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            return `pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n    `}\n\n    // Calculate ACTUAL particle velocity for coloring (not vector field!)\n    // This gives correct colors based on particle motion, not field strength\n    ${vecType} prev_pos;\n    ${Array.from({ length: dimensions }, (_, i) => {\n        const coord = ['x', 'y', 'z', 'w'][i];\n        if (i === 0) {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.x, u_max.x);`;\n        } else if (i === 1) {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), u_min.y, u_max.y);`;\n        } else {\n            return `prev_pos.${coord} = denormalizeFromViewport(decodeFloat(texture2D(u_prev_pos_${i}, texcoord)), -10.0, 10.0);`;\n        }\n    }).join('\\n    ')}\n\n    // Actual particle velocity from position difference\n    ${vecType} velocity = pos - prev_pos;\n\n    // Also compute vector field at current position (for field-based color modes)\n    ${vecType} field_velocity = get_velocity(pos);\n\n    // Pass N-dimensional position and full velocity to fragment shader\n    v_pos = pos;\n    v_velocity = velocity; // Actual particle velocity for expression mode\n    v_field_velocity = field_velocity; // Vector field at position\n\n    // Skip newly spawned particles (age < 1) by moving them off-screen\n    if (age < 1.0) {\n        gl_Position = vec4(10.0, 10.0, 10.0, 1.0); // Far outside clip space\n        gl_PointSize = 0.0;\n        v_velocity_projected = velocity; // Won't be used since particle is off-screen\n    } else {\n        // Project position to 3D (with depth)\n        vec3 pos_3d = project_to_3d(pos);\n\n        // Project velocity to 2D (using same mapper)\n        // For linear projections, this is correct for tangent vectors\n        vec2 velocity_2d = project_to_2d(velocity);\n\n        // Create 2D velocity vector (pad to match dimensions for varying)\n        ${vecType} velocity_projected;\n        velocity_projected.x = velocity_2d.x;\n        velocity_projected.y = velocity_2d.y;\n        ${dimensions > 2 ? 'velocity_projected.z = 0.0;' : ''}\n        ${dimensions > 3 ? 'velocity_projected.w = 0.0;' : ''}\n\n        // Pass projected 2D velocity to fragment shader (for angle-based color modes)\n        v_velocity_projected = velocity_projected;\n\n        // Map to screen space\n        vec2 normalized = (pos_3d.xy - u_min) / (u_max - u_min);\n\n        // Use depth value (normalized to [-1, 1] range)\n        // For now, assume depth is in similar range to x/y coordinates\n        float depth_normalized = (pos_3d.z - (u_min.x + u_min.y) * 0.5) / ((u_max.x - u_min.x + u_max.y - u_min.y) * 0.5);\n        depth_normalized = clamp(depth_normalized, -1.0, 1.0);\n\n        gl_Position = vec4(normalized * 2.0 - 1.0, depth_normalized, 1.0);\n\n        // Scale particle size by render scale to maintain consistent visual size\n        // Calculate render scale as viewport size / canvas size\n        float render_scale = u_viewport_size.x / u_canvas_size.x;\n        gl_PointSize = u_particle_size * render_scale;\n    }\n}\n`;\n}\n\n/**\n * Generate particle rendering fragment shader\n */\nexport function generateDrawFragmentShader(dimensions, colorCode, usesMaxVelocity) {\n    // Get custom function declarations\n    const customFunctions = getGLSLFunctionDeclarations();\n\n    return `\nprecision highp float;\n\n${customFunctions}\n\nvarying vec${dimensions} v_pos;\nvarying vec${dimensions} v_velocity;          // Actual particle velocity (pos - prev_pos)\nvarying vec${dimensions} v_field_velocity;    // Vector field at particle position\nvarying vec${dimensions} v_velocity_projected; // Projected 2D velocity (for angle-based color modes)\n\n${usesMaxVelocity ? 'uniform float u_max_velocity;\\nuniform float u_velocity_log_scale;' : ''}\nuniform float u_particle_intensity;\nuniform float u_color_saturation;\nuniform float u_alpha;\nuniform vec2 u_viewport_size;  // Actual render resolution\nuniform vec2 u_canvas_size;    // Canvas resolution\n\n${colorCode}\n\nvoid main() {\n    // Get color based on position, particle velocity, and field velocity\n    vec3 color = getColor(v_pos, v_velocity, v_field_velocity, v_velocity_projected);\n\n    // Apply saturation adjustment (for attractor visualization)\n    // 0.0 = grayscale, 1.0 = full saturation\n    if (u_color_saturation < 1.0) {\n        float luminance = dot(color, vec3(0.2126, 0.7152, 0.0722));\n        vec3 grayscale = vec3(luminance);\n        color = mix(grayscale, color, u_color_saturation);\n    }\n\n    // Scale by intensity for HDR (allows colors > 1.0)\n    color *= u_particle_intensity;\n\n    // Calculate render scale factor\n    float render_scale = u_viewport_size.x / u_canvas_size.x;\n\n    // Compensate alpha for particle size scaling to maintain constant brightness\n    // Particle area scales with render_scale\u00B2, so divide alpha by render_scale\u00B2\n    // This ensures that larger particles contribute the same total brightness\n    float area_compensation = 1.0 / (render_scale * render_scale);\n    float adjusted_alpha = 0.35 * area_compensation;\n\n    // Alpha blending allows proper fade to black\n    gl_FragColor = vec4(color, adjusted_alpha);\n}\n`;\n}\n\n/**\n * Generate screen fade/composite vertex shader\n */\nexport function generateScreenVertexShader() {\n    return `\nprecision highp float;\n\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\n\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * Generate screen fade fragment shader\n */\nexport function generateScreenFadeFragmentShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform float u_fade;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    vec4 color = texture2D(u_screen, v_texcoord);\n    vec3 faded = color.rgb * u_fade;\n\n    // Snap to black if very dark (prevents floating point precision issues)\n    // This ensures trails fade completely to black\n    float brightness = max(max(faded.r, faded.g), faded.b);\n    if (brightness < 0.003) {\n        faded = vec3(0.0);\n    }\n\n    gl_FragColor = vec4(faded, 1.0);\n}\n`;\n}\n\n/**\n * Generate screen copy fragment shader\n */\nexport function generateScreenCopyFragmentShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\n\nvarying vec2 v_texcoord;\n\nvoid main() {\n    gl_FragColor = texture2D(u_screen, v_texcoord);\n}\n`;\n}\n\n/**\n * Generate tone mapping fragment shader\n * @param {string} tonemapCode - GLSL code for tone mapping operator (from tonemapping.js)\n */\nexport function generateTonemapFragmentShader(tonemapCode = '') {\n    // Default to simple exposure + gamma if no operator provided\n    if (!tonemapCode) {\n        tonemapCode = `\nvec3 tonemap(vec3 color) {\n    return color * u_exposure;\n}\n\nvec3 applyGamma(vec3 color) {\n    return pow(color, vec3(1.0 / u_gamma));\n}\n`;\n    }\n\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform float u_exposure;\nuniform float u_gamma;\nuniform float u_whitePoint;\nuniform float u_brightness_desat;\nuniform float u_brightness_sat;\nuniform float u_hdr_max_brightness;\nuniform float u_hdr_avg_brightness;\nuniform float u_highlight_compression;\nuniform float u_compression_threshold;\n\nvarying vec2 v_texcoord;\n\n// Logarithmic highlight compression (pre-tone mapping)\n// Only compresses values above threshold to help tone mapper cover full dynamic range\n// Preserves hue by compressing luminance only, then scaling RGB to match\nvec3 compressHighlights(vec3 color, float strength, float threshold) {\n    if (strength < 0.0001) return color; // Disabled\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return color;\n\n    // Compress luminance only\n    float compressedLuma;\n    if (luma <= threshold) {\n        compressedLuma = luma; // Below threshold: unchanged\n    } else {\n        // Above threshold: compress the excess\n        float excess = luma - threshold;\n        float compressed = log(1.0 + excess * strength) / strength;\n        compressedLuma = threshold + compressed;\n    }\n\n    // Scale RGB to match compressed luminance (preserves hue and saturation)\n    return color * (compressedLuma / luma);\n}\n\n${tonemapCode}\n\nvoid main() {\n    // Read HDR color from framebuffer\n    vec3 hdrColor = texture2D(u_screen, v_texcoord).rgb;\n\n    // Calculate HDR brightness once for both effects (Rec. 709 luminance)\n    float hdrBrightness = dot(hdrColor, vec3(0.2126, 0.7152, 0.0722));\n    vec3 hdrGray = vec3(hdrBrightness);\n\n    // Get adaptive thresholds based on actual HDR buffer statistics\n    float avgBrightness = max(u_hdr_avg_brightness, 0.1); // Avoid division by zero\n    float maxBrightness = max(u_hdr_max_brightness, 1.0);\n\n    // Work in log space to handle the massive dynamic range (0.1 to 100,000+)\n    float logAvg = log2(avgBrightness + 1.0);\n    float logMax = log2(maxBrightness + 1.0);\n    float logBrightness = log2(hdrBrightness + 1.0);\n\n    // Apply brightness-based DESATURATION (desaturates BRIGHT regions)\n    // Prevents oversaturation and RGB clipping in dense accumulations\n    if (u_brightness_desat > 0.0) {\n        // Target brighter-than-average regions (where particles accumulate)\n        // Start desaturating at 2x average, full desat at 100x average\n        // This hits the actual bright accumulations, not just the max peaks\n        float brightStart = avgBrightness * 2.0;\n        float brightEnd = avgBrightness * 100.0;\n        float logBrightStart = log2(brightStart + 1.0);\n        float logBrightEnd = log2(brightEnd + 1.0);\n        float desatFactor = smoothstep(logBrightStart, logBrightEnd, logBrightness) * u_brightness_desat;\n\n        // Blend toward grayscale\n        hdrColor = mix(hdrColor, hdrGray, desatFactor);\n    }\n\n    // Apply brightness-based SATURATION BUILDUP (desaturates DIM regions)\n    // Creates effect where sparse particles are washed out, dense accumulations pop with color\n    if (u_brightness_sat > 0.0) {\n        // Slider controls the threshold: higher values = more aggressive desaturation\n        // - At 0.3: pixels below ~1000x average are desaturated\n        // - At 0.5: pixels below ~4000x average are desaturated\n        // - At 1.0: pixels below ~137,000 (max) are desaturated (very aggressive)\n        float threshold = avgBrightness * pow(10.0, u_brightness_sat * 3.0); // 1x to 1000x average\n        float logThreshold = log2(threshold + 1.0);\n\n        // Narrow transition for sharp cutoff\n        float logTransitionStart = log2(avgBrightness * 0.1 + 1.0); // 10% of average\n        float satFactor = smoothstep(logTransitionStart, logThreshold, logBrightness);\n\n        // Apply the effect: low brightness gets desaturated AND dimmed\n        float desatAmount = (1.0 - satFactor) * u_brightness_sat;\n        hdrColor = mix(hdrColor, hdrGray, desatAmount);\n\n        // Also reduce brightness in desaturated regions\n        // This makes sparse trails even more subtle (both dim and colorless)\n        hdrColor *= (1.0 - desatAmount * 0.5); // Reduce brightness by up to 50%\n    }\n\n    // Apply gamma correction in HDR space (before tone mapping)\n    // This prevents clipping and gives the tone mapper more headroom\n    vec3 gammaCorrected = applyGamma(hdrColor);\n\n    // Apply luminance gamma in HDR space (hue-preserving brightness adjustment)\n    vec3 hdrGammaCorrected = applyLuminanceGamma(gammaCorrected);\n\n    // Apply highlight compression to compress bright values before tone mapping\n    // This helps the tone mapper cover the full dynamic range more effectively\n    vec3 compressed = compressHighlights(hdrGammaCorrected, u_highlight_compression, u_compression_threshold);\n\n    // Apply tone mapping operator to compress HDR values into LDR range\n    vec3 ldrColor = tonemap(compressed);\n\n    gl_FragColor = vec4(ldrColor, 1.0);\n}\n`;\n}\n", "/**\n * SMAA (Subpixel Morphological Anti-Aliasing) Manager\n * Better edge preservation than FXAA - uses pattern recognition\n * Simplified implementation without precomputed area/search textures\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { createProgram } from './shaders.js';\n\n/**\n * SMAA Edge Detection Shader\n * Detects edges using luminance differences\n */\nfunction generateSMAAEdgeDetectionShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_screen;\nuniform vec2 u_resolution;\nuniform float u_threshold;\n\nvarying vec2 v_uv;\n\nfloat luminance(vec3 color) {\n    return dot(color, vec3(0.299, 0.587, 0.114));\n}\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    // Sample center\n    vec3 center = texture2D(u_screen, v_uv).rgb;\n    float lumC = luminance(center);\n\n    // Sample neighbors\n    float lumL = luminance(texture2D(u_screen, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).rgb);\n    float lumR = luminance(texture2D(u_screen, v_uv + vec2(1.0, 0.0) * inverseScreenSize).rgb);\n    float lumT = luminance(texture2D(u_screen, v_uv + vec2(0.0, -1.0) * inverseScreenSize).rgb);\n    float lumB = luminance(texture2D(u_screen, v_uv + vec2(0.0, 1.0) * inverseScreenSize).rgb);\n\n    // Compute delta (edge strength)\n    float deltaL = abs(lumC - lumL);\n    float deltaR = abs(lumC - lumR);\n    float deltaT = abs(lumC - lumT);\n    float deltaB = abs(lumC - lumB);\n\n    // Horizontal and vertical edges\n    vec2 edges = vec2(0.0);\n\n    // Horizontal edge (top-bottom difference)\n    float maxDeltaH = max(deltaT, deltaB);\n    if (maxDeltaH > u_threshold) {\n        edges.x = maxDeltaH;\n    }\n\n    // Vertical edge (left-right difference)\n    float maxDeltaV = max(deltaL, deltaR);\n    if (maxDeltaV > u_threshold) {\n        edges.y = maxDeltaV;\n    }\n\n    gl_FragColor = vec4(edges, 0.0, 1.0);\n}\n`;\n}\n\n/**\n * SMAA Blending Weight Shader\n * Calculates blend weights based on edge patterns\n */\nfunction generateSMAABlendingWeightShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_edgesTex;\nuniform vec2 u_resolution;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    vec2 edges = texture2D(u_edgesTex, v_uv).xy;\n    vec4 weights = vec4(0.0);\n\n    // If no edges detected, skip\n    if (dot(edges, vec2(1.0)) < 0.001) {\n        gl_FragColor = weights;\n        return;\n    }\n\n    // Simplified weight calculation\n    // For horizontal edge, blend vertically\n    if (edges.x > 0.0) {\n        // Check how far edge extends\n        float edgeT = texture2D(u_edgesTex, v_uv + vec2(0.0, -1.0) * inverseScreenSize).x;\n        float edgeB = texture2D(u_edgesTex, v_uv + vec2(0.0, 1.0) * inverseScreenSize).x;\n\n        // Weight based on edge continuity\n        weights.x = edges.x * 0.5; // Top blend\n        weights.y = edges.x * 0.5; // Bottom blend\n\n        // Reduce weight if edge continues (sharp feature, not aliasing)\n        if (edgeT > 0.0 && edgeB > 0.0) {\n            weights.x *= 0.25;\n            weights.y *= 0.25;\n        }\n    }\n\n    // For vertical edge, blend horizontally\n    if (edges.y > 0.0) {\n        float edgeL = texture2D(u_edgesTex, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).y;\n        float edgeR = texture2D(u_edgesTex, v_uv + vec2(1.0, 0.0) * inverseScreenSize).y;\n\n        weights.z = edges.y * 0.5; // Left blend\n        weights.w = edges.y * 0.5; // Right blend\n\n        // Reduce weight if edge continues\n        if (edgeL > 0.0 && edgeR > 0.0) {\n            weights.z *= 0.25;\n            weights.w *= 0.25;\n        }\n    }\n\n    gl_FragColor = weights;\n}\n`;\n}\n\n/**\n * SMAA Neighborhood Blending Shader\n * Final pass - blends pixels based on weights\n */\nfunction generateSMAANeighborhoodBlendingShader() {\n    return `\nprecision highp float;\n\nuniform sampler2D u_colorTex;\nuniform sampler2D u_blendTex;\nuniform vec2 u_resolution;\nuniform float u_intensity;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    vec2 inverseScreenSize = 1.0 / u_resolution;\n\n    // Get blend weights\n    vec4 weights = texture2D(u_blendTex, v_uv) * u_intensity;\n\n    // If no blending needed, return original color\n    if (dot(weights, vec4(1.0)) < 0.001) {\n        gl_FragColor = texture2D(u_colorTex, v_uv);\n        return;\n    }\n\n    // Sample neighbors\n    vec3 colorC = texture2D(u_colorTex, v_uv).rgb;\n    vec3 colorT = texture2D(u_colorTex, v_uv + vec2(0.0, -1.0) * inverseScreenSize).rgb;\n    vec3 colorB = texture2D(u_colorTex, v_uv + vec2(0.0, 1.0) * inverseScreenSize).rgb;\n    vec3 colorL = texture2D(u_colorTex, v_uv + vec2(-1.0, 0.0) * inverseScreenSize).rgb;\n    vec3 colorR = texture2D(u_colorTex, v_uv + vec2(1.0, 0.0) * inverseScreenSize).rgb;\n\n    // Blend based on weights\n    vec3 result = colorC;\n    result += colorT * weights.x;\n    result += colorB * weights.y;\n    result += colorL * weights.z;\n    result += colorR * weights.w;\n\n    // Normalize\n    float totalWeight = 1.0 + weights.x + weights.y + weights.z + weights.w;\n    result /= totalWeight;\n\n    gl_FragColor = vec4(result, 1.0);\n}\n`;\n}\n\n/**\n * SMAAManager class\n * Three-pass morphological antialiasing\n */\nexport class SMAAManager {\n    constructor(gl, width, height, config = {}) {\n        this.gl = gl;\n        this.width = width;\n        this.height = height;\n\n        // Configuration\n        this.enabled = config.enabled !== undefined ? config.enabled : true;\n        this.intensity = config.intensity !== undefined ? config.intensity : 0.75;\n        this.threshold = config.threshold !== undefined ? config.threshold : 0.1;\n\n        // Framebuffers and textures\n        this.edgesFramebuffer = null;\n        this.edgesTexture = null;\n        this.blendFramebuffer = null;\n        this.blendTexture = null;\n\n        // Shader programs\n        this.edgeDetectionProgram = null;\n        this.blendingWeightProgram = null;\n        this.neighborhoodBlendProgram = null;\n\n        // Vertex buffer (shared with renderer)\n        this.quadBuffer = null;\n\n        this.initialize();\n\n        logger.info('SMAAManager initialized', {\n            size: `${width}x${height}`,\n            enabled: this.enabled,\n            intensity: this.intensity,\n            threshold: this.threshold\n        });\n    }\n\n    /**\n     * Initialize SMAA resources\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create framebuffers\n        this.createFramebuffers();\n\n        // Compile shaders\n        this.compileShaders();\n\n        // Create quad buffer if not provided\n        if (!this.quadBuffer) {\n            const quadVertices = new Float32Array([\n                0, 0,  1, 0,  0, 1,\n                0, 1,  1, 0,  1, 1\n            ]);\n            this.quadBuffer = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n            gl.bufferData(gl.ARRAY_BUFFER, quadVertices, gl.STATIC_DRAW);\n        }\n    }\n\n    /**\n     * Create framebuffers for multi-pass rendering\n     */\n    createFramebuffers() {\n        const gl = this.gl;\n\n        // Edges framebuffer (stores edge detection results)\n        this.edgesTexture = this.createTexture();\n        this.edgesFramebuffer = this.createFramebuffer(this.edgesTexture);\n\n        // Blend weights framebuffer\n        this.blendTexture = this.createTexture();\n        this.blendFramebuffer = this.createFramebuffer(this.blendTexture);\n    }\n\n    /**\n     * Create a texture for intermediate results\n     */\n    createTexture() {\n        const gl = this.gl;\n\n        const texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.width, this.height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        return texture;\n    }\n\n    /**\n     * Create a framebuffer attached to a texture\n     */\n    createFramebuffer(texture) {\n        const gl = this.gl;\n\n        const framebuffer = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, framebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n\n        const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (status !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('SMAA framebuffer incomplete', { status });\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        return framebuffer;\n    }\n\n    /**\n     * Compile SMAA shader programs\n     */\n    compileShaders() {\n        const gl = this.gl;\n\n        const vertexShaderSource = `\nattribute vec2 a_pos;\nvarying vec2 v_uv;\n\nvoid main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        this.edgeDetectionProgram = createProgram(gl, vertexShaderSource, generateSMAAEdgeDetectionShader());\n        this.blendingWeightProgram = createProgram(gl, vertexShaderSource, generateSMAABlendingWeightShader());\n        this.neighborhoodBlendProgram = createProgram(gl, vertexShaderSource, generateSMAANeighborhoodBlendingShader());\n\n        if (!this.edgeDetectionProgram || !this.blendingWeightProgram || !this.neighborhoodBlendProgram) {\n            logger.error('Failed to compile SMAA shaders');\n        }\n    }\n\n    /**\n     * Apply SMAA to framebuffer (three-pass algorithm)\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @param {WebGLFramebuffer} targetFramebuffer - Target framebuffer to render to\n     * @param {WebGLBuffer} quadBuffer - Quad buffer for rendering\n     */\n    applyToFramebuffer(inputTexture, targetFramebuffer, quadBuffer) {\n        if (!this.enabled || this.intensity <= 0.0) {\n            // Pass through - just copy input to target framebuffer\n            const gl = this.gl;\n            gl.bindFramebuffer(gl.FRAMEBUFFER, targetFramebuffer);\n            gl.viewport(0, 0, this.width, this.height);\n            this.copyToFramebuffer(inputTexture, quadBuffer);\n            return;\n        }\n\n        const gl = this.gl;\n\n        // Pass 1: Edge Detection\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.edgesFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.edgeDetectionProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.edgeDetectionProgram, 'u_screen'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_threshold'), this.threshold);\n\n        this.drawQuad(this.edgeDetectionProgram, quadBuffer);\n\n        // Pass 2: Blending Weight Calculation\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blendFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.blendingWeightProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.edgesTexture);\n        gl.uniform1i(gl.getUniformLocation(this.blendingWeightProgram, 'u_edgesTex'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.blendingWeightProgram, 'u_resolution'), this.width, this.height);\n\n        this.drawQuad(this.blendingWeightProgram, quadBuffer);\n\n        // Pass 3: Neighborhood Blending (to target framebuffer)\n        gl.bindFramebuffer(gl.FRAMEBUFFER, targetFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), this.intensity);\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Apply SMAA to canvas (three-pass algorithm)\n     * @param {WebGLTexture} inputTexture - Input LDR texture\n     * @param {WebGLBuffer} quadBuffer - Quad buffer for rendering\n     */\n    applyToCanvas(inputTexture, quadBuffer) {\n        // Apply SMAA to canvas (null framebuffer)\n        this.applyToFramebuffer(inputTexture, null, quadBuffer);\n    }\n\n    /**\n     * DEPRECATED: Old applyToCanvas implementation (kept for reference)\n     */\n    applyToCanvas_OLD(inputTexture, quadBuffer) {\n        if (!this.enabled || this.intensity <= 0.0) {\n            // Pass through - just copy input to canvas\n            this.copyToCanvas(inputTexture, quadBuffer);\n            return;\n        }\n\n        const gl = this.gl;\n\n        // Pass 1: Edge Detection\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.edgesFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.edgeDetectionProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.edgeDetectionProgram, 'u_screen'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.edgeDetectionProgram, 'u_threshold'), this.threshold);\n\n        this.drawQuad(this.edgeDetectionProgram, quadBuffer);\n\n        // Pass 2: Blending Weight Calculation\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.blendFramebuffer);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.blendingWeightProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.edgesTexture);\n        gl.uniform1i(gl.getUniformLocation(this.blendingWeightProgram, 'u_edgesTex'), 0);\n        gl.uniform2f(gl.getUniformLocation(this.blendingWeightProgram, 'u_resolution'), this.width, this.height);\n\n        this.drawQuad(this.blendingWeightProgram, quadBuffer);\n\n        // Pass 3: Neighborhood Blending (to canvas)\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.width, this.height);\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), this.intensity);\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Draw fullscreen quad\n     */\n    drawQuad(program, quadBuffer) {\n        const gl = this.gl;\n\n        const aPosLoc = gl.getAttribLocation(program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    /**\n     * Copy input texture to currently bound framebuffer (passthrough)\n     */\n    copyToFramebuffer(inputTexture, quadBuffer) {\n        const gl = this.gl;\n\n        // Simple copy shader (reuse neighborhood blend program without weights)\n        gl.useProgram(this.neighborhoodBlendProgram);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, inputTexture);\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_colorTex'), 0);\n\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this.blendTexture); // Empty blend = passthrough\n        gl.uniform1i(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_blendTex'), 1);\n\n        gl.uniform2f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_resolution'), this.width, this.height);\n        gl.uniform1f(gl.getUniformLocation(this.neighborhoodBlendProgram, 'u_intensity'), 0.0); // Zero intensity = no AA\n\n        this.drawQuad(this.neighborhoodBlendProgram, quadBuffer);\n    }\n\n    /**\n     * Copy input texture to canvas (passthrough)\n     */\n    copyToCanvas(inputTexture, quadBuffer) {\n        const gl = this.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.width, this.height);\n        this.copyToFramebuffer(inputTexture, quadBuffer);\n    }\n\n    /**\n     * Update SMAA configuration\n     */\n    updateConfig(config) {\n        if (config.enabled !== undefined) {\n            this.enabled = config.enabled;\n        }\n        if (config.intensity !== undefined) {\n            this.intensity = config.intensity;\n        }\n        if (config.threshold !== undefined) {\n            this.threshold = config.threshold;\n        }\n    }\n\n    /**\n     * Check if SMAA is enabled\n     */\n    isEnabled() {\n        return this.enabled && this.intensity > 0.0;\n    }\n\n    /**\n     * Resize SMAA resources\n     */\n    resize(width, height) {\n        this.width = width;\n        this.height = height;\n\n        // Recreate framebuffers with new size\n        this.cleanup();\n        this.createFramebuffers();\n    }\n\n    /**\n     * Clean up WebGL resources\n     */\n    cleanup() {\n        const gl = this.gl;\n\n        if (this.edgesFramebuffer) gl.deleteFramebuffer(this.edgesFramebuffer);\n        if (this.blendFramebuffer) gl.deleteFramebuffer(this.blendFramebuffer);\n        if (this.edgesTexture) gl.deleteTexture(this.edgesTexture);\n        if (this.blendTexture) gl.deleteTexture(this.blendTexture);\n\n        this.edgesFramebuffer = null;\n        this.blendFramebuffer = null;\n        this.edgesTexture = null;\n        this.blendTexture = null;\n    }\n\n    /**\n     * Set quad buffer (share with renderer)\n     */\n    setQuadBuffer(buffer) {\n        this.quadBuffer = buffer;\n    }\n\n    /**\n     * Expose framebuffer for tone mapping target (compatibility with FXAA interface)\n     */\n    get framebuffer() {\n        // Return null - SMAA doesn't use this pattern\n        return null;\n    }\n}\n", "/**\n * GPU-based buffer statistics computation\n * Uses multi-pass reduction to compute min/max/avg efficiently\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * BufferStatsManager\n * Computes min/max/avg of framebuffer using GPU reduction\n */\nexport class BufferStatsManager {\n    constructor(gl) {\n        this.gl = gl;\n        this.reductionProgram = null;\n        this.finalProgram = null;\n        this.quadBuffer = null;\n        this.reductionFBOs = [];\n        this.reductionTextures = [];\n\n        // Cached statistics\n        this.stats = {\n            red: { min: 0, max: 0, avg: 0 },\n            green: { min: 0, max: 0, avg: 0 },\n            blue: { min: 0, max: 0, avg: 0 },\n            maxBrightness: 0,\n            avgBrightness: 0,\n            histogram: [], // Logarithmic histogram bins\n            timestamp: 0\n        };\n\n        this.initialized = false;\n    }\n\n    /**\n     * Initialize shaders and buffers\n     */\n    initialize() {\n        const gl = this.gl;\n\n        // Create quad buffer\n        this.quadBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]), gl.STATIC_DRAW);\n\n        // Reduction shader (downsample 2x2 blocks, compute local min/max/sum)\n        const reductionVS = `\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const reductionFS = `\nprecision highp float;\nuniform sampler2D u_texture;\nuniform vec2 u_texel_size;\nvarying vec2 v_texcoord;\n\nvoid main() {\n    // Sample 2x2 block\n    vec2 base = v_texcoord;\n    vec3 s0 = texture2D(u_texture, base).rgb;\n    vec3 s1 = texture2D(u_texture, base + vec2(u_texel_size.x, 0.0)).rgb;\n    vec3 s2 = texture2D(u_texture, base + vec2(0.0, u_texel_size.y)).rgb;\n    vec3 s3 = texture2D(u_texture, base + u_texel_size).rgb;\n\n    // Compute min/max across the 2x2 block\n    vec3 minVal = min(min(s0, s1), min(s2, s3));\n    vec3 maxVal = max(max(s0, s1), max(s2, s3));\n\n    // Store: R=min, G=max, B=sum (for averaging)\n    // We'll pack min in R channel, max in G channel, sum in B channel\n    // Actually, we need all three channels for each stat, so let's use a different approach\n    // Let's just compute the max for now (most useful for saturation buildup)\n\n    gl_FragColor = vec4(maxVal, 1.0);\n}\n`;\n\n        this.reductionProgram = this.createProgram(reductionVS, reductionFS);\n        if (!this.reductionProgram) {\n            logger.error('Failed to create reduction shader');\n            return false;\n        }\n\n        this.initialized = true;\n        return true;\n    }\n\n    /**\n     * Create shader program\n     */\n    createProgram(vsSource, fsSource) {\n        const gl = this.gl;\n\n        const vs = gl.createShader(gl.VERTEX_SHADER);\n        gl.shaderSource(vs, vsSource);\n        gl.compileShader(vs);\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n            logger.error('Vertex shader compile error:', gl.getShaderInfoLog(vs));\n            return null;\n        }\n\n        const fs = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(fs, fsSource);\n        gl.compileShader(fs);\n        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n            logger.error('Fragment shader compile error:', gl.getShaderInfoLog(fs));\n            return null;\n        }\n\n        const program = gl.createProgram();\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        gl.linkProgram(program);\n        if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            logger.error('Program link error:', gl.getProgramInfoLog(program));\n            return null;\n        }\n\n        return program;\n    }\n\n    /**\n     * Compute statistics (coarse = faster, samples every Nth pixel)\n     */\n    compute(sourceTexture, width, height, coarse = true) {\n        if (!this.initialized && !this.initialize()) {\n            return this.stats; // Return cached stats on failure\n        }\n\n        const gl = this.gl;\n        const sampleRate = coarse ? 16 : 2; // Downsample by 16x (coarse) or 2x (fine) - 16x gives ~4x less pixels\n\n        // For now, let's do a simple CPU-based sampling approach\n        // (GPU reduction is complex and requires multiple passes)\n        return this.computeCPUSampled(sourceTexture, width, height, sampleRate);\n    }\n\n    /**\n     * CPU-based sampling (reads back sampled pixels)\n     * Reads multiple small regions distributed across the screen\n     */\n    computeCPUSampled(sourceTexture, width, height, sampleRate) {\n        const gl = this.gl;\n\n        // Create temporary framebuffer\n        const fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fbo);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, sourceTexture, 0);\n\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Framebuffer not complete for stats readback');\n            gl.deleteFramebuffer(fbo);\n            return this.stats;\n        }\n\n        // Sample multiple regions across the screen in a grid pattern\n        // This ensures we capture bright/dark areas anywhere on screen, not just center\n        const gridSize = 4; // 4x4 grid = 16 regions\n        const regionSize = 16; // Each region is 16x16 pixels\n        const totalPixels = gridSize * gridSize * regionSize * regionSize;\n        const allPixels = new Float32Array(totalPixels * 4);\n\n        let pixelIndex = 0;\n        for (let gy = 0; gy < gridSize; gy++) {\n            for (let gx = 0; gx < gridSize; gx++) {\n                // Calculate position for this region (evenly distributed)\n                const x = Math.floor((width / gridSize) * gx + (width / gridSize - regionSize) / 2);\n                const y = Math.floor((height / gridSize) * gy + (height / gridSize - regionSize) / 2);\n\n                // Read this region\n                const regionPixels = new Float32Array(regionSize * regionSize * 4);\n                gl.readPixels(x, y, regionSize, regionSize, gl.RGBA, gl.FLOAT, regionPixels);\n\n                // Copy to combined buffer\n                allPixels.set(regionPixels, pixelIndex * 4);\n                pixelIndex += regionSize * regionSize;\n            }\n        }\n\n        gl.deleteFramebuffer(fbo);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Compute statistics from all sampled pixels\n        let minR = Infinity, maxR = -Infinity, sumR = 0;\n        let minG = Infinity, maxG = -Infinity, sumG = 0;\n        let minB = Infinity, maxB = -Infinity, sumB = 0;\n        const count = totalPixels;\n\n        for (let i = 0; i < count; i++) {\n            const idx = i * 4;\n            const r = allPixels[idx];\n            const g = allPixels[idx + 1];\n            const b = allPixels[idx + 2];\n\n            minR = Math.min(minR, r);\n            maxR = Math.max(maxR, r);\n            sumR += r;\n\n            minG = Math.min(minG, g);\n            maxG = Math.max(maxG, g);\n            sumG += g;\n\n            minB = Math.min(minB, b);\n            maxB = Math.max(maxB, b);\n            sumB += b;\n        }\n\n        // Compute averages\n        const avgR = count > 0 ? sumR / count : 0;\n        const avgG = count > 0 ? sumG / count : 0;\n        const avgB = count > 0 ? sumB / count : 0;\n\n        // Compute logarithmic histogram (20 bins)\n        const numBins = 20;\n        const histogram = new Array(numBins).fill(0);\n        const maxBright = Math.max(maxR, maxG, maxB);\n\n        if (maxBright > 0) {\n            const logMax = Math.log2(maxBright + 1);\n\n            for (let i = 0; i < count; i++) {\n                const idx = i * 4;\n                const brightness = Math.max(allPixels[idx], allPixels[idx + 1], allPixels[idx + 2]);\n                const logBrightness = Math.log2(brightness + 1);\n                const binIndex = Math.min(Math.floor((logBrightness / logMax) * numBins), numBins - 1);\n                histogram[binIndex]++;\n            }\n        }\n\n        // Update cached stats\n        this.stats = {\n            red: { min: minR, max: maxR, avg: avgR },\n            green: { min: minG, max: maxG, avg: avgG },\n            blue: { min: minB, max: maxB, avg: avgB },\n            maxBrightness: Math.max(maxR, maxG, maxB),\n            avgBrightness: (avgR + avgG + avgB) / 3,\n            histogram: histogram,\n            timestamp: Date.now(),\n            sampledPixels: count,\n            sampleRate: sampleRate\n        };\n\n        return this.stats;\n    }\n\n    /**\n     * Get cached statistics (doesn't recompute)\n     */\n    getCached() {\n        return this.stats;\n    }\n\n    /**\n     * Dispose resources\n     */\n    dispose() {\n        const gl = this.gl;\n\n        if (this.quadBuffer) gl.deleteBuffer(this.quadBuffer);\n        if (this.reductionProgram) gl.deleteProgram(this.reductionProgram);\n        if (this.finalProgram) gl.deleteProgram(this.finalProgram);\n\n        this.reductionFBOs.forEach(fbo => gl.deleteFramebuffer(fbo));\n        this.reductionTextures.forEach(tex => gl.deleteTexture(tex));\n\n        this.reductionFBOs = [];\n        this.reductionTextures = [];\n    }\n}\n", "/**\n * GPU-based velocity statistics computation\n * Samples particles and computes max/avg velocity using shaders\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\nexport class VelocityStatsManager {\n    constructor(gl) {\n        this.gl = gl;\n        this.program = null;\n        this.quadBuffer = null;\n        this.resultTexture = null;\n        this.resultFBO = null;\n\n        // Cached statistics\n        this.stats = {\n            maxVelocity: 5.0,\n            avgVelocity: 2.0,\n            sampleCount: 0,\n            timestamp: 0\n        };\n\n        this.initialized = false;\n        this.shaderSource = null; // Store for debugging\n    }\n\n    /**\n     * Initialize shaders and buffers\n     * @param {number} dimensions - Number of dimensions\n     * @param {string[]} velocityExpressions - Compiled GLSL expressions\n     * @param {Object} coordinateSystemCode - Optional coordinate system transformation code\n     */\n    initialize(dimensions, velocityExpressions, coordinateSystemCode = null) {\n        const gl = this.gl;\n\n        // Create quad buffer for full-screen pass\n        this.quadBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]), gl.STATIC_DRAW);\n\n        // Create small result texture (64x1 pixels for 64 samples)\n        this.resultTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.resultTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 64, 1, 0, gl.RGBA, gl.FLOAT, null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n        // Create framebuffer\n        this.resultFBO = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.resultFBO);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.resultTexture, 0);\n\n        if (gl.checkFramebufferStatus(gl.FRAMEBUFFER) !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Velocity stats framebuffer not complete');\n            this.dispose();\n            return false;\n        }\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Generate velocity function from expressions\n        const vecType = `vec${dimensions}`;\n        const swizzles = ['x', 'y', 'z', 'w'];\n        const velocityComponents = velocityExpressions.map((expr, i) =>\n            `    result.${swizzles[i]} = ${expr};`\n        ).join('\\n');\n\n        // Check if we have coordinate system transformations\n        const hasCoordinateSystem = coordinateSystemCode && coordinateSystemCode.forwardTransform;\n\n        const velocityFunction = hasCoordinateSystem ? `\n// User-defined velocity field in native coordinates\n${vecType} get_velocity_native(${vecType} pos_native) {\n    ${vecType} result;\n${velocityComponents}\n    return result;\n}\n\n// Velocity field for statistics (native-space integration)\n${vecType} get_velocity(${vecType} pos_cartesian) {\n    ${vecType} pos_native = transformToNative(pos_cartesian);\n    return get_velocity_native(pos_native);\n}\n` : `\n// User-defined velocity field\n${vecType} get_velocity(${vecType} pos) {\n    ${vecType} result;\n    float x = pos.x;\n    ${dimensions > 1 ? 'float y = pos.y;' : ''}\n    ${dimensions > 2 ? 'float z = pos.z;' : ''}\n    ${dimensions > 3 ? 'float w = pos.w;' : ''}\n\n${velocityComponents}\n\n    return result;\n}\n`;\n\n        // Create shader program\n        const vertexShader = `\nattribute vec2 a_pos;\nvarying vec2 v_texcoord;\nvoid main() {\n    v_texcoord = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n`;\n\n        const fragmentShader = `\nprecision highp float;\n\n${Array.from({length: dimensions}, (_, i) => `uniform sampler2D u_pos_${i};`).join('\\n')}\nuniform vec2 u_bbox_min;\nuniform vec2 u_bbox_max;\nuniform float u_resolution;\nuniform float u_sample_count;\nuniform float u_alpha;\n\nvarying vec2 v_texcoord;\n\n${hasCoordinateSystem ? coordinateSystemCode.forwardTransform : ''}\n\n${velocityFunction}\n\nvoid main() {\n    // Each output pixel computes velocity for one sampled particle\n    float particleIndex = floor(v_texcoord.x * u_sample_count);\n\n    // Random sampling across all particles\n    float totalParticles = u_resolution * u_resolution;\n    float stride = totalParticles / u_sample_count;\n    float sampleIdx = particleIndex * stride;\n\n    // Convert to texture coordinates\n    float x = mod(sampleIdx, u_resolution);\n    float y = floor(sampleIdx / u_resolution);\n    vec2 texCoord = (vec2(x, y) + 0.5) / u_resolution;\n\n    // Read position from textures\n    vec${dimensions} position;\n    ${Array.from({length: dimensions}, (_, i) =>\n        `position[${i}] = texture2D(u_pos_${i}, texCoord).r;`\n    ).join('\\n    ')}\n\n    // Compute velocity\n    vec${dimensions} velocity = get_velocity(position);\n\n    // Compute magnitude\n    float speed = length(velocity);\n\n    // Output: R = velocity magnitude, G = 1.0 (for counting), B/A unused\n    gl_FragColor = vec4(speed, 1.0, 0.0, 1.0);\n}\n`;\n\n        const vs = gl.createShader(gl.VERTEX_SHADER);\n        gl.shaderSource(vs, vertexShader);\n        gl.compileShader(vs);\n        if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n            logger.error('Velocity stats vertex shader error:', gl.getShaderInfoLog(vs));\n            return false;\n        }\n\n        const fs = gl.createShader(gl.FRAGMENT_SHADER);\n        gl.shaderSource(fs, fragmentShader);\n        gl.compileShader(fs);\n        if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n            logger.error('Velocity stats fragment shader error:', gl.getShaderInfoLog(fs));\n            logger.error('Generated shader code:\\n' + fragmentShader);\n            return false;\n        }\n\n        this.program = gl.createProgram();\n        gl.attachShader(this.program, vs);\n        gl.attachShader(this.program, fs);\n        gl.linkProgram(this.program);\n        if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n            logger.error('Velocity stats program link error:', gl.getProgramInfoLog(this.program));\n            return false;\n        }\n\n        this.initialized = true;\n        this.dimensions = dimensions;\n        this.shaderSource = fragmentShader; // Store for debugging\n        logger.verbose('VelocityStatsManager initialized');\n        return true;\n    }\n\n    /**\n     * Compute velocity statistics\n     */\n    compute(positionTextures, bbox, resolution, animationAlpha = 0.0) {\n        if (!this.initialized) {\n            return this.stats;\n        }\n\n        const gl = this.gl;\n\n        // Render to result texture\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.resultFBO);\n        gl.viewport(0, 0, 64, 1);\n\n        gl.useProgram(this.program);\n\n        // Bind position textures\n        for (let i = 0; i < this.dimensions; i++) {\n            gl.activeTexture(gl.TEXTURE0 + i);\n            gl.bindTexture(gl.TEXTURE_2D, positionTextures[i]);\n            gl.uniform1i(gl.getUniformLocation(this.program, `u_pos_${i}`), i);\n        }\n\n        // Set uniforms\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_bbox_min'), bbox.min[0], bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(this.program, 'u_bbox_max'), bbox.max[0], bbox.max[1]);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_resolution'), resolution);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_sample_count'), 64);\n        gl.uniform1f(gl.getUniformLocation(this.program, 'u_alpha'), animationAlpha);\n\n        // Draw quad\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        const aPosLoc = gl.getAttribLocation(this.program, 'a_pos');\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Read back result (64 pixels \u00D7 4 channels)\n        const results = new Float32Array(64 * 4);\n        gl.readPixels(0, 0, 64, 1, gl.RGBA, gl.FLOAT, results);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        // Process results - extract valid velocities\n        const velocities = [];\n        let maxVel = 0;\n        let sumVel = 0;\n\n        for (let i = 0; i < 64; i++) {\n            const vel = results[i * 4]; // R channel = velocity magnitude\n            if (isFinite(vel) && vel > 0) {\n                velocities.push(vel);\n                maxVel = Math.max(maxVel, vel);\n                sumVel += vel;\n            }\n        }\n\n        const count = velocities.length;\n        const avgVel = count > 0 ? sumVel / count : 0;\n\n        // Compute percentiles (90th and 95th) for more robust scaling\n        let percentile90 = avgVel;\n        let percentile95 = avgVel;\n        if (count > 0) {\n            velocities.sort((a, b) => a - b);\n            const idx90 = Math.floor(count * 0.90);\n            const idx95 = Math.floor(count * 0.95);\n            percentile90 = velocities[Math.min(idx90, count - 1)];\n            percentile95 = velocities[Math.min(idx95, count - 1)];\n        }\n\n        // Update cached stats\n        this.stats = {\n            maxVelocity: maxVel > 0 ? maxVel : this.stats.maxVelocity,\n            avgVelocity: avgVel > 0 ? avgVel : this.stats.avgVelocity,\n            percentile90: percentile90 > 0 ? percentile90 : this.stats.percentile90 || avgVel,\n            percentile95: percentile95 > 0 ? percentile95 : this.stats.percentile95 || avgVel,\n            sampleCount: count,\n            timestamp: Date.now()\n        };\n\n        return this.stats;\n    }\n\n    /**\n     * Get cached statistics\n     */\n    getCached() {\n        return this.stats;\n    }\n\n    /**\n     * Dispose resources\n     */\n    dispose() {\n        const gl = this.gl;\n        if (this.quadBuffer) gl.deleteBuffer(this.quadBuffer);\n        if (this.program) gl.deleteProgram(this.program);\n        if (this.resultTexture) gl.deleteTexture(this.resultTexture);\n        if (this.resultFBO) gl.deleteFramebuffer(this.resultFBO);\n        this.initialized = false;\n    }\n\n    /**\n     * Needs recompilation when velocity field changes\n     */\n    needsRecompile() {\n        return true; // Caller should track this\n    }\n\n    /**\n     * Get shader source for debugging\n     */\n    getShaderSource() {\n        return this.shaderSource;\n    }\n}\n", "/**\n * Particle system for managing particle data\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Particle system class\n */\nexport class ParticleSystem {\n    constructor(particleCount, dimensions, bbox, strategy) {\n        this.particleCount = particleCount;\n        this.dimensions = dimensions;\n        this.bbox = bbox || this.getDefaultBBox(dimensions);\n        this.strategy = strategy;\n\n        // Calculate texture resolution (square texture)\n        this.resolution = Math.ceil(Math.sqrt(particleCount));\n        this.actualParticleCount = this.resolution * this.resolution;\n\n        // Initialize particle data\n        this.initializeParticles();\n    }\n\n    /**\n     * Get default bounding box based on dimensions\n     */\n    getDefaultBBox(dimensions) {\n        const bbox = {\n            min: new Array(dimensions).fill(-5),\n            max: new Array(dimensions).fill(5)\n        };\n        return bbox;\n    }\n\n    /**\n     * Initialize particle positions randomly within bounding box\n     */\n    initializeParticles() {\n        this.data = [];\n        const debugSamples = []; // Track samples for debugging\n\n        const ArrayType = this.strategy.getArrayType();\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            const dimData = new ArrayType(this.actualParticleCount * componentsPerValue);\n\n            for (let i = 0; i < this.actualParticleCount; i++) {\n                // Random position within bounding box for this dimension\n                // Generate world coordinate\n                // Spawn 2% OUTSIDE viewport for natural flow-in effect\n                const margin = -0.02;\n                let worldValue;\n\n                if (dim < 2 && this.bbox.min && this.bbox.max) {\n                    // Use 2D bounding box for first two dimensions\n                    const min = dim === 0 ? this.bbox.min[0] : this.bbox.min[1];\n                    const max = dim === 0 ? this.bbox.max[0] : this.bbox.max[1];\n                    const range = max - min;\n                    // Spawn slightly outside viewport (negative margin)\n                    worldValue = min + range * margin + Math.random() * range * (1 - 2 * margin);\n                } else {\n                    // For higher dimensions, use default range [-10, 10] extending slightly beyond\n                    worldValue = -10.4 + Math.random() * 20.8;\n                }\n\n                // Encode using strategy\n                const min = dim < 2 ? (dim === 0 ? this.bbox.min[0] : this.bbox.min[1]) : -10;\n                const max = dim < 2 ? (dim === 0 ? this.bbox.max[0] : this.bbox.max[1]) : 10;\n                const encoded = this.strategy.encodeValue(worldValue, min, max);\n\n                // Copy encoded value to dimData\n                const offset = i * componentsPerValue;\n                for (let c = 0; c < componentsPerValue; c++) {\n                    dimData[offset + c] = encoded[c];\n                }\n\n                // Debug: log first 10 particles for dimension 0 and 1\n                if (i < 10 && dim < 2) {\n                    // Test round-trip: decode what we just encoded\n                    const buffer = new ArrayType(componentsPerValue);\n                    for (let c = 0; c < componentsPerValue; c++) {\n                        buffer[c] = dimData[offset + c];\n                    }\n                    const decodedWorld = this.strategy.decodeValue(buffer, min, max);\n\n                    if (!debugSamples[i]) debugSamples[i] = {};\n\n                    // Format encoded value for display\n                    let encodedStr;\n                    if (componentsPerValue === 4) {\n                        encodedStr = `[${encoded[0].toFixed?.(0) || encoded[0]}, ${encoded[1].toFixed?.(0) || encoded[1]}, ${encoded[2].toFixed?.(0) || encoded[2]}, ${encoded[3].toFixed?.(0) || encoded[3]}]`;\n                    } else {\n                        encodedStr = encoded[0].toString();\n                    }\n\n                    debugSamples[i][dim === 0 ? 'x' : 'y'] = {\n                        worldValue: worldValue.toFixed(4),\n                        encoded: encodedStr,\n                        decodedWorld: decodedWorld.toFixed(4),\n                        error: Math.abs(worldValue - decodedWorld).toFixed(6)\n                    };\n                }\n            }\n\n            this.data.push(dimData);\n        }\n\n        // Log debug samples\n        if (debugSamples.length > 0) {\n            logger.info('Particle initialization - first 10 particles:', {\n                strategy: this.strategy.getName(),\n                bbox: `[${this.bbox.min[0]}, ${this.bbox.min[1]}] to [${this.bbox.max[0]}, ${this.bbox.max[1]}]`,\n                samples: debugSamples.filter(s => s) // Filter out undefined\n            });\n        }\n\n        // Create particle index buffer (for rendering)\n        this.indices = new Float32Array(this.actualParticleCount);\n        for (let i = 0; i < this.actualParticleCount; i++) {\n            this.indices[i] = i;\n        }\n    }\n\n    /**\n     * Get particle data for a specific dimension\n     */\n    getDimensionData(dimension) {\n        return this.data[dimension];\n    }\n\n    /**\n     * Get all particle data\n     */\n    getAllData() {\n        return this.data;\n    }\n\n    /**\n     * Get particle indices for rendering\n     */\n    getIndices() {\n        return this.indices;\n    }\n\n    /**\n     * Update particle count and reinitialize\n     */\n    setParticleCount(newCount) {\n        this.particleCount = newCount;\n        this.resolution = Math.ceil(Math.sqrt(newCount));\n        this.actualParticleCount = this.resolution * this.resolution;\n        this.initializeParticles();\n    }\n\n    /**\n     * Update dimensions and reinitialize\n     */\n    setDimensions(newDimensions) {\n        this.dimensions = newDimensions;\n        this.bbox = this.getDefaultBBox(newDimensions);\n        this.initializeParticles();\n    }\n\n    /**\n     * Update bounding box\n     */\n    setBBox(newBBox) {\n        this.bbox = newBBox;\n    }\n\n    /**\n     * Get current resolution\n     */\n    getResolution() {\n        return this.resolution;\n    }\n\n    /**\n     * Get actual particle count (may be higher than requested due to square texture)\n     */\n    getActualParticleCount() {\n        return this.actualParticleCount;\n    }\n}\n", "/**\n * Main WebGL renderer for N-dimensional vector field visualization\n */\n\nimport { TextureManager } from './textures.js';\nimport { FramebufferManager } from './framebuffer.js';\nimport { BilateralFilterManager } from './bilateral.js';\nimport { SMAAManager } from './smaa.js';\nimport { BufferStatsManager } from './buffer-stats.js';\nimport { VelocityStatsManager } from './velocity-stats.js';\nimport { ParticleSystem } from '../particles/system.js';\nimport {\n    createProgram,\n    generateUpdateVertexShader,\n    generateUpdateFragmentShader,\n    generateDrawVertexShader,\n    generateDrawFragmentShader,\n    generateScreenVertexShader,\n    generateScreenFadeFragmentShader,\n    generateScreenCopyFragmentShader,\n    generateTonemapFragmentShader\n} from './shaders.js';\nimport { parseVectorField, createVelocityEvaluators, parseExpression } from '../math/parser.js';\nimport { getIntegrator } from '../math/integrators.js';\nimport { getMapper } from '../math/mappers.js';\nimport { getTransform } from '../math/transforms.js';\nimport { getColorMode, generateExpressionColorMode, generateGradientColorMode } from '../math/colors.js';\nimport { generateGradientGLSL, getDefaultGradient } from '../math/gradients.js';\nimport { generateTonemapGLSL, getToneMapper } from '../math/tonemapping.js';\nimport { getCartesianSystem } from '../math/coordinate-systems.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { RGBAStrategy } from './strategies/rgba-strategy.js';\nimport { FloatStrategy } from './strategies/float-strategy.js';\n\n/**\n * WebGL Renderer class\n */\nexport class Renderer {\n    constructor(canvas, config = {}) {\n        this.canvas = canvas;\n        this.gl = canvas.getContext('webgl', {\n            alpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false,\n            preserveDrawingBuffer: true\n        });\n\n        if (!this.gl) {\n            throw new Error('WebGL not supported');\n        }\n\n        const gl = this.gl;\n\n        // Disable depth and stencil tests\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.STENCIL_TEST);\n\n        // Enable blending (blend mode will be set per render pass)\n        gl.enable(gl.BLEND);\n\n        // Select coordinate storage strategy\n        const strategyType = config.storageStrategy || 'rgba';\n        try {\n            if (strategyType === 'float') {\n                this.strategy = new FloatStrategy(gl);\n                logger.info('Using Float texture strategy');\n            } else {\n                this.strategy = new RGBAStrategy(gl);\n                logger.info('Using RGBA encoded texture strategy');\n            }\n        } catch (error) {\n            logger.warn(`Failed to initialize ${strategyType} strategy: ${error.message}`);\n            logger.info('Falling back to RGBA strategy');\n            this.strategy = new RGBAStrategy(gl);\n        }\n\n        // Initialize state\n        this.dimensions = 2;\n        this.expressions = ['-y', 'x'];\n        this.coordinateSystem = getCartesianSystem(this.dimensions); // Must initialize BEFORE creating evaluators\n\n        // Create velocity evaluators for sampling\n        try {\n            const coordinateVars = this.coordinateSystem.getVariableNames();\n            this.velocityEvaluators = createVelocityEvaluators(this.expressions, coordinateVars);\n            logger.verbose('Initial velocity evaluators created', {\n                coordinateSystem: this.coordinateSystem.name,\n                variables: coordinateVars\n            });\n        } catch (error) {\n            logger.warn('Failed to create initial velocity evaluators', error);\n            this.velocityEvaluators = null;\n        }\n\n        this.integratorType = 'rk4';\n        this.integratorParams = { iterations: 3 }; // For implicit methods\n        this.integratorCostFactor = 1; // Cost factor for fair integrator comparison (set during shader compilation)\n        this.solutionMethod = 'fixed-point'; // For implicit methods: 'fixed-point' or 'newton'\n        this.transformType = 'identity'; // Domain transformation type\n        this.transformParams = {}; // Transform parameters\n        this.mapperType = 'select';\n        this.mapperParams = { dim1: 0, dim2: 1 };\n        this.colorMode = 'white';\n        this.colorExpression = 'x * y'; // Default expression for expression mode\n        this.colorGradient = getDefaultGradient(); // Default gradient\n        this.velocityScaleMode = 'percentile95'; // 'max', 'average', 'percentile90', 'percentile95'\n        this.velocityLogScale = false; // Use logarithmic scaling for velocity colors\n\n        // HDR rendering settings\n        this.useHDR = config.useHDR !== undefined ? config.useHDR : true;\n        this.tonemapOperator = config.tonemapOperator || 'aces';\n        this.exposure = config.exposure !== undefined ? config.exposure : 1.0;\n        this.gamma = config.gamma !== undefined ? config.gamma : 2.2;\n        this.luminanceGamma = config.luminanceGamma !== undefined ? config.luminanceGamma : 1.0;\n        this.highlightCompression = config.highlightCompression !== undefined ? config.highlightCompression : 0.0;\n        this.compressionThreshold = config.compressionThreshold !== undefined ? config.compressionThreshold : 1.0;\n        this.whitePoint = config.whitePoint !== undefined ? config.whitePoint : 2.0;\n        this.particleIntensity = config.particleIntensity !== undefined ? config.particleIntensity : 1.0;\n        this.particleSize = config.particleSize !== undefined ? config.particleSize : 1.0;\n        this.particleRenderMode = config.particleRenderMode || 'points'; // 'points' or 'lines'\n\n        // Depth testing (plasma mode)\n        this.useDepthTest = config.useDepthTest !== undefined ? config.useDepthTest : false;\n        this.colorSaturation = config.colorSaturation !== undefined ? config.colorSaturation : 1.0; // 0.0 = grayscale, 1.0 = full saturation\n        this.brightnessDesaturation = config.brightnessDesaturation !== undefined ? config.brightnessDesaturation : 0.0; // 0.0 = no desat, 1.0 = full desat at bright areas\n        this.brightnessSaturation = config.brightnessSaturation !== undefined ? config.brightnessSaturation : 0.0; // 0.0 = no effect, 1.0 = dim areas fully desaturated\n\n        // SMAA settings (morphological antialiasing)\n        this.smaaEnabled = config.smaaEnabled !== undefined ? config.smaaEnabled : true;\n        this.smaaIntensity = config.smaaIntensity !== undefined ? config.smaaIntensity : 0.75;\n        this.smaaThreshold = config.smaaThreshold !== undefined ? config.smaaThreshold : 0.1;\n\n        // Bilateral filter settings (edge-preserving noise reduction)\n        this.bilateralEnabled = config.bilateralEnabled !== undefined ? config.bilateralEnabled : false;\n        this.bilateralSpatialSigma = config.bilateralSpatialSigma !== undefined ? config.bilateralSpatialSigma : 4.0;\n        this.bilateralIntensitySigma = config.bilateralIntensitySigma !== undefined ? config.bilateralIntensitySigma : 0.2;\n\n        // Render scale (render at different resolution, resample to canvas)\n        // Supports both downsampling (0.5x for performance) and supersampling (2x+ for quality)\n        // Validate and clamp render scale factor\n        let supersampleFactor = config.supersampleFactor !== undefined ? config.supersampleFactor : 1.0;\n        if (typeof supersampleFactor !== 'number' || isNaN(supersampleFactor) || supersampleFactor <= 0) {\n            logger.warn(`Invalid supersampleFactor: ${supersampleFactor}, using default 1.0`);\n            supersampleFactor = 1.0;\n        }\n        this.supersampleFactor = Math.max(0.5, Math.min(4.0, supersampleFactor));\n        logger.info(`Initial render scale factor set to: ${this.supersampleFactor}`);\n\n        this.timestep = 0.01;\n        this.fadeOpacity = 0.99;\n        this.dropProbability = 0.003;\n        this.respawnMargin = 0.2; // Margin (as fraction of viewport) for respawning particles\n\n        // Animation support\n        this.animationAlpha = 0.0; // Alpha parameter for animation (0.0 to 1.0)\n        this.lockShaderRecompilation = false; // Prevent shader recompilation during animation\n\n        // Debug stats (expensive GPU readbacks)\n        this.enableDebugStats = false; // Enable particle sampling and detailed logging (expensive)\n\n        // Exponential moving average for max velocity (for color scaling)\n        this.maxVelocity = 5.0; // Initial reasonable value\n        this.prevMaxVelocity = 5.0; // Previous value for change detection\n        this.velocityEMAAlpha = 0.1; // Blend factor for new samples (10% new, 90% old)\n        this.velocitySampleInterval = 10; // Adaptive sample interval\n        this.velocitySampleIntervalMin = 5; // Sample at least every 5 frames when changing\n        this.velocitySampleIntervalMax = 60; // Sample at most every 60 frames when stable\n        this.framesSinceLastSample = 0; // Track frames for adaptive sampling\n        this.lowVelocityThreshold = 0.02; // Drop particles below 2% of max velocity\n\n        // Bounding box for 2D display (with aspect ratio correction)\n        const aspectRatio = canvas.width / canvas.height;\n        const height = 10; // -5 to 5\n        const width = height * aspectRatio;\n        this.bbox = {\n            min: [-width / 2, -5],\n            max: [width / 2, 5]\n        };\n\n        // Particle system\n        this.particleSystem = new ParticleSystem(10000, this.dimensions, this.bbox, this.strategy);\n\n        // Texture manager\n        this.textureManager = new TextureManager(\n            gl,\n            this.dimensions,\n            this.particleSystem.getResolution(),\n            this.strategy\n        );\n\n        // Set line mode if configured\n        if (this.particleRenderMode === 'lines') {\n            this.textureManager.setLineMode(true);\n        }\n\n        // Create framebuffer for particle position updates (not HDR, separate from screen rendering)\n        this.updateFramebuffer = gl.createFramebuffer();\n\n        // Calculate render resolution based on supersample factor\n        // Ensure we always have valid dimensions (minimum 1x1)\n        const canvasWidth = Math.max(1, canvas.width || 800);\n        const canvasHeight = Math.max(1, canvas.height || 600);\n        this.renderWidth = Math.max(1, Math.floor(canvasWidth * this.supersampleFactor));\n        this.renderHeight = Math.max(1, Math.floor(canvasHeight * this.supersampleFactor));\n\n        logger.verbose('Render dimensions calculated', {\n            canvasSize: `${canvasWidth}x${canvasHeight}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        // Create framebuffer manager for HDR rendering\n        logger.info('Initializing HDR rendering system...', {\n            requested: this.useHDR,\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        this.framebufferManager = new FramebufferManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                useHDR: this.useHDR,\n                usePingPong: true\n            }\n        );\n\n        // Log HDR capabilities and status\n        const hdrSupport = this.framebufferManager.getHDRSupport();\n        logger.info('HDR rendering system initialized', {\n            hdrEnabled: hdrSupport.enabled,\n            hdrSupported: hdrSupport.supported,\n            textureFormat: hdrSupport.format,\n            extensions: {\n                floatColorBuffer: hdrSupport.hasFloatColorBuffer,\n                halfFloatColorBuffer: hdrSupport.hasHalfFloatColorBuffer,\n                linearFiltering: hdrSupport.hasLinearFiltering\n            },\n            exposure: this.exposure,\n            gamma: this.gamma\n        });\n\n        if (this.useHDR && !hdrSupport.supported) {\n            logger.warn('HDR rendering requested but not supported by device. Using LDR fallback.');\n        }\n\n        // Create SMAA manager\n        this.smaaManager = new SMAAManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                enabled: this.smaaEnabled,\n                intensity: this.smaaIntensity,\n                threshold: this.smaaThreshold\n            }\n        );\n\n        logger.info('SMAA system initialized', {\n            enabled: this.smaaManager.isEnabled(),\n            intensity: this.smaaIntensity,\n            threshold: this.smaaThreshold\n        });\n\n        // Create bilateral filter manager\n        this.bilateralManager = new BilateralFilterManager(\n            gl,\n            this.renderWidth,\n            this.renderHeight,\n            {\n                enabled: this.bilateralEnabled,\n                spatialSigma: this.bilateralSpatialSigma,\n                intensitySigma: this.bilateralIntensitySigma\n            }\n        );\n\n        logger.info('Bilateral filter initialized', {\n            enabled: this.bilateralManager.isEnabled(),\n            spatialSigma: this.bilateralSpatialSigma,\n            intensitySigma: this.bilateralIntensitySigma\n        });\n\n        // Create dedicated LDR framebuffer for tone mapping output\n        // (prevents conflicts with SMAA's edges framebuffer)\n        this.ldrFramebuffer = gl.createFramebuffer();\n        this.ldrTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.ldrTexture);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.ldrTexture, 0);\n\n        const ldrFBStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (ldrFBStatus !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('LDR framebuffer incomplete', { status: ldrFBStatus });\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        logger.info('LDR framebuffer created for tone mapping output');\n\n        // Create final output framebuffer for scaled rendering\n        // SMAA will render to this at scaled resolution, then we resample to canvas\n        this.finalFramebuffer = gl.createFramebuffer();\n        this.finalTexture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        // Use linear filtering (mipmaps require power-of-two textures in WebGL 1.0)\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.finalFramebuffer);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.finalTexture, 0);\n\n        const finalFBStatus = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n        if (finalFBStatus !== gl.FRAMEBUFFER_COMPLETE) {\n            logger.error('Final framebuffer incomplete', { status: finalFBStatus });\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        logger.info('Final framebuffer created for supersampling output');\n\n        // Create buffer statistics manager\n        this.bufferStatsManager = new BufferStatsManager(gl);\n        this.velocityStatsManager = new VelocityStatsManager(gl);\n        this.statsUpdateInterval = 60; // Update stats every N frames (adaptive)\n        this.statsUpdateIntervalSlow = 120; // Slower update when not running (less important)\n        this.statsCoarseMode = true; // Use coarse sampling by default\n\n        // Create full-screen quad buffer\n        this.quadBuffer = this.createBuffer(new Float32Array([\n            0, 0,\n            1, 0,\n            0, 1,\n            0, 1,\n            1, 0,\n            1, 1\n        ]));\n\n        // Share quad buffer with postprocessing managers to avoid duplication\n        this.smaaManager.setQuadBuffer(this.quadBuffer);\n        this.bilateralManager.setQuadBuffer(this.quadBuffer);\n\n        // Compile shaders\n        logger.info('Compiling shaders...', { dimensions: this.dimensions, integrator: this.integratorType });\n        const shaderError = this.compileShaders();\n        if (shaderError) {\n            logger.error('Shader compilation failed', shaderError);\n            throw new Error(`Shader compilation failed: ${shaderError}`);\n        }\n        logger.info('Shaders compiled successfully');\n\n        // Initialize textures with particle data\n        logger.info('Initializing particle textures...', {\n            resolution: this.particleSystem.getResolution(),\n            particleCount: this.particleSystem.getActualParticleCount()\n        });\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n\n        // Create particle index buffers for both modes\n        this.indexBufferPoints = this.createBuffer(this.particleSystem.getIndices());\n        this.indexBufferLines = this.createLineIndexBuffer(this.particleSystem.getActualParticleCount());\n        this.vertexIdBufferLines = this.createLineVertexIdBuffer(this.particleSystem.getActualParticleCount());\n\n        // Animation state\n        this.isRunning = false;\n        this.frame = 0;\n        this.hdrLogged = false; // Flag to log HDR info on first frame\n    }\n\n    /**\n     * Create a WebGL buffer\n     */\n    createBuffer(data) {\n        const gl = this.gl;\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n    /**\n     * Create line mode index buffer (each particle index appears twice)\n     */\n    createLineIndexBuffer(particleCount) {\n        const gl = this.gl;\n        const indices = new Float32Array(particleCount * 2);\n\n        // Each particle renders 2 vertices: [0,0,1,1,2,2,3,3,...]\n        for (let i = 0; i < particleCount; i++) {\n            indices[i * 2] = i;\n            indices[i * 2 + 1] = i;\n        }\n\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, indices, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n    /**\n     * Create vertex ID buffer for line mode (alternating 0,1 for prev/current)\n     */\n    createLineVertexIdBuffer(particleCount) {\n        const gl = this.gl;\n        const vertexIds = new Float32Array(particleCount * 2);\n\n        // Alternating pattern: [0,1,0,1,0,1,...]\n        // 0 = previous position, 1 = current position\n        for (let i = 0; i < particleCount * 2; i++) {\n            vertexIds[i] = i % 2;\n        }\n\n        const buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, vertexIds, gl.STATIC_DRAW);\n        return buffer;\n    }\n\n\n    /**\n     * Compile all shader programs\n     */\n    compileShaders() {\n        const gl = this.gl;\n\n        try {\n            // Get coordinate system variable names\n            const coordinateVars = this.coordinateSystem.getVariableNames();\n            const isCartesian = this.coordinateSystem.name.includes('Cartesian');\n\n            // Use pre-generated GLSL if available, otherwise parse expressions\n            let velocityGLSL;\n            if (this.velocityGLSL) {\n                velocityGLSL = this.velocityGLSL;\n                logger.verbose('Using pre-generated velocity GLSL', {\n                    glsl: velocityGLSL\n                });\n            } else {\n                // Fallback: Parse expressions to GLSL using coordinate system variables\n                // For non-Cartesian systems, use 'pos_native' as the GLSL variable name\n                const posVarName = isCartesian ? 'pos' : 'pos_native';\n                velocityGLSL = parseVectorField(this.expressions, coordinateVars, posVarName);\n                logger.verbose('Generated velocity GLSL from expressions', {\n                    expressions: this.expressions,\n                    coordinateSystem: this.coordinateSystem.name,\n                    variables: coordinateVars,\n                    posVarName: posVarName,\n                    glsl: velocityGLSL\n                });\n            }\n\n            // Generate coordinate system GLSL code (if not Cartesian)\n            let coordinateSystemCode = null;\n            if (!isCartesian) {\n                const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n                const nativeVars = this.coordinateSystem.getVariableNames();\n\n                coordinateSystemCode = {\n                    name: this.coordinateSystem.name,\n                    nativeVars: nativeVars,\n                    forwardTransform: this.coordinateSystem.generateForwardTransformGLSL(cartesianVars, (expr, vars) => {\n                        return parseExpression(expr, vars.length, vars);\n                    }),\n                    inverseTransform: this.coordinateSystem.generateInverseTransformGLSL(nativeVars, (expr, vars) => {\n                        return parseExpression(expr, vars.length, vars);\n                    })\n                    // velocityTransform removed - not needed with native-space integration\n                };\n                logger.verbose('Generated coordinate system code', {\n                    name: coordinateSystemCode.name,\n                    forward: coordinateSystemCode.forwardTransform,\n                    inverse: coordinateSystemCode.inverseTransform\n                });\n            }\n\n            // Get integrator code (pass expressions and solutionMethod for Newton's method support)\n            const integratorParams = {\n                ...this.integratorParams,\n                expressions: this.expressions,\n                solutionMethod: this.solutionMethod\n            };\n            const integrator = getIntegrator(this.integratorType, this.dimensions, integratorParams);\n\n            // Store integrator costFactor for timestep scaling\n            this.integratorCostFactor = integrator.costFactor || 1;\n\n            // Get mapper code\n            const mapper = getMapper(this.mapperType, this.dimensions, this.mapperParams);\n\n            // Get transform code (domain transformation)\n            let transformCode = null;\n            if (this.transformType !== 'identity') {\n                const transform = getTransform(this.transformType);\n                transformCode = {\n                    helpers: transform.generateHelpers(this.dimensions),\n                    forward: transform.generateForward(this.dimensions),\n                    inverse: transform.generateInverse(this.dimensions),\n                    jacobian: transform.generateJacobian(this.dimensions)\n                };\n            }\n\n            // Get color mode code\n            const colorMode = getColorMode(this.colorMode, this.dimensions);\n            let colorCode = colorMode.code;\n            let usesMaxVelocity = colorMode.usesMaxVelocity || false;\n\n            // Handle expression mode specially\n            if (this.colorMode === 'expression') {\n                // Parse color expression to GLSL\n                const expressionGLSL = parseExpression(this.colorExpression, this.dimensions);\n\n                // Generate gradient GLSL\n                const gradientGLSL = generateGradientGLSL(this.colorGradient);\n\n                // Generate complete color function\n                colorCode = generateExpressionColorMode(this.dimensions, expressionGLSL, gradientGLSL);\n            }\n            // Handle gradient-based color modes (always use current gradient)\n            else if (colorMode.usesGradient) {\n                // Generate gradient GLSL\n                const gradientGLSL = generateGradientGLSL(this.colorGradient);\n\n                // Generate gradient-based version of the preset mode\n                colorCode = generateGradientColorMode(this.colorMode, this.dimensions, gradientGLSL);\n\n                // usesMaxVelocity already set from colorMode\n            }\n\n            // Create update program\n            const updateVertexShader = generateUpdateVertexShader();\n            const updateFragmentShader = generateUpdateFragmentShader(\n                this.dimensions,\n                velocityGLSL,\n                integrator.code,\n                this.strategy,\n                transformCode,\n                coordinateSystemCode\n            );\n\n            this.updateProgram = createProgram(gl, updateVertexShader, updateFragmentShader);\n\n            // Note: Age is now stored in alpha channel of u_pos_0, no separate age shader needed\n\n            // Create draw program\n            const isLineMode = this.particleRenderMode === 'lines';\n            const drawVertexShader = generateDrawVertexShader(\n                this.dimensions,\n                mapper.code,\n                velocityGLSL,\n                this.strategy,\n                isLineMode,\n                coordinateSystemCode\n            );\n            const drawFragmentShader = generateDrawFragmentShader(this.dimensions, colorCode, usesMaxVelocity);\n\n            this.drawProgram = createProgram(gl, drawVertexShader, drawFragmentShader);\n\n            // Track whether we need to compute max velocity\n            this.usesMaxVelocity = usesMaxVelocity;\n\n            // Store shader source for debugging\n            this.shaderSource = {\n                updateVertex: updateVertexShader,\n                updateFragment: updateFragmentShader,\n                drawVertex: drawVertexShader,\n                drawFragment: drawFragmentShader,\n                velocityField: velocityGLSL  // Store for velocity stats manager\n            };\n\n            // Dump shaders if flag is set\n            if (this.dumpShadersOnCompile) {\n                console.log('\\n========== SHADER DUMP ==========');\n                console.log(`Config: ${this.dimensions}D, ${this.integratorType}, ${this.mapperType}, ${this.colorMode}`);\n                console.log('\\n--- UPDATE VERTEX SHADER ---');\n                console.log(updateVertexShader);\n                console.log('\\n--- UPDATE FRAGMENT SHADER ---');\n                console.log(updateFragmentShader);\n                console.log('\\n--- DRAW VERTEX SHADER ---');\n                console.log(drawVertexShader);\n                console.log('\\n--- DRAW FRAGMENT SHADER ---');\n                console.log(drawFragmentShader);\n                console.log('\\n=================================\\n');\n                this.dumpShadersOnCompile = false; // Only dump once\n            }\n\n            // Initialize velocity stats manager with current velocity field\n            if (this.velocityStatsManager) {\n                this.velocityStatsManager.dispose(); // Clean up old instance\n                const initSuccess = this.velocityStatsManager.initialize(this.dimensions, velocityGLSL, coordinateSystemCode);\n                if (initSuccess) {\n                    logger.verbose('Velocity stats manager initialized');\n                } else {\n                    logger.warn('Failed to initialize velocity stats manager');\n                }\n            }\n\n            // Create screen programs\n            const screenVertexShader = generateScreenVertexShader();\n            const fadeFragmentShader = generateScreenFadeFragmentShader();\n\n            // Generate tone mapping shader with selected operator\n            const tonemapCode = generateTonemapGLSL(this.tonemapOperator, {\n                exposure: this.exposure,\n                gamma: this.gamma,\n                luminanceGamma: this.luminanceGamma,\n                whitePoint: this.whitePoint\n            });\n            const tonemapFragmentShader = generateTonemapFragmentShader(tonemapCode);\n\n            this.screenFadeProgram = createProgram(gl, screenVertexShader, fadeFragmentShader);\n            this.tonemapProgram = createProgram(gl, screenVertexShader, tonemapFragmentShader);\n\n            // Store shader source for debugging\n            this.shaderSource.screenFade = fadeFragmentShader;\n            this.shaderSource.tonemap = tonemapFragmentShader;\n\n            logger.verbose('Tone mapping operator compiled', {\n                operator: this.tonemapOperator,\n                exposure: this.exposure,\n                gamma: this.gamma,\n                whitePoint: this.whitePoint\n            });\n\n            // Set flag to indicate shaders were just recompiled (for animation timing)\n            this.shadersJustRecompiled = true;\n\n            return null; // No error\n        } catch (error) {\n            return error.message;\n        }\n    }\n\n    /**\n     * Update particle positions\n     */\n    updatePositions() {\n        const gl = this.gl;\n        const program = this.updateProgram;\n\n        // Sample actual particle data every 60 frames for detailed inspection\n        // Only if debug stats enabled (expensive GPU readback)\n        if (this.enableDebugStats && this.frame % 60 === 0) {\n            this.sampleParticleData();\n        }\n\n        // Debug: log shader uniforms occasionally\n        if (this.frame % 600 === 0) {\n            logger.verbose(`Frame ${this.frame}: Shader uniforms`, {\n                u_min: [this.bbox.min[0], this.bbox.min[1]],\n                u_max: [this.bbox.max[0], this.bbox.max[1]],\n                u_h: this.timestep * (this.integratorCostFactor || 1),\n                timestep_base: this.timestep,\n                costFactor: this.integratorCostFactor || 1,\n                u_drop_rate: this.dropProbability\n            });\n        }\n\n        gl.useProgram(program);\n\n        // Bind quad for full-screen pass\n        const aPosLoc = gl.getAttribLocation(program, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Bind position textures\n        this.textureManager.bindReadTextures(program);\n\n        // Set uniforms\n        const resolution = this.particleSystem.getResolution();\n        const randSeed = Math.random(); // Generate once per frame for consistency\n        gl.uniform2f(gl.getUniformLocation(program, 'u_min'), this.bbox.min[0], this.bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_max'), this.bbox.max[0], this.bbox.max[1]);\n        // Scale timestep by integrator cost factor for fair comparison\n        gl.uniform1f(gl.getUniformLocation(program, 'u_h'), this.timestep * (this.integratorCostFactor || 1));\n        gl.uniform1f(gl.getUniformLocation(program, 'u_rand_seed'), randSeed);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_drop_rate'), this.dropProbability);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_respawn_margin'), this.respawnMargin);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particles_res'), resolution);\n        const velocityScale = this.getVelocityScale();\n        gl.uniform1f(gl.getUniformLocation(program, 'u_max_velocity'), velocityScale);\n\n        // Set animation alpha parameter (for time-based expressions)\n        const alphaLoc = gl.getUniformLocation(program, 'u_alpha');\n        if (alphaLoc !== null) {\n            gl.uniform1f(alphaLoc, this.animationAlpha);\n        }\n\n        // Set transform parameters (if transform is active)\n        if (this.transformType !== 'identity') {\n            const params = this.transformParams || {};\n            // Map transform-specific parameters to vec4\n            // power: alpha, 0, 0, 0\n            // tanh: beta, 0, 0, 0\n            // sigmoid: k, 0, 0, 0\n            // exp: alpha, 0, 0, 0\n            // sine: amplitude, frequency, 0, 0\n            // radial_power: alpha, 0, 0, 0\n            const paramValues = [\n                params.alpha || params.beta || params.k || params.amplitude || 0.5,  // First param\n                params.frequency || 0.0,  // Second param (sine wave)\n                0.0,  // Reserved\n                0.0   // Reserved\n            ];\n            gl.uniform4f(gl.getUniformLocation(program, 'u_transform_params'),\n                paramValues[0], paramValues[1], paramValues[2], paramValues[3]);\n        }\n\n        // Render to each dimension texture\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            gl.uniform1i(gl.getUniformLocation(program, 'u_out_coordinate'), dim);\n\n            const writeTexture = this.textureManager.getWriteTexture(dim);\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.updateFramebuffer);\n            gl.framebufferTexture2D(\n                gl.FRAMEBUFFER,\n                gl.COLOR_ATTACHMENT0,\n                gl.TEXTURE_2D,\n                writeTexture,\n                0\n            );\n\n            gl.viewport(0, 0, resolution, resolution);\n            gl.drawArrays(gl.TRIANGLES, 0, 6);\n        }\n\n        // Age is now stored in alpha channel of u_pos_0, no separate update needed\n\n        // Swap textures\n        this.textureManager.swap();\n\n        this.frame++;\n    }\n\n    /**\n     * Draw particles to screen\n     */\n    drawParticles() {\n        const gl = this.gl;\n        const program = this.drawProgram;\n\n        gl.useProgram(program);\n\n        // Use additive blending for HDR accumulation (allows values > 1.0)\n        // Formula: src * src_alpha + dst * 1.0\n        // This allows overlapping particles to create bright HDR values\n        gl.blendFunc(gl.SRC_ALPHA, gl.ONE);\n\n        // Update max velocity tracker using GPU-based sampling and exponential moving average\n        this.framesSinceLastSample++;\n\n        // Adaptive sampling: sample more frequently when velocity is changing\n        if (this.framesSinceLastSample >= this.velocitySampleInterval) {\n            this.framesSinceLastSample = 0;\n\n            // GPU-based velocity sampling (much faster than CPU approach)\n            if (this.velocityStatsManager && this.velocityStatsManager.initialized) {\n                const posTextures = this.textureManager.getReadTextures();\n                const stats = this.velocityStatsManager.compute(posTextures, this.bbox, this.particleSystem.getResolution(), this.animationAlpha);\n\n                // Log occasionally for debugging\n                if (this.frame % 600 === 0 && stats.sampleCount > 0) {\n                    logger.debug(`GPU velocity stats: avg=${stats.avgVelocity.toFixed(3)}, max=${stats.maxVelocity.toFixed(3)} (${stats.sampleCount} samples)`);\n                }\n\n                // Update max velocity with exponential moving average\n                if (stats.maxVelocity > 0) {\n                    // Use asymmetric blending: faster response to increases, slower to decreases\n                    const alpha = stats.maxVelocity > this.maxVelocity ?\n                                 this.velocityEMAAlpha * 2 : // Faster tracking upward\n                                 this.velocityEMAAlpha;      // Slower decay downward\n\n                    this.prevMaxVelocity = this.maxVelocity;\n                    this.maxVelocity = alpha * stats.maxVelocity + (1 - alpha) * this.maxVelocity;\n                }\n            } else {\n                // Manager not initialized - log warning once\n                if (!this.velocityStatsWarningLogged) {\n                    logger.warn('Velocity stats manager not initialized - max velocity will not be computed');\n                    this.velocityStatsWarningLogged = true;\n                }\n            }\n\n            // Calculate relative change rate (normalized by current value)\n            const relativeChange = Math.abs(this.maxVelocity - this.prevMaxVelocity) /\n                                  Math.max(this.maxVelocity, 0.1);\n\n            // Adapt sample interval based on rate of change\n            // High change rate (>5%) \u2192 sample frequently (min interval)\n            // Low change rate (<1%) \u2192 sample infrequently (max interval)\n            // Linear interpolation between min and max based on change rate\n            const changeThresholdHigh = 0.05; // 5% change\n            const changeThresholdLow = 0.01;  // 1% change\n\n            if (relativeChange > changeThresholdHigh) {\n                // Rapidly changing: sample frequently\n                this.velocitySampleInterval = this.velocitySampleIntervalMin;\n            } else if (relativeChange < changeThresholdLow) {\n                // Stable: sample infrequently\n                this.velocitySampleInterval = this.velocitySampleIntervalMax;\n            } else {\n                // Moderate change: interpolate\n                const t = (relativeChange - changeThresholdLow) /\n                         (changeThresholdHigh - changeThresholdLow);\n                this.velocitySampleInterval = Math.round(\n                    this.velocitySampleIntervalMax * (1 - t) +\n                    this.velocitySampleIntervalMin * t\n                );\n            }\n        }\n\n        // Prevent from dropping too low\n        this.maxVelocity = Math.max(this.maxVelocity, 0.5);\n\n        // Bind particle indices (different buffer for line mode)\n        const aIndexLoc = gl.getAttribLocation(program, 'a_index');\n        const indexBuffer = this.particleRenderMode === 'lines' ? this.indexBufferLines : this.indexBufferPoints;\n        gl.bindBuffer(gl.ARRAY_BUFFER, indexBuffer);\n        gl.enableVertexAttribArray(aIndexLoc);\n        gl.vertexAttribPointer(aIndexLoc, 1, gl.FLOAT, false, 0, 0);\n\n        // Bind vertex ID buffer for line mode (distinguishes prev vs current vertex)\n        if (this.particleRenderMode === 'lines') {\n            const aVertexIdLoc = gl.getAttribLocation(program, 'a_vertex_id');\n            if (aVertexIdLoc !== -1) {\n                gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexIdBufferLines);\n                gl.enableVertexAttribArray(aVertexIdLoc);\n                gl.vertexAttribPointer(aVertexIdLoc, 1, gl.FLOAT, false, 0, 0);\n            }\n        }\n\n        // Bind position textures (age is in alpha channel of u_pos_0)\n        this.textureManager.bindReadTextures(program);\n\n        // Bind previous position textures (always needed for velocity computation)\n        this.textureManager.bindPrevTextures(program);\n\n        // Set uniforms\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particles_res'), this.particleSystem.getResolution());\n        gl.uniform2f(gl.getUniformLocation(program, 'u_min'), this.bbox.min[0], this.bbox.min[1]);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_max'), this.bbox.max[0], this.bbox.max[1]);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particle_intensity'), this.particleIntensity);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_particle_size'), this.particleSize);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_viewport_size'), this.renderWidth, this.renderHeight);\n        gl.uniform2f(gl.getUniformLocation(program, 'u_canvas_size'), this.canvas.width, this.canvas.height);\n        gl.uniform1f(gl.getUniformLocation(program, 'u_color_saturation'), this.colorSaturation);\n\n        // Set animation alpha parameter (for color expressions using 'a')\n        const alphaLoc = gl.getUniformLocation(program, 'u_alpha');\n        if (alphaLoc !== null) {\n            gl.uniform1f(alphaLoc, this.animationAlpha);\n        }\n\n        // Set max velocity uniform if needed\n        if (this.usesMaxVelocity) {\n            const velocityScale = this.getVelocityScale();\n            gl.uniform1f(gl.getUniformLocation(program, 'u_max_velocity'), velocityScale);\n            gl.uniform1f(gl.getUniformLocation(program, 'u_velocity_log_scale'), this.velocityLogScale ? 1.0 : 0.0);\n        }\n\n        // Draw particles (points or lines)\n        if (this.particleRenderMode === 'lines') {\n            // In line mode, we render 2 vertices per particle (previous and current position)\n            gl.drawArrays(gl.LINES, 0, this.particleSystem.getActualParticleCount() * 2);\n        } else {\n            // Point mode\n            gl.drawArrays(gl.POINTS, 0, this.particleSystem.getActualParticleCount());\n        }\n    }\n\n    /**\n     * Get velocity scale value based on selected mode\n     */\n    getVelocityScale() {\n        if (!this.velocityStatsManager || !this.velocityStatsManager.initialized) {\n            return this.maxVelocity;\n        }\n\n        const stats = this.velocityStatsManager.getCached();\n\n        switch (this.velocityScaleMode) {\n            case 'max':\n                return stats.maxVelocity || this.maxVelocity;\n            case 'average':\n                return stats.avgVelocity || this.maxVelocity;\n            case 'percentile90':\n                return stats.percentile90 || stats.avgVelocity || this.maxVelocity;\n            case 'percentile95':\n                return stats.percentile95 || stats.avgVelocity || this.maxVelocity;\n            default:\n                return this.maxVelocity;\n        }\n    }\n\n    /**\n     * Fade previous frame\n     */\n    fadeScreen() {\n        const gl = this.gl;\n\n        const currentTex = this.framebufferManager.getCurrentTexture();\n\n        // Swap to next buffer\n        this.framebufferManager.swap();\n\n        // Bind next buffer for rendering\n        this.framebufferManager.bind();\n\n        // CRITICAL: Set viewport to render size for HDR framebuffer rendering\n        // Use supersample resolution for higher quality\n        gl.viewport(0, 0, this.renderWidth, this.renderHeight);\n\n        // Disable blending for fade pass (we're doing a direct texture copy with multiplication)\n        gl.disable(gl.BLEND);\n\n        gl.useProgram(this.screenFadeProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.screenFadeProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, currentTex);\n        gl.uniform1i(gl.getUniformLocation(this.screenFadeProgram, 'u_screen'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.screenFadeProgram, 'u_fade'), this.fadeOpacity);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Re-enable blending for particle drawing\n        gl.enable(gl.BLEND);\n    }\n\n    /**\n     * Resample scaled render to canvas\n     * Uses bilinear filtering for smooth resampling (both up and down)\n     */\n    downsampleToCanvas() {\n        const gl = this.gl;\n\n        // Bind canvas\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.viewport(0, 0, this.canvas.width, this.canvas.height);\n\n        // Use simple copy shader (screenFadeProgram just samples texture)\n        gl.useProgram(this.screenFadeProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.screenFadeProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Bind final texture (SMAA output at scaled resolution)\n        // Bilinear filtering provides smooth resampling\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        gl.uniform1i(gl.getUniformLocation(this.screenFadeProgram, 'u_screen'), 0);\n        gl.uniform1f(gl.getUniformLocation(this.screenFadeProgram, 'u_fade'), 1.0); // No fade, just copy\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n    }\n\n    /**\n     * Render one frame\n     * @param {boolean} displayToCanvas - If false, renders to hidden buffer without displaying (for double-buffering)\n     */\n    render(displayToCanvas = true) {\n        const gl = this.gl;\n\n        // Log HDR status on first frame\n        if (!this.hdrLogged) {\n            const hdrSupport = this.framebufferManager.getHDRSupport();\n            logger.info('First frame render', {\n                renderingMode: hdrSupport.enabled ? 'HDR' : 'LDR',\n                textureFormat: hdrSupport.format,\n                exposure: this.exposure,\n                gamma: this.gamma\n            });\n            this.hdrLogged = true;\n        }\n\n        // Update positions\n        this.updatePositions();\n\n        // Fade previous frame\n        this.fadeScreen();\n\n        // Draw particles to current framebuffer\n        this.framebufferManager.bind();\n\n        // Enable depth testing if configured (plasma mode)\n        if (this.useDepthTest) {\n            gl.enable(gl.DEPTH_TEST);\n            gl.depthFunc(gl.LESS);  // Closer particles occlude farther ones\n\n            // Clear depth buffer (color is not cleared - we want trails from fade)\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n\n        this.drawParticles();\n\n        // Disable depth test after particle drawing (if it was enabled)\n        if (this.useDepthTest) {\n            gl.disable(gl.DEPTH_TEST);\n        }\n\n        // Render tone mapping to dedicated LDR framebuffer\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n        gl.viewport(0, 0, this.renderWidth, this.renderHeight);\n\n        // Disable blending for tone mapping pass\n        gl.disable(gl.BLEND);\n\n        // Use tone mapping shader\n        gl.useProgram(this.tonemapProgram);\n\n        const aPosLoc = gl.getAttribLocation(this.tonemapProgram, 'a_pos');\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.quadBuffer);\n        gl.enableVertexAttribArray(aPosLoc);\n        gl.vertexAttribPointer(aPosLoc, 2, gl.FLOAT, false, 0, 0);\n\n        // Base HDR texture\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.framebufferManager.getCurrentTexture());\n        gl.uniform1i(gl.getUniformLocation(this.tonemapProgram, 'u_screen'), 0);\n\n        // Get cached buffer stats\n        const stats = this.bufferStatsManager.getCached();\n\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_exposure'), this.exposure);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_gamma'), this.gamma);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_whitePoint'), this.whitePoint);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_highlight_compression'), this.highlightCompression);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_compression_threshold'), this.compressionThreshold);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_brightness_desat'), this.brightnessDesaturation);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_brightness_sat'), this.brightnessSaturation);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_hdr_max_brightness'), stats.maxBrightness);\n        gl.uniform1f(gl.getUniformLocation(this.tonemapProgram, 'u_hdr_avg_brightness'), stats.avgBrightness);\n\n        gl.drawArrays(gl.TRIANGLES, 0, 6);\n\n        // Apply bilateral filter for edge-preserving noise reduction\n        // Reads from LDR tone-mapped texture, writes to bilateral framebuffer\n        const filteredTexture = this.bilateralManager.apply(this.ldrTexture);\n\n        // Apply SMAA to filtered LDR image (3-pass morphological AA)\n        // SMAA reads from filtered texture and outputs to final framebuffer\n        this.smaaManager.applyToFramebuffer(filteredTexture, this.finalFramebuffer, this.quadBuffer);\n\n        // Resample to canvas (bilinear filtering for smooth scaling)\n        // Skip if we're accumulating in hidden buffer (double-buffering mode)\n        if (displayToCanvas) {\n            this.downsampleToCanvas();\n        }\n\n        // Update buffer statistics periodically\n        if (!this.frame) this.frame = 0;\n        this.frame++;\n\n        // Compute buffer stats with adaptive interval (needed for tone mapping)\n        // Use slower update rate when main loop is paused (animation is controlling rendering)\n        const currentInterval = this.isRunning ? this.statsUpdateInterval : this.statsUpdateIntervalSlow;\n        if (this.frame % currentInterval === 0) {\n            const hdrTexture = this.framebufferManager.getCurrentTexture();\n            const newStats = this.bufferStatsManager.compute(\n                hdrTexture,\n                this.renderWidth,  // Use actual render resolution, not canvas size\n                this.renderHeight,\n                true  // Always use coarse sampling for performance\n            );\n\n            // Log stats occasionally for debugging (only if debug stats enabled)\n            if (this.enableDebugStats && this.frame % (currentInterval * 10) === 0) {\n                logger.info('HDR Buffer Stats (sampled)', {\n                    avgBrightness: newStats.avgBrightness.toFixed(2),\n                    maxBrightness: newStats.maxBrightness.toFixed(2),\n                    sampledPixels: newStats.sampledPixels,\n                    sampleRate: newStats.sampleRate\n                });\n            }\n        }\n    }\n\n    /**\n     * Get current HDR buffer statistics (using cached values from BufferStatsManager)\n     */\n    getBufferStats() {\n        const stats = this.bufferStatsManager.getCached();\n        // Add velocity info from GPU-based velocity stats\n        const velStats = this.velocityStatsManager ? this.velocityStatsManager.getCached() : null;\n        stats.maxVelocity = this.maxVelocity; // EMA-smoothed max velocity\n        stats.avgVelocity = velStats ? velStats.avgVelocity : 0;\n        stats.velocitySampleCount = velStats ? velStats.sampleCount : 0; // 64 GPU samples\n        return stats;\n    }\n\n    /**\n     * Log HDR buffer statistics to console\n     */\n    logBufferStats() {\n        const stats = this.getBufferStats(); // Use getBufferStats to include velocity\n        const age = Date.now() - stats.timestamp;\n\n        logger.info('=== HDR Buffer Statistics (Sampled) ===');\n        logger.info(`Cached age: ${(age / 1000).toFixed(1)}s`);\n        logger.info(`Sample rate: every ${stats.sampleRate}th pixel (${stats.sampledPixels} total)`);\n        logger.info(`Red   - Min: ${stats.red.min.toFixed(6)}, Max: ${stats.red.max.toFixed(6)}, Avg: ${stats.red.avg.toFixed(6)}`);\n        logger.info(`Green - Min: ${stats.green.min.toFixed(6)}, Max: ${stats.green.max.toFixed(6)}, Avg: ${stats.green.avg.toFixed(6)}`);\n        logger.info(`Blue  - Min: ${stats.blue.min.toFixed(6)}, Max: ${stats.blue.max.toFixed(6)}, Avg: ${stats.blue.avg.toFixed(6)}`);\n        logger.info(`Max Brightness: ${stats.maxBrightness.toFixed(6)}`);\n        logger.info(`Avg Brightness: ${stats.avgBrightness.toFixed(6)}`);\n        logger.info(`Max Velocity: ${stats.maxVelocity.toFixed(6)} (GPU-sampled, ${stats.velocitySampleCount} particles, EMA-smoothed)`);\n        if (stats.avgVelocity) {\n            logger.info(`Avg Velocity: ${stats.avgVelocity.toFixed(6)}`);\n        }\n    }\n\n    /**\n     * DEPRECATED: Old particle statistics (removed - use BufferStatsManager instead)\n     */\n    calculateParticleStatistics_REMOVED() {\n        const resolution = this.particleSystem.getResolution();\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        const posStats = [];\n        const velStats = [];\n\n        // Decode all particle positions\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n        const positions = [];\n\n        for (let i = 0; i < this.particleSystem.getActualParticleCount(); i++) {\n            const pos = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const data = dimensionData[dim];\n                const texelIdx = i * componentsPerValue;\n\n                // Extract buffer for this value\n                const buffer = new ArrayType(componentsPerValue);\n                for (let c = 0; c < componentsPerValue; c++) {\n                    buffer[c] = data[texelIdx + c];\n                }\n\n                // Determine min/max for this dimension\n                const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n                const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n\n                // Decode using strategy\n                const worldValue = this.strategy.decodeValue(buffer, min, max);\n\n                pos.push(worldValue);\n            }\n            positions.push(pos);\n        }\n\n        // Calculate position statistics\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            let min = Infinity;\n            let max = -Infinity;\n            let sum = 0;\n\n            for (const pos of positions) {\n                min = Math.min(min, pos[dim]);\n                max = Math.max(max, pos[dim]);\n                sum += pos[dim];\n            }\n\n            const dimName = ['x', 'y', 'z', 'w'][dim] || `dim${dim}`;\n            posStats.push({\n                dim: dimName,\n                min: min.toFixed(3),\n                max: max.toFixed(3),\n                avg: (sum / positions.length).toFixed(3)\n            });\n        }\n\n        // Calculate velocity statistics\n        if (this.velocityEvaluators) {\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                let min = Infinity;\n                let max = -Infinity;\n                let sum = 0;\n\n                try {\n                    for (const pos of positions) {\n                        const velocity = this.velocityEvaluators[dim](...pos);\n                        min = Math.min(min, velocity);\n                        max = Math.max(max, velocity);\n                        sum += velocity;\n                    }\n\n                    const dimName = ['x', 'y', 'z', 'w'][dim] || `dim${dim}`;\n                    velStats.push({\n                        dim: `v${dimName}`,\n                        min: min.toFixed(3),\n                        max: max.toFixed(3),\n                        avg: (sum / positions.length).toFixed(3)\n                    });\n                } catch (error) {\n                    logger.warn(`Error computing velocity for dim ${dim}`, error);\n                }\n            }\n        }\n\n        logger.verbose(`Frame ${this.frame}: Particle statistics`, {\n            bounds: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`,\n            position: posStats,\n            velocity: velStats.length > 0 ? velStats : 'N/A'\n        });\n    }\n\n    /**\n     * Sample a single particle's velocity magnitude\n     */\n    sampleParticleVelocity() {\n        const gl = this.gl;\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n\n        // Sample a random particle\n        const particleIdx = Math.floor(Math.random() * this.particleSystem.getActualParticleCount());\n        const texelIdx = particleIdx * componentsPerValue;\n\n        // Get position for all dimensions\n        const position = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            const data = dimensionData[dim];\n            const buffer = new ArrayType(componentsPerValue);\n            for (let c = 0; c < componentsPerValue; c++) {\n                buffer[c] = data[texelIdx + c];\n            }\n\n            const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n            const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n            const worldValue = this.strategy.decodeValue(buffer, min, max);\n            position.push(worldValue);\n        }\n\n        // Compute velocity using the velocity evaluators\n        if (!this.velocityEvaluators || this.velocityEvaluators.length === 0) {\n            return 0;\n        }\n\n        try {\n            const velocity = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const vel = this.velocityEvaluators[dim](...position);\n                velocity.push(vel);\n            }\n\n            // Compute magnitude\n            const magnitudeSquared = velocity.reduce((sum, v) => sum + v * v, 0);\n            const magnitude = Math.sqrt(magnitudeSquared);\n\n            // Check for invalid values\n            if (!isFinite(magnitude)) {\n                if (!this.velocityNaNWarningLogged) {\n                    logger.warn('Invalid velocity magnitude detected', {\n                        position,\n                        velocity,\n                        magnitude\n                    });\n                    this.velocityNaNWarningLogged = true;\n                }\n                return 0;\n            }\n\n            return magnitude;\n        } catch (error) {\n            if (!this.velocityErrorLogged) {\n                logger.error('Error computing velocity', error);\n                this.velocityErrorLogged = true;\n            }\n            return 0;\n        }\n    }\n\n    /**\n     * Sample particle data for debugging\n     */\n    sampleParticleData() {\n        const sampleCount = 5;\n        const resolution = this.particleSystem.getResolution();\n        const samples = [];\n\n        // Read back texture data for each dimension\n        const dimensionData = [];\n        for (let dim = 0; dim < this.dimensions; dim++) {\n            dimensionData.push(this.textureManager.readTexture(dim));\n        }\n\n        // Age is now stored in alpha channel of dimension 0 texture\n        // We'll read it directly from dimensionData[0]\n\n        const componentsPerValue = this.strategy.getComponentsPerValue();\n        const ArrayType = this.strategy.getArrayType();\n\n        // Decode a few random particles\n        for (let i = 0; i < sampleCount; i++) {\n            const particleIdx = Math.floor(Math.random() * this.particleSystem.getActualParticleCount());\n            const texelIdx = particleIdx * componentsPerValue;\n\n            const position = [];\n            for (let dim = 0; dim < this.dimensions; dim++) {\n                const data = dimensionData[dim];\n\n                // Extract buffer for this value\n                const buffer = new ArrayType(componentsPerValue);\n                for (let c = 0; c < componentsPerValue; c++) {\n                    buffer[c] = data[texelIdx + c];\n                }\n\n                // Determine min/max for this dimension\n                const min = dim === 0 ? this.bbox.min[0] : (dim === 1 ? this.bbox.min[1] : -10.0);\n                const max = dim === 0 ? this.bbox.max[0] : (dim === 1 ? this.bbox.max[1] : 10.0);\n\n                // Decode using strategy\n                const worldValue = this.strategy.decodeValue(buffer, min, max);\n\n                position.push(worldValue.toFixed(3));\n            }\n\n            // Decode age value from alpha channel of dimension 0\n            // For RGBA textures, alpha is the 4th component (index 3)\n            const dim0Data = dimensionData[0];\n            const ageValue = componentsPerValue === 4 ? dim0Data[texelIdx + 3] : 1.0;\n\n            samples.push({\n                particle: particleIdx,\n                position: position.join(', '),\n                age: ageValue.toFixed(2)\n            });\n        }\n\n        logger.verbose(`Frame ${this.frame}: Sampled ${sampleCount} particles (with age)`, {\n            bounds: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`,\n            samples: samples\n        });\n    }\n\n    /**\n     * Decode float from RGBA (matches shader decode)\n     * Returns normalized value in [0, 1] range\n     */\n    decodeFloatRGBA(r, g, b, a) {\n        // Fixed-point decoding to [0, 1]\n        const FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n\n        // Reconstruct 32-bit integer from bytes (big-endian)\n        const intValue = (r << 24) | (g << 16) | (b << 8) | a;\n        const uintValue = intValue >>> 0; // convert to unsigned\n\n        // Map from [0, 2^32-1] back to [0, 1]\n        return uintValue / FIXED_POINT_SCALE;\n    }\n\n    /**\n     * Start animation loop\n     */\n    start() {\n        this.isRunning = true;\n        this.frameCount = 0;\n        this.totalFrames = 0; // Total frames since last screen clear\n        this.lastFpsUpdate = performance.now();\n        this.fps = 0;\n\n        // Only initialize frame limit settings if they don't exist yet\n        // (don't reset them on restart, preserve user settings)\n        if (this.frameLimitEnabled === undefined) {\n            this.frameLimitEnabled = false;\n        }\n        if (this.frameLimit === undefined) {\n            this.frameLimit = 1000;\n        }\n\n        logger.verbose(`Starting render loop (frameLimitEnabled: ${this.frameLimitEnabled}, frameLimit: ${this.frameLimit})`);\n\n        const loop = () => {\n            if (!this.isRunning) return;\n\n            // Update FPS counter\n            this.frameCount++;\n            this.totalFrames++;\n            const now = performance.now();\n            const elapsed = now - this.lastFpsUpdate;\n\n            if (elapsed >= 500) { // Update FPS every 500ms\n                this.fps = Math.round((this.frameCount * 1000) / elapsed);\n                this.frameCount = 0;\n                this.lastFpsUpdate = now;\n            }\n\n            this.render();\n\n            // Check if frame limit is reached AFTER rendering this frame\n            if (this.frameLimitEnabled && this.totalFrames >= this.frameLimit) {\n                // Update FPS one last time before stopping\n                const finalNow = performance.now();\n                const finalElapsed = finalNow - this.lastFpsUpdate;\n                if (finalElapsed > 0) {\n                    this.fps = Math.round((this.frameCount * 1000) / finalElapsed);\n                }\n                logger.info(`Frame limit reached (${this.frameLimit} frames), stopping render loop`);\n                this.stop();\n                return;\n            }\n\n            requestAnimationFrame(loop);\n        };\n        loop();\n    }\n\n    /**\n     * Stop animation\n     */\n    stop() {\n        this.isRunning = false;\n    }\n\n    /**\n     * Set animation alpha parameter (0.0 to 1.0)\n     * Used in expressions with the 'a' variable\n     */\n    setAnimationAlpha(alpha) {\n        this.animationAlpha = Math.max(0.0, Math.min(1.0, alpha));\n    }\n\n    /**\n     * Clear only the render buffer (remove trails but keep particles)\n     * Useful for animation frames where you want to reset the canvas\n     * but keep particles at their current positions\n     * @param {boolean} skipAutoRestart - Skip auto-restart of main render loop. Normally after clearing the buffer (e.g., user clicking Reset Particles after hitting frame limit), we auto-restart rendering as a convenience. Set to true during animation playback to prevent the main loop from interfering with the animation loop's manual render calls.\n     */\n    clearRenderBuffer(skipAutoRestart = false) {\n        this.framebufferManager.clearAll(0, 0, 0, 1);\n\n        // Reset frame counter since screen was cleared\n        this.totalFrames = 0;\n\n        // Restart rendering if it was stopped (e.g., from frame limit)\n        // Skip restart during animation playback to prevent interference\n        if (!this.isRunning && !skipAutoRestart) {\n            logger.info('Restarting render loop after render buffer clear');\n            this.start();\n        }\n\n        logger.verbose('Render buffer cleared (particles preserved)');\n    }\n\n    /**\n     * Reset particles to random initial positions\n     * Useful for starting a new animation frame with fresh particles\n     * @param {boolean} recompileShaders - Whether to recompile shaders after reset (default: false)\n     */\n    resetParticles(recompileShaders = false) {\n        this.particleSystem.initializeParticles();\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n        logger.verbose('Particles reinitialized to random positions');\n\n        if (recompileShaders) {\n            logger.info('Recompiling shaders after particle reset...');\n            try {\n                this.compileShaders();\n                logger.info('Shaders recompiled successfully');\n            } catch (error) {\n                logger.error('Failed to recompile shaders:', error);\n            }\n        }\n    }\n\n    /**\n     * Run N integration steps without rendering to canvas\n     * Useful for convergence/burn-in during animation\n     * @param {number} steps - Number of integration steps to execute\n     */\n    step(steps = 1) {\n        for (let i = 0; i < steps; i++) {\n            this.updatePositions();\n        }\n    }\n\n    /**\n     * Clear the screen (remove all particle trails and reinitialize particles)\n     */\n    clearScreen() {\n        // Clear all framebuffers to black\n        this.framebufferManager.clearAll(0, 0, 0, 1);\n\n        // Reinitialize all particles to random positions\n        this.particleSystem.initializeParticles();\n        this.textureManager.initializeData(this.particleSystem.getAllData());\n\n        // Reset frame counter since screen was cleared\n        this.totalFrames = 0;\n\n        // Restart rendering if it was stopped (e.g., from frame limit)\n        if (!this.isRunning) {\n            logger.info('Restarting render loop after screen clear');\n            this.start();\n        }\n\n        logger.verbose('Screen cleared and particles reinitialized');\n    }\n\n    /**\n     * Capture the high-resolution render buffer as a PNG blob\n     * This captures the render buffer at the scaled resolution (renderWidth x renderHeight)\n     * instead of the canvas resolution, preserving full quality at higher render scales.\n     * @returns {Promise<Blob>} PNG image blob\n     */\n    captureRenderBuffer() {\n        return new Promise((resolve, reject) => {\n            const gl = this.gl;\n\n            try {\n                // Bind the final framebuffer to read from it\n                gl.bindFramebuffer(gl.FRAMEBUFFER, this.finalFramebuffer);\n\n                // Read pixels from the framebuffer\n                const pixels = new Uint8Array(this.renderWidth * this.renderHeight * 4);\n                gl.readPixels(0, 0, this.renderWidth, this.renderHeight, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n\n                // Unbind framebuffer\n                gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n                // Create a temporary canvas at render resolution\n                const tempCanvas = document.createElement('canvas');\n                tempCanvas.width = this.renderWidth;\n                tempCanvas.height = this.renderHeight;\n                const ctx = tempCanvas.getContext('2d');\n\n                // Create ImageData from the pixel array\n                const imageData = ctx.createImageData(this.renderWidth, this.renderHeight);\n                imageData.data.set(pixels);\n\n                // WebGL reads pixels from bottom-up, but canvas uses top-down\n                // We need to flip the image vertically\n                ctx.save();\n                ctx.scale(1, -1); // Flip vertically\n                ctx.translate(0, -this.renderHeight); // Translate back\n                ctx.putImageData(imageData, 0, 0);\n                ctx.restore();\n\n                // Convert to blob\n                tempCanvas.toBlob((blob) => {\n                    if (blob) {\n                        resolve(blob);\n                    } else {\n                        reject(new Error('Failed to create blob from canvas'));\n                    }\n                }, 'image/png');\n\n            } catch (error) {\n                logger.error('Failed to capture render buffer:', error);\n                reject(error);\n            }\n        });\n    }\n\n    /**\n     * Resize canvas\n     */\n    resize(width, height) {\n        const gl = this.gl;\n\n        // Validate dimensions\n        if (!width || !height || width <= 0 || height <= 0) {\n            logger.warn(`Invalid resize dimensions: ${width}x${height}, skipping resize`);\n            return;\n        }\n\n        this.canvas.width = width;\n        this.canvas.height = height;\n\n        // Recalculate render resolution\n        // Ensure we always have valid dimensions (minimum 1x1)\n        this.renderWidth = Math.max(1, Math.floor(width * this.supersampleFactor));\n        this.renderHeight = Math.max(1, Math.floor(height * this.supersampleFactor));\n\n        logger.info('Resizing renderer', {\n            canvasSize: `${width}x${height}`,\n            renderSize: `${this.renderWidth}x${this.renderHeight}`,\n            supersampleFactor: this.supersampleFactor\n        });\n\n        this.framebufferManager.resize(this.renderWidth, this.renderHeight);\n        this.bilateralManager.resize(this.renderWidth, this.renderHeight);\n        this.smaaManager.resize(this.renderWidth, this.renderHeight);\n\n        // Resize LDR framebuffer\n        gl.bindTexture(gl.TEXTURE_2D, this.ldrTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        // Resize final framebuffer\n        gl.bindTexture(gl.TEXTURE_2D, this.finalTexture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, this.renderWidth, this.renderHeight, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        this.gl.viewport(0, 0, width, height);\n        this.clearScreen(); // Clear on resize\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(config) {\n        logger.info('Updating configuration', config);\n        let needsRecompile = false;\n\n        if (config.dimensions !== undefined && config.dimensions !== this.dimensions) {\n            logger.info(`Changing dimensions: ${this.dimensions} \u2192 ${config.dimensions}`);\n            this.dimensions = config.dimensions;\n            needsRecompile = true;\n\n            // Update coordinate system to match new dimensions\n            this.coordinateSystem = getCartesianSystem(this.dimensions);\n            logger.info(`Updated coordinate system to ${this.dimensions}D Cartesian`);\n\n            // Update particle system\n            this.particleSystem.setDimensions(this.dimensions);\n            this.textureManager.dispose();\n            this.textureManager = new TextureManager(\n                this.gl,\n                this.dimensions,\n                this.particleSystem.getResolution(),\n                this.strategy\n            );\n\n            // Restore line mode if configured\n            if (this.particleRenderMode === 'lines') {\n                this.textureManager.setLineMode(true);\n            }\n            this.textureManager.initializeData(this.particleSystem.getAllData());\n        }\n\n        // Handle coordinate system changes BEFORE expressions\n        // (so expression parsing uses the correct variables)\n        if (config.coordinateSystem !== undefined) {\n            logger.info(`Updating coordinate system: ${this.coordinateSystem.name} \u2192 ${config.coordinateSystem.name}`);\n            this.coordinateSystem = config.coordinateSystem;\n            needsRecompile = true;\n            logger.info('  needsRecompile flag set to true (coordinate system change)');\n        }\n\n        if (config.expressions !== undefined) {\n            logger.info('Updating vector field expressions', config.expressions);\n            this.expressions = config.expressions;\n            // Create velocity evaluators for computing statistics in JavaScript\n            try {\n                // Get variable names from coordinate system\n                let coordinateVars;\n                if (this.coordinateSystem && typeof this.coordinateSystem.getVariableNames === 'function') {\n                    coordinateVars = this.coordinateSystem.getVariableNames();\n                } else {\n                    // Fallback to default Cartesian variables\n                    logger.warn('coordinateSystem missing getVariableNames(), using Cartesian fallback');\n                    coordinateVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, this.dimensions);\n                }\n\n                this.velocityEvaluators = createVelocityEvaluators(this.expressions, coordinateVars);\n                logger.verbose('Velocity evaluators created successfully', {\n                    coordinateSystem: this.coordinateSystem ? this.coordinateSystem.name : 'unknown',\n                    variables: coordinateVars\n                });\n            } catch (error) {\n                logger.warn('Failed to create velocity evaluators', error);\n                this.velocityEvaluators = null;\n            }\n            needsRecompile = true;\n            logger.info('  needsRecompile flag set to true (expressions change)');\n        }\n\n        if (config.velocityGLSL !== undefined) {\n            logger.info('Updating pre-generated velocity GLSL', config.velocityGLSL);\n            this.velocityGLSL = config.velocityGLSL;\n            needsRecompile = true;\n            logger.info('  needsRecompile flag set to true (velocityGLSL change)');\n        }\n\n        if (config.integratorType !== undefined && config.integratorType !== this.integratorType) {\n            logger.info(`Changing integrator: ${this.integratorType} \u2192 ${config.integratorType}`);\n            this.integratorType = config.integratorType;\n            needsRecompile = true;\n        }\n\n        if (config.integratorParams !== undefined) {\n            logger.verbose('Updating integrator parameters', config.integratorParams);\n            this.integratorParams = { ...this.integratorParams, ...config.integratorParams };\n            needsRecompile = true;\n        }\n\n        if (config.solutionMethod !== undefined && config.solutionMethod !== this.solutionMethod) {\n            logger.info(`Changing solution method: ${this.solutionMethod} \u2192 ${config.solutionMethod}`);\n            this.solutionMethod = config.solutionMethod;\n            needsRecompile = true;\n            logger.info(`  needsRecompile flag set to true (solutionMethod change)`);\n        }\n        logger.info('Solution method update complete, continuing...');\n\n        if (config.transformType !== undefined && config.transformType !== this.transformType) {\n            logger.info(`Changing transform: ${this.transformType} \u2192 ${config.transformType}`);\n            this.transformType = config.transformType;\n            needsRecompile = true;\n        }\n\n        if (config.transformParams !== undefined) {\n            logger.verbose('Updating transform parameters', config.transformParams);\n            this.transformParams = config.transformParams;\n            needsRecompile = true;\n        }\n\n        if (config.mapperType !== undefined && config.mapperType !== this.mapperType) {\n            logger.info(`Changing mapper: ${this.mapperType} \u2192 ${config.mapperType}`);\n            this.mapperType = config.mapperType;\n            needsRecompile = true;\n        }\n\n        if (config.mapperParams !== undefined) {\n            logger.verbose('Updating mapper parameters', config.mapperParams);\n            this.mapperParams = config.mapperParams;\n            needsRecompile = true;\n        }\n\n        if (config.colorMode !== undefined && config.colorMode !== this.colorMode) {\n            logger.info(`Changing color mode: ${this.colorMode} \u2192 ${config.colorMode}`);\n            this.colorMode = config.colorMode;\n            needsRecompile = true;\n        }\n\n        if (config.colorExpression !== undefined && config.colorExpression !== this.colorExpression) {\n            logger.info(`Changing color expression: ${this.colorExpression} \u2192 ${config.colorExpression}`);\n            this.colorExpression = config.colorExpression;\n            needsRecompile = true;\n        }\n\n        if (config.colorGradient !== undefined) {\n            // Compare gradient arrays (deep comparison)\n            const gradientChanged = JSON.stringify(config.colorGradient) !== JSON.stringify(this.colorGradient);\n            if (gradientChanged) {\n                logger.info('Changing color gradient');\n                this.colorGradient = config.colorGradient;\n                needsRecompile = true;\n            }\n        }\n\n        if (config.velocityScaleMode !== undefined && config.velocityScaleMode !== this.velocityScaleMode) {\n            logger.info(`Changing velocity scale mode: ${this.velocityScaleMode} \u2192 ${config.velocityScaleMode}`);\n            this.velocityScaleMode = config.velocityScaleMode;\n            // No recompile needed - just changes which value we use\n        }\n\n        if (config.velocityLogScale !== undefined && config.velocityLogScale !== this.velocityLogScale) {\n            logger.info(`Changing velocity log scale: ${this.velocityLogScale} \u2192 ${config.velocityLogScale}`);\n            this.velocityLogScale = config.velocityLogScale;\n            needsRecompile = true; // Needs recompile to change shader code\n        }\n\n        if (config.timestep !== undefined) {\n            logger.verbose(`Timestep: ${this.timestep} \u2192 ${config.timestep}`);\n            this.timestep = config.timestep;\n        }\n        if (config.fadeOpacity !== undefined) {\n            logger.verbose(`Fade opacity: ${this.fadeOpacity} \u2192 ${config.fadeOpacity}`);\n            this.fadeOpacity = config.fadeOpacity;\n        }\n        if (config.dropProbability !== undefined) {\n            logger.verbose(`Drop probability: ${this.dropProbability} \u2192 ${config.dropProbability}`);\n            this.dropProbability = config.dropProbability;\n        }\n        if (config.respawnMargin !== undefined) {\n            logger.verbose(`Respawn margin: ${this.respawnMargin} \u2192 ${config.respawnMargin}`);\n            this.respawnMargin = config.respawnMargin;\n        }\n\n        // Animation settings\n        if (config.lockShaderRecompilation !== undefined) {\n            logger.info(`Shader recompilation lock: ${this.lockShaderRecompilation} \u2192 ${config.lockShaderRecompilation}`);\n            this.lockShaderRecompilation = config.lockShaderRecompilation;\n        }\n\n        // HDR rendering settings (no recompile needed)\n        if (config.useHDR !== undefined && config.useHDR !== this.useHDR) {\n            logger.info(`Changing HDR rendering: ${this.useHDR} \u2192 ${config.useHDR}`);\n            this.useHDR = config.useHDR;\n\n            // Recreate framebuffer manager with new HDR setting\n            this.framebufferManager.dispose();\n            this.framebufferManager = new FramebufferManager(\n                this.gl,\n                this.canvas.width,\n                this.canvas.height,\n                {\n                    useHDR: this.useHDR,\n                    usePingPong: true\n                }\n            );\n\n            // Log new HDR status\n            const hdrSupport = this.framebufferManager.getHDRSupport();\n            logger.info('HDR rendering system reconfigured', {\n                hdrEnabled: hdrSupport.enabled,\n                hdrSupported: hdrSupport.supported,\n                textureFormat: hdrSupport.format\n            });\n\n            if (this.useHDR && !hdrSupport.supported) {\n                logger.warn('HDR requested but not supported. Falling back to LDR.');\n            }\n\n            this.clearScreen();\n        }\n        if (config.exposure !== undefined) {\n            logger.verbose(`Exposure: ${this.exposure} \u2192 ${config.exposure}`);\n            this.exposure = config.exposure;\n            needsRecompile = true; // Exposure is baked into shader\n        }\n        if (config.gamma !== undefined) {\n            logger.verbose(`Gamma: ${this.gamma} \u2192 ${config.gamma}`);\n            this.gamma = config.gamma;\n            needsRecompile = true; // Gamma is baked into shader\n        }\n        if (config.luminanceGamma !== undefined) {\n            logger.verbose(`Luminance Gamma: ${this.luminanceGamma} \u2192 ${config.luminanceGamma}`);\n            this.luminanceGamma = config.luminanceGamma;\n            needsRecompile = true; // Luminance gamma is baked into shader\n        }\n        if (config.highlightCompression !== undefined) {\n            logger.verbose(`Highlight Compression: ${this.highlightCompression} \u2192 ${config.highlightCompression}`);\n            this.highlightCompression = config.highlightCompression;\n            // No recompile needed - just a uniform\n        }\n        if (config.compressionThreshold !== undefined) {\n            logger.verbose(`Compression Threshold: ${this.compressionThreshold} \u2192 ${config.compressionThreshold}`);\n            this.compressionThreshold = config.compressionThreshold;\n            // No recompile needed - just a uniform\n        }\n        if (config.whitePoint !== undefined) {\n            logger.verbose(`White point: ${this.whitePoint} \u2192 ${config.whitePoint}`);\n            this.whitePoint = config.whitePoint;\n            needsRecompile = true; // White point is baked into shader\n        }\n        if (config.tonemapOperator !== undefined && config.tonemapOperator !== this.tonemapOperator) {\n            logger.info(`Tone mapping operator: ${this.tonemapOperator} \u2192 ${config.tonemapOperator}`);\n            this.tonemapOperator = config.tonemapOperator;\n            needsRecompile = true;\n        }\n        if (config.particleIntensity !== undefined) {\n            logger.verbose(`Particle intensity: ${this.particleIntensity} \u2192 ${config.particleIntensity}`);\n            this.particleIntensity = config.particleIntensity;\n        }\n        if (config.particleSize !== undefined) {\n            logger.verbose(`Particle size: ${this.particleSize} \u2192 ${config.particleSize}`);\n            this.particleSize = config.particleSize;\n        }\n        if (config.particleRenderMode !== undefined && config.particleRenderMode !== this.particleRenderMode) {\n            logger.info(`Particle render mode: ${this.particleRenderMode} \u2192 ${config.particleRenderMode}`);\n            this.particleRenderMode = config.particleRenderMode;\n            // Enable/disable line mode in texture manager\n            const isLineMode = this.particleRenderMode === 'lines';\n            this.textureManager.setLineMode(isLineMode);\n            needsRecompile = true; // Shader needs to be regenerated for line mode\n        }\n        if (config.colorSaturation !== undefined) {\n            logger.verbose(`Color saturation: ${this.colorSaturation} \u2192 ${config.colorSaturation}`);\n            this.colorSaturation = config.colorSaturation;\n        }\n        if (config.brightnessDesaturation !== undefined) {\n            logger.verbose(`Brightness desaturation: ${this.brightnessDesaturation} \u2192 ${config.brightnessDesaturation}`);\n            this.brightnessDesaturation = config.brightnessDesaturation;\n        }\n        if (config.brightnessSaturation !== undefined) {\n            logger.verbose(`Brightness saturation: ${this.brightnessSaturation} \u2192 ${config.brightnessSaturation}`);\n            this.brightnessSaturation = config.brightnessSaturation;\n        }\n        if (config.useDepthTest !== undefined) {\n            logger.verbose(`Depth testing: ${this.useDepthTest} \u2192 ${config.useDepthTest}`);\n            this.useDepthTest = config.useDepthTest;\n        }\n\n        if (config.smaaEnabled !== undefined) {\n            logger.verbose(`SMAA enabled: ${this.smaaEnabled} \u2192 ${config.smaaEnabled}`);\n            this.smaaEnabled = config.smaaEnabled;\n            this.smaaManager.updateConfig({ enabled: config.smaaEnabled });\n        }\n        if (config.smaaIntensity !== undefined) {\n            logger.verbose(`SMAA intensity: ${this.smaaIntensity} \u2192 ${config.smaaIntensity}`);\n            this.smaaIntensity = config.smaaIntensity;\n            this.smaaManager.updateConfig({ intensity: config.smaaIntensity });\n        }\n        if (config.smaaThreshold !== undefined) {\n            logger.verbose(`SMAA threshold: ${this.smaaThreshold} \u2192 ${config.smaaThreshold}`);\n            this.smaaThreshold = config.smaaThreshold;\n            this.smaaManager.updateConfig({ threshold: config.smaaThreshold });\n        }\n        if (config.bilateralEnabled !== undefined) {\n            logger.verbose(`Bilateral filter enabled: ${this.bilateralEnabled} \u2192 ${config.bilateralEnabled}`);\n            this.bilateralEnabled = config.bilateralEnabled;\n            this.bilateralManager.updateConfig({ enabled: config.bilateralEnabled });\n        }\n        if (config.bilateralSpatialSigma !== undefined) {\n            logger.verbose(`Bilateral spatial sigma: ${this.bilateralSpatialSigma} \u2192 ${config.bilateralSpatialSigma}`);\n            this.bilateralSpatialSigma = config.bilateralSpatialSigma;\n            this.bilateralManager.updateConfig({ spatialSigma: config.bilateralSpatialSigma });\n        }\n        if (config.bilateralIntensitySigma !== undefined) {\n            logger.verbose(`Bilateral intensity sigma: ${this.bilateralIntensitySigma} \u2192 ${config.bilateralIntensitySigma}`);\n            this.bilateralIntensitySigma = config.bilateralIntensitySigma;\n            this.bilateralManager.updateConfig({ intensitySigma: config.bilateralIntensitySigma });\n        }\n        if (config.supersampleFactor !== undefined && config.supersampleFactor !== this.supersampleFactor) {\n            logger.info(`Render scale factor: ${this.supersampleFactor} \u2192 ${config.supersampleFactor}`);\n\n            // Validate render scale factor\n            const validFactor = Math.max(0.5, Math.min(4.0, config.supersampleFactor));\n            if (validFactor !== config.supersampleFactor) {\n                logger.warn(`Invalid render scale factor ${config.supersampleFactor}, clamping to ${validFactor}`);\n            }\n\n            this.supersampleFactor = validFactor;\n            logger.info(`Applying render scale factor: ${this.supersampleFactor}`);\n            // Trigger resize to update all framebuffers\n            this.resize(this.canvas.width, this.canvas.height);\n        }\n\n        if (config.particleCount !== undefined && config.particleCount !== this.particleSystem.particleCount) {\n            this.particleSystem.setParticleCount(config.particleCount);\n            this.textureManager.resize(this.particleSystem.getResolution());\n            this.textureManager.initializeData(this.particleSystem.getAllData());\n\n            // Recreate both index buffers and vertex ID buffer\n            this.gl.deleteBuffer(this.indexBufferPoints);\n            this.gl.deleteBuffer(this.indexBufferLines);\n            this.gl.deleteBuffer(this.vertexIdBufferLines);\n            this.indexBufferPoints = this.createBuffer(this.particleSystem.getIndices());\n            this.indexBufferLines = this.createLineIndexBuffer(this.particleSystem.getActualParticleCount());\n            this.vertexIdBufferLines = this.createLineVertexIdBuffer(this.particleSystem.getActualParticleCount());\n        }\n\n        if (config.bbox !== undefined) {\n            this.bbox = config.bbox;\n            this.particleSystem.setBBox(this.bbox);\n\n            // Reinitialize particles if requested (e.g., on reset)\n            if (config.reinitializeParticles) {\n                this.particleSystem.initializeParticles();\n                this.textureManager.initializeData(this.particleSystem.getAllData());\n                logger.info('Particles reinitialized to new viewport bounds');\n            }\n\n            this.clearScreen(); // Clear trails when view changes\n        }\n\n        logger.info(`Checking needsRecompile flag: ${needsRecompile}`);\n\n        if (needsRecompile) {\n            if (this.lockShaderRecompilation) {\n                logger.info('Shader recompilation needed but LOCKED - skipping recompilation');\n            } else {\n                logger.info('Recompiling shaders...');\n                try {\n                    const error = this.compileShaders();\n                    if (error) {\n                        logger.error('Recompilation failed', error);\n                        // Don't throw - allow temporary error states (e.g., dimension/coordinate mismatch)\n                        logger.warn('Shader compilation failed - visualization will not render until error is resolved');\n                        return; // Skip clearing screen\n                    }\n                    this.frame = 0; // Reset frame counter\n                    logger.info('Clearing screen after recompilation...');\n                    this.clearScreen(); // Clear old particles that were computed with old vector field\n                    logger.info('Configuration updated successfully, shaders recompiled');\n                } catch (e) {\n                    logger.error('EXCEPTION during shader recompilation:', e);\n                    logger.error('Stack trace:', e.stack);\n                    // Don't throw - allow temporary error states\n                    logger.warn('Shader compilation exception - visualization will not render until error is resolved');\n                }\n            }\n        } else {\n            logger.info('Configuration updated (no recompile needed)');\n        }\n\n        // Log current applied settings\n        logger.info('Current settings applied', {\n            dimensions: this.dimensions,\n            expressions: this.expressions,\n            integrator: this.integratorType,\n            mapper: this.mapperType,\n            timestep: this.timestep,\n            particleCount: this.particleSystem.particleCount,\n            fadeOpacity: this.fadeOpacity,\n            dropProbability: this.dropProbability,\n            bbox: `[${this.bbox.min[0].toFixed(3)}, ${this.bbox.min[1].toFixed(3)}] to [${this.bbox.max[0].toFixed(3)}, ${this.bbox.max[1].toFixed(3)}]`\n        });\n    }\n\n    /**\n     * Test encode/decode symmetry\n     * Tests JavaScript encode\u2192decode round-trip accuracy\n     */\n    testEncodeDecodeSymmetry() {\n        const { encodeFloatRGBA, decodeFloatRGBA } = require('../utils/float-packing.js');\n\n        // Test values covering the full [0, 1] range\n        const testValues = [0.0, 0.1, 0.25, 0.5, 0.75, 0.9, 1.0];\n\n        // Also test many random values\n        for (let i = 0; i < 100; i++) {\n            testValues.push(Math.random());\n        }\n\n        let maxError = 0;\n        let avgError = 0;\n        const errors = [];\n        const problematic = [];\n\n        logger.info('Testing encode/decode symmetry...');\n\n        for (const testVal of testValues) {\n            // Encode\n            const buffer = new Uint8Array(4);\n            encodeFloatRGBA(testVal, buffer, 0);\n\n            // Decode\n            const decoded = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n            // Calculate error\n            const error = Math.abs(testVal - decoded);\n            errors.push(error);\n            avgError += error;\n            maxError = Math.max(maxError, error);\n\n            // Track problematic values (error > 1e-6)\n            if (error > 1e-6) {\n                problematic.push({\n                    original: testVal,\n                    encoded: `[${buffer[0]}, ${buffer[1]}, ${buffer[2]}, ${buffer[3]}]`,\n                    decoded: decoded,\n                    error: error\n                });\n            }\n        }\n\n        avgError /= testValues.length;\n\n        logger.info('Encode/Decode symmetry test results:', {\n            testCount: testValues.length,\n            maxError: maxError.toExponential(3),\n            avgError: avgError.toExponential(3),\n            problematicCount: problematic.length,\n            problematicSamples: problematic.slice(0, 5) // Show first 5\n        });\n\n        // Test with world coordinate round-trip\n        logger.info('Testing world coordinate round-trip [-5, 5]...');\n        const worldTests = [-5, -4, -2.5, 0, 2.5, 4, 5];\n        const worldErrors = [];\n\n        for (const worldVal of worldTests) {\n            // Normalize\n            const normalized = (worldVal - this.bbox.min[0]) / (this.bbox.max[0] - this.bbox.min[0]);\n\n            // Encode\n            const buffer = new Uint8Array(4);\n            encodeFloatRGBA(normalized, buffer, 0);\n\n            // Decode\n            const decoded = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n            // Denormalize\n            const worldDecoded = this.bbox.min[0] + decoded * (this.bbox.max[0] - this.bbox.min[0]);\n\n            const error = Math.abs(worldVal - worldDecoded);\n            worldErrors.push({\n                world: worldVal.toFixed(3),\n                normalized: normalized.toFixed(6),\n                decoded: worldDecoded.toFixed(6),\n                error: error.toExponential(3)\n            });\n        }\n\n        logger.info('World coordinate round-trip results:', { tests: worldErrors });\n\n        return { maxError, avgError, problematic: problematic.length };\n    }\n\n    /**\n     * Log statistics about the current HDR framebuffer\n     * Reads the framebuffer pixels and computes min/max/avg values\n     */\n    logBufferStats() {\n        const gl = this.gl;\n\n        if (!this.framebufferManager) {\n            logger.warn('No framebuffer manager available');\n            return;\n        }\n\n        // Bind the current framebuffer for reading\n        const currentIndex = this.framebufferManager.currentIndex;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebufferManager.framebuffers[currentIndex]);\n\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        const pixelCount = width * height;\n\n        // Allocate buffer for pixel data\n        // Float framebuffers return Float32Array, RGBA8 returns Uint8Array\n        const isHDR = this.framebufferManager.isHDR();\n        const pixels = isHDR ?\n            new Float32Array(pixelCount * 4) :\n            new Uint8Array(pixelCount * 4);\n\n        // Read pixels from framebuffer\n        gl.readPixels(0, 0, width, height, gl.RGBA, isHDR ? gl.FLOAT : gl.UNSIGNED_BYTE, pixels);\n\n        // Initialize statistics\n        let minR = Infinity, minG = Infinity, minB = Infinity;\n        let maxR = -Infinity, maxG = -Infinity, maxB = -Infinity;\n        let sumR = 0, sumG = 0, sumB = 0;\n        let maxBrightness = -Infinity;\n        let pixelsAboveOne = 0;\n\n        // Compute statistics\n        for (let i = 0; i < pixelCount; i++) {\n            const idx = i * 4;\n            let r = pixels[idx];\n            let g = pixels[idx + 1];\n            let b = pixels[idx + 2];\n\n            // If LDR, normalize to [0,1]\n            if (!isHDR) {\n                r /= 255;\n                g /= 255;\n                b /= 255;\n            }\n\n            minR = Math.min(minR, r);\n            minG = Math.min(minG, g);\n            minB = Math.min(minB, b);\n\n            maxR = Math.max(maxR, r);\n            maxG = Math.max(maxG, g);\n            maxB = Math.max(maxB, b);\n\n            sumR += r;\n            sumG += g;\n            sumB += b;\n\n            const brightness = Math.max(r, g, b);\n            maxBrightness = Math.max(maxBrightness, brightness);\n\n            if (brightness > 1.0) {\n                pixelsAboveOne++;\n            }\n        }\n\n        const avgR = sumR / pixelCount;\n        const avgG = sumG / pixelCount;\n        const avgB = sumB / pixelCount;\n\n        // Log results\n        logger.info('=== HDR Buffer Statistics ===');\n        logger.info(`Framebuffer: ${width}x${height} (${pixelCount.toLocaleString()} pixels)`);\n        logger.info(`Format: ${isHDR ? 'HDR Float' : 'LDR RGBA8'}`);\n        logger.info(`Red   - Min: ${minR.toFixed(6)}, Max: ${maxR.toFixed(6)}, Avg: ${avgR.toFixed(6)}`);\n        logger.info(`Green - Min: ${minG.toFixed(6)}, Max: ${maxG.toFixed(6)}, Avg: ${avgG.toFixed(6)}`);\n        logger.info(`Blue  - Min: ${minB.toFixed(6)}, Max: ${maxB.toFixed(6)}, Avg: ${avgB.toFixed(6)}`);\n        logger.info(`Max Brightness (max of R/G/B): ${maxBrightness.toFixed(6)}`);\n        logger.info(`Pixels above 1.0: ${pixelsAboveOne.toLocaleString()} (${(pixelsAboveOne / pixelCount * 100).toFixed(2)}%)`);\n\n        // Restore previous framebuffer binding\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n\n    /**\n     * Log current shader source code to console\n     */\n    logShaders() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== UPDATE VERTEX SHADER ===');\n        console.log(this.shaderSource.updateVertex);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== UPDATE FRAGMENT SHADER ===');\n        console.log(this.shaderSource.updateFragment);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== DRAW VERTEX SHADER ===');\n        console.log(this.shaderSource.drawVertex);\n        console.log('=== END SHADER ===\\n');\n\n        console.log('=== DRAW FRAGMENT SHADER ===');\n        console.log(this.shaderSource.drawFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Shaders logged to console');\n    }\n\n    /**\n     * Log update shader (contains integrator and Jacobian)\n     */\n    logUpdateShader() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== UPDATE FRAGMENT SHADER (Integrator + Jacobian) ===');\n        console.log(this.shaderSource.updateFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Update shader logged to browser console');\n    }\n\n    /**\n     * Log draw shader (contains color computations)\n     */\n    logDrawShader() {\n        if (!this.shaderSource) {\n            console.warn('No shader source available');\n            return;\n        }\n\n        console.log('=== DRAW VERTEX SHADER ===');\n        console.log(this.shaderSource.drawVertex);\n        console.log('=== END VERTEX SHADER ===');\n        console.log('');\n        console.log('=== DRAW FRAGMENT SHADER (Color Mode) ===');\n        console.log(this.shaderSource.drawFragment);\n        console.log('=== END FRAGMENT SHADER ===');\n\n        logger.info('Draw shaders (vertex + fragment) logged to browser console');\n    }\n\n    /**\n     * Log screen shader (contains tone mapping)\n     */\n    logScreenShader() {\n        if (!this.shaderSource || !this.shaderSource.screenFragment) {\n            console.warn('No screen shader source available');\n            return;\n        }\n\n        console.log('=== SCREEN FRAGMENT SHADER (Tone Mapping) ===');\n        console.log(this.shaderSource.screenFragment);\n        console.log('=== END SHADER ===');\n\n        logger.info('Screen shader logged to browser console');\n    }\n\n    /**\n     * Log diagnostic stats shaders (velocity and brightness)\n     */\n    logStatsShaders() {\n        logger.info('=== DIAGNOSTIC STATS SHADERS ===');\n\n        // Log velocity stats shader\n        if (this.velocityStatsManager && this.velocityStatsManager.getShaderSource) {\n            const velShader = this.velocityStatsManager.getShaderSource();\n            if (velShader) {\n                console.log('=== VELOCITY STATS FRAGMENT SHADER ===');\n                console.log(velShader);\n                console.log('=== END SHADER ===');\n            } else {\n                console.warn('Velocity stats shader not available');\n            }\n        } else {\n            console.warn('VelocityStatsManager not initialized or no getShaderSource method');\n        }\n\n        // Log buffer stats shader (brightness histogram)\n        if (this.bufferStatsManager && this.bufferStatsManager.getShaderSource) {\n            const bufferShader = this.bufferStatsManager.getShaderSource();\n            if (bufferShader) {\n                console.log('=== BRIGHTNESS STATS FRAGMENT SHADER ===');\n                console.log(bufferShader);\n                console.log('=== END SHADER ===');\n            } else {\n                console.warn('Buffer stats shader not available');\n            }\n        } else {\n            console.warn('BufferStatsManager not initialized or no getShaderSource method');\n        }\n\n        logger.info('Stats shaders logged to browser console');\n    }\n\n    /**\n     * Read pixel values at screen coordinates\n     * Returns both HDR and LDR values without copying entire framebuffer\n     * @param {number} screenX - Screen X coordinate (canvas pixels)\n     * @param {number} screenY - Screen Y coordinate (canvas pixels)\n     * @returns {Object} { hdr: [r, g, b], ldr: [r, g, b] } or null if out of bounds\n     */\n    readPixelAt(screenX, screenY) {\n        const gl = this.gl;\n\n        // Convert to framebuffer coordinates (may be different from canvas if using devicePixelRatio)\n        const fbX = Math.floor(screenX * (this.renderWidth / this.canvas.width));\n        const fbY = Math.floor(screenY * (this.renderHeight / this.canvas.height));\n\n        // Flip Y (WebGL uses bottom-left origin)\n        const glY = this.renderHeight - fbY - 1;\n\n        // Check bounds\n        if (fbX < 0 || fbX >= this.renderWidth || glY < 0 || glY >= this.renderHeight) {\n            return null;\n        }\n\n        const result = { hdr: null, ldr: null };\n\n        // Read HDR value from current HDR framebuffer\n        if (this.useHDR && this.framebufferManager) {\n            const hdrTexture = this.framebufferManager.getCurrentTexture();\n            const hdrFramebuffer = this.framebufferManager.framebuffers[this.framebufferManager.currentIndex];\n\n            gl.bindFramebuffer(gl.FRAMEBUFFER, hdrFramebuffer);\n\n            // Read 1x1 pixel\n            if (this.framebufferManager.hdrType === gl.FLOAT) {\n                // Full float\n                const pixels = new Float32Array(4);\n                gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.FLOAT, pixels);\n                result.hdr = [pixels[0], pixels[1], pixels[2]];\n            } else {\n                // Half float or LDR fallback\n                const pixels = new Uint8Array(4);\n                gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n                result.hdr = [pixels[0] / 255, pixels[1] / 255, pixels[2] / 255];\n            }\n        }\n\n        // Read LDR value from tone-mapped texture\n        if (this.ldrFramebuffer && this.ldrTexture) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.ldrFramebuffer);\n\n            const pixels = new Uint8Array(4);\n            gl.readPixels(fbX, glY, 1, 1, gl.RGBA, gl.UNSIGNED_BYTE, pixels);\n            result.ldr = [pixels[0] / 255, pixels[1] / 255, pixels[2] / 255];\n        }\n\n        // Restore default framebuffer binding\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n        return result;\n    }\n}\n", "/**\n * Numerical integration methods for updating particle positions\n * Each integrator generates GLSL code for computing position updates\n */\n\nimport { computeSymbolicJacobian, isValidJacobian } from './jacobian.js';\nimport { parseExpression } from './parser.js';\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Variable names for dimensions\n */\nconst VARIABLE_NAMES = ['x', 'y', 'z', 'w', 'u', 'v'];\n\n/**\n * Generate GLSL code for NxN matrix inversion using Gauss-Jordan elimination\n *\n * @param {number} n - Matrix dimension\n * @returns {string} - GLSL function code for matrix inverse\n */\nfunction generateMatrixInverseGLSL(n) {\n    const matType = n === 2 ? 'mat2' : n === 3 ? 'mat3' : 'mat4';\n    const funcName = `inverse${n}`;\n\n    // For 2x2, use fast closed-form formula\n    if (n === 2) {\n        return `\n// Compute inverse of 2x2 matrix (closed form)\n// For matrix [a c; b d] (column-major), inverse is [d -c; -b a] / det\nmat2 inverse2(mat2 m) {\n    float det = m[0][0]*m[1][1] - m[1][0]*m[0][1];\n    return mat2(m[1][1], -m[1][0], -m[0][1], m[0][0]) / det;\n}`;\n    }\n\n    // For 3x3 and larger, use Gauss-Jordan elimination\n    // Create augmented matrix [A | I] and reduce to [I | A^-1]\n\n    let code = `\n// Compute inverse of ${n}x${n} matrix using Gauss-Jordan elimination\n${matType} ${funcName}(${matType} m) {\n    // Create augmented matrix [m | I] stored as ${n} column vectors\n`;\n\n    // Initialize augmented matrix columns\n    for (let col = 0; col < n; col++) {\n        code += `    vec${n} aug${col} = vec${n}(`;\n        for (let row = 0; row < n; row++) {\n            if (row > 0) code += ', ';\n            // First n columns are m, next n columns are identity\n            code += `m[${col}][${row}]`;\n        }\n        code += `);\\n`;\n    }\n\n    // Add identity matrix columns\n    for (let col = 0; col < n; col++) {\n        code += `    vec${n} aug${n + col} = vec${n}(`;\n        for (let row = 0; row < n; row++) {\n            if (row > 0) code += ', ';\n            code += (row === col) ? '1.0' : '0.0';\n        }\n        code += `);\\n`;\n    }\n\n    code += `\\n`;\n\n    // Gauss-Jordan elimination (working on rows)\n    for (let pivot = 0; pivot < n; pivot++) {\n        code += `    // Pivot ${pivot}: Make diagonal element = 1 and eliminate column ${pivot}\\n`;\n\n        // Scale pivot row to make diagonal element = 1\n        // The pivot row is row ${pivot}, which means element [${pivot}] in each column vector\n        code += `    float scale${pivot} = aug${pivot}[${pivot}];\\n`;\n        // Protect against division by zero\n        code += `    if (abs(scale${pivot}) < 0.0001) scale${pivot} = 0.0001;\\n`;\n        for (let col = 0; col < 2 * n; col++) {\n            // Divide element [pivot] in each column by the pivot value\n            code += `    aug${col}[${pivot}] /= scale${pivot};\\n`;\n        }\n        code += `\\n`;\n\n        // Eliminate other rows in this column\n        for (let row = 0; row < n; row++) {\n            if (row === pivot) continue;\n\n            code += `    // Eliminate row ${row}\\n`;\n            code += `    float factor${pivot}_${row} = aug${pivot}[${row}];\\n`;\n            for (let col = 0; col < 2 * n; col++) {\n                // Subtract factor * pivot_row[col] from current row[col]\n                code += `    aug${col}[${row}] -= factor${pivot}_${row} * aug${col}[${pivot}];\\n`;\n            }\n            code += `\\n`;\n        }\n    }\n\n    // Extract inverse matrix from right side of augmented matrix\n    code += `    // Extract inverse from augmented matrix\\n`;\n    code += `    return ${matType}(\\n`;\n    for (let col = 0; col < n; col++) {\n        if (col > 0) code += `,\\n`;\n        code += `        aug${n + col}`;\n    }\n    code += `\\n    );\\n`;\n    code += `}\\n`;\n\n    return code;\n}\n\n/**\n * Generate GLSL code for computing the Jacobian matrix\n *\n * @param {string[][]} jacobianMatrix - 2D array of symbolic expressions\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL function code for computing Jacobian\n */\nfunction generateJacobianGLSL(jacobianMatrix, dimensions) {\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const vecType = `vec${dimensions}`;\n\n    // Generate variable declarations\n    let varDecls = '';\n    for (let i = 0; i < dimensions; i++) {\n        varDecls += `    float ${VARIABLE_NAMES[i]} = pos.${['x', 'y', 'z', 'w'][i]};\\n`;\n    }\n\n    // Generate matrix constructor arguments\n    // GLSL matrices are column-major, so we need to transpose\n    const matrixElements = [];\n    for (let col = 0; col < dimensions; col++) {\n        for (let row = 0; row < dimensions; row++) {\n            const symbolicExpr = jacobianMatrix[row][col];\n            try {\n                const glslExpr = parseExpression(symbolicExpr, dimensions);\n                matrixElements.push(glslExpr);\n            } catch (error) {\n                logger.warn(`Failed to compile Jacobian element [${row}][${col}]: ${symbolicExpr}`, error);\n                matrixElements.push('0.0');\n            }\n        }\n    }\n\n    // Generate matrix inverse function (WebGL 1.0 doesn't have built-in inverse())\n    const inverseFunc = generateMatrixInverseGLSL(dimensions);\n\n    return `\n${inverseFunc}\n\n// Compute Jacobian matrix at given position\n${matType} computeJacobian(${vecType} pos) {\n${varDecls}\n    return ${matType}(\n        ${matrixElements.join(',\\n        ')}\n    );\n}`;\n}\n\n/**\n * Solver generator functions for implicit equations\n * These generate GLSL code for different iterative solver methods\n */\n\n/**\n * Generate fixed-point iteration solver body (single iteration step)\n *\n * @param {string} varName - Variable name to solve for (e.g., 'x_new', 'k1')\n * @param {function(string): string} updateExprFn - Function that takes variable name and returns GLSL update expression\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateFixedPointSolverBody(varName, updateExprFn, dimensions) {\n    const updateExpr = updateExprFn(varName);\n    return `        ${varName} = ${updateExpr};`;\n}\n\n/**\n * Generate midpoint solver body (predictor-corrector single iteration step)\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} updateExprFn - Function that takes variable name and returns GLSL update expression\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateMidpointSolverBody(varName, updateExprFn, dimensions) {\n    const vecType = `vec${dimensions}`;\n    const predName = `${varName}_pred`;\n    const midName = `${varName}_mid`;\n\n    const updateExprPred = updateExprFn(varName);\n    const updateExprMid = updateExprFn(midName);\n\n    return `        // Predictor: standard fixed-point step\n        ${vecType} ${predName} = ${updateExprPred};\n\n        // Corrector: evaluate at midpoint between current and predictor\n        ${vecType} ${midName} = (${varName} + ${predName}) * 0.5;\n        ${varName} = ${updateExprMid};`;\n}\n\n/**\n * Generate Newton's method solver body (single iteration step)\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} residualExprFn - Function that takes variable name and returns GLSL residual F(x)\n * @param {function(string): string} jacobianExprFn - Function that takes variable name and returns GLSL Jacobian matrix\n * @param {number} dimensions - Number of dimensions\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateNewtonSolverBody(varName, residualExprFn, jacobianExprFn, dimensions) {\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const inverseFuncName = `inverse${dimensions}`;\n\n    const residualExpr = residualExprFn(varName);\n    const jacobianExpr = jacobianExprFn(varName);\n\n    // Use varName prefix for local variables to avoid redeclaration when used multiple times in same scope\n    return `        ${vecType} F_${varName} = ${residualExpr};\n        ${matType} J_${varName} = ${jacobianExpr};\n\n        // Newton step: x -= J^(-1) * F\n        ${vecType} delta_${varName} = ${inverseFuncName}(J_${varName}) * F_${varName};\n        ${varName} -= delta_${varName};`;\n}\n\n/**\n * Generate Newton's method solver body with finite difference Jacobian (single iteration step)\n *\n * Uses finite differences to approximate the Jacobian matrix instead of symbolic differentiation.\n * This avoids dependency on symbolic math but may create interesting numerical artifacts.\n *\n * @param {string} varName - Variable name to solve for\n * @param {function(string): string} velocityExprFn - Function that takes position and returns GLSL velocity expression\n * @param {number} dimensions - Number of dimensions\n * @param {string} hScale - Scaling factor for velocity Jacobian (e.g., 'h', 'h*0.5', '1.0')\n * @param {string} residualRHS - Right-hand side of residual (e.g., 'pos + h * vel', 'pos + h * 0.5 * (f0 + vel)')\n * @returns {string} - GLSL code for single solver iteration (just the loop body)\n */\nfunction generateNewtonFDSolverBody(varName, velocityExprFn, dimensions, hScale = 'h', residualRHS = null) {\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n    const inverseFuncName = `inverse${dimensions}`;\n    const coords = ['x', 'y', 'z', 'w'];\n\n    // Epsilon for finite differences - balanced to avoid both truncation and cancellation errors\n    const epsilon = '1e-4';\n\n    // Generate code to compute each column of the velocity Jacobian (Df)\n    let jacobianCode = '';\n    const dfColumns = [];\n\n    for (let col = 0; col < dimensions; col++) {\n        const colName = `Df_col${col}_${varName}`;\n\n        // Create perturbation vector (unit vector in dimension col)\n        const perturbation = Array.from({length: dimensions}, (_, i) =>\n            i === col ? epsilon : '0.0'\n        ).join(', ');\n\n        // Compute f(x + eps*e_col) and f(x) - this is the derivative of the velocity field\n        const velocityAtPerturbed = velocityExprFn(`${varName} + ${vecType}(${perturbation})`);\n        const velocityAtCurrent = velocityExprFn(varName);\n\n        jacobianCode += `\n        // Velocity Jacobian column ${col}: d(velocity)/d${coords[col]}\n        ${vecType} ${colName} = (${velocityAtPerturbed} - ${velocityAtCurrent}) / ${epsilon};`;\n\n        dfColumns.push(colName);\n    }\n\n    // Build the Jacobian of the velocity field\n    jacobianCode += `\n\n        // Velocity Jacobian matrix Df\n        ${matType} Df_${varName} = ${matType}(${dfColumns.join(', ')});\n\n        // Residual Jacobian: J_F = I - ${hScale} * Df\n        ${matType} J_${varName} = ${matType}(1.0) - ${hScale} * Df_${varName};`;\n\n    // Compute residual\n    const currentVel = velocityExprFn(varName);\n    const residual = residualRHS || `pos + ${hScale} * ${currentVel}`;\n\n    return `        // Finite difference Jacobian approximation (epsilon = ${epsilon})${jacobianCode}\n\n        // Compute residual: F(x) = x - RHS\n        ${vecType} F_${varName} = ${varName} - (${residual});\n\n        // Newton step: x -= J^(-1) * F\n        ${vecType} delta_${varName} = ${inverseFuncName}(J_${varName}) * F_${varName};\n        ${varName} -= delta_${varName};`;\n}\n\n/**\n * Euler integrator (1st order)\n * Simple forward step: x(t+h) = x(t) + h*f(x)\n */\nexport function eulerIntegrator(dimensions) {\n    return {\n        name: 'Euler',\n        costFactor: 1, // 1 function evaluation per step\n        code: `\n// Euler integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} velocity = get_velocity(pos);\n    return pos + h * velocity;\n}\n`\n    };\n}\n\n/**\n * Explicit Midpoint (RK2)\n * 2nd order accurate\n */\nexport function explicitMidpointIntegrator(dimensions) {\n    return {\n        name: 'Explicit Midpoint',\n        costFactor: 2, // 2 function evaluations per step\n        code: `\n// Explicit Midpoint (RK2) integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * 0.5 * k1);\n    return pos + h * k2;\n}\n`\n    };\n}\n\n/**\n * Heun's Method (Explicit Trapezoidal, RK2 variant)\n * 2nd order accurate\n * Explicit counterpart to implicit trapezoidal rule\n */\nexport function heunIntegrator(dimensions) {\n    return {\n        name: 'Heun (Explicit Trapezoidal)',\n        costFactor: 2, // 2 function evaluations per step\n        code: `\n// Heun's Method (Explicit Trapezoidal) integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * k1);\n    return pos + h * 0.5 * (k1 + k2);\n}\n`\n    };\n}\n\n/**\n * Runge-Kutta 4\n * 4th order accurate, good balance of accuracy and performance\n */\nexport function rk4Integrator(dimensions) {\n    return {\n        name: 'RK4',\n        costFactor: 4, // 4 function evaluations per step\n        code: `\n// Runge-Kutta 4 integration\nvec${dimensions} integrate(vec${dimensions} pos, float h) {\n    vec${dimensions} k1 = get_velocity(pos);\n    vec${dimensions} k2 = get_velocity(pos + h * 0.5 * k1);\n    vec${dimensions} k3 = get_velocity(pos + h * 0.5 * k2);\n    vec${dimensions} k4 = get_velocity(pos + h * k3);\n\n    return pos + h * (k1 / 6.0 + k2 / 3.0 + k3 / 3.0 + k4 / 6.0);\n}\n`\n    };\n}\n\n/**\n * Implicit Euler (Backward Euler)\n * Solves: x(t+h) = x(t) + h*f(x(t+h))\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * More stable than explicit Euler, especially for stiff systems\n */\nexport function implicitEulerIntegrator(dimensions, iterations = 3, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit Euler integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Problem definition for Implicit Euler: x_new = pos + h * f(x_new)\n    const initialGuess = 'pos + h * get_velocity(pos)';\n    const updateExprFn = (v) => `pos + h * get_velocity(${v})`;\n    const velocityExprFn = (v) => `get_velocity(${v})`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Implicit Euler');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * get_velocity(${v})`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - h * computeJacobian(${v})`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        // Finite difference Newton's method - no symbolic expressions needed\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit Euler');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions);\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Implicit Euler (${solverName})`,\n        costFactor: 1, // Base cost (iterations are tunable convergence parameter)\n        code: `\n${jacobianGLSL}\n// Implicit Euler integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Implicit Midpoint (Implicit RK2)\n * Solves: x(t+h) = x(t) + h*f((x(t) + x(t+h))/2)\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * 2nd order accurate, A-stable (excellent for stiff systems)\n */\nexport function implicitMidpointIntegrator(dimensions, iterations = 4, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit Midpoint integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Initial guess: explicit RK2\n    const k1Init = 'get_velocity(pos)';\n    const initialGuess = `pos + h * get_velocity(pos + h * 0.5 * ${k1Init})`;\n\n    // Problem definition for Implicit Midpoint: x_new = pos + h * f((pos + x_new)/2)\n    const updateExprFn = (v) => `pos + h * get_velocity((pos + ${v}) * 0.5)`;\n    const velocityExprFn = (v) => `get_velocity((pos + ${v}) * 0.5)`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Implicit Midpoint)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Implicit Midpoint');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * get_velocity((pos + ${v}) * 0.5)`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - (h * 0.5) * computeJacobian((pos + ${v}) * 0.5)`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Implicit Midpoint)');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit Midpoint');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions, 'h * 0.5');\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Implicit Midpoint (${solverName})`,\n        costFactor: 2, // 2nd order method (like explicit midpoint)\n        code: `\n${jacobianGLSL}\n// Implicit Midpoint integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Trapezoidal Rule (Implicit RK2)\n * Solves: x(t+h) = x(t) + h/2 * (f(x(t)) + f(x(t+h)))\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n * 2nd order accurate, A-stable\n */\nexport function trapezoidalIntegrator(dimensions, iterations = 4, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Trapezoidal integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    const initialGuess = 'pos + h * f0';\n\n    // Problem definition for Trapezoidal: x_new = pos + h/2 * (f0 + f(x_new))\n    const updateExprFn = (v) => `pos + h * 0.5 * (f0 + get_velocity(${v}))`;\n    const velocityExprFn = (v) => `get_velocity(${v})`;\n\n    let solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Trapezoidal)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using Newton\\'s method for Trapezoidal');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n            const residualExprFn = (v) => `${v} - pos - h * 0.5 * (f0 + get_velocity(${v}))`;\n            const jacobianExprFn = (v) => `${matType}(1.0) - (h * 0.5) * computeJacobian(${v})`;\n\n            solverBody = generateNewtonSolverBody('x_new', residualExprFn, jacobianExprFn, dimensions);\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Trapezoidal)');\n            logger.warn('Falling back to fixed-point iteration');\n            solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Trapezoidal');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n        solverBody = generateNewtonFDSolverBody('x_new', velocityExprFn, dimensions, 'h * 0.5', 'pos + h * 0.5 * (f0 + ' + velocityExprFn('x_new') + ')');\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        solverBody = generateMidpointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        solverBody = generateFixedPointSolverBody('x_new', updateExprFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    return {\n        name: `Trapezoidal (${solverName})`,\n        costFactor: 2, // 2nd order method (like Heun)\n        code: `\n${jacobianGLSL}\n// Trapezoidal Rule integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n    ${vecType} f0 = get_velocity(pos);\n\n    // Start with initial guess\n    ${vecType} x_new = ${initialGuess};\n\n    // Iterative solver\n    for (int i = 0; i < ${iterations}; i++) {\n${solverBody}\n    }\n\n    return x_new;\n}\n`\n    };\n}\n\n/**\n * Implicit RK4 (Gauss-Legendre)\n * Fully implicit 4th order method, excellent stability\n * Uses simplified 2-stage Gauss-Legendre\n * Can use fixed-point iteration, midpoint solver, or Newton's method\n *\n * Note: This uses a simplified Newton's method that treats each stage separately\n * (Gauss-Seidel style). A full Newton's method would solve the coupled 2N\u00D72N system\n * for both stages simultaneously, which is more accurate but significantly more complex.\n * The simplified approach offers a good balance of accuracy and implementation complexity.\n */\nexport function implicitRK4Integrator(dimensions, iterations = 5, solutionMethod = 'fixed-point', expressions = null) {\n    logger.info(`*** Implicit RK4 integrator requested: solutionMethod=${solutionMethod}, hasExpressions=${!!expressions}`);\n\n    const vecType = `vec${dimensions}`;\n    const matType = dimensions === 2 ? 'mat2' : dimensions === 3 ? 'mat3' : 'mat4';\n\n    // Gauss-Legendre coefficients (will be inlined in GLSL)\n    const coeffsGLSL = `\n    // Gauss-Legendre coefficients for 2-stage method\n    const float a11 = 0.25;\n    const float a12 = 0.25 - sqrt(3.0) / 6.0;\n    const float a21 = 0.25 + sqrt(3.0) / 6.0;\n    const float a22 = 0.25;\n    const float b1 = 0.5;\n    const float b2 = 0.5;\n    const float c1 = 0.5 - sqrt(3.0) / 6.0;\n    const float c2 = 0.5 + sqrt(3.0) / 6.0;`;\n\n    const initialGuessGLSL = `\n    // Start with explicit RK4 as initial guess\n    ${vecType} k1_guess = get_velocity(pos);\n    ${vecType} k2_guess = get_velocity(pos + h * 0.5 * k1_guess);\n\n    ${vecType} k1 = k1_guess;\n    ${vecType} k2 = k2_guess;`;\n\n    // Problem: k1 = f(pos + h*(a11*k1 + a12*k2)), k2 = f(pos + h*(a21*k1 + a22*k2))\n    // Update functions for each stage\n    const k1_updateFn = (v) => `get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n    const k2_updateFn = (v) => `get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n    // Velocity functions for finite difference\n    const k1_velocityFn = (v) => `get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n    const k2_velocityFn = (v) => `get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n    let k1_solverBody, k2_solverBody;\n    let solverName;\n    let jacobianGLSL = '';\n\n    // Choose solver method\n    if (solutionMethod === 'newton' && expressions) {\n        logger.info('Computing Jacobian for Newton\\'s method (Implicit RK4 - simplified)');\n\n        const jacobian = computeSymbolicJacobian(expressions, dimensions);\n\n        if (isValidJacobian(jacobian)) {\n            logger.info('\u2713 Successfully using simplified Newton\\'s method for Implicit RK4');\n\n            jacobianGLSL = generateJacobianGLSL(jacobian, dimensions);\n\n            // Define residual and Jacobian functions for each stage\n            // Stage 1: F1(k1) = k1 - f(pos + h*(a11*k1 + a12*k2))\n            const k1_residualFn = (v) => `${v} - get_velocity(pos + h * (a11 * ${v} + a12 * k2))`;\n            const k1_jacobianFn = (v) => `${matType}(1.0) - (h * a11) * computeJacobian(pos + h * (a11 * ${v} + a12 * k2))`;\n\n            // Stage 2: F2(k2) = k2 - f(pos + h*(a21*k1 + a22*k2))\n            const k2_residualFn = (v) => `${v} - get_velocity(pos + h * (a21 * k1 + a22 * ${v}))`;\n            const k2_jacobianFn = (v) => `${matType}(1.0) - (h * a22) * computeJacobian(pos + h * (a21 * k1 + a22 * ${v}))`;\n\n            k1_solverBody = generateNewtonSolverBody('k1', k1_residualFn, k1_jacobianFn, dimensions);\n            k2_solverBody = generateNewtonSolverBody('k2', k2_residualFn, k2_jacobianFn, dimensions);\n\n            solverName = 'Newton';\n        } else {\n            logger.warn('\u2717 Failed to compute Jacobian for Newton\\'s method (Implicit RK4)');\n            logger.warn('Falling back to fixed-point iteration');\n            k1_solverBody = generateFixedPointSolverBody('k1', k1_updateFn, dimensions);\n            k2_solverBody = generateFixedPointSolverBody('k2', k2_updateFn, dimensions);\n            solverName = 'Fixed-Point';\n        }\n    } else if (solutionMethod === 'newton-fd') {\n        logger.info('\u2713 Using finite difference Newton\\'s method for Implicit RK4 (simplified)');\n\n        jacobianGLSL = generateMatrixInverseGLSL(dimensions);\n\n        // For each stage k_i: k_i = f(pos + h*(a_i1*k1 + a_i2*k2))\n        // Residual: F(k_i) = k_i - f(...)\n        // Jacobian: J = I - h*a_ii*Df\n        k1_solverBody = generateNewtonFDSolverBody('k1', k1_velocityFn, dimensions, 'h * a11');\n        k2_solverBody = generateNewtonFDSolverBody('k2', k2_velocityFn, dimensions, 'h * a22');\n\n        solverName = 'Newton (FD)';\n    } else if (solutionMethod === 'midpoint') {\n        k1_solverBody = generateMidpointSolverBody('k1', k1_updateFn, dimensions);\n        k2_solverBody = generateMidpointSolverBody('k2', k2_updateFn, dimensions);\n        solverName = 'Midpoint';\n    } else {\n        // Default: fixed-point iteration\n        k1_solverBody = generateFixedPointSolverBody('k1', k1_updateFn, dimensions);\n        k2_solverBody = generateFixedPointSolverBody('k2', k2_updateFn, dimensions);\n        solverName = 'Fixed-Point';\n    }\n\n    // Build the solver loop (both stages in one loop, Gauss-Seidel style)\n    const solverCode = `\n    // Iterative solver for coupled stages (Gauss-Seidel style)\n    for (int i = 0; i < ${iterations}; i++) {\n        // Stage 1\n${k1_solverBody}\n\n        // Stage 2\n${k2_solverBody}\n    }`;\n\n    return {\n        name: `Implicit RK4 (${solverName})`,\n        costFactor: 4, // 4th order method (like explicit RK4)\n        code: `\n${jacobianGLSL}\n// Implicit RK4 (Gauss-Legendre 2-stage) integration (${solverName.toLowerCase()} solver)\n${vecType} integrate(${vecType} pos, float h) {\n${coeffsGLSL}\n${initialGuessGLSL}\n${solverCode}\n\n    return pos + h * (b1 * k1 + b2 * k2);\n}\n`\n    };\n}\n\n/**\n * Get integrator by name\n */\nexport function getIntegrator(name, dimensions, params = {}) {\n    const iterations = params.iterations || 3;\n    const solutionMethod = params.solutionMethod || 'fixed-point';\n    const expressions = params.expressions || null;\n\n    switch (name) {\n        case 'euler':\n            return eulerIntegrator(dimensions);\n        case 'explicit-midpoint':\n            return explicitMidpointIntegrator(dimensions);\n        case 'heun':\n            return heunIntegrator(dimensions);\n        case 'rk4':\n            return rk4Integrator(dimensions);\n        case 'implicit-euler':\n            return implicitEulerIntegrator(dimensions, iterations, solutionMethod, expressions);\n        case 'implicit-midpoint':\n            return implicitMidpointIntegrator(dimensions, params.iterations || 4, solutionMethod, expressions);\n        case 'trapezoidal':\n            return trapezoidalIntegrator(dimensions, params.iterations || 4, solutionMethod, expressions);\n        case 'implicit-rk4':\n            return implicitRK4Integrator(dimensions, params.iterations || 5, solutionMethod, expressions);\n        // Legacy aliases\n        case 'rk2':\n            return explicitMidpointIntegrator(dimensions);\n        case 'implicit':\n            return implicitEulerIntegrator(dimensions, iterations, solutionMethod, expressions);\n        default:\n            return rk4Integrator(dimensions); // Default to RK4\n    }\n}\n\n/**\n * Create custom integrator from user GLSL code\n */\nexport function customIntegrator(glslCode, dimensions) {\n    return {\n        name: 'Custom',\n        code: glslCode\n    };\n}\n", "/**\n * 2D projection mappers for visualizing n-dimensional vector fields\n * Each mapper reduces n-dimensional position to 2D screen coordinates\n */\n\nimport { parseExpression } from './parser.js';\n\n/**\n * Select mapper - choose 2 dimensions to display (with optional depth)\n * @param {number} dim1 - First dimension index (0-based)\n * @param {number} dim2 - Second dimension index (0-based)\n * @param {number} totalDims - Total number of dimensions\n * @param {number} depthDim - Depth dimension index (optional, defaults to 2 or -1 if not available)\n */\nexport function selectMapper(dim1, dim2, totalDims, depthDim = null) {\n    // Auto-select depth dimension if not specified\n    if (depthDim === null) {\n        // Use dimension 2 if we have at least 3 dimensions, otherwise -1\n        depthDim = totalDims >= 3 ? 2 : -1;\n    }\n\n    const hasDepth = depthDim >= 0 && depthDim < totalDims;\n\n    return {\n        name: 'Select',\n        params: { dim1, dim2, depthDim },\n        code: `\n// Select 2 dimensions for display${hasDepth ? ' (with depth)' : ''}\nvec2 project_to_2d(vec${totalDims} pos) {\n    return vec2(pos[${dim1}], pos[${dim2}]);\n}\n\nvec3 project_to_3d(vec${totalDims} pos) {\n    return vec3(pos[${dim1}], pos[${dim2}], ${hasDepth ? `pos[${depthDim}]` : '0.0'});\n}\n`\n    };\n}\n\n/**\n * Linear projection mapper - apply 2\u00D7N or 3\u00D7N matrix projection\n * @param {number[][]} matrix - 2\u00D7N or 3\u00D7N projection matrix\n * @param {number} dimensions - Number of dimensions\n */\nexport function linearProjectionMapper(matrix, dimensions) {\n    // Generate GLSL code for matrix multiplication\n    const row1 = matrix[0].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ');\n    const row2 = matrix[1].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ');\n    const row3 = matrix[2] ? matrix[2].map((val, i) => `${val.toFixed(6)} * pos[${i}]`).join(' + ') : null;\n\n    return {\n        name: 'Linear Projection',\n        params: { matrix },\n        code: `\n// Linear projection matrix\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(\n        ${row1},\n        ${row2}\n    );\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(\n        ${row1},\n        ${row2},\n        ${row3 || '0.0'}\n    );\n}\n`\n    };\n}\n\n/**\n * Orthographic projection - project along a specific axis\n * @param {number} axis - Axis to project out (0-based)\n * @param {number} dimensions - Total dimensions\n */\nexport function orthographicMapper(axis, dimensions) {\n    // Project out the specified axis, take first two remaining dimensions\n    let dim1 = axis === 0 ? 1 : 0;\n    let dim2 = dim1 + 1;\n    if (dim2 === axis) dim2++;\n\n    return {\n        name: 'Orthographic',\n        params: { axis },\n        code: `\n// Orthographic projection (remove axis ${axis}, use as depth)\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(pos[${dim1}], pos[${dim2}]);\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(pos[${dim1}], pos[${dim2}], pos[${axis}]);\n}\n`\n    };\n}\n\n/**\n * Spherical projection - project from 3D spherical coordinates\n * Only works for 3D systems\n */\nexport function sphericalMapper() {\n    return {\n        name: 'Spherical',\n        params: {},\n        code: `\n// Spherical projection (3D only)\nvec2 project_to_2d(vec3 pos) {\n    float r = length(pos);\n    if (r < 0.001) return vec2(0.0, 0.0);\n\n    float theta = atan(pos.y, pos.x);\n    float phi = acos(pos.z / r);\n\n    return vec2(theta, phi);\n}\n\nvec3 project_to_3d(vec3 pos) {\n    float r = length(pos);\n    if (r < 0.001) return vec3(0.0, 0.0, 0.0);\n\n    float theta = atan(pos.y, pos.x);\n    float phi = acos(pos.z / r);\n\n    return vec3(theta, phi, r);  // Use radius as depth\n}\n`\n    };\n}\n\n/**\n * Stereographic projection - project high-dimensional sphere to 2D\n * Projects from N-sphere to 2D plane\n */\nexport function stereographicMapper(dimensions) {\n    return {\n        name: 'Stereographic',\n        params: {},\n        code: `\n// Stereographic projection\nvec2 project_to_2d(vec${dimensions} pos) {\n    float denom = 1.0 - pos[${dimensions - 1}];\n    if (abs(denom) < 0.001) denom = 0.001;\n    return vec2(pos[0] / denom, pos[1] / denom);\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    float denom = 1.0 - pos[${dimensions - 1}];\n    if (abs(denom) < 0.001) denom = 0.001;\n    return vec3(pos[0] / denom, pos[1] / denom, pos[${dimensions - 1}]);\n}\n`\n    };\n}\n\n/**\n * Get default mapper based on dimensions and type\n */\nexport function getMapper(type, dimensions, params = {}) {\n    switch (type) {\n        case 'select': {\n            const dim1 = params.dim1 !== undefined ? params.dim1 : 0;\n            const dim2 = params.dim2 !== undefined ? params.dim2 : Math.min(1, dimensions - 1);\n            const depthDim = params.depthDim !== undefined ? params.depthDim : null;\n            return selectMapper(dim1, dim2, dimensions, depthDim);\n        }\n\n        case 'project': {\n            // Default: identity-like projection for first 2 dims\n            const matrix = params.matrix || [\n                [1, 0, ...Array(Math.max(0, dimensions - 2)).fill(0)],\n                [0, 1, ...Array(Math.max(0, dimensions - 2)).fill(0)]\n            ];\n            return linearProjectionMapper(matrix, dimensions);\n        }\n\n        case 'orthographic': {\n            const axis = params.axis !== undefined ? params.axis : dimensions - 1;\n            return orthographicMapper(axis, dimensions);\n        }\n\n        case 'spherical':\n            if (dimensions === 3) {\n                return sphericalMapper();\n            }\n            // Fall back to select if not 3D\n            return selectMapper(0, 1, dimensions);\n\n        case 'stereographic':\n            if (dimensions >= 3) {\n                return stereographicMapper(dimensions);\n            }\n            return selectMapper(0, 1, dimensions);\n\n        case 'custom': {\n            const horizontalExpr = params.horizontalExpr || 'x';\n            const verticalExpr = params.verticalExpr || 'y';\n            const depthExpr = params.depthExpr || '';\n            return customMapper(horizontalExpr, verticalExpr, depthExpr, dimensions);\n        }\n\n        default:\n            return selectMapper(0, 1, dimensions);\n    }\n}\n\n/**\n * Create custom mapper from user math expressions\n * @param {string} horizontalExpr - Math expression for horizontal coordinate\n * @param {string} verticalExpr - Math expression for vertical coordinate\n * @param {string} depthExpr - Optional math expression for depth coordinate\n * @param {number} dimensions - Number of dimensions\n */\nexport function customMapper(horizontalExpr, verticalExpr, depthExpr, dimensions) {\n    // Parse expressions to GLSL\n    const horizontalGLSL = parseExpression(horizontalExpr || 'x', dimensions);\n    const verticalGLSL = parseExpression(verticalExpr || 'y', dimensions);\n    const depthGLSL = depthExpr ? parseExpression(depthExpr, dimensions) : '0.0';\n\n    return {\n        name: 'Custom',\n        params: { horizontalExpr, verticalExpr, depthExpr },\n        code: `\n// Custom mapper\nvec2 project_to_2d(vec${dimensions} pos) {\n    return vec2(\n        ${horizontalGLSL},\n        ${verticalGLSL}\n    );\n}\n\nvec3 project_to_3d(vec${dimensions} pos) {\n    return vec3(\n        ${horizontalGLSL},\n        ${verticalGLSL},\n        ${depthGLSL}\n    );\n}\n`\n    };\n}\n\n/**\n * Get list of available mapper names\n */\nexport function getAvailableMappers(dimensions) {\n    const mappers = ['select', 'project'];\n\n    if (dimensions >= 3) {\n        mappers.push('orthographic', 'stereographic');\n    }\n\n    if (dimensions === 3) {\n        mappers.push('spherical');\n    }\n\n    return mappers;\n}\n", "/**\n * Domain transformations for phase space integration\n *\n * Applies a 1-to-1 transformation T(x) before integration, then transforms back with T^(-1)(y).\n * This creates a spatially-varying effective timestep without breaking convergence.\n *\n * For dx/dt = f(x), we transform to y-space:\n *   y = T(x)\n *   dy/dt = J_T(x) * f(x)\n *\n * We integrate in y-space and transform back:\n *   y(t+h) = integrate(y(t), h, J_T * f \u2218 T^(-1))\n *   x(t+h) = T^(-1)(y(t+h))\n */\n\n// Transform parameter slider constants\nconst TRANSFORM_PARAM_MIN = 0.0001;\nconst TRANSFORM_PARAM_MAX = 25.0;\nconst TRANSFORM_PARAM_STEP = 0.0001;\n\n/**\n * Base class for coordinate transformations\n */\nclass Transform {\n    constructor(name, description) {\n        this.name = name;\n        this.description = description;\n    }\n\n    /**\n     * Generate GLSL helper functions (optional)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL helper function code\n     */\n    generateHelpers(dimensions) {\n        return ''; // Default: no helpers\n    }\n\n    /**\n     * Generate GLSL code for forward transform: y = T(x)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateForward(dimensions) {\n        throw new Error('generateForward must be implemented');\n    }\n\n    /**\n     * Generate GLSL code for inverse transform: x = T^(-1)(y)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateInverse(dimensions) {\n        throw new Error('generateInverse must be implemented');\n    }\n\n    /**\n     * Generate GLSL code for Jacobian: J_T(x)\n     * @param {number} dimensions - Number of dimensions\n     * @returns {string} GLSL function code\n     */\n    generateJacobian(dimensions) {\n        throw new Error('generateJacobian must be implemented');\n    }\n\n    /**\n     * Get parameter schema for UI controls\n     * @returns {Array<{name: string, label: string, type: string, min: number, max: number, step: number, default: number}>}\n     */\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Identity transform (no transformation)\n */\nclass IdentityTransform extends Transform {\n    constructor() {\n        super('identity', 'No transformation (identity)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    return x;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    return y;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    return ${vecType}(1.0);\n}`;\n    }\n}\n\n/**\n * Power transform (component-wise)\n * T(x) = sign(x) * |x|^alpha\n *\n * alpha < 1.0: More detail near origin, compress outer regions\n * alpha > 1.0: Less detail near origin, stretch outer regions\n */\nclass PowerTransform extends Transform {\n    constructor() {\n        super('power', 'Power transform (zoom lens effect)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = sign(x.${comp}) * pow(abs(x.${comp}) + 1e-8, alpha);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    float inv_alpha = 1.0 / alpha;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = sign(y.${comp}) * pow(abs(y.${comp}) + 1e-8, inv_alpha);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `    result.${comp} = alpha * pow(abs(x.${comp}) + 1e-8, alpha - 1.0);`;\n    }).join('\\n')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Exponent (\u03B1)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 0.5,\n            info: '\u03B1 < 1.0: zoom into origin; \u03B1 > 1.0: compress origin'\n        }];\n    }\n}\n\n/**\n * Hyperbolic tangent transform (component-wise)\n * T(x) = tanh(beta * x)\n *\n * Compresses infinite space into [-1, 1]\n * Higher beta = more compression near origin\n */\nclass TanhTransform extends Transform {\n    constructor() {\n        super('tanh', 'Hyperbolic tangent (compress infinity)');\n    }\n\n    generateHelpers(dimensions) {\n        return `\n// Helper: tanh(x) = (exp(2x) - 1) / (exp(2x) + 1)\nfloat tanh_scalar(float x) {\n    float e2x = exp(2.0 * x);\n    return (e2x - 1.0) / (e2x + 1.0);\n}\n`;\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float beta = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = tanh_scalar(beta * x.${comp});`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float beta = u_transform_params.x;\n    // atanh(y) = 0.5 * log((1+y)/(1-y))\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = 0.5 * log((1.0 + y_clamped) / (1.0 - y_clamped)) / beta;\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float beta = u_transform_params.x;\n    // Jacobian of tanh: d/dx tanh(x) = 1 - tanh^2(x)\n    ${vecType} tanh_vals;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `tanh_vals.${comp} = tanh_scalar(beta * x.${comp});`;\n    }).join('\\n    ')}\n    return beta * (${vecType}(1.0) - tanh_vals * tanh_vals);\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'beta',\n            label: 'Compression (\u03B2)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Higher = more compression. Maps infinite space to [-1,1]'\n        }];\n    }\n}\n\n/**\n * Logistic sigmoid transform (component-wise)\n * T(x) = 2*sigmoid(k*x) - 1 = 2/(1 + exp(-k*x)) - 1\n *\n * Compresses to [-1, 1], smoother than tanh in center region\n * Standard logistic function, centered at zero\n */\nclass SigmoidTransform extends Transform {\n    constructor() {\n        super('sigmoid', 'Logistic Sigmoid (smooth S-curve)');\n    }\n\n    generateHelpers(dimensions) {\n        return `\n// Helper: sigmoid(x) = 1 / (1 + exp(-x))\nfloat sigmoid_scalar(float x) {\n    return 1.0 / (1.0 + exp(-x));\n}\n`;\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float k = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = 2.0 * sigmoid_scalar(k * x.${comp}) - 1.0;`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float k = u_transform_params.x;\n    // Inverse: x = ln((y+1)/(1-y)) / k\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = log((y_clamped + 1.0) / (1.0 - y_clamped)) / k;\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float k = u_transform_params.x;\n    // Jacobian: d/dx [2*sigmoid(k*x) - 1] = 2k * sigmoid(k*x) * (1 - sigmoid(k*x))\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float sig = sigmoid_scalar(k * x.${comp});\n        result.${comp} = 2.0 * k * sig * (1.0 - sig);\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'k',\n            label: 'Steepness (k)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Higher = steeper transition. Maps infinite space to [-1,1] with logistic curve.'\n        }];\n    }\n}\n\n/**\n * Rational transform (component-wise)\n * T(x) = x / sqrt(x^2 + a)\n * Jacobian: a/(x^2+a)^(3/2) - bell-shaped!\n *\n * Compresses to (-\u221Aa, \u221Aa), with bell-shaped derivative\n * Parameter 'a' controls bell width: higher = wider/shallower, lower = narrower/sharper\n */\nclass RationalTransform extends Transform {\n    constructor() {\n        super('rational', 'Rational (bell-shaped Jacobian)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float a = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = x.${comp} / sqrt(x.${comp} * x.${comp} + a);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float a = u_transform_params.x;\n    // Inverse: x = y * sqrt(a / (1 - y^2))\n    // Note: y is bounded to [-1, 1] regardless of a\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        float y_sq = y_clamped * y_clamped;\n        result.${comp} = y_clamped * sqrt(a / (1.0 - y_sq));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float a = u_transform_params.x;\n    // Jacobian: d/dx [x/sqrt(x^2+a)] = a/(x^2+a)^(3/2)\n    // This is bell-shaped! Peaks at x=0, decays at infinity\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float x_sq = x.${comp} * x.${comp};\n        float denom = x_sq + a;\n        result.${comp} = a / (denom * sqrt(denom));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'a',\n            label: 'Width (a)',\n            type: 'slider',\n            min: TRANSFORM_PARAM_MIN,\n            max: TRANSFORM_PARAM_MAX,\n            step: TRANSFORM_PARAM_STEP,\n            default: 1.0,\n            info: 'Controls bell curve width. Higher = wider/shallower, lower = narrower/sharper.'\n        }];\n    }\n}\n\n/**\n * Sine wave distortion (component-wise)\n * T(x) = x + amplitude * sin(frequency * x)\n *\n * Creates periodic \"speed bumps\" in integration\n */\nclass SineTransform extends Transform {\n    constructor() {\n        super('sine', 'Sine wave distortion (periodic speed bumps)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n    return x + amplitude * sin(frequency * x);\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        // Use Newton's method to solve y = x + a*sin(f*x) for x\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n\n    // Newton's method: x_{n+1} = x_n - (f(x_n) - y) / f'(x_n)\n    // where f(x) = x + a*sin(f*x)\n    // f'(x) = 1 + a*f*cos(f*x)\n    ${vecType} x = y; // Initial guess\n    for (int iter = 0; iter < 5; iter++) {\n        ${vecType} fx = x + amplitude * sin(frequency * x);\n        ${vecType} dfx = ${vecType}(1.0) + amplitude * frequency * cos(frequency * x);\n        x = x - (fx - y) / dfx;\n    }\n    return x;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float amplitude = u_transform_params.x;\n    float frequency = u_transform_params.y;\n    return ${vecType}(1.0) + amplitude * frequency * cos(frequency * x);\n}`;\n    }\n\n    getParameters() {\n        return [\n            {\n                name: 'amplitude',\n                label: 'Amplitude',\n                type: 'slider',\n                min: TRANSFORM_PARAM_MIN,\n                max: TRANSFORM_PARAM_MAX,\n                step: TRANSFORM_PARAM_STEP,\n                default: 0.5,\n                info: 'Strength of distortion'\n            },\n            {\n                name: 'frequency',\n                label: 'Frequency',\n                type: 'slider',\n                min: TRANSFORM_PARAM_MIN,\n                max: TRANSFORM_PARAM_MAX,\n                step: TRANSFORM_PARAM_STEP,\n                default: 1.0,\n                info: 'Number of waves per unit length'\n            }\n        ];\n    }\n}\n\n/**\n * Radial power transform (2D and 3D)\n * In polar/spherical coordinates: r' = r^alpha, theta' = theta\n *\n * Changes integration density as function of distance from origin\n */\nclass RadialPowerTransform extends Transform {\n    constructor() {\n        super('radial_power', 'Radial power (compress/expand by distance)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        if (dimensions === 2) {\n            return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    if (r < 1e-8) return x;\n    float r_new = pow(r, alpha);\n    return x * (r_new / r);\n}`;\n        } else {\n            // For higher dimensions, apply same radial logic\n            return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    if (r < 1e-8) return x;\n    float r_new = pow(r, alpha);\n    return x * (r_new / r);\n}`;\n        }\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    float inv_alpha = 1.0 / alpha;\n    float r = length(y);\n    if (r < 1e-8) return y;\n    float r_new = pow(r, inv_alpha);\n    return y * (r_new / r);\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        // Jacobian is scalar for radial transform: J = alpha * r^(alpha-1)\n        // But we need component-wise for vector field multiplication\n        // For radial transform, Jacobian is J = alpha * r^(alpha-1) * I (identity matrix scaled)\n        // In component form: J_i = alpha * r^(alpha-1)\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    float r = length(x);\n    float jacobian_scalar = alpha * pow(r + 1e-8, alpha - 1.0);\n    return ${vecType}(jacobian_scalar);\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Radial Exponent (\u03B1)',\n            type: 'slider',\n            min: 0.1,\n            max: 3.0,\n            step: 0.1,\n            default: 0.5,\n            info: '\u03B1 < 1.0: zoom into origin; \u03B1 > 1.0: compress origin'\n        }];\n    }\n}\n\n/**\n * Logarithmic transform (component-wise)\n * T(x) = sign(x) * log(|x| + 1)\n *\n * Stretches near zero (large derivative), compresses at infinity\n * Maps infinite space to infinite space with logarithmic spacing\n */\nclass LogTransform extends Transform {\n    constructor() {\n        super('log', 'Logarithmic (stretch near zero)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(x.${comp}) * log(abs(x.${comp}) + 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(y.${comp}) * (exp(abs(y.${comp})) - 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    // Jacobian: d/dx [sign(x)*log(|x|+1)] = 1/(|x|+1)\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = 1.0 / (abs(x.${comp}) + 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Exponential transform (component-wise)\n * T(x) = sign(x) * (exp(\u03B1*|x|) - 1)\n *\n * Compresses near zero, stretches at infinity\n * Creates exponential growth away from origin\n */\nclass ExpTransform extends Transform {\n    constructor() {\n        super('exp', 'Exponential (compress near zero)');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(x.${comp}) * (exp(alpha * abs(x.${comp})) - 1.0);`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    float alpha = u_transform_params.x;\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = sign(y.${comp}) * log(abs(y.${comp}) + 1.0) / alpha;`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    float alpha = u_transform_params.x;\n    // Jacobian: d/dx [sign(x)*(exp(\u03B1|x|)-1)] = \u03B1*exp(\u03B1|x|)\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = alpha * exp(alpha * abs(x.${comp}));`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [{\n            name: 'alpha',\n            label: 'Growth Rate (\u03B1)',\n            type: 'slider',\n            min: 0.1,\n            max: 2.0,\n            step: 0.1,\n            default: 0.5,\n            info: 'Higher \u03B1 = stronger exponential growth. Use small values (0.1-0.5) to avoid overflow.'\n        }];\n    }\n}\n\n/**\n * Soft-sign transform (component-wise)\n * T(x) = x / (1 + |x|)\n *\n * Compresses to [-1, 1], smooth S-curve\n * Similar to tanh but simpler, no parameters\n */\nclass SoftsignTransform extends Transform {\n    constructor() {\n        super('softsign', 'Soft-sign (smooth compression to [-1,1])');\n    }\n\n    generateForward(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_forward(${vecType} x) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `result.${comp} = x.${comp} / (1.0 + abs(x.${comp}));`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateInverse(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_inverse(${vecType} y) {\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float y_clamped = clamp(y.${comp}, -0.99999, 0.99999);\n        result.${comp} = y_clamped / (1.0 - abs(y_clamped));\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    generateJacobian(dimensions) {\n        const vecType = `vec${dimensions}`;\n        return `\n${vecType} transform_jacobian(${vecType} x) {\n    // Jacobian: d/dx [x/(1+|x|)] = 1/(1+|x|)^2\n    ${vecType} result;\n    ${Array.from({length: dimensions}, (_, i) => {\n        const comp = ['x', 'y', 'z', 'w'][i] || `[${i}]`;\n        return `{\n        float denom = 1.0 + abs(x.${comp});\n        result.${comp} = 1.0 / (denom * denom);\n    }`;\n    }).join('\\n    ')}\n    return result;\n}`;\n    }\n\n    getParameters() {\n        return [];\n    }\n}\n\n/**\n * Custom transform (user-defined)\n * Requires user to provide forward, inverse, and Jacobian expressions\n */\nclass CustomTransform extends Transform {\n    constructor() {\n        super('custom', 'Custom (user-defined GLSL)');\n        this.forwardCode = '';\n        this.inverseCode = '';\n        this.jacobianCode = '';\n    }\n\n    setCode(forward, inverse, jacobian) {\n        this.forwardCode = forward;\n        this.inverseCode = inverse;\n        this.jacobianCode = jacobian;\n    }\n\n    generateForward(dimensions) {\n        return this.forwardCode || new IdentityTransform().generateForward(dimensions);\n    }\n\n    generateInverse(dimensions) {\n        return this.inverseCode || new IdentityTransform().generateInverse(dimensions);\n    }\n\n    generateJacobian(dimensions) {\n        return this.jacobianCode || new IdentityTransform().generateJacobian(dimensions);\n    }\n}\n\n/**\n * Transform registry\n */\nconst transforms = {\n    identity: new IdentityTransform(),\n    power: new PowerTransform(),\n    log: new LogTransform(),\n    exp: new ExpTransform(),\n    softsign: new SoftsignTransform(),\n    tanh: new TanhTransform(),\n    sigmoid: new SigmoidTransform(),\n    rational: new RationalTransform(),\n    sine: new SineTransform(),\n    radial_power: new RadialPowerTransform(),\n    custom: new CustomTransform()\n};\n\n/**\n * Get transform by name\n */\nfunction getTransform(name) {\n    return transforms[name] || transforms.identity;\n}\n\n/**\n * Get all transform names\n */\nfunction getTransformNames() {\n    return Object.keys(transforms);\n}\n\n/**\n * Get transform list for UI\n */\nfunction getTransformList() {\n    return Object.entries(transforms).map(([key, transform]) => ({\n        value: key,\n        label: transform.description\n    }));\n}\n\nexport {\n    Transform,\n    IdentityTransform,\n    PowerTransform,\n    TanhTransform,\n    SineTransform,\n    RadialPowerTransform,\n    CustomTransform,\n    getTransform,\n    getTransformNames,\n    getTransformList\n};\n", "/**\n * Color mode definitions for particle rendering\n */\n\nexport function getColorMode(name, dimensions) {\n    const vecType = `vec${dimensions}`;\n\n    const modes = {\n        white: {\n            name: 'Solid White',\n            code: `\n// Simple solid white particles\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} field_velocity, ${vecType} velocity_proj) {\n    return vec3(1.0, 1.0, 1.0);\n}\n`\n        },\n        velocity_magnitude: {\n            name: 'Velocity Magnitude',\n            usesMaxVelocity: true,\n            usesGradient: true\n        },\n        velocity_angle: {\n            name: 'Velocity Angle',\n            usesGradient: true\n        },\n        velocity_combined: {\n            name: 'Velocity Angle + Magnitude',\n            usesMaxVelocity: true,\n            usesGradient: true\n        },\n        field_magnitude: {\n            name: 'Field Magnitude',\n            usesMaxVelocity: true,\n            usesGradient: true\n        },\n        field_angle: {\n            name: 'Field Angle',\n            usesGradient: true\n        },\n        field_combined: {\n            name: 'Field Angle + Magnitude',\n            usesMaxVelocity: true,\n            usesGradient: true\n        },\n        expression: {\n            name: 'Expression',\n            usesMaxVelocity: false,\n            requiresExpression: true,\n            // Code will be generated dynamically based on user's expression\n            code: null\n        },\n        custom: {\n            name: 'Custom (Advanced)',\n            code: `\n// Custom color function\n// Inputs: pos (position vector), velocity (full N-D velocity), velocity_proj (projected 2D velocity)\n// Output: RGB color vec3\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} field_velocity, ${vecType} velocity_proj) {\n    return vec3(1.0, 1.0, 1.0);\n}\n`\n        }\n    };\n\n    const mode = modes[name];\n    if (!mode) {\n        throw new Error(`Unknown color mode: ${name}`);\n    }\n\n    return mode;\n}\n\n/**\n * Generate expression-based color mode code\n * @param {number} dimensions - Number of dimensions\n * @param {string} expressionGLSL - Compiled user expression GLSL code\n * @param {string} gradientGLSL - Generated gradient function code\n * @returns {string} GLSL color function code\n */\nexport function generateExpressionColorMode(dimensions, expressionGLSL, gradientGLSL) {\n    const vecType = `vec${dimensions}`;\n\n    // Generate variable declarations for position and velocity components\n    const varDecls = [];\n    const swizzles = ['x', 'y', 'z', 'w', 'u', 'v'];\n    const velocityVars = ['dx', 'dy', 'dz', 'dw', 'du', 'dv'];\n\n    for (let i = 0; i < dimensions; i++) {\n        varDecls.push(`float ${swizzles[i]} = pos.${swizzles[i]};`);\n        varDecls.push(`float ${velocityVars[i]} = velocity.${swizzles[i]};`); // Use full N-D velocity\n    }\n\n    return `\n${gradientGLSL}\n\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} field_velocity, ${vecType} velocity_proj) {\n    // Unpack position and FULL velocity components for user expression\n    ${varDecls.join('\\n    ')}\n\n    // Evaluate user expression\n    float value = ${expressionGLSL};\n\n    // Map through gradient\n    return evaluateGradient(value);\n}\n`;\n}\n\n/**\n * Generate gradient-based version of a preset color mode\n * @param {string} modeName - Name of the color mode\n * @param {number} dimensions - Number of dimensions\n * @param {string} gradientGLSL - Generated gradient function code\n * @returns {string} GLSL color function code\n */\nexport function generateGradientColorMode(modeName, dimensions, gradientGLSL) {\n    const vecType = `vec${dimensions}`;\n\n    let valueExpression;\n\n    switch (modeName) {\n        case 'velocity_magnitude':\n            valueExpression = `\n    // Use full N-dimensional velocity magnitude\n    float speed = length(velocity);\n    float normalized;\n    if (u_velocity_log_scale > 0.5) {\n        // Logarithmic scaling: log(1 + speed) / log(1 + max_velocity)\n        normalized = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        // Linear scaling\n        normalized = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n    return evaluateGradient(normalized);`;\n            break;\n\n        case 'velocity_angle':\n            valueExpression = `\n    // Use projected 2D velocity angle\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    return evaluateGradient(hue);`;\n            break;\n\n        case 'velocity_combined':\n            valueExpression = `\n    // Full velocity for magnitude, projected velocity for angle\n    float speed = length(velocity);\n    float angle = atan(velocity_proj.y, velocity_proj.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    float saturation;\n    if (u_velocity_log_scale > 0.5) {\n        // Logarithmic scaling: log(1 + speed) / log(1 + max_velocity)\n        saturation = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        // Linear scaling\n        saturation = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n\n    // Get color from gradient based on angle\n    vec3 fullColor = evaluateGradient(hue);\n\n    // Desaturate based on speed (slow \u2192 grey, fast \u2192 full color)\n    const vec3 grey = vec3(0.5, 0.5, 0.5);\n    return mix(grey, fullColor, saturation);`;\n            break;\n\n        case 'field_magnitude':\n            valueExpression = `\n    // Use field velocity magnitude\n    float speed = length(field_velocity);\n    float normalized;\n    if (u_velocity_log_scale > 0.5) {\n        normalized = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        normalized = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n    return evaluateGradient(normalized);`;\n            break;\n\n        case 'field_angle':\n            valueExpression = `\n    // Use field velocity angle in 2D\n    vec2 field_2d = vec2(field_velocity.x, field_velocity.y);\n    float angle = atan(field_2d.y, field_2d.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    return evaluateGradient(hue);`;\n            break;\n\n        case 'field_combined':\n            valueExpression = `\n    // Field velocity for both magnitude and angle\n    float speed = length(field_velocity);\n    vec2 field_2d = vec2(field_velocity.x, field_velocity.y);\n    float angle = atan(field_2d.y, field_2d.x);\n    float hue = (angle + 3.14159265) / (2.0 * 3.14159265);\n    float saturation;\n    if (u_velocity_log_scale > 0.5) {\n        saturation = clamp(log(1.0 + speed) / log(1.0 + max(u_max_velocity, 0.1)), 0.0, 1.0);\n    } else {\n        saturation = clamp(speed / max(u_max_velocity, 0.1), 0.0, 1.0);\n    }\n\n    vec3 fullColor = evaluateGradient(hue);\n    const vec3 grey = vec3(0.5, 0.5, 0.5);\n    return mix(grey, fullColor, saturation);`;\n            break;\n\n        default:\n            throw new Error(`Cannot create gradient version of color mode: ${modeName}`);\n    }\n\n    return `\n${gradientGLSL}\n\nvec3 getColor(${vecType} pos, ${vecType} velocity, ${vecType} field_velocity, ${vecType} velocity_proj) {\n    ${valueExpression}\n}\n`;\n}\n", "/**\n * Gradient generation for color mapping\n * Converts an array of color stops to GLSL interpolation code\n */\n\n/**\n * Generate GLSL code for a color gradient\n * @param {Array} stops - Array of {position: float [0,1], color: [r, g, b] in [0,1]}\n * @returns {string} GLSL function code\n */\nexport function generateGradientGLSL(stops) {\n    // Sort stops by position\n    const sortedStops = [...stops].sort((a, b) => a.position - b.position);\n\n    // Ensure we have at least 2 stops\n    if (sortedStops.length < 2) {\n        throw new Error('Gradient must have at least 2 color stops');\n    }\n\n    // Ensure positions are in [0, 1]\n    sortedStops.forEach(stop => {\n        if (stop.position < 0 || stop.position > 1) {\n            throw new Error(`Stop position must be in [0, 1], got ${stop.position}`);\n        }\n    });\n\n    // Generate piecewise linear interpolation code\n    let code = `vec3 evaluateGradient(float t) {\n    t = clamp(t, 0.0, 1.0);\n`;\n\n    // Generate if-else chain for each segment\n    for (let i = 0; i < sortedStops.length - 1; i++) {\n        const stop1 = sortedStops[i];\n        const stop2 = sortedStops[i + 1];\n\n        const color1 = formatColor(stop1.color);\n        const color2 = formatColor(stop2.color);\n        const pos1 = stop1.position.toFixed(6);\n        const pos2 = stop2.position.toFixed(6);\n\n        if (i === 0) {\n            code += `    if (t <= ${pos2}) {\\n`;\n        } else if (i === sortedStops.length - 2) {\n            code += `    } else {\\n`;\n        } else {\n            code += `    } else if (t <= ${pos2}) {\\n`;\n        }\n\n        // Linear interpolation between stops\n        code += `        float segmentT = (t - ${pos1}) / (${pos2} - ${pos1});\\n`;\n        code += `        return mix(${color1}, ${color2}, segmentT);\\n`;\n    }\n\n    code += `    }\\n`;\n    code += `}\\n`;\n\n    return code;\n}\n\n/**\n * Format a color array as GLSL vec3\n */\nfunction formatColor(color) {\n    return `vec3(${color[0].toFixed(6)}, ${color[1].toFixed(6)}, ${color[2].toFixed(6)})`;\n}\n\n/**\n * Create velocity magnitude gradient (blue \u2192 cyan \u2192 green \u2192 yellow \u2192 red)\n */\nexport function getVelocityMagnitudeGradient() {\n    return [\n        { position: 0.00, color: [0.0, 0.0, 1.0] }, // Blue\n        { position: 0.25, color: [0.0, 1.0, 1.0] }, // Cyan\n        { position: 0.50, color: [0.0, 1.0, 0.0] }, // Green\n        { position: 0.75, color: [1.0, 1.0, 0.0] }, // Yellow\n        { position: 1.00, color: [1.0, 0.0, 0.0] }  // Red\n    ];\n}\n\n/**\n * Create spectrum gradient (rainbow: red \u2192 orange \u2192 yellow \u2192 green \u2192 cyan \u2192 blue \u2192 violet)\n */\nexport function getSpectrumGradient() {\n    return [\n        { position: 0.00, color: [1.0, 0.0, 0.0] },   // Red\n        { position: 0.17, color: [1.0, 0.5, 0.0] },   // Orange\n        { position: 0.33, color: [1.0, 1.0, 0.0] },   // Yellow\n        { position: 0.50, color: [0.0, 1.0, 0.0] },   // Green\n        { position: 0.67, color: [0.0, 1.0, 1.0] },   // Cyan\n        { position: 0.83, color: [0.0, 0.0, 1.0] },   // Blue\n        { position: 1.00, color: [0.5, 0.0, 1.0] }    // Violet\n    ];\n}\n\n/**\n * Create HSV color wheel (for angle-based coloring, wraps around)\n * Red \u2192 Yellow \u2192 Green \u2192 Cyan \u2192 Blue \u2192 Magenta \u2192 back to Red\n */\nexport function getHSVGradient() {\n    return [\n        { position: 0.00, color: [1.0, 0.0, 0.0] },   // Red (0\u00B0)\n        { position: 0.17, color: [1.0, 1.0, 0.0] },   // Yellow (60\u00B0)\n        { position: 0.33, color: [0.0, 1.0, 0.0] },   // Green (120\u00B0)\n        { position: 0.50, color: [0.0, 1.0, 1.0] },   // Cyan (180\u00B0)\n        { position: 0.67, color: [0.0, 0.0, 1.0] },   // Blue (240\u00B0)\n        { position: 0.83, color: [1.0, 0.0, 1.0] },   // Magenta (300\u00B0)\n        { position: 1.00, color: [1.0, 0.0, 0.0] }    // Red (360\u00B0 = 0\u00B0, wraps)\n    ];\n}\n\n/**\n * Create default gradient (HSV color wheel, works for both angles and magnitudes)\n */\nexport function getDefaultGradient() {\n    return getHSVGradient();\n}\n\n/**\n * Convert hex color string to RGB array [0,1]\n */\nexport function hexToRgb(hex) {\n    // Remove # if present\n    hex = hex.replace('#', '');\n\n    const r = parseInt(hex.substring(0, 2), 16) / 255;\n    const g = parseInt(hex.substring(2, 4), 16) / 255;\n    const b = parseInt(hex.substring(4, 6), 16) / 255;\n\n    return [r, g, b];\n}\n\n/**\n * Convert RGB array [0,1] to hex color string\n */\nexport function rgbToHex(rgb) {\n    const r = Math.round(rgb[0] * 255).toString(16).padStart(2, '0');\n    const g = Math.round(rgb[1] * 255).toString(16).padStart(2, '0');\n    const b = Math.round(rgb[2] * 255).toString(16).padStart(2, '0');\n\n    return `#${r}${g}${b}`;\n}\n", "/**\n * Tone Mapping Operators\n * Compresses HDR [0, \u221E) color values into displayable LDR [0, 1] range\n */\n\n/**\n * Get tone mapping operator by name\n * @param {string} name - Operator name\n * @returns {Object} Operator definition with name, description, code generator\n */\nexport function getToneMapper(name) {\n    const operators = {\n        linear: {\n            name: 'Linear (No Tone Mapping)',\n            description: 'Direct exposure and gamma, no compression. Values > 1 will clip.',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        reinhard: {\n            name: 'Reinhard',\n            description: 'Simple, preserves hues. Formula: color / (1 + color)',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        reinhard_extended: {\n            name: 'Reinhard Extended',\n            description: 'Reinhard with adjustable white point for highlight control',\n            usesWhitePoint: true,\n            defaultExposure: 1.0,\n            defaultWhitePoint: 2.0\n        },\n        filmic: {\n            name: 'Filmic (ACES Approximation)',\n            description: 'Film-like S-curve, industry standard look',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        uncharted2: {\n            name: 'Uncharted 2',\n            description: 'Popular in games, punchy highlights and saturated colors',\n            usesWhitePoint: true,\n            defaultExposure: 2.0,\n            defaultWhitePoint: 11.2\n        },\n        aces: {\n            name: 'ACES (Academy Color)',\n            description: 'Academy standard, natural film-like response',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        hable: {\n            name: 'Hable (Uncharted 2 Filmic)',\n            description: 'John Hable\\'s filmic curve, excellent highlight rolloff',\n            usesWhitePoint: true,\n            defaultExposure: 2.0,\n            defaultWhitePoint: 11.2\n        },\n        luminance_reinhard: {\n            name: 'Luminance Reinhard (Hue Preserving)',\n            description: 'Tone maps brightness only, preserves color hue/saturation perfectly. Ideal for attractors.',\n            usesWhitePoint: false,\n            defaultExposure: 1.0\n        },\n        luminance_extended: {\n            name: 'Luminance Extended (Hue Preserving)',\n            description: 'Extended Reinhard on luminance only. Best for colorful attractor density visualization.',\n            usesWhitePoint: true,\n            defaultExposure: 1.0,\n            defaultWhitePoint: 5.0\n        }\n    };\n\n    return operators[name] || operators.linear;\n}\n\n/**\n * Generate GLSL code for tone mapping operator\n * @param {string} operatorName - Name of the operator\n * @param {Object} params - Parameters (exposure, gamma, whitePoint, luminanceGamma, etc.)\n * @returns {string} GLSL shader code\n */\nexport function generateTonemapGLSL(operatorName, params = {}) {\n    const operator = getToneMapper(operatorName);\n\n    // Default parameters\n    const exposure = params.exposure !== undefined ? params.exposure : operator.defaultExposure;\n    const gamma = params.gamma !== undefined ? params.gamma : 2.2;\n    const whitePoint = params.whitePoint !== undefined ? params.whitePoint : (operator.defaultWhitePoint || 1.0);\n    const luminanceGamma = params.luminanceGamma !== undefined ? params.luminanceGamma : 1.0;\n\n    let code = `\n// Tone mapping operator: ${operator.name}\n// ${operator.description}\n\n`;\n\n    // Generate operator-specific functions\n    switch (operatorName) {\n        case 'linear':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Simple exposure, no compression\n    return color * ${exposure.toFixed(6)};\n}\n`;\n            break;\n\n        case 'reinhard':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Reinhard tone mapping: color / (1 + color)\n    color *= ${exposure.toFixed(6)};\n    return color / (vec3(1.0) + color);\n}\n`;\n            break;\n\n        case 'reinhard_extended':\n            code += `\nvec3 tonemap(vec3 color) {\n    // Reinhard with white point\n    color *= ${exposure.toFixed(6)};\n    float whitePoint = ${whitePoint.toFixed(6)};\n    vec3 numerator = color * (vec3(1.0) + (color / (whitePoint * whitePoint)));\n    return numerator / (vec3(1.0) + color);\n}\n`;\n            break;\n\n        case 'filmic':\n        case 'aces':\n            code += `\n// ACES approximation (simplified)\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // ACES fitted curve\n    const float a = 2.51;\n    const float b = 0.03;\n    const float c = 2.43;\n    const float d = 0.59;\n    const float e = 0.14;\n\n    return clamp((color * (a * color + b)) / (color * (c * color + d) + e), 0.0, 1.0);\n}\n`;\n            break;\n\n        case 'uncharted2':\n        case 'hable':\n            code += `\n// Uncharted 2 filmic tone mapping by John Hable\nvec3 uncharted2Curve(vec3 x) {\n    const float A = 0.15; // Shoulder strength\n    const float B = 0.50; // Linear strength\n    const float C = 0.10; // Linear angle\n    const float D = 0.20; // Toe strength\n    const float E = 0.02; // Toe numerator\n    const float F = 0.30; // Toe denominator\n    return ((x * (A * x + C * B) + D * E) / (x * (A * x + B) + D * F)) - E / F;\n}\n\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Apply curve\n    vec3 curr = uncharted2Curve(color);\n\n    // White point scaling\n    float whitePoint = ${whitePoint.toFixed(6)};\n    vec3 whiteScale = vec3(1.0) / uncharted2Curve(vec3(whitePoint));\n\n    return curr * whiteScale;\n}\n`;\n            break;\n\n        case 'luminance_reinhard':\n            code += `\n// Luminance-based Reinhard (hue-preserving)\n// Tone maps brightness only, keeps color ratios intact\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Apply Reinhard to luminance only\n    float toneMappedLuma = luma / (1.0 + luma);\n\n    // Scale color to match tone-mapped luminance\n    // This preserves hue and saturation perfectly\n    return color * (toneMappedLuma / luma);\n}\n`;\n            break;\n\n        case 'luminance_extended':\n            code += `\n// Luminance-based Extended Reinhard (hue-preserving)\n// Best for attractor visualization with dense bright regions\nvec3 tonemap(vec3 color) {\n    color *= ${exposure.toFixed(6)};\n\n    // Calculate luminance (Rec. 709)\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Extended Reinhard with white point on luminance only\n    float whitePoint = ${whitePoint.toFixed(6)};\n    float numerator = luma * (1.0 + (luma / (whitePoint * whitePoint)));\n    float toneMappedLuma = numerator / (1.0 + luma);\n\n    // Scale color to match tone-mapped luminance\n    // This preserves hue and saturation perfectly\n    return color * (toneMappedLuma / luma);\n}\n`;\n            break;\n\n        default:\n            // Fallback to linear\n            code += `\nvec3 tonemap(vec3 color) {\n    return color * ${exposure.toFixed(6)};\n}\n`;\n    }\n\n    // Add gamma correction\n    code += `\nvec3 applyGamma(vec3 color) {\n    return pow(color, vec3(1.0 / ${gamma.toFixed(6)}));\n}\n\nvec3 applyLuminanceGamma(vec3 color) {\n    // Luminance-preserving gamma: adjusts brightness only, preserves hue\n    float luma = dot(color, vec3(0.2126, 0.7152, 0.0722));\n\n    // Avoid division by zero\n    if (luma < 0.0001) return vec3(0.0);\n\n    // Apply gamma to luminance only\n    float gammaCorrectedLuma = pow(luma, 1.0 / ${luminanceGamma.toFixed(6)});\n\n    // Scale color to match gamma-corrected luminance\n    // This preserves hue and saturation perfectly\n    return color * (gammaCorrectedLuma / luma);\n}\n`;\n\n    return code;\n}\n\n/**\n * Get list of all available operators\n * @returns {Array} Array of {key, name, description} objects\n */\nexport function getAvailableOperators() {\n    return [\n        { key: 'linear', name: 'Linear (No Tone Mapping)', description: 'Direct mapping, clips at 1.0' },\n        { key: 'reinhard', name: 'Reinhard', description: 'Simple, preserves hues' },\n        { key: 'reinhard_extended', name: 'Reinhard Extended', description: 'With white point control' },\n        { key: 'luminance_reinhard', name: 'Luminance Reinhard', description: 'Hue-preserving, ideal for attractors' },\n        { key: 'luminance_extended', name: 'Luminance Extended', description: 'Best for colorful attractor visualization' },\n        { key: 'filmic', name: 'Filmic (ACES)', description: 'Film-like, industry standard' },\n        { key: 'uncharted2', name: 'Uncharted 2', description: 'Game-style, punchy' },\n        { key: 'aces', name: 'ACES', description: 'Academy standard' },\n        { key: 'hable', name: 'Hable Filmic', description: 'Excellent highlights' }\n    ];\n}\n\n/**\n * Calculate luminance from RGB color\n * Used for exposure adjustment\n * @param {Array} rgb - [r, g, b] in [0, 1]\n * @returns {number} Luminance value\n */\nexport function luminance(rgb) {\n    // Rec. 709 luma coefficients\n    return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2];\n}\n", "/**\n * Base class for coordinate storage strategies\n * Defines the interface that all strategies must implement\n */\nexport class CoordinateStrategy {\n    constructor(gl) {\n        this.gl = gl;\n    }\n\n    /**\n     * Get the WebGL texture format configuration\n     * @returns {{internalFormat: number, format: number, type: number}}\n     */\n    getTextureFormat() {\n        throw new Error('getTextureFormat() must be implemented by subclass');\n    }\n\n    /**\n     * Get the JavaScript array type for storing data\n     * @returns {TypedArrayConstructor} (e.g., Uint8Array or Float32Array)\n     */\n    getArrayType() {\n        throw new Error('getArrayType() must be implemented by subclass');\n    }\n\n    /**\n     * Get the number of components per value\n     * @returns {number} (e.g., 4 for RGBA, 1 for single float)\n     */\n    getComponentsPerValue() {\n        throw new Error('getComponentsPerValue() must be implemented by subclass');\n    }\n\n    /**\n     * Check if this strategy requires a WebGL extension\n     * @returns {boolean}\n     */\n    requiresExtension() {\n        return false;\n    }\n\n    /**\n     * Get the required WebGL extension name (if any)\n     * @returns {string|null}\n     */\n    getExtensionName() {\n        return null;\n    }\n\n    /**\n     * Encode a world coordinate value for storage\n     * @param {number} worldValue - Value in world coordinates\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {TypedArray} Encoded value as array (length = getComponentsPerValue())\n     */\n    encodeValue(worldValue, min, max) {\n        throw new Error('encodeValue() must be implemented by subclass');\n    }\n\n    /**\n     * Decode a stored value back to world coordinates\n     * @param {TypedArray|Array} buffer - Encoded value\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} World coordinate value\n     */\n    decodeValue(buffer, min, max) {\n        throw new Error('decodeValue() must be implemented by subclass');\n    }\n\n    /**\n     * Normalize world coordinate to storage space\n     * For RGBA: normalize to [0, 1]\n     * For Float: might just return as-is\n     * @param {number} worldValue - Value in world coordinates\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} Normalized value\n     */\n    normalizeWorld(worldValue, min, max) {\n        throw new Error('normalizeWorld() must be implemented by subclass');\n    }\n\n    /**\n     * Denormalize from storage space to world coordinates\n     * @param {number} storageValue - Value from storage\n     * @param {number} min - Minimum world coordinate\n     * @param {number} max - Maximum world coordinate\n     * @returns {number} World coordinate value\n     */\n    denormalizeWorld(storageValue, min, max) {\n        throw new Error('denormalizeWorld() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL constant definitions needed by this strategy\n     * @returns {string} GLSL code\n     */\n    getGLSLConstants() {\n        throw new Error('getGLSLConstants() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL decode function\n     * Converts from texture RGBA to float value\n     * @returns {string} GLSL code\n     */\n    getGLSLDecodeFunction() {\n        throw new Error('getGLSLDecodeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL encode function\n     * Converts from float value to RGBA for texture storage\n     * @returns {string} GLSL code\n     */\n    getGLSLEncodeFunction() {\n        throw new Error('getGLSLEncodeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL normalize function\n     * Converts world coordinates to storage space\n     * @returns {string} GLSL code\n     */\n    getGLSLNormalizeFunction() {\n        throw new Error('getGLSLNormalizeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get GLSL denormalize function\n     * Converts from storage space to world coordinates\n     * @returns {string} GLSL code\n     */\n    getGLSLDenormalizeFunction() {\n        throw new Error('getGLSLDenormalizeFunction() must be implemented by subclass');\n    }\n\n    /**\n     * Get a human-readable name for this strategy\n     * @returns {string}\n     */\n    getName() {\n        throw new Error('getName() must be implemented by subclass');\n    }\n}\n", "/**\n * RGBA-encoded coordinate storage strategy\n * Uses 32-bit fixed-point encoding to store floats as RGBA bytes\n *\n * Provides maximum compatibility with all WebGL devices, including those\n * without floating-point texture support.\n *\n * ENCODING:\n * - World coordinates normalized to [0, 1] relative to viewport bounds\n * - Normalized value mapped to 32-bit integer using scale factor 2^32 - 1\n * - Integer split into 4 bytes (RGBA) using big-endian byte order\n * - Provides approximately 32 bits of precision per coordinate\n *\n * PRECISION:\n * - ~8 bits per RGBA channel, combined to 32-bit fixed-point\n * - Slightly lower precision than native float textures (~23 bits mantissa)\n * - Very minor quantization artifacts may appear in extreme zoom scenarios\n * - Negligible for typical visualization use cases\n *\n * PERFORMANCE:\n * - No extension requirements, works on all devices\n * - Small encoding/decoding overhead in shaders\n * - Recommended for maximum compatibility\n *\n * COMPARISON TO FLOAT STRATEGY:\n * - FloatStrategy provides higher precision (~23-bit mantissa, direct storage)\n * - RGBAStrategy has wider device compatibility (no extension required)\n * - Both strategies produce visually identical results for most systems\n */\n\nimport { CoordinateStrategy } from '../coordinate-strategy.js';\nimport { encodeFloatRGBA, decodeFloatRGBA } from '../../utils/float-packing.js';\n\nexport class RGBAStrategy extends CoordinateStrategy {\n    constructor(gl) {\n        super(gl);\n    }\n\n    getName() {\n        return 'RGBA Fixed-Point Encoding';\n    }\n\n    getTextureFormat() {\n        const gl = this.gl;\n        return {\n            internalFormat: gl.RGBA,\n            format: gl.RGBA,\n            type: gl.UNSIGNED_BYTE\n        };\n    }\n\n    getArrayType() {\n        return Uint8Array;\n    }\n\n    getComponentsPerValue() {\n        return 4; // RGBA = 4 bytes per encoded float\n    }\n\n    requiresExtension() {\n        return false; // RGBA UNSIGNED_BYTE always supported\n    }\n\n    getExtensionName() {\n        return null;\n    }\n\n    encodeValue(worldValue, min, max) {\n        // Normalize world value to [0, 1]\n        const normalized = (worldValue - min) / (max - min);\n\n        // Encode to RGBA bytes\n        const buffer = new Uint8Array(4);\n        encodeFloatRGBA(normalized, buffer, 0);\n\n        return buffer;\n    }\n\n    decodeValue(buffer, min, max) {\n        // Decode RGBA bytes to [0, 1]\n        const normalized = decodeFloatRGBA(buffer[0], buffer[1], buffer[2], buffer[3]);\n\n        // Denormalize to world coordinates\n        return min + normalized * (max - min);\n    }\n\n    normalizeWorld(worldValue, min, max) {\n        return (worldValue - min) / (max - min);\n    }\n\n    denormalizeWorld(normalized, min, max) {\n        return min + normalized * (max - min);\n    }\n\n    getGLSLConstants() {\n        return `\n// Map to [0, 1] range for maximum precision at any zoom level\nconst float FIXED_POINT_SCALE = 4294967295.0; // 2^32 - 1\n`;\n    }\n\n    getGLSLDecodeFunction() {\n        return `\n// Decode RGBA bytes back to float in [0, 1] range\nfloat decodeFloat(vec4 rgba) {\n    // Reconstruct 32-bit integer from bytes (big-endian)\n    vec4 bytes = rgba * 255.0;\n    float intValue = bytes.r * 16777216.0 + bytes.g * 65536.0 + bytes.b * 256.0 + bytes.a;\n\n    // Map from [0, 2^32-1] back to [0, 1]\n    return intValue / FIXED_POINT_SCALE;\n}\n`;\n    }\n\n    getGLSLEncodeFunction() {\n        return `\n// Encode float in [0, 1] range to RGBA bytes\nvec4 encodeFloat(float v) {\n    // Clamp to [0, 1]\n    v = clamp(v, 0.0, 1.0);\n\n    // Map to [0, 2^32-1]\n    float normalized = v * FIXED_POINT_SCALE;\n\n    // Split into 4 bytes (big-endian)\n    float byte0 = floor(normalized / 16777216.0);  // 2^24\n    normalized -= byte0 * 16777216.0;\n    float byte1 = floor(normalized / 65536.0);      // 2^16\n    normalized -= byte1 * 65536.0;\n    float byte2 = floor(normalized / 256.0);        // 2^8\n    normalized -= byte2 * 256.0;\n    float byte3 = floor(normalized);\n\n    return vec4(byte0, byte1, byte2, byte3) / 255.0;\n}\n`;\n    }\n\n    getGLSLNormalizeFunction() {\n        return `\n// Helper to normalize world coordinate to [0, 1] relative to viewport\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return (worldValue - minVal) / (maxVal - minVal);\n}\n`;\n    }\n\n    getGLSLDenormalizeFunction() {\n        return `\n// Helper to denormalize from [0, 1] back to world coordinates\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return minVal + normalized * (maxVal - minVal);\n}\n`;\n    }\n}\n", "/**\n * Float texture coordinate storage strategy\n * Stores coordinates directly as floats without encoding\n * Requires OES_texture_float extension (available on most modern devices)\n */\n\nimport { CoordinateStrategy } from '../coordinate-strategy.js';\nimport { logger } from '../../utils/debug-logger.js';\n\nexport class FloatStrategy extends CoordinateStrategy {\n    constructor(gl) {\n        super(gl);\n\n        // Check for float texture support\n        const ext = gl.getExtension('OES_texture_float');\n        if (!ext) {\n            throw new Error('OES_texture_float extension not supported');\n        }\n\n        logger.info('Float texture support detected', {\n            extension: 'OES_texture_float'\n        });\n    }\n\n    getName() {\n        return 'Float Textures (Direct Storage)';\n    }\n\n    getTextureFormat() {\n        const gl = this.gl;\n        return {\n            internalFormat: gl.RGBA,\n            format: gl.RGBA,\n            type: gl.FLOAT\n        };\n    }\n\n    getArrayType() {\n        return Float32Array;\n    }\n\n    getComponentsPerValue() {\n        // Store float in RGBA.r, leave g,b,a unused\n        return 4;\n    }\n\n    requiresExtension() {\n        return true;\n    }\n\n    getExtensionName() {\n        return 'OES_texture_float';\n    }\n\n    encodeValue(worldValue, min, max) {\n        // No encoding needed! Store world coordinate directly\n        // But pack into RGBA format: [worldValue, 0, 0, 1]\n        const buffer = new Float32Array(4);\n        buffer[0] = worldValue;\n        buffer[1] = 0;\n        buffer[2] = 0;\n        buffer[3] = 1;\n        return buffer;\n    }\n\n    decodeValue(buffer, min, max) {\n        // No decoding needed! Just return the value directly\n        return buffer[0];\n    }\n\n    normalizeWorld(worldValue, min, max) {\n        // No normalization needed for float textures\n        return worldValue;\n    }\n\n    denormalizeWorld(storageValue, min, max) {\n        // No denormalization needed for float textures\n        return storageValue;\n    }\n\n    getGLSLConstants() {\n        return `\n// Float strategy: no constants needed\n`;\n    }\n\n    getGLSLDecodeFunction() {\n        return `\n// Decode float from RGBA - just read the red channel directly\nfloat decodeFloat(vec4 rgba) {\n    return rgba.r;\n}\n`;\n    }\n\n    getGLSLEncodeFunction() {\n        return `\n// Encode float to RGBA - store in red channel\nvec4 encodeFloat(float v) {\n    return vec4(v, 0.0, 0.0, 1.0);\n}\n`;\n    }\n\n    getGLSLNormalizeFunction() {\n        return `\n// Float strategy: no normalization needed, pass through directly\nfloat normalizeToViewport(float worldValue, float minVal, float maxVal) {\n    return worldValue;\n}\n`;\n    }\n\n    getGLSLDenormalizeFunction() {\n        return `\n// Float strategy: no denormalization needed, pass through directly\nfloat denormalizeFromViewport(float normalized, float minVal, float maxVal) {\n    return normalized;\n}\n`;\n    }\n}\n", "/**\n * Base classes for UI controls with automatic save/restore\n */\n\nimport { CoordinateSystem } from '../math/coordinate-systems.js';\n\n/**\n * Base Control class\n * All controls must implement getValue() and setValue()\n */\nexport class Control {\n    constructor(id, defaultValue, options = {}) {\n        this.id = id;\n        this.defaultValue = defaultValue;\n        this.settingsKey = options.settingsKey || id; // Key used in settings object\n        this.onChange = options.onChange || null; // Callback when value changes\n        this.element = null; // Will be set when attaching listeners\n    }\n\n    /**\n     * Get current value from DOM\n     * Must be implemented by subclasses\n     */\n    getValue() {\n        throw new Error('getValue() must be implemented by subclass');\n    }\n\n    /**\n     * Set value in DOM\n     * Must be implemented by subclasses\n     */\n    setValue(value) {\n        throw new Error('setValue() must be implemented by subclass');\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n\n    /**\n     * Attach event listeners\n     * Must be implemented by subclasses\n     */\n    attachListeners(callback) {\n        throw new Error('attachListeners() must be implemented by subclass');\n    }\n\n    /**\n     * Get mouse position relative to an element\n     * Converts page coordinates to element-local coordinates\n     * @param {MouseEvent} event - The mouse event\n     * @param {jQuery|HTMLElement} element - The element to get coordinates relative to\n     * @returns {{x: number, y: number}} - Position relative to element's top-left corner\n     */\n    getMousePositionInElement(event, element) {\n        const $element = $(element);\n        const offset = $element.offset();\n        return {\n            x: event.pageX - offset.left,\n            y: event.pageY - offset.top\n        };\n    }\n\n    /**\n     * Handle button action (increment/decrement)\n     * Can be overridden by subclasses for custom behavior\n     * @param {string} action - 'increase', 'decrease', 'increase-large', 'decrease-large', 'reset'\n     * @returns {boolean} True if action was handled\n     */\n    handleButtonAction(action) {\n        // Default implementation: no button support\n        return false;\n    }\n\n    /**\n     * Save current value to settings object\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore value from settings object\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] != null) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n/**\n * Linear slider control\n */\nexport class SliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0;\n        this.max = options.max || 100;\n        this.step = options.step || 1;\n        this.displayId = options.displayId || null; // Optional display element ID\n        this.displayFormat = options.displayFormat || (v => v.toFixed(2)); // Format function\n        // Transform functions for value conversion (e.g., slider value \u2192 actual value)\n        this.transform = options.transform || (v => v); // slider \u2192 setting\n        this.inverseTransform = options.inverseTransform || (v => v); // setting \u2192 slider\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        // Apply transform to get actual setting value\n        return this.transform(sliderValue);\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        // Apply inverse transform to get slider value\n        const sliderValue = this.inverseTransform(value);\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            // Display shows the actual value, not the slider value\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n        const step = parseFloat(element.attr('step')) || this.step;\n\n        let increment = step;\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = step * 10;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        } else if (action === 'reset') {\n            newValue = this.inverseTransform(this.defaultValue);\n        } else {\n            return false; // Unknown action\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        // Handle both input and change events for better browser compatibility\n        const handler = () => {\n            const value = this.getValue(); // Gets transformed value\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        };\n\n        element.on('input change', handler);\n    }\n}\n\n/**\n * Logarithmic slider control\n * Slider position is linear [0-100], but value is logarithmic [minValue-maxValue]\n */\nexport class LogSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.minValue = options.minValue || 0.01;\n        this.maxValue = options.maxValue || 100.0;\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(3));\n    }\n\n    /**\n     * Convert linear slider position [0, 100] to logarithmic value\n     */\n    linearToLog(sliderValue) {\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        return Math.exp(minLog + scale * sliderValue);\n    }\n\n    /**\n     * Convert logarithmic value to linear slider position [0, 100]\n     */\n    logToLinear(actualValue) {\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        return (Math.log(actualValue) - minLog) / scale;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        return this.linearToLog(sliderValue);\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        const sliderValue = this.logToLinear(value);\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentSliderValue = parseFloat(element.val());\n        const min = 0;\n        const max = 100;\n\n        // Increment in slider space (0-100)\n        // Use smaller increments for logarithmic sliders since they're already non-linear\n        let increment = 1.0;  // Small step\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = 10.0;  // Large step\n        }\n\n        let newSliderValue = currentSliderValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newSliderValue = Math.min(max, currentSliderValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newSliderValue = Math.max(min, currentSliderValue - increment);\n        } else if (action === 'reset') {\n            newSliderValue = this.logToLinear(this.defaultValue);\n        } else {\n            return false;\n        }\n\n        if (newSliderValue !== currentSliderValue) {\n            element.val(newSliderValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // LogSlider uses internal 0-100 range for linear slider position\n        element.attr('min', 0);\n        element.attr('max', 100);\n        element.attr('step', 0.1);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Text input control\n */\nexport class TextControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.trim = options.trim !== undefined ? options.trim : true;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        let value = element.val();\n        if (this.trim) value = value.trim();\n        return value;\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Dropdown/select control\n */\nexport class SelectControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const value = element.val();\n        // Return defaultValue if element returns null/undefined\n        return value != null ? value : this.defaultValue;\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('change', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Checkbox control\n */\nexport class CheckboxControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return element.prop('checked');\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.prop('checked', value);\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('change', () => {\n            const value = this.getValue();\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Percentage slider control\n * Slider shows 0-100, but value is stored as 0.0-1.0\n */\nexport class PercentSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0;\n        this.max = options.max || 100;\n        this.step = options.step || 0.1;\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(2));\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        const sliderValue = parseFloat(element.val());\n        return sliderValue / 100.0; // Convert to 0.0-1.0\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        const sliderValue = value * 100.0; // Convert to 0-100\n        element.val(sliderValue);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentSliderValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n        const step = parseFloat(element.attr('step')) || this.step;\n\n        let increment = step;\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = step * 10;\n        }\n\n        let newSliderValue = currentSliderValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newSliderValue = Math.min(max, currentSliderValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newSliderValue = Math.max(min, currentSliderValue - increment);\n        } else if (action === 'reset') {\n            newSliderValue = this.defaultValue * 100.0; // Convert to slider space\n        } else {\n            return false;\n        }\n\n        if (newSliderValue !== currentSliderValue) {\n            element.val(newSliderValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Adaptive slider control\n * Increment is always one order of magnitude less than current value\n * E.g., value=10-99 \u2192 increment=1; value=1-9.9 \u2192 increment=0.1; etc.\n */\nexport class AdaptiveSliderControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0.001;\n        this.max = options.max || 100;\n        this.minIncrement = options.minIncrement || 0.0001; // Minimum allowed increment\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(4));\n    }\n\n    /**\n     * Calculate increment based on current value\n     * Returns 10^(floor(log10(|value|)) - 1)\n     */\n    calculateIncrement(value) {\n        const absValue = Math.abs(value);\n\n        // Handle edge cases\n        if (absValue < this.minIncrement) {\n            return this.minIncrement;\n        }\n\n        // Calculate order of magnitude\n        const orderOfMagnitude = Math.floor(Math.log10(absValue));\n        const increment = Math.pow(10, orderOfMagnitude - 1);\n\n        // Ensure we don't go below minimum\n        return Math.max(this.minIncrement, increment);\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n\n        let increment = this.calculateIncrement(currentValue);\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment *= 10;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        } else if (action === 'reset') {\n            newValue = this.defaultValue;\n        } else {\n            return false;\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return parseFloat(element.val());\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        // Adaptive sliders use a very small step for smooth adjustment\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.minIncrement);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n\n/**\n * Timestep slider control with custom increment buttons\n * Has --, -, +, ++ buttons with different increment sizes\n */\nexport class TimestepControl extends Control {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n        this.min = options.min || 0.001;\n        this.max = options.max || 2.5;\n        this.step = options.step || 0.001;\n        this.smallIncrement = options.smallIncrement || 0.001;  // - and + buttons\n        this.largeIncrement = options.largeIncrement || 0.01;   // -- and ++ buttons\n        this.displayId = options.displayId || null;\n        this.displayFormat = options.displayFormat || (v => v.toFixed(3));\n    }\n\n    getValue() {\n        const element = $(`#${this.id}`);\n        return parseFloat(element.val());\n    }\n\n    setValue(value) {\n        const element = $(`#${this.id}`);\n        element.val(value);\n        this.updateDisplay(value);\n    }\n\n    updateDisplay(value) {\n        if (this.displayId) {\n            $(`#${this.displayId}`).text(this.displayFormat(value));\n        }\n    }\n\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = parseFloat(element.val());\n        const min = parseFloat(element.attr('min'));\n        const max = parseFloat(element.attr('max'));\n\n        let increment;\n        if (action === 'increase' || action === 'decrease') {\n            increment = this.smallIncrement;\n        } else if (action === 'increase-large' || action === 'decrease-large') {\n            increment = this.largeIncrement;\n        } else if (action === 'reset') {\n            const newValue = this.defaultValue;\n            if (newValue !== currentValue) {\n                element.val(newValue).trigger('input');\n                return true;\n            }\n            return false;\n        } else {\n            return false;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(max, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(min, currentValue - increment);\n        }\n\n        if (newValue !== currentValue) {\n            element.val(newValue).trigger('input');\n            return true;\n        }\n        return false;\n    }\n\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n\n        // Set slider attributes from JavaScript (single source of truth)\n        element.attr('min', this.min);\n        element.attr('max', this.max);\n        element.attr('step', this.step);\n\n        // Set initial value (will be overridden by restoreFromSettings if settings exist)\n        this.setValue(this.defaultValue);\n\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n}\n/**\n * Animatable Slider Control\n * Extends SliderControl with animation bounds that interpolate with alpha\n */\nexport class AnimatableSliderControl extends SliderControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n\n        // Animation state\n        this.animationEnabled = false;\n        this.animationMin = options.animationMin !== undefined ? options.animationMin : this.transform(this.min);\n        this.animationMax = options.animationMax !== undefined ? options.animationMax : this.transform(this.max);\n        this.currentAlpha = 0.0;\n    }\n\n    /**\n     * Enable/disable animation for this control\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = min;\n        this.animationMax = max;\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n        this.setValue(value);\n\n        // Update the main slider visual state\n        const element = $(`#${this.id}`);\n        element.addClass('animating');\n    }\n\n    /**\n     * Update the UI to show/hide animation controls\n     */\n    updateAnimationUI() {\n        const boundsContainer = $(`#${this.id}-animation-bounds`);\n        const slider = $(`#${this.id}`);\n        const animBtn = $(`#${this.id}-anim-btn`);\n\n        if (this.animationEnabled) {\n            boundsContainer.slideDown(200);\n            slider.addClass('animating');\n            animBtn.addClass('active');\n            animBtn.attr('title', 'Disable animation');\n        } else {\n            boundsContainer.slideUp(200);\n            slider.removeClass('animating');\n            animBtn.removeClass('active');\n            animBtn.attr('title', 'Enable animation');\n        }\n    }\n\n    /**\n     * Override attach listeners to add animation controls\n     */\n    attachListeners(callback) {\n        // Call parent to attach basic slider listeners\n        super.attachListeners(callback);\n\n        const element = $(`#${this.id}`);\n        const container = element.closest('.slider-control');\n\n        // Add animation button\n        const animBtn = $('<button>')\n            .attr('id', `${this.id}-anim-btn`)\n            .addClass('slider-btn anim-btn')\n            .attr('title', 'Enable animation')\n            .html('\uD83C\uDFAC')\n            .on('click', (e) => {\n                e.stopPropagation();\n                this.setAnimationEnabled(!this.animationEnabled);\n            });\n\n        container.append(animBtn);\n\n        // Add animation bounds container (initially hidden)\n        const boundsHTML = `\n            <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds\" style=\"display: none;\">\n                <div class=\"bounds-row\">\n                    <label>Min: <input type=\"number\" id=\"${this.id}-anim-min\" step=\"any\" value=\"${this.animationMin}\"/></label>\n                    <label>Max: <input type=\"number\" id=\"${this.id}-anim-max\" step=\"any\" value=\"${this.animationMax}\"/></label>\n                </div>\n            </div>\n        `;\n        container.after(boundsHTML);\n\n        // Attach listeners to bound inputs\n        $(`#${this.id}-anim-min`).on('input', () => {\n            this.animationMin = parseFloat($(`#${this.id}-anim-min`).val());\n        });\n\n        $(`#${this.id}-anim-max`).on('input', () => {\n            this.animationMax = parseFloat($(`#${this.id}-anim-max`).val());\n        });\n    }\n\n    /**\n     * Save animation state to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore animation state from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            // Update UI inputs\n            $(`#${this.id}-anim-min`).val(this.animationMin);\n            $(`#${this.id}-anim-max`).val(this.animationMax);\n\n            this.updateAnimationUI();\n        }\n    }\n}\n\n/**\n * Control Manager\n * Manages a collection of controls with automatic save/restore\n */\nexport class ControlManager {\n    constructor(options = {}) {\n        this.controls = new Map(); // id -> Control instance\n        this.storageKey = options.storageKey || 'settings';\n        this.onApply = options.onApply || null; // Called when settings should be applied\n        this.debounceTime = options.debounceTime || 300;\n        this.applyTimeout = null;\n        this.renderer = options.renderer || null; // Renderer instance for coordinate system handling\n    }\n\n    /**\n     * Register a control\n     */\n    register(control) {\n        this.controls.set(control.id, control);\n        return control;\n    }\n\n    /**\n     * Register multiple controls\n     */\n    registerAll(controls) {\n        controls.forEach(control => this.register(control));\n    }\n\n    /**\n     * Initialize all controls (create DOM elements)\n     */\n    initializeControls() {\n        const debouncedCallback = () => this.debouncedApply();\n\n        for (const control of this.controls.values()) {\n            control.attachListeners(debouncedCallback);\n        }\n    }\n\n    /**\n     * Attach event listeners to all controls\n     * @deprecated Use initializeControls() instead\n     */\n    attachAllListeners() {\n        this.initializeControls();\n    }\n\n    /**\n     * Apply settings to all controls\n     */\n    applySettings(settings) {\n        this.setSettings(settings);\n    }\n\n    /**\n     * Get a control by ID\n     */\n    get(id) {\n        return this.controls.get(id);\n    }\n\n    /**\n     * Get current settings from all controls\n     */\n    getSettings() {\n        const settings = {};\n        for (const control of this.controls.values()) {\n            control.saveToSettings(settings);\n        }\n        return settings;\n    }\n\n    /**\n     * Apply settings to all controls\n     */\n    setSettings(settings) {\n        // Handle coordinate system first (if present in settings and dimensions match)\n        if (settings.coordinateSystem && settings.dimensions) {\n            try {\n                const coordSystemData = settings.coordinateSystem;\n                const coordinateSystem = CoordinateSystem.fromJSON(coordSystemData);\n\n                // Validate that coordinate system dimensions match settings dimensions\n                if (coordinateSystem.dimensions === settings.dimensions) {\n                    if (this.renderer) {\n                        this.renderer.coordinateSystem = coordinateSystem;\n                    }\n\n                    // Update dimension inputs UI to reflect coordinate variables\n                    const expressionsControl = this.get('dimension-inputs');\n                    if (expressionsControl && expressionsControl.setCoordinateSystem) {\n                        expressionsControl.setCoordinateSystem(coordinateSystem, false);\n                    }\n                }\n            } catch (error) {\n                console.error('Failed to restore coordinate system from settings:', error);\n            }\n        }\n\n        // First, restore all values\n        for (const control of this.controls.values()) {\n            control.restoreFromSettings(settings);\n        }\n\n        // Then, trigger onChange callbacks to update dependent controls\n        // This ensures all controls are in their correct state before triggering changes\n        for (const control of this.controls.values()) {\n            if (control.onChange && settings && settings[control.settingsKey] !== undefined) {\n                control.onChange(control.getValue());\n            }\n        }\n    }\n\n    /**\n     * Reset all controls to defaults\n     */\n    resetAll() {\n        for (const control of this.controls.values()) {\n            control.reset();\n        }\n    }\n\n    /**\n     * Save settings to localStorage\n     */\n    saveToStorage() {\n        const settings = this.getSettings();\n        localStorage.setItem(this.storageKey, JSON.stringify(settings));\n        return settings;\n    }\n\n    /**\n     * Load settings from localStorage\n     */\n    loadFromStorage() {\n        try {\n            const saved = localStorage.getItem(this.storageKey);\n            if (saved) {\n                const settings = JSON.parse(saved);\n                this.setSettings(settings);\n                return settings;\n            }\n        } catch (e) {\n            console.warn('Failed to load settings from localStorage:', e);\n        }\n        return null;\n    }\n\n    /**\n     * Clear settings from localStorage\n     */\n    clearStorage() {\n        localStorage.removeItem(this.storageKey);\n    }\n\n    /**\n     * Debounced apply function\n     */\n    debouncedApply() {\n        if (this.applyTimeout) {\n            clearTimeout(this.applyTimeout);\n        }\n        this.applyTimeout = setTimeout(() => {\n            if (this.onApply) {\n                const settings = this.getSettings();\n                this.onApply(settings);\n            }\n        }, this.debounceTime);\n    }\n\n    /**\n     * Immediate apply (no debounce)\n     */\n    apply() {\n        if (this.onApply) {\n            const settings = this.getSettings();\n            this.onApply(settings);\n        }\n    }\n}\n", "/**\n * Shared utility functions for UI controls\n * Formatting, scale inference, increment calculation, etc.\n */\n\n/**\n * Create a scientific notation formatter\n * @param {number} precision - Number of decimal places in scientific notation\n * @param {number} threshold - Threshold for switching to scientific notation (default: 10)\n * @returns {function(number): string}\n */\nexport function createScientificFormatter(precision = 2, threshold = 10) {\n    return (v) => {\n        const absV = Math.abs(v);\n        if (absV >= threshold || (absV < 1.0 / threshold && absV !== 0)) {\n            return v.toExponential(precision);\n        } else {\n            return v.toFixed(precision + 1);\n        }\n    };\n}\n\n/**\n * Create a decimal formatter\n * @param {number} precision - Number of decimal places\n * @returns {function(number): string}\n */\nexport function createDecimalFormatter(precision = 2) {\n    return (v) => v.toFixed(precision);\n}\n\n/**\n * Create an integer formatter\n * @returns {function(number): string}\n */\nexport function createIntegerFormatter() {\n    return (v) => v.toFixed(0);\n}\n\n/**\n * Infer scale type from parameter range\n * @param {number} min - Minimum value\n * @param {number} max - Maximum value\n * @param {number} step - Step size\n * @returns {'linear' | 'log' | 'adaptive'}\n */\nexport function inferScaleType(min, max, step) {\n    // If min is positive and range spans multiple orders of magnitude, use adaptive/log\n    if (min > 0 && max / min > 1000) {\n        return 'adaptive';\n    }\n    return 'linear';\n}\n\n/**\n * Calculate adaptive increment based on current value\n * For wide-range parameters, increment should scale with magnitude\n *\n * @param {number} currentValue - Current value\n * @param {number} baseStep - Base step size (minimum increment)\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Calculated increment\n */\nexport function calculateAdaptiveIncrement(currentValue, baseStep, isLarge = false) {\n    const absValue = Math.abs(currentValue);\n\n    // For very small values, use baseStep\n    let increment = absValue < baseStep\n        ? baseStep\n        : Math.pow(10, Math.floor(Math.log10(absValue)) - 1);\n\n    // Ensure we never go below baseStep\n    increment = Math.max(baseStep, increment);\n\n    // For large increments, multiply by 10\n    if (isLarge) {\n        increment *= 10;\n    }\n\n    return increment;\n}\n\n/**\n * Calculate logarithmic increment\n * For log-scale sliders, increment in slider space\n *\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Slider space increment\n */\nexport function calculateLogIncrement(isLarge = false) {\n    return isLarge ? 10 : 1;\n}\n\n/**\n * Calculate linear increment\n * @param {number} step - Step size\n * @param {boolean} isLarge - Whether this is a large increment (10x)\n * @returns {number} Calculated increment\n */\nexport function calculateLinearIncrement(step, isLarge = false) {\n    return isLarge ? step * 10 : step;\n}\n\n/**\n * Create a formatter from parameter definition\n * @param {object} paramDef - Parameter definition\n * @returns {function(number): string}\n */\nexport function createFormatterFromDef(paramDef) {\n    // If custom formatter provided, use it\n    if (typeof paramDef.displayFormat === 'function') {\n        return paramDef.displayFormat;\n    }\n\n    const precision = paramDef.displayPrecision ?? 2;\n\n    // Parse string format types\n    switch (paramDef.displayFormat) {\n        case 'scientific':\n            return createScientificFormatter(precision, paramDef.scientificThreshold ?? 10);\n        case 'integer':\n            return createIntegerFormatter();\n        case 'decimal':\n        default:\n            return createDecimalFormatter(precision);\n    }\n}\n", "/**\n * Accordion utility functions\n * Handles automatic resizing of accordion sections when content changes\n */\n\n/**\n * Resize an accordion section to fit its content\n * @param {jQuery|string} selectorOrElement - jQuery element or selector for the control inside the accordion\n * @param {number} delay - Delay in ms to wait for DOM updates (default: 0)\n */\nexport function resizeAccordion(selectorOrElement, delay = 0) {\n    setTimeout(() => {\n        let $element;\n\n        // Handle both jQuery elements and selectors\n        if (typeof selectorOrElement === 'string') {\n            $element = $(selectorOrElement);\n        } else {\n            $element = selectorOrElement;\n        }\n\n        if (!$element.length) {\n            console.warn('resizeAccordion: Element not found', selectorOrElement);\n            return;\n        }\n\n        // Find the closest accordion section\n        const $accordionSection = $element.closest('.accordion-section');\n\n        if ($accordionSection.length && !$accordionSection.hasClass('collapsed')) {\n            // Set max-height to scrollHeight to accommodate new content\n            $accordionSection.css('max-height', $accordionSection[0].scrollHeight + 'px');\n        }\n    }, delay);\n}\n\n/**\n * Resize the accordion section containing a specific control ID\n * @param {string} controlId - The ID of a control inside the accordion\n * @param {number} delay - Delay in ms to wait for DOM updates (default: 0)\n */\nexport function resizeAccordionForControl(controlId, delay = 0) {\n    resizeAccordion(`#${controlId}`, delay);\n}\n\n/**\n * Create a debounced resize function for frequent updates\n * @param {number} wait - Debounce wait time in ms (default: 100)\n * @returns {Function} Debounced resize function\n */\nexport function createDebouncedResize(wait = 100) {\n    let timeout;\n\n    return function(selectorOrElement) {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => {\n            resizeAccordion(selectorOrElement, 0);\n        }, wait);\n    };\n}\n\n/**\n * Setup automatic resize observer for an element\n * Watches for size changes and automatically resizes the accordion\n * @param {jQuery|HTMLElement} element - Element to observe\n * @returns {ResizeObserver} The observer instance (call .disconnect() to stop)\n */\nexport function setupAccordionAutoResize(element) {\n    const target = element instanceof jQuery ? element[0] : element;\n\n    if (!target) {\n        console.warn('setupAccordionAutoResize: Invalid element', element);\n        return null;\n    }\n\n    // Check if ResizeObserver is available\n    if (typeof ResizeObserver === 'undefined') {\n        console.warn('ResizeObserver not available, falling back to manual resize');\n        return null;\n    }\n\n    const observer = new ResizeObserver(() => {\n        resizeAccordion($(target), 0);\n    });\n\n    observer.observe(target);\n    return observer;\n}\n\n/**\n * Resize all visible accordions\n * Useful after major layout changes\n */\nexport function resizeAllAccordions() {\n    $('.accordion-section').not('.collapsed').each(function() {\n        $(this).css('max-height', this.scrollHeight + 'px');\n    });\n}\n", "/**\n * Generic parameter control that reads metadata from parameter definitions\n * Eliminates duplication between transform definitions and UI code\n */\n\nimport { Control } from './control-base.js';\nimport {\n    createFormatterFromDef,\n    inferScaleType,\n    calculateAdaptiveIncrement,\n    calculateLogIncrement,\n    calculateLinearIncrement\n} from './control-utilities.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * ParameterControl - Generic control for any parameter with metadata\n *\n * Reads parameter definition (from transforms, integrators, mappers, etc.)\n * and creates appropriate UI controls automatically.\n *\n * Parameter definition schema:\n * {\n *   name: string,              // Parameter name (used as key in settings)\n *   label: string,             // Display label\n *   type: string,              // 'slider' | 'text' | 'checkbox' (future)\n *   min: number,               // Minimum value\n *   max: number,               // Maximum value\n *   step: number,              // Step size\n *   default: number,           // Default value\n *   info: string,              // Optional help text\n *   scale: string,             // Optional: 'linear' | 'log' | 'adaptive' (auto-inferred if not provided)\n *   displayFormat: string|fn,  // Optional: 'scientific' | 'decimal' | 'integer' | custom function\n *   displayPrecision: number,  // Optional: decimal places (default: 2)\n *   scientificThreshold: number // Optional: threshold for scientific notation (default: 10)\n * }\n */\nexport class ParameterControl extends Control {\n    constructor(id, parameterDef, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n\n        // Store parameter definition\n        this.parameterDef = parameterDef;\n\n        // Infer or use explicit scale type\n        this.scale = parameterDef.scale || inferScaleType(\n            parameterDef.min,\n            parameterDef.max,\n            parameterDef.step\n        );\n\n        // Create formatter from parameter definition\n        this.formatter = createFormatterFromDef(parameterDef);\n\n        // Store display element reference (will be set in attachListeners)\n        this.displayElement = null;\n    }\n\n    /**\n     * Calculate increment for button actions\n     * @param {number} currentValue - Current parameter value\n     * @param {boolean} isLarge - Whether this is a large increment\n     * @returns {number} Increment value\n     */\n    calculateIncrement(currentValue, isLarge = false) {\n        switch (this.scale) {\n            case 'adaptive':\n                return calculateAdaptiveIncrement(\n                    currentValue,\n                    this.parameterDef.step,\n                    isLarge\n                );\n\n            case 'log':\n                // For log scale, increment in slider space\n                return calculateLogIncrement(isLarge);\n\n            case 'linear':\n            default:\n                return calculateLinearIncrement(\n                    this.parameterDef.step,\n                    isLarge\n                );\n        }\n    }\n\n    /**\n     * Handle button actions (increment/decrement/reset)\n     * @param {string} action - 'increase', 'decrease', 'increase-large', 'decrease-large', 'reset'\n     * @returns {boolean} True if action was handled\n     */\n    handleButtonAction(action) {\n        const element = $(`#${this.id}`);\n        if (!element.length) return false;\n\n        const currentValue = this.getValue();\n        const min = this.parameterDef.min;\n        const max = this.parameterDef.max;\n\n        let newValue = currentValue;\n\n        if (action === 'reset') {\n            newValue = this.defaultValue;\n        } else {\n            const increment = this.calculateIncrement(\n                currentValue,\n                action.includes('large')\n            );\n\n            if (action.startsWith('increase')) {\n                newValue = Math.min(max, currentValue + increment);\n            } else if (action.startsWith('decrease')) {\n                newValue = Math.max(min, currentValue - increment);\n            } else {\n                return false;\n            }\n        }\n\n        if (newValue !== currentValue) {\n            this.setValue(newValue);\n            element.trigger('input');\n            return true;\n        }\n\n        return false;\n    }\n\n    /**\n     * Render the control HTML\n     * @returns {string} HTML string\n     */\n    render() {\n        const displayId = `${this.id}-display`;\n        const currentValue = this.defaultValue;\n\n        return `\n            <div class=\"control-group\">\n                <label>\n                    ${this.parameterDef.label}:\n                    <span class=\"range-value\" id=\"${displayId}\">\n                        ${this.formatter(currentValue)}\n                    </span>\n                </label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease-large\">--</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"${this.id}\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase-large\">++</button>\n                </div>\n                ${this.parameterDef.info ? `<div class=\"info\">${this.parameterDef.info}</div>` : ''}\n            </div>\n        `;\n    }\n\n    /**\n     * Attach to DOM and set up listeners\n     * @param {function} callback - Callback to trigger when value changes\n     */\n    attachListeners(callback) {\n        const element = $(`#${this.id}`);\n        this.element = element;\n        this.displayElement = $(`#${this.id}-display`);\n\n        if (!element.length) {\n            console.error(`ParameterControl: Element #${this.id} not found in DOM`);\n            return;\n        }\n\n        // Set slider attributes\n        element.attr('min', this.parameterDef.min);\n        element.attr('max', this.parameterDef.max);\n        element.attr('step', this.parameterDef.step);\n        element.val(this.defaultValue);\n\n        // Update display\n        this.updateDisplay(this.defaultValue);\n\n        // Listen for changes\n        element.on('input', () => {\n            const value = this.getValue();\n            this.updateDisplay(value);\n            if (this.onChange) this.onChange(value);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Update display element with formatted value\n     * @param {number} value - Value to display\n     */\n    updateDisplay(value) {\n        if (this.displayElement && this.displayElement.length) {\n            this.displayElement.text(this.formatter(value));\n        }\n    }\n\n    /**\n     * Get current value from DOM\n     * @returns {number}\n     */\n    getValue() {\n        if (!this.element || !this.element.length) {\n            return this.defaultValue;\n        }\n        return parseFloat(this.element.val());\n    }\n\n    /**\n     * Set value in DOM\n     * @param {number} value - Value to set\n     */\n    setValue(value) {\n        if (this.element && this.element.length) {\n            this.element.val(value);\n            this.updateDisplay(value);\n        }\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n}\n\n/**\n * AnimatableParameterControl\n * Extends ParameterControl with animation bounds\n */\nexport class AnimatableParameterControl extends ParameterControl {\n    constructor(id, parameterDef, defaultValue, options = {}) {\n        super(id, parameterDef, defaultValue, options);\n\n        // Animation state\n        this.animationEnabled = false;\n        // Default to 25% and 75% of the range if not specified\n        const range = parameterDef.max - parameterDef.min;\n        this.animationMin = options.animationMin ?? (parameterDef.min + range * 0.25);\n        this.animationMax = options.animationMax ?? (parameterDef.min + range * 0.75);\n        this.currentAlpha = 0.0;\n        this.isAnimating = false;\n    }\n\n    /**\n     * Enable/disable animation\n     */\n    setAnimationEnabled(enabled) {\n        this.animationEnabled = enabled;\n        this.updateAnimationUI();\n    }\n\n    /**\n     * Set animation bounds\n     */\n    setAnimationBounds(min, max) {\n        this.animationMin = Math.min(min, max);\n        this.animationMax = Math.max(min, max);\n        this.updateBoundsDisplay();\n    }\n\n    /**\n     * Update value based on current alpha (0.0 to 1.0)\n     */\n    updateFromAlpha(alpha) {\n        if (!this.animationEnabled) return;\n\n        this.currentAlpha = alpha;\n        const value = this.animationMin + alpha * (this.animationMax - this.animationMin);\n\n        this.isAnimating = true;\n        this.setValue(value);\n        this.updateCurrentIndicator(alpha);\n        this.isAnimating = false;\n    }\n\n    /**\n     * Update current indicator position\n     */\n    updateCurrentIndicator(alpha) {\n        const indicator = $(`#${this.id}-current-indicator`);\n        if (indicator.length) {\n            indicator.css('left', `${alpha * 100}%`);\n        }\n    }\n\n    /**\n     * Update bounds display\n     */\n    updateBoundsDisplay() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const minDisplay = $(`#${this.id}-min-display`);\n        const maxDisplay = $(`#${this.id}-max-display`);\n        const range = $(`#${this.id}-range`);\n\n        if (minHandle.length && maxHandle.length) {\n            const min = this.parameterDef.min;\n            const max = this.parameterDef.max;\n\n            const minPercent = ((this.animationMin - min) / (max - min)) * 100;\n            const maxPercent = ((this.animationMax - min) / (max - min)) * 100;\n\n            minHandle.css('left', `${minPercent}%`);\n            maxHandle.css('left', `${maxPercent}%`);\n\n            range.css({\n                'left': `${minPercent}%`,\n                'width': `${maxPercent - minPercent}%`\n            });\n\n            if (minDisplay.length) minDisplay.text(this.formatter(this.animationMin));\n            if (maxDisplay.length) maxDisplay.text(this.formatter(this.animationMax));\n        }\n    }\n\n    /**\n     * Update animation UI visibility\n     */\n    updateAnimationUI() {\n        const boundsContainer = $(`#${this.id}-animation-bounds`);\n        const animBtn = $(`#${this.id}-anim-btn`);\n\n        if (this.animationEnabled) {\n            boundsContainer.slideDown(200);\n            animBtn.addClass('active');\n            animBtn.attr('title', 'Disable animation (\uD83C\uDFAC)');\n            this.updateBoundsDisplay();\n\n            // Update accordion height immediately and after animation\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 0);\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 250);\n        } else {\n            boundsContainer.slideUp(200);\n            animBtn.removeClass('active');\n            animBtn.attr('title', 'Enable animation (\uD83C\uDFAC)');\n\n            // Update accordion height after animation\n            setTimeout(() => {\n                this.updateAccordionHeight();\n            }, 250);\n        }\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#transform-controls', 0);\n    }\n\n    /**\n     * Override render to add animation button\n     */\n    render() {\n        const displayId = `${this.id}-display`;\n        const currentValue = this.defaultValue;\n\n        return `\n            <div class=\"control-group\">\n                <label>\n                    ${this.parameterDef.label}:\n                    <span class=\"range-value\" id=\"${displayId}\">\n                        ${this.formatter(currentValue)}\n                    </span>\n                </label>\n                <div class=\"slider-control\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease-large\">--</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"decrease\">-</button>\n                    <input type=\"range\" id=\"${this.id}\">\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase\">+</button>\n                    <button class=\"slider-btn\" data-slider=\"${this.id}\" data-action=\"increase-large\">++</button>\n                    <button class=\"slider-btn anim-btn\" id=\"${this.id}-anim-btn\" title=\"Enable animation (\uD83C\uDFAC)\">\uD83C\uDFAC</button>\n                </div>\n                ${this.parameterDef.info ? `<div class=\"info\">${this.parameterDef.info}</div>` : ''}\n            </div>\n        `;\n    }\n\n    /**\n     * Override attachListeners to add animation controls\n     */\n    attachListeners(callback) {\n        // Call parent to set up basic slider\n        super.attachListeners(callback);\n\n        // Use setTimeout to ensure DOM is fully ready for dynamically created content\n        setTimeout(() => {\n            const element = $(`#${this.id}`);\n            if (!element.length) {\n                return;\n            }\n\n            const animBtn = $(`#${this.id}-anim-btn`);\n            if (!animBtn.length) {\n                return;\n            }\n\n            // Add animation button handler\n            animBtn.on('click', (e) => {\n                e.stopPropagation();\n                this.setAnimationEnabled(!this.animationEnabled);\n            });\n\n            // Add multi-thumb slider HTML after the control group\n            const boundsHTML = `\n                <div id=\"${this.id}-animation-bounds\" class=\"animation-bounds-slider\" style=\"display: none;\">\n                    <div class=\"bounds-labels\">\n                        <span>Min: <span id=\"${this.id}-min-display\">${this.formatter(this.animationMin)}</span></span>\n                        <span>Max: <span id=\"${this.id}-max-display\">${this.formatter(this.animationMax)}</span></span>\n                    </div>\n                    <div class=\"multi-thumb-slider\">\n                        <div class=\"slider-track\"></div>\n                        <div id=\"${this.id}-range\" class=\"slider-range\"></div>\n                        <div id=\"${this.id}-current-indicator\" class=\"slider-current-indicator\"></div>\n                        <div id=\"${this.id}-min-handle\" class=\"slider-thumb min-thumb\" data-bound=\"min\">\n                            <span class=\"thumb-label\">MIN</span>\n                        </div>\n                        <div id=\"${this.id}-max-handle\" class=\"slider-thumb max-thumb\" data-bound=\"max\">\n                            <span class=\"thumb-label\">MAX</span>\n                        </div>\n                    </div>\n                </div>\n            `;\n\n            const controlGroup = element.closest('.control-group');\n            if (controlGroup.length) {\n                controlGroup.after(boundsHTML);\n                // Attach drag handlers after inserting HTML\n                this.attachThumbDragHandlers();\n            } else {\n                console.warn(`AnimatableParameterControl: Could not find .control-group parent for #${this.id}`);\n            }\n        }, 0);\n    }\n\n    /**\n     * Attach drag handlers to thumbs\n     */\n    attachThumbDragHandlers() {\n        const minHandle = $(`#${this.id}-min-handle`);\n        const maxHandle = $(`#${this.id}-max-handle`);\n        const track = minHandle.parent();\n\n        const handlers = [\n            { handle: minHandle, bound: 'min' },\n            { handle: maxHandle, bound: 'max' }\n        ];\n\n        handlers.forEach(({ handle, bound }) => {\n            let isDragging = false;\n            let startX = 0;\n            let startLeft = 0;\n\n            handle.on('mousedown', (e) => {\n                isDragging = true;\n                startX = e.pageX;\n                startLeft = parseFloat(handle.css('left')) || 0;\n\n                handle.addClass('dragging');\n                // Bring this handle to front\n                minHandle.css('z-index', '10');\n                maxHandle.css('z-index', '10');\n                handle.css('z-index', '11');\n                $('body').css('user-select', 'none');\n                e.preventDefault();\n            });\n\n            $(document).on('mousemove', (e) => {\n                if (!isDragging) return;\n\n                // Get track dimensions and position\n                const trackOffset = track.offset();\n                const trackWidth = track.width();\n\n                // Calculate mouse position relative to track\n                const relativeX = e.pageX - trackOffset.left;\n\n                // Convert to percentage\n                let newPercent = (relativeX / trackWidth) * 100;\n\n                // Clamp to 0-100\n                newPercent = Math.max(0, Math.min(100, newPercent));\n\n                // Convert percent to actual value\n                const min = this.parameterDef.min;\n                const max = this.parameterDef.max;\n                const actualValue = min + (newPercent / 100) * (max - min);\n\n                // Update the bound\n                if (bound === 'min') {\n                    if (actualValue <= this.animationMax) {\n                        this.animationMin = actualValue;\n                    }\n                } else {\n                    if (actualValue >= this.animationMin) {\n                        this.animationMax = actualValue;\n                    }\n                }\n\n                this.updateBoundsDisplay();\n            });\n\n            $(document).on('mouseup', () => {\n                if (isDragging) {\n                    isDragging = false;\n                    handle.removeClass('dragging');\n                    $('body').css('user-select', '');\n                }\n            });\n        });\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        super.saveToSettings(settings);\n\n        if (this.animationEnabled) {\n            if (!settings.animations) settings.animations = {};\n            settings.animations[this.settingsKey] = {\n                enabled: true,\n                min: this.animationMin,\n                max: this.animationMax\n            };\n        }\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        super.restoreFromSettings(settings);\n\n        if (settings.animations && settings.animations[this.settingsKey]) {\n            const animData = settings.animations[this.settingsKey];\n            this.animationEnabled = animData.enabled || false;\n            this.animationMin = animData.min;\n            this.animationMax = animData.max;\n\n            this.updateAnimationUI();\n        }\n    }\n}\n", "/**\n * Custom control classes for complex UI controls (Version 2)\n * Refactored to eliminate duplication with transform parameter definitions\n */\n\nimport { Control, CheckboxControl } from './control-base.js';\nimport { ParameterControl, AnimatableParameterControl } from './parameter-control.js';\nimport { getTransform } from '../math/transforms.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { resizeAccordion } from './accordion-utils.js';\n\n/**\n * FloatCheckboxControl - checkbox that outputs 0.0 or 1.0 instead of boolean\n * Useful for shader uniforms that expect floats\n */\nexport class FloatCheckboxControl extends CheckboxControl {\n    constructor(id, defaultValue, options = {}) {\n        super(id, defaultValue, options);\n    }\n\n    getValue() {\n        const checked = super.getValue();\n        return checked ? 1.0 : 0.0;\n    }\n\n    setValue(value) {\n        // Accept both boolean and numeric values\n        const checked = (typeof value === 'number') ? (value > 0.5) : value;\n        super.setValue(checked);\n    }\n}\n\n/**\n * DimensionInputsControl - manages dynamic expression inputs\n * Creates/destroys input fields based on dimension count\n */\nexport class DimensionInputsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('dimension-inputs', defaultValue, options);\n        this.dimensionsControl = null; // Will be set to the dimensions control\n        this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n        this.coordinateSystem = null; // Current coordinate system\n    }\n\n    /**\n     * Set reference to dimensions control (needed to know how many inputs to create)\n     */\n    setDimensionsControl(dimensionsControl) {\n        this.dimensionsControl = dimensionsControl;\n    }\n\n    /**\n     * Update coordinate system and refresh variable labels\n     * @param {CoordinateSystem} coordinateSystem - The new coordinate system\n     * @param {boolean} updateUI - Whether to refresh the UI (default: true)\n     */\n    setCoordinateSystem(coordinateSystem, updateUI = true) {\n        this.coordinateSystem = coordinateSystem;\n\n        // Update varNames from coordinate system\n        if (coordinateSystem && coordinateSystem.getDisplayLabels) {\n            this.varNames = coordinateSystem.getDisplayLabels();\n        } else {\n            // Fallback to Cartesian\n            this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n        }\n\n        // Refresh the inputs with new labels (preserve current values)\n        // Skip during initialization to avoid overwriting saved values\n        if (updateUI) {\n            this.updateInputs();\n        }\n    }\n\n    /**\n     * Get current dimension count\n     */\n    getDimensions() {\n        if (this.dimensionsControl) {\n            return this.dimensionsControl.getValue();\n        }\n        // Get from web component\n        const dimensionsEl = document.getElementById('dimensions');\n        if (dimensionsEl && dimensionsEl.getValue) {\n            return dimensionsEl.getValue();\n        }\n        return 2;\n    }\n\n    /**\n     * Get current expression values\n     */\n    getValue() {\n        const dimensions = this.getDimensions();\n        const expressions = [];\n        for (let i = 0; i < dimensions; i++) {\n            const value = $(`#expr-${i}`).val();\n            let expr = value ? value.trim() : '0';\n\n            // Convert Unicode symbols to ASCII (\u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.)\n            if (expr && window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                expr = window.UnicodeAutocomplete.unicodeToAscii(expr);\n            }\n\n            expressions.push(expr || '0');\n        }\n        return expressions;\n    }\n\n    /**\n     * Set expression values\n     */\n    setValue(expressions) {\n        if (!Array.isArray(expressions)) return;\n\n        // Ensure we have the right number of inputs first, passing the new values\n        this.updateInputs(expressions.length, expressions);\n    }\n\n    /**\n     * Update dimension inputs based on current dimension count\n     * @param {number|null} dimensions - Number of dimensions (null = use current)\n     * @param {Array|null} newValues - Optional new values to set (overrides current values)\n     */\n    updateInputs(dimensions = null, newValues = null) {\n        if (dimensions === null) {\n            dimensions = this.getDimensions();\n        }\n\n        logger.verbose('updateInputs called with dimensions:', dimensions);\n\n        const container = $('#dimension-inputs');\n        logger.verbose('Container found:', container.length);\n        if (container.length === 0) {\n            logger.error('Could not find #dimension-inputs element');\n            return;\n        }\n\n        // Determine what values to use\n        let valuesToUse;\n        if (newValues && Array.isArray(newValues)) {\n            // Use provided new values\n            valuesToUse = newValues;\n            logger.verbose('Using provided newValues');\n        } else {\n            // Get current values before clearing - read ALL existing inputs, not just current dimension count\n            const firstElement = $(`#expr-0`);\n            logger.verbose('firstElement exists:', firstElement.length > 0);\n            try {\n                if (firstElement.length > 0) {\n                    // Read all existing expression inputs (find max index)\n                    const existingValues = [];\n                    let i = 0;\n                    while ($(`#expr-${i}`).length > 0) {\n                        const value = $(`#expr-${i}`).val();\n                        existingValues.push(value ? value.trim() : '0');\n                        i++;\n                    }\n                    valuesToUse = existingValues;\n                    logger.verbose('Got current values from existing inputs:', valuesToUse);\n                } else {\n                    valuesToUse = this.defaultValue;\n                    logger.verbose('Using defaultValue');\n                }\n            } catch (error) {\n                logger.error('Error getting values:', error);\n                valuesToUse = this.defaultValue;\n            }\n        }\n\n        // Pad valuesToUse to match new dimensions if needed\n        // This preserves existing values when increasing dimensions\n        if (valuesToUse.length < dimensions) {\n            const padded = [...valuesToUse];\n            for (let i = valuesToUse.length; i < dimensions; i++) {\n                padded[i] = '0'; // Use '0' for new dimensions\n            }\n            valuesToUse = padded;\n            logger.verbose('Padded values to match dimensions:', valuesToUse);\n        }\n\n        logger.verbose('Values to use:', valuesToUse);\n\n        // Clear and rebuild\n        container.empty();\n        logger.verbose('Container emptied, now creating', dimensions, 'inputs');\n\n        for (let i = 0; i < dimensions; i++) {\n            // Use fallback variable names if coordinate system hasn't updated yet\n            const fallbackVarNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n            const varName = this.varNames[i] || fallbackVarNames[i] || `v${i}`;\n            const defaultValue = valuesToUse[i] || '0';\n\n            const div = $('<div class=\"dimension-input\"></div>');\n            div.append(`<label>d${varName}/dt =</label>`);\n            div.append(`<input type=\"text\" id=\"expr-${i}\" value=\"${defaultValue}\">`);\n\n            container.append(div);\n            logger.verbose('Created input', i, 'with value:', defaultValue);\n        }\n\n        logger.verbose('All inputs created, container now has', container.children().length, 'children');\n\n        // Reattach listeners to new inputs\n        this.attachInputListeners();\n\n        // Attach unicode autocomplete to expression inputs\n        if (window.unicodeAutocomplete) {\n            window.unicodeAutocomplete.attachToAll('[id^=\"expr-\"]');\n        }\n\n        // Update accordion height to accommodate new inputs\n        this.updateAccordionHeight();\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#dimension-inputs', 0);\n    }\n\n    /**\n     * Attach listeners to expression inputs\n     */\n    attachInputListeners() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('input', '[id^=\"expr-\"]');\n\n        // Add new listeners\n        $(document).on('input', '[id^=\"expr-\"]', () => {\n            if (this.onChange) this.onChange(this.getValue());\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n\n        // Initial setup\n        this.updateInputs();\n\n        // Attach input listeners\n        this.attachInputListeners();\n\n        // Listen for dimension changes (will be called externally)\n        // The dimensions control will call updateInputs() via onChange\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n}\n\n/**\n * MapperParamsControl - manages mapper dimension selectors\n * Creates dropdowns for selecting which dimensions to display\n */\nexport class MapperParamsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('mapper-params', defaultValue, options);\n        this.dimensionsControl = null;\n        this.mapperControl = null;\n        this.varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n    }\n\n    /**\n     * Set references to related controls\n     */\n    setRelatedControls(dimensionsControl, mapperControl) {\n        this.dimensionsControl = dimensionsControl;\n        this.mapperControl = mapperControl;\n    }\n\n    /**\n     * Get current dimensions and mapper type\n     */\n    getContext() {\n        const dimensions = this.dimensionsControl ? this.dimensionsControl.getValue() : 2;\n        const mapper = this.mapperControl ? this.mapperControl.getValue() : 'select';\n        return { dimensions, mapper };\n    }\n\n    /**\n     * Get current mapper params\n     */\n    getValue() {\n        const { mapper } = this.getContext();\n\n        if (mapper === 'custom') {\n            const horizontalElement = $('#mapper-horizontal-expr');\n            const verticalElement = $('#mapper-vertical-expr');\n            const depthElement = $('#mapper-depth-expr');\n\n            if (horizontalElement.length && verticalElement.length) {\n                return {\n                    horizontalExpr: horizontalElement.val() || 'x',\n                    verticalExpr: verticalElement.val() || 'y',\n                    depthExpr: depthElement.val() || ''\n                };\n            }\n            return this.currentParams || { horizontalExpr: 'x', verticalExpr: 'y', depthExpr: '' };\n        }\n\n        const dim1Element = $('#mapper-dim1');\n        const dim2Element = $('#mapper-dim2');\n\n        if (dim1Element.length && dim2Element.length) {\n            const dim1 = parseInt(dim1Element.val());\n            const dim2 = parseInt(dim2Element.val());\n\n            // Validate dimensions are valid numbers\n            if (isNaN(dim1) || isNaN(dim2)) {\n                console.warn('Invalid mapper dimensions, using defaults');\n                return this.defaultValue;\n            }\n\n            return { dim1, dim2 };\n        }\n\n        // Return default if elements don't exist yet\n        return this.defaultValue;\n    }\n\n    /**\n     * Set mapper params\n     */\n    setValue(params) {\n        // Update controls will recreate the dropdowns with these values\n        this.currentParams = params;\n        this.updateControls();\n    }\n\n    /**\n     * Update mapper controls based on mapper type and dimensions\n     */\n    updateControls() {\n        const { dimensions, mapper } = this.getContext();\n        const container = $('#mapper-controls');\n\n        if (container.length === 0) return;\n\n        container.empty();\n\n        if (mapper === 'select') {\n            const row = $('<div class=\"control-row\"></div>');\n\n            // Horizontal dimension selector\n            const group1 = $('<div class=\"control-group\" style=\"flex: 1;\"></div>');\n            group1.append(`<label>Horizontal</label>`);\n\n            const select1 = $('<select id=\"mapper-dim1\"></select>');\n            const currentDim1 = this.currentParams ? this.currentParams.dim1 : this.defaultValue.dim1;\n\n            for (let i = 0; i < dimensions; i++) {\n                const selected = i === currentDim1 ? 'selected' : '';\n                select1.append(`<option value=\"${i}\" ${selected}>${this.varNames[i]}</option>`);\n            }\n            group1.append(select1);\n\n            // Vertical dimension selector\n            const group2 = $('<div class=\"control-group\" style=\"flex: 1;\"></div>');\n            group2.append(`<label>Vertical</label>`);\n\n            const select2 = $('<select id=\"mapper-dim2\"></select>');\n            const currentDim2 = this.currentParams ? this.currentParams.dim2 : this.defaultValue.dim2;\n\n            for (let i = 0; i < dimensions; i++) {\n                const selected = i === currentDim2 ? 'selected' : '';\n                select2.append(`<option value=\"${i}\" ${selected}>${this.varNames[i]}</option>`);\n            }\n            group2.append(select2);\n\n            row.append(group1);\n            row.append(group2);\n            container.append(row);\n\n            // Attach change listeners\n            this.attachSelectListeners();\n\n        } else if (mapper === 'project') {\n            const info = $('<div class=\"info\">Linear projection uses default 2D projection</div>');\n            container.append(info);\n\n        } else if (mapper === 'custom') {\n            const varNames = this.varNames.slice(0, dimensions).join(', ');\n\n            // Horizontal expression\n            const group1 = $('<div class=\"control-group\"></div>');\n            group1.append(`<label>Horizontal (X):</label>`);\n            const currentHorizontal = this.currentParams?.horizontalExpr || 'x';\n            const input1 = $(`<input type=\"text\" id=\"mapper-horizontal-expr\" value=\"${currentHorizontal}\" placeholder=\"e.g., sin(x) + sin(y)\" style=\"font-family: monospace; width: 100%;\" />`);\n            group1.append(input1);\n            container.append(group1);\n\n            // Vertical expression\n            const group2 = $('<div class=\"control-group\"></div>');\n            group2.append(`<label>Vertical (Y):</label>`);\n            const currentVertical = this.currentParams?.verticalExpr || 'y';\n            const input2 = $(`<input type=\"text\" id=\"mapper-vertical-expr\" value=\"${currentVertical}\" placeholder=\"e.g., -cos(x) - cos(y)\" style=\"font-family: monospace; width: 100%;\" />`);\n            group2.append(input2);\n            container.append(group2);\n\n            // Depth expression (optional)\n            const group3 = $('<div class=\"control-group\"></div>');\n            group3.append(`<label>Depth (Z, optional):</label>`);\n            const currentDepth = this.currentParams?.depthExpr || '';\n            const input3 = $(`<input type=\"text\" id=\"mapper-depth-expr\" value=\"${currentDepth}\" placeholder=\"optional, e.g., z\" style=\"font-family: monospace; width: 100%;\" />`);\n            group3.append(input3);\n            container.append(group3);\n\n            const info = $('<div class=\"info\">Define math expressions using variables: ' + varNames + '. Functions: sin, cos, tan, exp, log, sqrt, abs, etc.</div>');\n            container.append(info);\n\n            // Attach change listeners\n            this.attachCustomListener();\n        }\n    }\n\n    /**\n     * Attach listeners to mapper dimension selectors\n     */\n    attachSelectListeners() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('change', '#mapper-dim1, #mapper-dim2');\n\n        // Add new listeners\n        $('#mapper-dim1, #mapper-dim2').on('change', () => {\n            this.currentParams = this.getValue();\n            if (this.onChange) this.onChange(this.currentParams);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach listeners to custom mapper text inputs\n     */\n    attachCustomListener() {\n        const callback = this.onChangeCallback;\n\n        // Remove old listeners\n        $(document).off('input', '#mapper-horizontal-expr, #mapper-vertical-expr, #mapper-depth-expr');\n\n        // Add new listeners\n        $('#mapper-horizontal-expr, #mapper-vertical-expr, #mapper-depth-expr').on('input', () => {\n            this.currentParams = this.getValue();\n            if (this.onChange) this.onChange(this.currentParams);\n            if (callback) callback();\n        });\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n        this.currentParams = this.defaultValue;\n\n        // Initial setup\n        this.updateControls();\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.currentParams = this.defaultValue;\n        this.updateControls();\n    }\n}\n\n/**\n * GradientControl - integrates with existing gradient editor\n * Wraps the gradient editor for use with ControlManager\n */\nexport class GradientControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('color-gradient', defaultValue, options);\n        this.gradientEditor = null;\n    }\n\n    /**\n     * Set reference to gradient editor instance\n     */\n    setGradientEditor(gradientEditor) {\n        this.gradientEditor = gradientEditor;\n    }\n\n    /**\n     * Get current gradient\n     */\n    getValue() {\n        if (this.gradientEditor && this.gradientEditor.getGradient) {\n            return this.gradientEditor.getGradient();\n        }\n        // Return stored value if editor not available\n        return this.currentGradient || this.defaultValue;\n    }\n\n    /**\n     * Set gradient value\n     */\n    setValue(gradient) {\n        this.currentGradient = gradient;\n        if (this.gradientEditor && this.gradientEditor.setGradient) {\n            this.gradientEditor.setGradient(gradient);\n        }\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        // Gradient editor has its own onChange handler\n        // We'll set this up when the editor is initialized\n        this.onChangeCallback = callback;\n    }\n\n    /**\n     * Called when gradient editor changes\n     */\n    notifyChange(newGradient) {\n        this.currentGradient = newGradient;\n        if (this.onChange) this.onChange(newGradient);\n        if (this.onChangeCallback) this.onChangeCallback();\n    }\n\n    /**\n     * Reset to default gradient\n     */\n    reset() {\n        this.setValue(this.defaultValue);\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] !== undefined) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n/**\n * TransformParamsControl - manages transform parameter sliders\n * Creates dynamic controls based on the selected transform type\n *\n * REFACTORED VERSION: No longer duplicates parameter definitions!\n * - Reads parameters from transform's getParameters() method (single source of truth)\n * - Uses ParameterControl instances for rendering and value management\n * - Eliminates ~200 lines of duplicate code\n */\nexport class TransformParamsControl extends Control {\n    constructor(defaultValue, options = {}) {\n        super('transform-params', defaultValue, options);\n        this.transformControl = null;\n        this.currentParams = defaultValue || {};\n        this.parameterControls = new Map(); // Maps control ID -> ParameterControl instance\n    }\n\n    /**\n     * Set reference to transform control\n     */\n    setTransformControl(transformControl) {\n        this.transformControl = transformControl;\n    }\n\n    /**\n     * Get current transform type\n     */\n    getTransformType() {\n        return this.transformControl ? this.transformControl.getValue() : 'identity';\n    }\n\n    /**\n     * Get current parameter values\n     */\n    getValue() {\n        const values = {};\n\n        // Collect values from all parameter controls\n        for (const [controlId, paramControl] of this.parameterControls.entries()) {\n            const paramName = paramControl.settingsKey;\n            values[paramName] = paramControl.getValue();\n        }\n\n        return values;\n    }\n\n    /**\n     * Set parameter values\n     */\n    setValue(params) {\n        this.currentParams = params || {};\n        this.updateControls();\n    }\n\n    /**\n     * Update transform parameter controls based on transform type\n     * Reads parameter definitions directly from the transform instance\n     */\n    updateControls() {\n        const transformType = this.getTransformType();\n        const container = $('#transform-controls');\n\n        if (container.length === 0) return;\n\n        // Clear old controls\n        container.empty();\n        this.parameterControls.clear();\n\n        // Get transform instance\n        const transform = getTransform(transformType);\n        if (!transform) {\n            logger.warn(`Transform not found: ${transformType}`);\n            this.updateAccordionHeight();\n            return;\n        }\n\n        // Get parameter definitions from transform (single source of truth!)\n        const paramDefs = transform.getParameters();\n\n        if (paramDefs.length === 0) {\n            // No parameters for this transform\n            this.updateAccordionHeight();\n            return;\n        }\n\n        // Create AnimatableParameterControl for each parameter\n        paramDefs.forEach((paramDef, index) => {\n            const controlId = `transform-param-${index}`;\n            const defaultValue = this.currentParams[paramDef.name] ?? paramDef.default;\n\n            // Create animatable parameter control\n            const paramControl = new AnimatableParameterControl(\n                controlId,\n                paramDef,\n                defaultValue,\n                {\n                    settingsKey: paramDef.name, // Use parameter name as settings key\n                    onChange: (value) => {\n                        this.currentParams[paramDef.name] = value;\n                        if (this.onChange) this.onChange(this.currentParams);\n                    }\n                }\n            );\n\n            // Render and append to container\n            container.append(paramControl.render());\n\n            // Attach listeners\n            paramControl.attachListeners(this.onChangeCallback);\n\n            // Store reference for button handling\n            this.parameterControls.set(controlId, paramControl);\n        });\n\n        // Update accordion height to accommodate new controls\n        this.updateAccordionHeight();\n    }\n\n    /**\n     * Update accordion section height to fit content\n     */\n    updateAccordionHeight() {\n        resizeAccordion('#transform-controls', 0);\n    }\n\n    /**\n     * Handle button actions for dynamically created transform parameter sliders\n     * Delegates to the appropriate ParameterControl instance\n     *\n     * @param {string} sliderId - The slider ID (e.g., 'transform-param-0')\n     * @param {string} action - The button action\n     * @returns {boolean} True if handled\n     */\n    handleTransformParamButton(sliderId, action) {\n        const control = this.parameterControls.get(sliderId);\n        if (control) {\n            return control.handleButtonAction(action);\n        }\n        return false;\n    }\n\n    /**\n     * Attach event listeners\n     */\n    attachListeners(callback) {\n        this.onChangeCallback = callback;\n\n        // Initial setup\n        this.updateControls();\n    }\n\n    /**\n     * Reset to default value\n     */\n    reset() {\n        this.currentParams = this.defaultValue;\n        this.updateControls();\n    }\n\n    /**\n     * Save to settings\n     */\n    saveToSettings(settings) {\n        settings[this.settingsKey] = this.getValue();\n    }\n\n    /**\n     * Restore from settings\n     */\n    restoreFromSettings(settings) {\n        if (settings && settings[this.settingsKey] !== undefined) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n", "/**\n * Simple gradient editor component\n * Creates a UI for editing color gradients with multiple stops\n */\n\nimport { rgbToHex, hexToRgb } from '../math/gradients.js';\n\n/**\n * Initialize gradient editor\n * @param {string} containerId - ID of container element\n * @param {Array} initialGradient - Initial gradient stops\n * @param {Function} onChange - Callback when gradient changes\n */\nexport function initGradientEditor(containerId, initialGradient, onChange) {\n    const container = $(`#${containerId}`);\n    if (!container.length) {\n        console.error(`Gradient editor container #${containerId} not found`);\n        return null;\n    }\n\n    let gradient = initialGradient.map(stop => ({...stop})); // Deep copy\n\n    function render() {\n        // Sort by position for display\n        const sorted = [...gradient].sort((a, b) => a.position - b.position);\n\n        let html = '<div class=\"gradient-stops\">';\n\n        sorted.forEach((stop, index) => {\n            const actualIndex = gradient.indexOf(stop);\n            const hex = rgbToHex(stop.color);\n\n            html += `\n                <div class=\"gradient-stop\" data-index=\"${actualIndex}\">\n                    <input type=\"color\" class=\"color-picker\" value=\"${hex}\" data-index=\"${actualIndex}\">\n                    <input type=\"number\" class=\"stop-position\" min=\"0\" max=\"1\" step=\"0.01\" value=\"${stop.position.toFixed(2)}\" data-index=\"${actualIndex}\">\n                    ${gradient.length > 2 ? `<button class=\"remove-stop\" data-index=\"${actualIndex}\">\u00D7</button>` : ''}\n                </div>\n            `;\n        });\n\n        html += '</div>';\n        html += '<button id=\"add-stop\" class=\"secondary\" style=\"margin-top: 5px;\">Add Color Stop</button>';\n        html += '<div class=\"gradient-preview\" id=\"gradient-preview\"></div>';\n\n        container.html(html);\n\n        // Render preview\n        renderPreview();\n\n        // Attach event listeners\n        attachEventListeners();\n    }\n\n    function renderPreview() {\n        const preview = $('#gradient-preview');\n        if (!preview.length) return;\n\n        // Create CSS gradient\n        const sorted = [...gradient].sort((a, b) => a.position - b.position);\n        const stops = sorted.map(stop => {\n            const hex = rgbToHex(stop.color);\n            return `${hex} ${(stop.position * 100).toFixed(1)}%`;\n        }).join(', ');\n\n        preview.css('background', `linear-gradient(to right, ${stops})`);\n    }\n\n    function attachEventListeners() {\n        // Color picker change\n        $('.color-picker').off('change').on('change', function() {\n            const index = parseInt($(this).data('index'));\n            const hex = $(this).val();\n            gradient[index].color = hexToRgb(hex);\n            renderPreview();\n            onChange(gradient);\n        });\n\n        // Position change\n        $('.stop-position').off('change').on('change', function() {\n            const index = parseInt($(this).data('index'));\n            let pos = parseFloat($(this).val());\n            pos = Math.max(0, Math.min(1, pos)); // Clamp to [0,1]\n            gradient[index].position = pos;\n            render(); // Re-render to resort\n            onChange(gradient);\n        });\n\n        // Remove stop\n        $('.remove-stop').off('click').on('click', function() {\n            const index = parseInt($(this).data('index'));\n            if (gradient.length > 2) {\n                gradient.splice(index, 1);\n                render();\n                onChange(gradient);\n            }\n        });\n\n        // Add stop\n        $('#add-stop').off('click').on('click', function() {\n            // Find middle position\n            const sorted = [...gradient].sort((a, b) => a.position - b.position);\n            let newPos = 0.5;\n\n            // Find largest gap\n            let maxGap = 0;\n            let gapPos = 0.5;\n            for (let i = 0; i < sorted.length - 1; i++) {\n                const gap = sorted[i + 1].position - sorted[i].position;\n                if (gap > maxGap) {\n                    maxGap = gap;\n                    gapPos = (sorted[i].position + sorted[i + 1].position) / 2;\n                }\n            }\n            newPos = gapPos;\n\n            // Interpolate color at that position\n            const newColor = interpolateGradient(gradient, newPos);\n\n            gradient.push({\n                position: newPos,\n                color: newColor\n            });\n\n            render();\n            onChange(gradient);\n        });\n    }\n\n    // Helper to interpolate color at a given position\n    function interpolateGradient(stops, t) {\n        const sorted = [...stops].sort((a, b) => a.position - b.position);\n\n        // Find surrounding stops\n        if (t <= sorted[0].position) return [...sorted[0].color];\n        if (t >= sorted[sorted.length - 1].position) return [...sorted[sorted.length - 1].color];\n\n        for (let i = 0; i < sorted.length - 1; i++) {\n            if (t >= sorted[i].position && t <= sorted[i + 1].position) {\n                const t1 = sorted[i].position;\n                const t2 = sorted[i + 1].position;\n                const segmentT = (t - t1) / (t2 - t1);\n\n                const c1 = sorted[i].color;\n                const c2 = sorted[i + 1].color;\n\n                return [\n                    c1[0] + (c2[0] - c1[0]) * segmentT,\n                    c1[1] + (c2[1] - c1[1]) * segmentT,\n                    c1[2] + (c2[2] - c1[2]) * segmentT\n                ];\n            }\n        }\n\n        return [0.5, 0.5, 0.5]; // Fallback\n    }\n\n    // Initial render\n    render();\n\n    // Return API\n    return {\n        getGradient: () => gradient.map(stop => ({...stop})),\n        setGradient: (newGradient) => {\n            gradient = newGradient.map(stop => ({...stop}));\n            render();\n        }\n    };\n}\n", "/**\n * Coordinate System Editor\n *\n * Provides a UI for configuring alternate coordinate systems (polar, spherical, etc.)\n * Users can select presets or define custom coordinate transformations.\n */\n\nimport { CoordinateSystem, PRESET_COORDINATE_SYSTEMS, getPresetsForDimension, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { solveInverseSymbolically } from '../math/inverse-solver.js';\n\n/**\n * Initialize coordinate editor panel\n * @param {string} containerId - ID of container element\n * @param {number} dimensions - Current number of dimensions\n * @param {Object} initialSystem - Initial coordinate system\n * @param {Function} onChange - Callback when coordinate system changes (system) => {}\n */\nexport function initCoordinateEditor(containerId, dimensions, initialSystem, onChange) {\n    const container = $(`#${containerId}`);\n    if (!container.length) {\n        console.error(`Coordinate editor container #${containerId} not found`);\n        return null;\n    }\n\n    let currentSystem = initialSystem || getCartesianSystem(dimensions);\n    let currentDimensions = dimensions;\n\n    const editor = {\n        render,\n        update,\n        getCurrentSystem: () => currentSystem,\n        setDimensions\n    };\n\n    function render() {\n        const presets = getPresetsForDimension(currentDimensions);\n\n        let html = '<div class=\"coordinate-editor-content\">';\n\n        // Preset dropdown\n        html += '<div class=\"control-group\">';\n        html += '<label for=\"coord-preset\">Preset</label>';\n        html += '<select id=\"coord-preset\">';\n\n        // Find current preset key (if any)\n        let currentPresetKey = 'custom';\n        for (const [key, system] of Object.entries(PRESET_COORDINATE_SYSTEMS)) {\n            if (system.name === currentSystem.name &&\n                system.dimensions === currentSystem.dimensions) {\n                currentPresetKey = key;\n                break;\n            }\n        }\n\n        html += '<option value=\"custom\">Custom</option>';\n        presets.forEach(({ key, system }) => {\n            const selected = key === currentPresetKey ? 'selected' : '';\n            html += `<option value=\"${key}\" ${selected}>${system.name}</option>`;\n        });\n        html += '</select>';\n        html += '</div>';\n\n        // Variable definitions\n        html += '<div class=\"coordinate-variables\">';\n        html += '<div style=\"font-weight: bold;\">Coordinate Variables:</div>';\n\n        for (let i = 0; i < currentDimensions; i++) {\n            const variable = currentSystem.variables[i] || { label: 'x', displayLabel: 'x' };\n            const transform = currentSystem.forwardTransforms[i] || 'x';\n            const cartesianVar = ['x', 'y', 'z', 'w', 'u', 'v'][i];\n\n            html += '<div class=\"coord-var-row\">';\n            html += `<input type=\"text\" class=\"coord-var-label\" data-index=\"${i}\" value=\"${variable.displayLabel}\" placeholder=\"${cartesianVar}\" title=\"Variable label (can use Greek letters like \u03B8)\">`;\n            html += '<span>=</span>';\n            html += `<input type=\"text\" class=\"coord-var-transform coord-math-input\" data-index=\"${i}\" value=\"${transform}\" placeholder=\"${cartesianVar}\" title=\"Transformation expression in Cartesian coordinates\">`;\n            html += '</div>';\n        }\n\n        html += '</div>';\n\n        // Inverse transform section\n        html += '<div class=\"coordinate-inverse\">';\n        html += '<div style=\"font-weight: bold; margin-top: 15px;\">Inverse Transform (Native \u2192 Cartesian):</div>';\n\n        const useIterative = currentSystem.useIterativeSolver || false;\n\n        for (let i = 0; i < currentDimensions; i++) {\n            const cartesianVar = ['x', 'y', 'z', 'w', 'u', 'v'][i];\n            const inverseTransform = currentSystem.inverseTransforms && currentSystem.inverseTransforms[i]\n                ? currentSystem.inverseTransforms[i]\n                : '';\n            const nativeVars = currentSystem.variables.map(v => v.label || v.displayLabel).join(', ');\n\n            html += '<div class=\"coord-var-row\">';\n            html += `<span style=\"min-width: 20px;\">${cartesianVar}</span>`;\n            html += '<span>=</span>';\n            html += `<input type=\"text\" class=\"coord-inverse-transform coord-math-input\" data-index=\"${i}\" value=\"${inverseTransform}\" placeholder=\"(e.g., r*cos(theta))\" title=\"Inverse transformation from native coordinates\" ${useIterative ? 'disabled' : ''}>`;\n            html += '</div>';\n        }\n\n        html += '</div>';\n\n        // Solve button and iterative solver checkbox\n        html += '<div class=\"coordinate-tools\" style=\"margin-top: 10px;\">';\n        html += '<button id=\"coord-solve-inverse\" class=\"secondary\" title=\"Attempt to solve inverse transforms automatically using symbolic math\">\u26A1 Solve Inverse Symbolically</button>';\n        html += '<div style=\"margin-top: 8px;\">';\n        html += '<label style=\"display: flex; align-items: center; font-size: 0.9em;\">';\n        html += `<input type=\"checkbox\" id=\"coord-use-iterative\" ${useIterative ? 'checked' : ''} style=\"margin-right: 5px;\">`;\n        html += '<span title=\"Use GPU-based Newton\\'s method to compute inverse. Slower but works for any transform.\">Use iterative Newton solver (GLSL)</span>';\n        html += '</label>';\n        html += '</div>';\n        html += '</div>';\n\n        // Info text\n        html += '<div class=\"info-text\" style=\"margin-top: 15px;\">';\n        html += '<strong>Forward Transform:</strong> Define each native coordinate in terms of Cartesian variables (x, y, z, w, ...). ';\n        html += '<strong>Inverse Transform:</strong> Define each Cartesian coordinate in terms of native variables. ';\n        html += 'Use the \"Solve\" button to attempt automatic computation, or enable iterative solver for complex transforms. ';\n        html += 'Type \"theta\", \"phi\", etc. to insert Greek letters.';\n        html += '</div>';\n\n        // Action buttons\n        html += '<div class=\"coordinate-editor-buttons\">';\n        html += '<button id=\"coord-apply\" class=\"primary\">Apply</button>';\n        html += '<button id=\"coord-cancel\" class=\"secondary\">Cancel</button>';\n        html += '</div>';\n\n        html += '</div>';\n\n        container.html(html);\n\n        // Attach event listeners\n        attachEventListeners();\n\n        // Attach unicode autocomplete to math inputs\n        if (window.unicodeAutocomplete) {\n            $('.coord-math-input').each(function() {\n                window.unicodeAutocomplete.attach(this);\n            });\n            $('.coord-var-label').each(function() {\n                window.unicodeAutocomplete.attach(this);\n            });\n        }\n    }\n\n    function attachEventListeners() {\n        // Preset selection\n        $('#coord-preset').off('change').on('change', function() {\n            const presetKey = $(this).val();\n\n            if (presetKey === 'custom') {\n                // Keep current custom system\n                return;\n            }\n\n            const preset = PRESET_COORDINATE_SYSTEMS[presetKey];\n            if (preset) {\n                currentSystem = preset;\n                render();\n            }\n        });\n\n        // Variable label change\n        $('.coord-var-label').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const label = $(this).val().trim();\n\n            // Update current system (make it custom)\n            if (!currentSystem.variables[index]) {\n                currentSystem.variables[index] = { label: '', displayLabel: '' };\n            }\n            currentSystem.variables[index].displayLabel = label;\n            currentSystem.variables[index].label = label;\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Transform expression change\n        $('.coord-var-transform').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const transform = $(this).val().trim();\n\n            // Update current system (make it custom)\n            if (!currentSystem.forwardTransforms[index]) {\n                currentSystem.forwardTransforms[index] = transform;\n            } else {\n                currentSystem.forwardTransforms[index] = transform;\n            }\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Inverse transform expression change\n        $('.coord-inverse-transform').off('input').on('input', function() {\n            const index = parseInt($(this).data('index'));\n            const transform = $(this).val().trim();\n\n            // Initialize inverseTransforms array if needed\n            if (!currentSystem.inverseTransforms) {\n                currentSystem.inverseTransforms = new Array(currentDimensions).fill('');\n            }\n\n            // Update current system (make it custom)\n            currentSystem.inverseTransforms[index] = transform;\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Solve inverse button\n        $('#coord-solve-inverse').off('click').on('click', function() {\n            const button = $(this);\n            button.prop('disabled', true);\n            const originalText = button.text();\n            button.text('Solving...');\n\n            try {\n                const cartesianVars = ['x', 'y', 'z', 'w', 'u', 'v'].slice(0, currentDimensions);\n                const nativeVars = currentSystem.variables.map(v => v.label || v.displayLabel);\n\n                const inverseTransforms = solveInverseSymbolically(\n                    currentSystem.forwardTransforms,\n                    currentDimensions,\n                    cartesianVars,\n                    nativeVars\n                );\n\n                if (inverseTransforms) {\n                    // Success! Update the system and UI\n                    currentSystem.inverseTransforms = inverseTransforms;\n\n                    // Update input fields\n                    $('.coord-inverse-transform').each(function() {\n                        const index = parseInt($(this).data('index'));\n                        $(this).val(inverseTransforms[index]);\n                    });\n\n                    button.text('\u2713 Solved!');\n                    setTimeout(() => {\n                        button.text(originalText);\n                        button.prop('disabled', false);\n                    }, 1500);\n                } else {\n                    // Failed - show error\n                    alert('Could not solve inverse transforms symbolically. You can:\\n' +\n                          '1. Define the inverse transforms manually\\n' +\n                          '2. Enable \"Use iterative Newton solver\" checkbox');\n                    button.text(originalText);\n                    button.prop('disabled', false);\n                }\n\n                // Mark as custom\n                $('#coord-preset').val('custom');\n\n            } catch (error) {\n                console.error('Error solving inverse:', error);\n                alert('Error solving inverse: ' + error.message);\n                button.text(originalText);\n                button.prop('disabled', false);\n            }\n        });\n\n        // Iterative solver checkbox\n        $('#coord-use-iterative').off('change').on('change', function() {\n            const useIterative = $(this).is(':checked');\n            currentSystem.useIterativeSolver = useIterative;\n\n            // Enable/disable inverse transform inputs\n            $('.coord-inverse-transform').prop('disabled', useIterative);\n\n            if (useIterative) {\n                // Gray out inputs and show they're not needed\n                $('.coord-inverse-transform').css('opacity', '0.5');\n            } else {\n                $('.coord-inverse-transform').css('opacity', '1.0');\n            }\n\n            // Mark as custom\n            $('#coord-preset').val('custom');\n        });\n\n        // Apply button\n        $('#coord-apply').off('click').on('click', function() {\n            const button = $(this);\n\n            // Disable button and show feedback\n            button.prop('disabled', true);\n            const originalText = button.text();\n            button.text('Applying...');\n\n            try {\n                // Validate system\n                const isValid = validateSystem();\n\n                if (isValid) {\n                    // Convert Unicode symbols to ASCII in transform expressions before applying\n                    const transformsWithAscii = currentSystem.forwardTransforms.map(transform => {\n                        // Convert \u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.\n                        if (window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                            return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                        }\n                        return transform;\n                    });\n\n                    // Convert Unicode symbols in inverse transforms too\n                    const inverseTransformsWithAscii = currentSystem.inverseTransforms\n                        ? currentSystem.inverseTransforms.map(transform => {\n                            if (window.UnicodeAutocomplete && window.UnicodeAutocomplete.unicodeToAscii) {\n                                return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                            }\n                            return transform;\n                        })\n                        : null;\n\n                    // Create a proper CoordinateSystem instance (not a plain object!)\n                    // This preserves methods like getVariableNames(), toJSON(), etc.\n                    const systemToApply = new CoordinateSystem(\n                        currentSystem.name,\n                        currentSystem.dimensions,\n                        currentSystem.variables,\n                        transformsWithAscii,\n                        inverseTransformsWithAscii,\n                        currentSystem.useIterativeSolver || false\n                    );\n\n                    // Brief delay for visual feedback\n                    setTimeout(() => {\n                        // Apply coordinate system - allow temporary error states\n                        // (e.g., dimension mismatch will be resolved when dimensions update)\n                        onChange(systemToApply);\n                        button.prop('disabled', false);\n                        button.text(originalText);\n                    }, 100);\n                } else {\n                    alert('Invalid coordinate system. Please check your expressions.');\n                    button.prop('disabled', false);\n                    button.text(originalText);\n                }\n            } catch (error) {\n                console.error('Error in apply handler:', error);\n                // Don't block the change with an alert - just log and reset button\n                button.prop('disabled', false);\n                button.text(originalText);\n            }\n        });\n\n        // Cancel button\n        $('#coord-cancel').off('click').on('click', function() {\n            // Close panel (handled by caller)\n            onChange(null); // null means cancelled\n        });\n    }\n\n    function validateSystem() {\n        // Check that all variables have labels\n        for (let i = 0; i < currentDimensions; i++) {\n            if (!currentSystem.variables[i] || !currentSystem.variables[i].label) {\n                return false;\n            }\n            if (!currentSystem.forwardTransforms[i] || currentSystem.forwardTransforms[i].trim() === '') {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    function update(newSystem) {\n        currentSystem = newSystem;\n        render();\n    }\n\n    function setDimensions(newDimensions) {\n        if (newDimensions !== currentDimensions) {\n            currentDimensions = newDimensions;\n            // Reset to Cartesian for new dimensions\n            currentSystem = getCartesianSystem(newDimensions);\n            render();\n        }\n    }\n\n    // Initial render\n    render();\n\n    return editor;\n}\n\n/**\n * Show coordinate editor in a floating panel\n * @param {number} dimensions - Current number of dimensions\n * @param {Object} initialSystem - Initial coordinate system\n * @param {Function} onApply - Callback when system is applied\n */\nexport function showCoordinateEditor(dimensions, initialSystem, onApply) {\n    // Create floating panel if it doesn't exist\n    let panel = $('#coordinate-editor-panel');\n    if (!panel.length) {\n        $('body').append(`\n            <div id=\"coordinate-editor-panel\" class=\"floating-panel\" style=\"display: none;\">\n                <button class=\"floating-panel-close\" style=\"display: none;\">&times;</button>\n                <div class=\"floating-panel-header\">\n                    <h3>Coordinate System</h3>\n                </div>\n                <div id=\"coordinate-editor-container\" class=\"floating-panel-content\">\n                </div>\n            </div>\n        `);\n        panel = $('#coordinate-editor-panel');\n    }\n\n    // Show panel\n    panel.show();\n\n    // Initialize editor\n    const editor = initCoordinateEditor(\n        'coordinate-editor-container',\n        dimensions,\n        initialSystem,\n        (system) => {\n            if (system === null) {\n                // Cancelled\n                panel.hide();\n            } else {\n                // Applied\n                onApply(system);\n                panel.hide();\n            }\n        }\n    );\n\n    // Close button\n    $('.floating-panel-close', panel).off('click').on('click', function() {\n        panel.hide();\n    });\n\n    // Drag functionality (same as gradient editor)\n    let isDragging = false;\n    let dragOffsetX = 0;\n    let dragOffsetY = 0;\n\n    $('.panel-header', panel).off('mousedown').on('mousedown', function(e) {\n        isDragging = true;\n        dragOffsetX = e.clientX - panel.offset().left;\n        dragOffsetY = e.clientY - panel.offset().top;\n        $(document).on('mousemove.panelDrag', function(e) {\n            if (isDragging) {\n                panel.css({\n                    left: e.clientX - dragOffsetX,\n                    top: e.clientY - dragOffsetY\n                });\n            }\n        });\n    });\n\n    $(document).on('mouseup.panelDrag', function() {\n        isDragging = false;\n        $(document).off('mousemove.panelDrag');\n    });\n\n    return editor;\n}\n", "/**\n * Symbolic Inverse Transform Solver\n *\n * Attempts to solve for inverse coordinate transforms using symbolic equation solver.\n * Given forward transforms (Cartesian \u2192 Native), solves for reverse transforms (Native \u2192 Cartesian).\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Notebook instance (injected from main.js)\n * @type {import('./notebook.js').Notebook}\n */\nlet notebook = null;\n\n/**\n * Set the Notebook to use for inverse solving\n * @param {import('./notebook.js').Notebook} nb\n */\nexport function setNotebook(nb) {\n    notebook = nb;\n    logger.info('Inverse Solver: Notebook set (CAS engine:', notebook.casEngine.getName() + ')');\n}\n\n/**\n * Attempt to solve for inverse transforms symbolically using CAS engine\n *\n * Strategy:\n * 1. Set up equations: native_i = forwardTransform_i(cartesian vars)\n * 2. Use CAS solve() to isolate each Cartesian variable\n * 3. Simplify results\n *\n * @param {string[]} forwardTransforms - Forward transform expressions (e.g., ['sqrt(x^2+y^2)', 'atan2(y,x)'])\n * @param {number} dimensions - Number of dimensions\n * @param {string[]} cartesianVars - Cartesian variable names (e.g., ['x', 'y', 'z'])\n * @param {string[]} nativeVars - Native variable names (e.g., ['r', 'theta', 'phi'])\n * @returns {string[]|null} - Inverse transform expressions or null if failed\n */\nexport function solveInverseSymbolically(forwardTransforms, dimensions, cartesianVars, nativeVars) {\n    logger.info('=== SYMBOLIC INVERSE SOLVING ===');\n    logger.info('Forward transforms:', forwardTransforms);\n    logger.info('Cartesian vars:', cartesianVars);\n    logger.info('Native vars:', nativeVars);\n\n    if (!notebook) {\n        logger.error('Notebook not set - cannot solve inverse symbolically');\n        return null;\n    }\n\n    if (!notebook.casEngine.isReady()) {\n        logger.error('CAS engine not ready - cannot solve inverse symbolically');\n        return null;\n    }\n\n    try {\n        // NOTE: No cache clear needed - Notebook handles context automatically\n\n        const inverseTransforms = [];\n\n        // Strategy: For each Cartesian variable, try to solve from the equations\n        // This works well for 2D/3D coordinate systems with simple relationships\n\n        // For 2D Polar (r, \u03B8), we can solve:\n        //   From r = sqrt(x^2+y^2) and \u03B8 = atan2(y,x)\n        //   We can derive x = r*cos(\u03B8), y = r*sin(\u03B8)\n        //\n        // Approach:\n        //   1. Try substitution method for common patterns (polar, spherical)\n        //   2. Fall back to Nerdamer's solve() for individual variables\n\n        if (dimensions === 2 && isValidPolarTransform(forwardTransforms)) {\n            // Polar 2D: Use known inverse formulas\n            logger.info('Detected 2D polar coordinates - using standard inverse');\n            return [`${nativeVars[0]}*cos(${nativeVars[1]})`, `${nativeVars[0]}*sin(${nativeVars[1]})`];\n        }\n\n        if (dimensions === 3 && isValidCylindricalTransform(forwardTransforms)) {\n            // Cylindrical 3D: Use known inverse formulas\n            logger.info('Detected 3D cylindrical coordinates - using standard inverse');\n            return [\n                `${nativeVars[0]}*cos(${nativeVars[1]})`,  // x = \u03C1*cos(\u03C6)\n                `${nativeVars[0]}*sin(${nativeVars[1]})`,  // y = \u03C1*sin(\u03C6)\n                nativeVars[2]                               // z = z\n            ];\n        }\n\n        if (dimensions === 3 && isValidSphericalTransform(forwardTransforms)) {\n            // Spherical 3D: Use known inverse formulas\n            logger.info('Detected 3D spherical coordinates - using standard inverse');\n            return [\n                `${nativeVars[0]}*sin(${nativeVars[1]})*cos(${nativeVars[2]})`,  // x = r*sin(\u03B8)*cos(\u03C6)\n                `${nativeVars[0]}*sin(${nativeVars[1]})*sin(${nativeVars[2]})`,  // y = r*sin(\u03B8)*sin(\u03C6)\n                `${nativeVars[0]}*cos(${nativeVars[1]})`                          // z = r*cos(\u03B8)\n            ];\n        }\n\n        // General approach: Try to solve each equation individually\n        logger.info('Attempting general symbolic solve...');\n\n        for (let i = 0; i < dimensions; i++) {\n            const cartesianVar = cartesianVars[i];\n\n            // Try to isolate cartesian variable from each forward transform\n            let solved = null;\n\n            for (let j = 0; j < dimensions; j++) {\n                const nativeVar = nativeVars[j];\n                const forwardExpr = forwardTransforms[j];\n\n                try {\n                    // Set up equation: nativeVar = forwardExpr\n                    // Solve for cartesianVar using Notebook (ensures context is applied)\n                    const equation = `${nativeVar} - (${forwardExpr})`;\n                    const solutions = notebook.solve(equation, cartesianVar);\n\n                    if (solutions) {\n                        const solStr = typeof solutions === 'string' ? solutions : solutions.toString();\n                        logger.verbose(`Solved ${cartesianVar} from equation ${j}:`, solStr);\n\n                        // Check if solution is valid (doesn't contain other Cartesian variables)\n                        const containsOtherVars = cartesianVars.some((v, idx) =>\n                            idx !== i && solStr.includes(v)\n                        );\n\n                        if (!containsOtherVars) {\n                            solved = solStr;\n                            break; // Found a valid solution\n                        }\n                    }\n                } catch (e) {\n                    logger.verbose(`Failed to solve ${cartesianVar} from equation ${j}:`, e.message);\n                }\n            }\n\n            if (!solved) {\n                logger.warn(`Could not solve for ${cartesianVar} - symbolic solving failed`);\n                return null;\n            }\n\n            inverseTransforms.push(solved);\n        }\n\n        logger.info('Successfully solved inverse transforms:', inverseTransforms);\n        return inverseTransforms;\n\n    } catch (error) {\n        logger.error('Symbolic inverse solving failed:', error.message);\n        return null;\n    }\n}\n\n/**\n * Check if forward transforms match standard 2D polar pattern\n */\nfunction isValidPolarTransform(transforms) {\n    if (transforms.length !== 2) return false;\n\n    const r = transforms[0];\n    const theta = transforms[1];\n\n    // Check for sqrt(x^2 + y^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2/.test(r);\n\n    // Check for atan2(y, x) pattern\n    const hasAngleTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(theta);\n\n    return hasRadialTerm && hasAngleTerm;\n}\n\n/**\n * Check if forward transforms match standard 3D cylindrical pattern\n */\nfunction isValidCylindricalTransform(transforms) {\n    if (transforms.length !== 3) return false;\n\n    const rho = transforms[0];\n    const phi = transforms[1];\n    const z = transforms[2];\n\n    // Check for sqrt(x^2 + y^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2/.test(rho);\n\n    // Check for atan2(y, x) pattern\n    const hasAngleTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(phi);\n\n    // Check for z = z identity\n    const hasZTerm = z.trim() === 'z';\n\n    return hasRadialTerm && hasAngleTerm && hasZTerm;\n}\n\n/**\n * Check if forward transforms match standard 3D spherical pattern\n */\nfunction isValidSphericalTransform(transforms) {\n    if (transforms.length !== 3) return false;\n\n    const r = transforms[0];\n    const theta = transforms[1];\n    const phi = transforms[2];\n\n    // Check for sqrt(x^2 + y^2 + z^2) pattern\n    const hasRadialTerm = /sqrt\\s*\\(\\s*x\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*y\\s*\\^?\\*?\\*?\\s*2\\s*\\+\\s*z\\s*\\^?\\*?\\*?\\s*2/.test(r);\n\n    // Check for acos(...) pattern for polar angle\n    const hasPolarAngleTerm = /acos/.test(theta);\n\n    // Check for atan2(y, x) pattern for azimuthal angle\n    const hasAzimuthalTerm = /atan2\\s*\\(\\s*y\\s*,\\s*x\\s*\\)/.test(phi);\n\n    return hasRadialTerm && hasPolarAngleTerm && hasAzimuthalTerm;\n}\n", "/**\n * Main Controls Registry and Orchestrator\n *\n * This module serves as the central initialization point for the entire UI control system.\n * It coordinates control registration, event handlers, specialized modules, and initialization\n * sequence.\n *\n * Responsibilities:\n * - Create and configure ControlManager\n * - Register all controls (web components, sliders, checkboxes, etc.)\n * - Set up event handlers for control changes\n * - Initialize specialized modules (gradient panel, rendering panel, animation, presets, mobile)\n * - Handle settings loading/saving/sharing\n * - Set up keyboard shortcuts and modal system\n * - Coordinate bbox (camera) state restoration\n *\n * Architecture:\n * - Delegates complex UI logic to specialized modules (visibility-manager, settings-manager, etc.)\n * - Maintains backward compatibility with main.js API\n * - Returns manager instance for external access\n *\n * @module controls-registry\n */\n\nimport {\n    ControlManager,\n    SliderControl,\n    LogSliderControl,\n    PercentSliderControl,\n    AdaptiveSliderControl,\n    TimestepControl,\n    TextControl,\n    CheckboxControl\n} from './control-base.js';\n\nimport { AnimatableParameterControl } from './parameter-control.js';\nimport {\n    DimensionInputsControl,\n    MapperParamsControl,\n    GradientControl,\n    TransformParamsControl\n} from './custom-controls.js';\n\nimport { initGradientEditor } from './gradient-editor.js';\nimport { showCoordinateEditor } from './coordinate-editor.js';\nimport { CoordinateSystem, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { getDefaultGradient } from '../math/gradients.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { resizeAccordion } from './accordion-utils.js';\nimport { FieldEquationWorkflow } from '../math/field-equation-workflow.js';\nimport { WebComponentControlRegistry } from './web-component-registry.js';\nimport { equationOverlay } from './equation-overlay.js';\nimport { AnimationController } from '../animation/animation-controller.js';\nimport { ZIndex } from './utils/z-index.js';\nimport { PanelManager } from './utils/panel-manager.js';\nimport { isMobile } from './utils/mobile.js';\n\n// Import specialized modules (Phase 3 refactoring)\nimport { updateWhitePointVisibility, updateExpressionControls, updateGradientButtonVisibility, updateVelocityScalingVisibility } from './visibility-manager.js';\nimport { loadSettingsFromURLOrStorage, saveAllSettings, applyInitialSettings, restoreBBox, shareSettings } from './settings-manager.js';\nimport { loadPresets, loadPreset, initPresetControls } from './preset-manager.js';\nimport { initGradientPanel } from './panel-controllers/gradient-panel.js';\nimport { initRenderingPanel } from './panel-controllers/rendering-panel.js';\nimport { initAnimationControls } from './animation-setup.js';\nimport { initMobilePanelManager, setupMobileControlsSync } from './panel-controllers/mobile-panel-manager.js';\n\n/**\n * Initialize UI controls with ControlManager\n *\n * This is the main entry point for the UI system. It creates the ControlManager,\n * registers all controls, sets up event handlers, initializes specialized modules,\n * and loads saved settings.\n *\n * @param {Renderer} renderer - The renderer instance\n * @param {Function} callback - Called when initialization is complete with { manager, state, saveSettings }\n * @returns {ControlManager} The manager instance for external access\n */\nexport function initControls(renderer, callback) {\n    // Track previous dimensions to detect changes\n    let previousDimensions = null;\n\n    // ========================================\n    // Create ControlManager\n    // ========================================\n\n    const manager = new ControlManager({\n        renderer: renderer,\n        storageKey: 'vectorFieldSettings',\n        debounceTime: 300,\n        onApply: (settings) => {\n            // Transform implicitIterations into integratorParams\n            if (settings.implicitIterations !== undefined) {\n                settings.integratorParams = { iterations: settings.implicitIterations };\n            }\n\n            // Update expression inputs BEFORE applying to renderer if dimensions changed\n            // This ensures settings.expressions has the correct length\n            const currentDimensions = settings.dimensions;\n            if (currentDimensions !== previousDimensions) {\n                const expressionsControl = manager.get('dimension-inputs');\n                if (expressionsControl) {\n                    expressionsControl.updateInputs(currentDimensions);\n                    // Re-get expressions with correct length\n                    settings.expressions = expressionsControl.getValue();\n                }\n\n                // Update mapper params control if dimensions changed\n                const mapperParamsControl = manager.get('mapper-params');\n                if (mapperParamsControl) {\n                    mapperParamsControl.updateControls();\n                }\n\n                previousDimensions = currentDimensions;\n            }\n\n            // Keep original expressions for equation overlay display (LaTeX should show user input, not algebraic expansion)\n            const originalExpressions = settings.expressions ? [...settings.expressions] : null;\n\n            // Extract expressions from settings (will be applied via workflow)\n            const expressions = settings.expressions;\n            delete settings.expressions;\n\n            // Apply all settings EXCEPT expressions to renderer\n            renderer.updateConfig(settings);\n\n            // Apply expressions via automated workflow (validates, generates GLSL, applies)\n            if (expressions && expressions.length > 0 && window.notebook) {\n                try {\n                    const workflow = new FieldEquationWorkflow();\n                    workflow.executeAutomated(expressions, window.notebook, renderer);\n                    logger.info(`Applied ${expressions.length} field equations via workflow`);\n                } catch (error) {\n                    logger.error(`Failed to apply field equations:`, error.message);\n                    showError(`Failed to apply field equations: ${error.message}`);\n                    return; // Don't save settings if expressions failed\n                }\n            }\n\n            // Update coordinate system (just updates variable names, doesn't rebuild DOM)\n            if (renderer.coordinateSystem) {\n                const expressionsControl = manager.get('dimension-inputs');\n                if (expressionsControl) {\n                    expressionsControl.setCoordinateSystem(renderer.coordinateSystem, false);\n                }\n            }\n\n            // Update equation overlay if visible\n            if (equationOverlay.isVisible() && originalExpressions && renderer.coordinateSystem) {\n                const variables = renderer.coordinateSystem.getVariableNames();\n\n                // Expand custom functions for LaTeX rendering\n                // (Parser needs expanded form to handle function calls)\n                const expandedForLatex = originalExpressions.map(expr => {\n                    if (window.notebook) {\n                        try {\n                            return window.notebook.expandFunctions(expr);\n                        } catch (error) {\n                            logger.warn(`Failed to expand \"${expr}\" for LaTeX:`, error.message);\n                            return expr; // Fall back to original\n                        }\n                    }\n                    return expr;\n                });\n\n                equationOverlay.updateEquations(expandedForLatex, variables);\n            }\n\n            // Save to localStorage (including bbox and coordinate system)\n            const settingsToSave = manager.getSettings();\n            if (renderer && renderer.bbox) {\n                settingsToSave.bbox = {\n                    min: [...renderer.bbox.min],\n                    max: [...renderer.bbox.max]\n                };\n            }\n            if (renderer && renderer.coordinateSystem) {\n                settingsToSave.coordinateSystem = renderer.coordinateSystem.toJSON();\n            }\n            localStorage.setItem('vectorFieldSettings', JSON.stringify(settingsToSave));\n\n            // Clear any error messages\n            hideError();\n        }\n    });\n\n    // ========================================\n    // Create specialized components\n    // ========================================\n\n    // Web Component registry for async control registration\n    const webComponentRegistry = new WebComponentControlRegistry(manager);\n    manager.webComponentRegistry = webComponentRegistry;\n\n    // ========================================\n    // Register all controls\n    // ========================================\n\n    // === Dimension and integration controls ===\n\n    // Integrator select (web component with onChange handler)\n    webComponentRegistry.register('select-control', 'integrator');\n    const integratorElement = document.getElementById('integrator');\n    if (integratorElement) {\n        integratorElement.addEventListener('change', () => {\n            const value = integratorElement.getValue();\n            // Show/hide implicit method controls based on integrator type\n            const isImplicit = value.startsWith('implicit-') || value === 'trapezoidal';\n            $('#implicit-iterations-group').toggle(isImplicit);\n            $('#solution-method-group').toggle(isImplicit);\n            resizeAccordion('#integrator', 0);\n        });\n    }\n\n    // Solution method select\n    webComponentRegistry.register('select-control', 'solution-method');\n\n    // Timestep slider with custom increment buttons\n    webComponentRegistry.register('animatable-timestep', 'timestep');\n\n    // === Particle controls ===\n\n    // Fade slider with custom logarithmic transform\n    webComponentRegistry.register('animatable-slider', 'fade').then(el => {\n        if (el) {\n            // Import and apply fade transform\n            import('./web-components/animatable-slider.js').then(module => {\n                const { createFadeTransform } = module;\n                const { transform, inverseTransform } = createFadeTransform();\n                el.setCustomTransform(transform, inverseTransform);\n\n                // Update bounds display now that transform is set\n                if (el.updateBoundsDisplay) {\n                    el.updateBoundsDisplay();\n                }\n            });\n        }\n    });\n\n    // === Transform controls ===\n\n    // Transform select (web component with onChange handler)\n    webComponentRegistry.register('select-control', 'transform');\n    const transformElement = document.getElementById('transform');\n    if (transformElement) {\n        transformElement.addEventListener('change', () => {\n            // Update transform params UI when transform type changes\n            const transformParamsControl = manager.get('transform-params');\n            if (transformParamsControl) {\n                transformParamsControl.updateControls();\n            }\n        });\n    }\n\n    const transformParamsControl = manager.register(new TransformParamsControl({}, {\n        settingsKey: 'transformParams'\n    }));\n\n    // Set up transform params cross-reference\n    transformParamsControl.setTransformControl(transformElement);\n\n    // === Mapper controls ===\n\n    // Mapper select (web component with onChange handler)\n    webComponentRegistry.register('select-control', 'mapper');\n    const mapperElement = document.getElementById('mapper');\n    if (mapperElement) {\n        mapperElement.addEventListener('change', () => {\n            // Update mapper params UI when mapper type changes\n            const mapperParamsControl = manager.get('mapper-params');\n            if (mapperParamsControl) {\n                mapperParamsControl.updateControls();\n            }\n        });\n    }\n\n    const mapperParamsControl = manager.register(new MapperParamsControl({ dim1: 0, dim2: 1 }, {\n        settingsKey: 'mapperParams'\n    }));\n\n    // Set up mapper params cross-references\n    const dimensionsElement = document.getElementById('dimensions');\n    mapperParamsControl.setRelatedControls(dimensionsElement, mapperElement);\n\n    // === Color mode controls ===\n\n    // Color mode select (web component with onChange handler)\n    webComponentRegistry.register('select-control', 'color-mode');\n    const colorModeElement = document.getElementById('color-mode');\n    if (colorModeElement) {\n        colorModeElement.addEventListener('change', () => {\n            const value = colorModeElement.getValue();\n            updateExpressionControls(value);\n            updateGradientButtonVisibility(value);\n            updateVelocityScalingVisibility(value);\n        });\n    }\n\n    const colorExpressionControl = manager.register(new TextControl('color-expression', 'x * y', {\n        settingsKey: 'colorExpression'\n    }));\n\n    const gradientControl = manager.register(new GradientControl(getDefaultGradient(), {\n        settingsKey: 'colorGradient'\n    }));\n\n    // Velocity scale mode select\n    webComponentRegistry.register('select-control', 'velocity-scale-mode');\n\n    // === Expression inputs (custom control) ===\n\n    const expressionsControl = manager.register(new DimensionInputsControl(['-y', 'x'], {\n        settingsKey: 'expressions'\n    }));\n\n    // === Tone mapping controls ===\n\n    // Tonemap operator select (web component with onChange handler)\n    webComponentRegistry.register('select-control', 'tonemap-operator');\n    const tonemapElement = document.getElementById('tonemap-operator');\n    if (tonemapElement) {\n        tonemapElement.addEventListener('change', () => {\n            const value = tonemapElement.getValue();\n            updateWhitePointVisibility(value);\n        });\n    }\n\n    // Particle render mode select\n    webComponentRegistry.register('select-control', 'particle-render-mode');\n\n    // === Web Component controls ===\n\n    // Linear sliders\n    webComponentRegistry.register('linear-slider', 'dimensions').then(el => {\n        if (el) {\n            el.onChange = (value) => {\n                logger.verbose('Dimensions changed to:', value);\n\n                // Update dimension inputs immediately (before debounced apply)\n                const expressionsControl = manager.get('dimension-inputs');\n                if (expressionsControl) {\n                    logger.verbose('Updating dimension inputs with dimensions:', value);\n                    expressionsControl.updateInputs(value);\n                }\n            };\n        }\n    });\n\n    webComponentRegistry.register('linear-slider', 'implicit-iterations');\n    webComponentRegistry.register('linear-slider', 'particles');\n    webComponentRegistry.register('linear-slider', 'drop');\n    webComponentRegistry.register('linear-slider', 'supersample-factor');\n    webComponentRegistry.register('linear-slider', 'bilateral-spatial');\n    webComponentRegistry.register('linear-slider', 'bilateral-intensity');\n\n    // Log sliders\n    webComponentRegistry.register('log-slider', 'exposure');\n    webComponentRegistry.register('log-slider', 'gamma');\n    webComponentRegistry.register('log-slider', 'luminance-gamma');\n    webComponentRegistry.register('log-slider', 'highlight-compression');\n    webComponentRegistry.register('log-slider', 'compression-threshold');\n    webComponentRegistry.register('log-slider', 'white-point');\n    webComponentRegistry.register('log-slider', 'particle-intensity');\n    webComponentRegistry.register('log-slider', 'particle-size');\n    webComponentRegistry.register('log-slider', 'frame-limit').then(el => {\n        if (el) {\n            el.onChange = (value) => {\n                if (window.renderer) {\n                    window.renderer.frameLimit = value;\n                }\n            };\n        }\n    });\n\n    // Percent sliders\n    webComponentRegistry.register('percent-slider', 'smaa-intensity');\n    webComponentRegistry.register('percent-slider', 'smaa-threshold');\n    webComponentRegistry.register('percent-slider', 'color-saturation');\n    webComponentRegistry.register('percent-slider', 'brightness-desat');\n    webComponentRegistry.register('percent-slider', 'saturation-buildup');\n    webComponentRegistry.register('percent-slider', 'respawn-margin');\n\n    // Checkboxes\n    webComponentRegistry.register('check-box', 'velocity-log-scale');\n    webComponentRegistry.register('check-box', 'show-grid');\n    webComponentRegistry.register('check-box', 'show-equations');\n    webComponentRegistry.register('check-box', 'frame-limit-enabled');\n    webComponentRegistry.register('check-box', 'use-hdr');\n    webComponentRegistry.register('check-box', 'smaa-enabled');\n    webComponentRegistry.register('check-box', 'bilateral-enabled');\n    webComponentRegistry.register('check-box', 'animation-clear-particles');\n    webComponentRegistry.register('check-box', 'animation-clear-screen');\n    webComponentRegistry.register('check-box', 'animation-smooth-timing');\n    webComponentRegistry.register('check-box', 'animation-lock-shaders');\n    webComponentRegistry.register('check-box', 'animation-half-loops');\n\n    // Frame limit enabled checkbox - wire up renderer integration\n    const frameLimitEnabledCheckbox = document.getElementById('frame-limit-enabled');\n    if (frameLimitEnabledCheckbox) {\n        frameLimitEnabledCheckbox.addEventListener('change', () => {\n            if (window.renderer) {\n                window.renderer.frameLimitEnabled = frameLimitEnabledCheckbox.getValue();\n            }\n        });\n    }\n\n    // Show equations checkbox - wire up equation overlay\n    const showEquationsCheckbox = document.getElementById('show-equations');\n    if (showEquationsCheckbox) {\n\n        const cb = async () => {\n            const showEquations = showEquationsCheckbox.getValue();\n            equationOverlay.setVisible(showEquations);\n\n            // If showing for the first time, render current equations\n            if (showEquations) {\n                await equationOverlay.refresh();\n            }\n        };\n\n        showEquationsCheckbox.addEventListener('change', cb);\n    }\n\n    // === Theme control (special handling for immediate application) ===\n\n    webComponentRegistry.register('select-control', 'theme-selector');\n    const themeElement = document.getElementById('theme-selector');\n    if (themeElement) {\n        themeElement.addEventListener('change', () => {\n            const value = themeElement.getValue();\n            // Apply theme immediately (no debounce)\n            if (value === 'light') {\n                $('body').addClass('light-theme');\n            } else {\n                $('body').removeClass('light-theme');\n            }\n            // Save immediately\n            manager.saveToStorage();\n        });\n    }\n\n    // ========================================\n    // Special buttons (non-managed controls)\n    // ========================================\n\n    // Default Settings button\n    $('#default-settings').on('click', function() {\n        manager.resetAll();\n        manager.clearStorage();\n        manager.apply();\n    });\n\n    // Share URL button\n    $('#share-url').on('click', function() {\n        const settings = manager.getSettings();\n        shareSettings(settings);\n    });\n\n    // Reset button (resets camera bbox, not settings)\n    $('#reset').on('click', function() {\n        const canvas = renderer.gl.canvas;\n        const aspectRatio = canvas.width / canvas.height;\n        const height = 10; // -5 to 5\n        const width = height * aspectRatio;\n\n        renderer.updateConfig({\n            bbox: {\n                min: [-width / 2, -5],\n                max: [width / 2, 5]\n            },\n            reinitializeParticles: true\n        });\n    });\n\n    // Reset Particles button (clears screen trails)\n    $('#reset-particles').on('click', function() {\n        renderer.clearScreen();\n    });\n\n    // Save Image button (saves render buffer at scaled resolution as PNG)\n    $('#save-image').on('click', async function() {\n        try {\n            const blob = await renderer.captureRenderBuffer();\n            const url = URL.createObjectURL(blob);\n            const link = document.createElement('a');\n\n            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n            const resolution = `${renderer.renderWidth}x${renderer.renderHeight}`;\n            link.download = `vector-field-${timestamp}-${resolution}.png`;\n\n            link.href = url;\n            document.body.appendChild(link);\n            link.click();\n            document.body.removeChild(link);\n            URL.revokeObjectURL(url);\n\n            logger.info('Image saved: ' + link.download);\n        } catch (error) {\n            logger.error('Failed to save image:', error);\n            alert('Failed to save image. Check console for details.');\n        }\n    });\n\n    // Storage strategy selector (requires page reload)\n    const urlParams = new URLSearchParams(window.location.search);\n    const currentStrategy = urlParams.get('storage') || 'float';\n    $('#storage-strategy').val(currentStrategy);\n\n    $('#storage-strategy').on('change', function() {\n        const newStrategy = $(this).val();\n\n        // Save current settings before reload\n        const settings = manager.getSettings();\n        if (renderer && renderer.bbox) {\n            settings.bbox = {\n                min: [...renderer.bbox.min],\n                max: [...renderer.bbox.max]\n            };\n        }\n        if (renderer && renderer.coordinateSystem) {\n            settings.coordinateSystem = renderer.coordinateSystem.toJSON();\n        }\n        localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n\n        // Reload page with new storage strategy\n        const url = new URL(window.location);\n        url.searchParams.set('storage', newStrategy);\n        window.location.href = url.toString();\n    });\n\n    // ========================================\n    // Slider +/- button delegation\n    // ========================================\n\n    $(document).on('click', '.slider-btn', function() {\n        const sliderId = $(this).data('slider');\n        const action = $(this).data('action');\n\n        // Safety check: ignore buttons without slider ID\n        if (!sliderId) {\n            console.warn('Slider button missing data-slider attribute');\n            return;\n        }\n\n        // Try to get the registered control\n        const control = manager.get(sliderId);\n        if (control && control.handleButtonAction) {\n            control.handleButtonAction(action);\n            return;\n        }\n\n        // Handle dynamically created transform parameter sliders\n        if (sliderId.startsWith('transform-param-')) {\n            const transformParamsControl = manager.get('transform-params');\n            if (transformParamsControl && transformParamsControl.handleTransformParamButton) {\n                transformParamsControl.handleTransformParamButton(sliderId, action);\n            }\n            return;\n        }\n\n        console.warn(`No button handler found for slider: ${sliderId}`);\n    });\n\n    // ========================================\n    // Configure Coordinates button\n    // ========================================\n\n    $('#configure-coordinates').on('click', function() {\n        const currentDimensions = renderer.dimensions;\n        let currentSystem = renderer.coordinateSystem;\n\n        // Validate that coordinate system dimensions match current dimensions\n        if (!currentSystem || currentSystem.dimensions !== currentDimensions) {\n            console.warn('Coordinate system dimension mismatch, resetting to Cartesian');\n            currentSystem = getCartesianSystem(currentDimensions);\n            renderer.coordinateSystem = currentSystem;\n        }\n\n        showCoordinateEditor(currentDimensions, currentSystem, (newSystem) => {\n            // Update renderer with new coordinate system\n            renderer.updateConfig({ coordinateSystem: newSystem });\n\n            // Update dimension input labels\n            expressionsControl.setCoordinateSystem(newSystem);\n\n            // Trigger apply to recompile shaders\n            manager.apply();\n        });\n    });\n\n    // ========================================\n    // Initialize specialized modules\n    // ========================================\n\n    // Initialize gradient panel (manages gradient editor UI)\n    const gradientPanelHandlers = initGradientPanel(manager, gradientControl);\n\n    // Initialize rendering panel (manages rendering settings UI)\n    const renderingPanelHandlers = initRenderingPanel(manager);\n\n    // Initialize animation controls (manages animation UI and controllers)\n    // Returns the AnimationController instance\n    const animationController = initAnimationControls(manager, renderer, webComponentRegistry);\n\n    // Initialize preset controls (manages preset dropdown and buttons)\n    initPresetControls(manager);\n\n    // Load built-in presets\n    loadPresets();\n\n    // Initialize mobile panel manager (manages mobile overlay panels)\n    // Pass the PanelManager instance, not the handlers object\n    const mobilePanelManager = initMobilePanelManager(renderingPanelHandlers.renderingPanelManager);\n    window.mobilePanelManager = mobilePanelManager;\n\n    // Set up mobile controls sync (syncs mobile controls with main controls)\n    setupMobileControlsSync(manager, webComponentRegistry);\n\n    // ========================================\n    // Modal system and keyboard shortcuts\n    // ========================================\n\n    // Menu bar settings button\n    $(document).on('click', '#menu-settings', function() {\n        if (window.appModal) {\n            window.appModal.show();\n        }\n    });\n\n    // Menu bar docs button\n    $(document).on('click', '#menu-docs', function() {\n        if (window.appModal) {\n            window.appModal.show('docs');\n        }\n    });\n\n    // Menu bar notebook button\n    $(document).on('click', '#menu-notebook', function() {\n        if (window.notebookEditor) {\n            window.notebookEditor.open();\n        }\n    });\n\n    // Keyboard shortcut: Ctrl+, to open settings modal\n    $(document).on('keydown', function(e) {\n        if ((e.ctrlKey || e.metaKey) && e.key === ',') {\n            e.preventDefault();\n            if (window.appModal) {\n                window.appModal.show();\n            }\n        }\n    });\n\n    // ========================================\n    // Animation section accordion toggle\n    // ========================================\n\n    $('#animation-section-toggle').on('click', function() {\n        const content = $('#animation-section-content');\n        const arrow = $('#animation-section-arrow');\n        const histogram = $('#histogram-panel');\n        const cursor = $('#cursor-position');\n\n        if (content.is(':visible')) {\n            content.slideUp(200);\n            arrow.text('\u25BC');\n            histogram.removeClass('shifted');\n            cursor.removeClass('shifted');\n        } else {\n            content.slideDown(200);\n            arrow.text('\u25B2');\n            histogram.addClass('shifted');\n            cursor.addClass('shifted');\n        }\n    });\n\n    // ========================================\n    // Initialization sequence\n    // ========================================\n\n    // First, initialize controls (creates DOM elements and attaches listeners)\n    manager.initializeControls();\n\n    // Initialize equation overlay\n    equationOverlay.initialize('equation-overlay');\n\n    // Then load and apply saved settings\n    const savedSettings = loadSettingsFromURLOrStorage();\n\n    // Set mobile-specific defaults if no saved settings exist\n    if (isMobile() && (!savedSettings || (savedSettings.frameLimitEnabled === undefined && savedSettings.frameLimit === undefined))) {\n        if (frameLimitEnabledCheckbox) frameLimitEnabledCheckbox.setValue(true);\n        const frameLimitElement = document.getElementById('frame-limit');\n        if (frameLimitElement) {\n            frameLimitElement.setValue(200);\n        }\n        if (window.renderer) {\n            window.renderer.frameLimitEnabled = true;\n            window.renderer.frameLimit = 200;\n        }\n        logger.info('Mobile detected: frame limit enabled at 200 frames');\n    }\n\n    // Wait for all Web Components to be ready before applying settings\n    webComponentRegistry.whenAllReady().then(() => {\n        if (savedSettings) {\n            // Apply initial settings (includes coordinate system restoration)\n            applyInitialSettings(savedSettings, manager, renderer);\n\n            // Convert Unicode to ASCII in expressions\n            if (savedSettings.expressions && Array.isArray(savedSettings.expressions) && window.UnicodeAutocomplete) {\n                savedSettings.expressions = savedSettings.expressions.map(expr => {\n                    if (typeof expr === 'string' && window.UnicodeAutocomplete.unicodeToAscii) {\n                        return window.UnicodeAutocomplete.unicodeToAscii(expr);\n                    }\n                    return expr;\n                });\n            }\n\n            // Validate and fix mapper params if needed\n            if (savedSettings.mapperParams) {\n                const params = savedSettings.mapperParams;\n                if (params.dim1 !== undefined && params.dim2 !== undefined) {\n                    if (params.dim1 === params.dim2) {\n                        console.warn('Invalid mapper params: dim1 and dim2 are the same, fixing to default');\n                        savedSettings.mapperParams = { dim1: 0, dim2: 1 };\n                    }\n                }\n            }\n        }\n\n        // Apply settings after all Web Components are ready\n        webComponentRegistry.applyWhenReady(savedSettings).then(() => {\n            // Initialize animation controller options from restored checkbox states\n            const animClearParticles = document.getElementById('animation-clear-particles');\n            const animClearScreen = document.getElementById('animation-clear-screen');\n            const animSmoothTiming = document.getElementById('animation-smooth-timing');\n            const animLockShaders = document.getElementById('animation-lock-shaders');\n\n            animationController.setOptions({\n                clearParticles: animClearParticles?.getValue ? animClearParticles.getValue() : false,\n                clearScreen: animClearScreen?.getValue ? animClearScreen.getValue() : false,\n                smoothTiming: animSmoothTiming?.getValue ? animSmoothTiming.getValue() : false,\n                lockShaders: animLockShaders?.getValue ? animLockShaders.getValue() : false\n            });\n\n            // Initialize frame limit settings in renderer\n            if (renderer) {\n                renderer.frameLimitEnabled = frameLimitEnabledCheckbox?.getValue ? frameLimitEnabledCheckbox.getValue() : false;\n                const frameLimitElement = document.getElementById('frame-limit');\n                if (frameLimitElement) {\n                    renderer.frameLimit = frameLimitElement.getValue();\n                }\n            }\n\n            // Initialize special UI states\n            updateWhitePointVisibility(manager.get('tonemap-operator').getValue());\n            const colorMode = manager.get('color-mode').getValue();\n            updateExpressionControls(colorMode);\n            updateGradientButtonVisibility(colorMode);\n            updateVelocityScalingVisibility(colorMode);\n\n            // Initialize implicit method controls visibility\n            const currentIntegrator = manager.get('integrator').getValue() || 'rk2';\n            const isImplicit = currentIntegrator.startsWith('implicit-') || currentIntegrator === 'trapezoidal';\n            $('#implicit-iterations-group').toggle(isImplicit);\n            $('#solution-method-group').toggle(isImplicit);\n\n            // Initialize equation overlay visibility\n            if (showEquationsCheckbox?.getValue && showEquationsCheckbox.getValue()) {\n                equationOverlay.setVisible(true);\n                // Get current equations and variables from renderer\n                if (renderer && renderer.coordinateSystem) {\n                    // Use renderer.expressions (already expanded during settings apply)\n                    // Don't use simple UI expressions which may have custom functions\n                    const expressions = renderer.expressions;\n                    if (expressions) {\n                        const variables = renderer.coordinateSystem.getVariableNames();\n                        equationOverlay.updateEquations(expressions, variables);\n                    }\n                }\n            }\n\n            // Apply initial theme\n            const theme = manager.get('theme-selector').getValue();\n            if (theme === 'light') {\n                $('body').addClass('light-theme');\n            }\n        });\n    });\n\n    // ========================================\n    // Unicode autocomplete setup\n    // ========================================\n\n    if (window.unicodeAutocomplete) {\n        window.unicodeAutocomplete.setEnabled(true);\n\n        // Attach to all math input fields\n        window.unicodeAutocomplete.attachToAll('[id^=\"expr-\"]');\n        window.unicodeAutocomplete.attachToAll('#mapper-expression');\n        window.unicodeAutocomplete.attachToAll('#color-expression');\n        window.unicodeAutocomplete.attachToAll('#custom-color-code');\n        window.unicodeAutocomplete.attachToAll('#custom-integrator-code');\n\n        console.log('Unicode autocomplete enabled for all math inputs');\n    }\n\n    // ========================================\n    // Sync UI from renderer state\n    // ========================================\n\n    /**\n     * Sync simple UI controls to match renderer's authoritative state\n     * Called after field equations editor applies changes\n     */\n    function syncUIFromRenderer() {\n        if (!renderer) return;\n\n        logger.info('Syncing UI from renderer state');\n\n        // Sync dimensions (web component)\n        const dimensionsElement = document.getElementById('dimensions');\n        if (dimensionsElement && dimensionsElement.setValue && renderer.dimensions !== undefined) {\n            const currentDimValue = dimensionsElement.getValue();\n            if (currentDimValue !== renderer.dimensions) {\n                logger.info(`Syncing dimensions: ${currentDimValue} \u2192 ${renderer.dimensions}`);\n                dimensionsElement.setValue(renderer.dimensions);\n            }\n        }\n\n        // Sync expression inputs\n        const expressionsControl = manager.get('dimension-inputs');\n        if (expressionsControl && renderer.expressions) {\n            logger.info('Syncing expressions from renderer:', renderer.expressions);\n            expressionsControl.setValue(renderer.expressions);\n        }\n\n        // Update equation overlay if visible\n        if (equationOverlay && equationOverlay.isVisible && equationOverlay.isVisible() &&\n            renderer.expressions && renderer.coordinateSystem) {\n            const variables = renderer.coordinateSystem.getVariableNames();\n\n            // renderer.expressions are already expanded (workflow does this)\n            // No need to expand again\n            equationOverlay.updateEquations(renderer.expressions, variables);\n            logger.info('Updated equation overlay with new expressions');\n        }\n\n        logger.info('UI sync complete');\n    }\n\n    // Make sync function globally available\n    window.syncUIFromRenderer = syncUIFromRenderer;\n\n    // Make manager globally available for field editor sync\n    window.manager = manager;\n    window.equationOverlay = equationOverlay;\n\n    // ========================================\n    // Create save function and callback\n    // ========================================\n\n    function saveAllSettingsWrapper() {\n        return saveAllSettings(manager, renderer);\n    }\n\n    // Call initialization callback\n    if (callback) {\n        callback({\n            manager,\n            state: manager.getSettings(),\n            saveSettings: saveAllSettingsWrapper\n        });\n    }\n\n    // ========================================\n    // Restore bbox from saved settings\n    // ========================================\n\n    // Restore bbox from saved settings (handles aspect ratio expansion internally)\n    if (savedSettings && savedSettings.bbox) {\n        restoreBBox(savedSettings, renderer);\n    }\n\n    // Return manager for external access\n    return manager;\n}\n\n// ========================================\n// Helper Functions\n// ========================================\n\n/**\n * Show error message\n * @param {string} message - Error message to display\n */\nfunction showError(message) {\n    $('#error-message').text(message).show();\n}\n\n/**\n * Hide error message\n */\nfunction hideError() {\n    $('#error-message').hide();\n}\n\n// ========================================\n// Exports\n// ========================================\n\n// Export loadPreset for backward compatibility\nexport { loadPreset } from './preset-manager.js';\n", "/**\n * GLSL Generation Workflow Base Class\n *\n * Defines the architectural pattern for all GLSL generation workflows.\n * Enforces: validate \u2192 generate \u2192 apply \u2192 close/error\n *\n * Subclasses implement specific logic for different contexts:\n * - FieldEquationWorkflow - Vector field equations\n * - ColorExpressionWorkflow - Custom color expressions (future)\n * - CustomMapperWorkflow - Custom 2D mappers (future)\n * - etc.\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Result of workflow execution\n * @typedef {Object} WorkflowResult\n * @property {boolean} success - True if workflow completed successfully\n * @property {string[]} glslArray - Generated GLSL code (only if success=true)\n * @property {Array<{index: number, error: string}>} errors - Errors by index (only if success=false)\n */\n\n/**\n * Base class for GLSL generation workflows\n *\n * Subclasses must implement:\n * - getGenerationContext(index, totalCount) - Returns context object for generator\n * - applyToRenderer(glslArray, renderer) - Applies generated GLSL to renderer\n */\nexport class GLSLWorkflow {\n    /**\n     * @param {IGLSLGenerator} generator - Generator instance\n     */\n    constructor(generator) {\n        if (!generator) {\n            throw new Error('GLSLWorkflow requires a generator instance');\n        }\n        this.generator = generator;\n    }\n\n    /**\n     * Get context for generator at specific index\n     * Subclasses must implement this\n     *\n     * @param {number} index - Expression index\n     * @param {number} totalCount - Total number of expressions\n     * @returns {Object} Context object passed to generator\n     */\n    getGenerationContext(index, totalCount) {\n        throw new Error('GLSLWorkflow subclass must implement getGenerationContext()');\n    }\n\n    /**\n     * Apply generated GLSL to renderer\n     * Subclasses must implement this\n     *\n     * @param {string[]} glslArray - Generated GLSL code\n     * @param {Renderer} renderer - Renderer instance\n     * @param {string[]} expressions - Original math expressions (for context)\n     * @throws {Error} If application fails\n     */\n    applyToRenderer(glslArray, renderer, expressions) {\n        throw new Error('GLSLWorkflow subclass must implement applyToRenderer()');\n    }\n\n    /**\n     * Execute interactive workflow (from UI controls)\n     *\n     * Steps (enforced order):\n     * 1. Collect expressions from controls\n     * 2. Validate ALL expressions\n     * 3. Generate ALL GLSL (only if validation passes)\n     * 4. Apply to renderer (atomic)\n     * 5. Close modal on success, show errors on failure\n     *\n     * @param {Array<MathToGLSLControl>} controls - Array of UI controls\n     * @param {Notebook} notebook - Notebook instance\n     * @param {Renderer} renderer - Renderer instance\n     * @param {NotebookModal} modal - Modal instance\n     * @returns {Promise<WorkflowResult>}\n     */\n    async executeInteractive(controls, notebook, renderer, modal) {\n        const totalCount = controls.length;\n        const errors = [];\n\n        // Step 1: Collect expressions from controls\n        const expressions = controls.map(ctrl => ctrl.getMath());\n\n        // Step 2: Validate ALL expressions first\n        for (let i = 0; i < expressions.length; i++) {\n            const context = this.getGenerationContext(i, totalCount);\n            const validation = this.generator.validate(expressions[i], context);\n\n            if (!validation.valid) {\n                errors.push({\n                    index: i,\n                    error: validation.error\n                });\n            }\n        }\n\n        // If validation failed, show errors and keep modal open\n        if (errors.length > 0) {\n            this._displayErrors(modal, errors);\n            return { success: false, errors };\n        }\n\n        // Step 3: Generate ALL GLSL\n        const glslArray = [];\n        for (let i = 0; i < expressions.length; i++) {\n            try {\n                const context = this.getGenerationContext(i, totalCount);\n                const glsl = this.generator.generate(expressions[i], notebook, context);\n                glslArray.push(glsl);\n            } catch (error) {\n                errors.push({\n                    index: i,\n                    error: error.message\n                });\n            }\n        }\n\n        // If generation failed, show errors and keep modal open\n        if (errors.length > 0) {\n            this._displayErrors(modal, errors);\n            return { success: false, errors };\n        }\n\n        // Step 4: Apply to renderer (atomic - all or nothing)\n        try {\n            this.applyToRenderer(glslArray, renderer, expressions);\n            logger.info(`Applied ${glslArray.length} expressions to renderer`);\n        } catch (error) {\n            this._displayErrors(modal, [{\n                index: -1, // Global error\n                error: `Failed to apply to renderer: ${error.message}`\n            }]);\n            return { success: false, errors: [{ index: -1, error: error.message }] };\n        }\n\n        // Step 5: Close modal on success\n        modal.hide();\n        return { success: true, glslArray, expressions };\n    }\n\n    /**\n     * Execute automated workflow (from presets/programmatic)\n     *\n     * Steps (enforced order):\n     * 1. Validate ALL expressions\n     * 2. Generate ALL GLSL\n     * 3. Apply to renderer (atomic)\n     *\n     * @param {string[]} expressions - Array of math expressions\n     * @param {Notebook} notebook - Notebook instance\n     * @param {Renderer} renderer - Renderer instance\n     * @returns {WorkflowResult}\n     * @throws {Error} If workflow fails (automated = fail fast)\n     */\n    executeAutomated(expressions, notebook, renderer) {\n        const totalCount = expressions.length;\n        const errors = [];\n\n        // Step 1: Validate ALL expressions first\n        for (let i = 0; i < expressions.length; i++) {\n            const context = this.getGenerationContext(i, totalCount);\n            const validation = this.generator.validate(expressions[i], context);\n\n            if (!validation.valid) {\n                errors.push({\n                    index: i,\n                    error: validation.error\n                });\n            }\n        }\n\n        if (errors.length > 0) {\n            const errorMsg = errors.map(e => `Index ${e.index}: ${e.error}`).join('; ');\n            throw new Error(`Validation failed: ${errorMsg}`);\n        }\n\n        // Step 2: Generate ALL GLSL\n        const glslArray = [];\n        for (let i = 0; i < expressions.length; i++) {\n            try {\n                const context = this.getGenerationContext(i, totalCount);\n                const glsl = this.generator.generate(expressions[i], notebook, context);\n                glslArray.push(glsl);\n            } catch (error) {\n                throw new Error(`Failed to generate GLSL at index ${i}: ${error.message}`);\n            }\n        }\n\n        // Step 3: Apply to renderer (atomic)\n        try {\n            this.applyToRenderer(glslArray, renderer, expressions);\n            logger.info(`Applied ${glslArray.length} expressions to renderer (automated)`);\n        } catch (error) {\n            throw new Error(`Failed to apply to renderer: ${error.message}`);\n        }\n\n        return { success: true, glslArray, expressions };\n    }\n\n    /**\n     * Display errors in modal\n     * Can be overridden by subclasses for custom error formatting\n     *\n     * @protected\n     */\n    _displayErrors(modal, errors) {\n        const errorHtml = errors.map(e => {\n            const label = e.index >= 0 ? `Index ${e.index}` : 'Global';\n            return `<div style=\"color: #f44336; margin: 4px 0;\">\n                <strong>${label}:</strong> ${e.error}\n            </div>`;\n        }).join('');\n\n        modal.showError(errorHtml);\n    }\n}\n", "/**\n * GLSL Generator Interface\n *\n * Defines the contract for converting math expressions to GLSL code.\n * Used by both UI (MathToGLSLControl) and programmatic code.\n *\n * Pattern:\n * 1. UI passes math expression to generator\n * 2. Generator uses notebook context to expand functions\n * 3. Generator parses to GLSL\n * 4. Returns GLSL code\n *\n * This ensures UI and programmatic paths use IDENTICAL logic.\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Base interface for GLSL generation\n *\n * Subclasses implement specific generation logic (field equations, color expressions, etc.)\n */\nexport class IGLSLGenerator {\n    /**\n     * Generate GLSL code from math expression\n     *\n     * @param {string|string[]} mathExpr - Math expression(s)\n     * @param {Notebook} notebook - Notebook instance with function definitions\n     * @param {Object} context - Additional context (dimensions, variables, etc.)\n     * @returns {string} Generated GLSL code\n     * @throws {Error} If generation fails\n     */\n    generate(mathExpr, notebook, context = {}) {\n        throw new Error('IGLSLGenerator.generate() must be implemented by subclass');\n    }\n\n    /**\n     * Validate math expression before generation\n     *\n     * @param {string|string[]} mathExpr - Math expression(s)\n     * @param {Object} context - Additional context\n     * @returns {{valid: boolean, error?: string}} Validation result\n     */\n    validate(mathExpr, context = {}) {\n        throw new Error('IGLSLGenerator.validate() must be implemented by subclass');\n    }\n\n    /**\n     * Get a user-friendly description of what this generator does\n     *\n     * @returns {string} Description\n     */\n    getDescription() {\n        return 'GLSL Generator';\n    }\n\n    /**\n     * Get placeholder text for the math input\n     *\n     * @returns {string} Placeholder text\n     */\n    getMathPlaceholder() {\n        return 'Enter math expression...';\n    }\n\n    /**\n     * Get placeholder text for the GLSL output\n     *\n     * @returns {string} Placeholder text\n     */\n    getGLSLPlaceholder() {\n        return 'Generated GLSL code...';\n    }\n}\n\n/**\n * Example generator for demonstration\n * Wraps a single expression in a GLSL function\n */\nexport class SimpleExpressionGenerator extends IGLSLGenerator {\n    constructor(options = {}) {\n        super();\n        this.functionName = options.functionName || 'customFunction';\n        this.returnType = options.returnType || 'float';\n        this.parameters = options.parameters || [];\n    }\n\n    validate(mathExpr, context) {\n        if (!mathExpr || (typeof mathExpr === 'string' && !mathExpr.trim())) {\n            return { valid: false, error: 'Expression is empty' };\n        }\n        return { valid: true };\n    }\n\n    generate(mathExpr, notebook, context = {}) {\n        // Import parseExpression dynamically to avoid circular dependencies\n        const { parseExpression } = require('./parser.js');\n\n        // Step 1: Expand using notebook\n        const expanded = notebook ? notebook.expandFunctions(mathExpr) : mathExpr;\n        logger.verbose(`Expanded: \"${mathExpr}\" \u2192 \"${expanded}\"`);\n\n        // Step 2: Parse to GLSL\n        const dims = this.parameters.length;\n        const vars = this.parameters.map(p => p.name);\n        const glslExpr = parseExpression(expanded, dims, vars, 'pos');\n\n        // Step 3: Wrap in function\n        const paramList = this.parameters.map(p => `${p.type} ${p.name}`).join(', ');\n        const glslCode = `${this.returnType} ${this.functionName}(${paramList}) {\n    return ${glslExpr};\n}`;\n\n        logger.verbose('Generated GLSL:', glslCode);\n        return glslCode;\n    }\n\n    getDescription() {\n        return `Generate ${this.returnType} ${this.functionName}(...)`;\n    }\n\n    getMathPlaceholder() {\n        return 'Enter expression...';\n    }\n\n    getGLSLPlaceholder() {\n        return `${this.returnType} ${this.functionName}(...) { ... }`;\n    }\n}\n", "/**\n * Field Equation Generator\n *\n * Generates GLSL code for vector field equations (dx/dt, dy/dt, etc.)\n *\n * NOTE: This generator handles ONLY vector field equations. Other GLSL generation\n * that currently happens in the renderer needs to be migrated to IGLSLGenerator\n * implementations:\n * - Jacobian matrix generation (for Newton's method in implicit integrators)\n * - Color expression generation (custom color modes)\n * - Custom mapper expressions (2D projection)\n * - Any other user-editable GLSL expressions\n *\n * These should be user-editable in modals similar to FieldEquationsEditor.\n * See TODO.md for migration tasks.\n *\n * Usage Pattern (same for UI and automation):\n *\n * Interactive (UI):\n *   const glslArray = controls.map(ctrl => ctrl.getGLSL());\n *   renderer.updateConfig({ expressions: glslArray });\n *\n * Automated (presets):\n *   const glslArray = expressions.map((expr, i) =>\n *       generator.generate(expr, notebook, { dimension: i, totalDims: N })\n *   );\n *   renderer.updateConfig({ expressions: glslArray });\n */\n\nimport { IGLSLGenerator } from './glsl-generator.js';\nimport { parseExpression } from './parser.js';\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Generator for vector field equations\n * Converts math expressions to GLSL velocity field code\n */\nexport class FieldEquationGenerator extends IGLSLGenerator {\n    /**\n     * @param {Object} options - Generator options\n     * @param {string[]} options.variableNames - Variable names (e.g., ['x', 'y', 'z'])\n     */\n    constructor(options = {}) {\n        super();\n        this.variableNames = options.variableNames || null; // Will be inferred from context if null\n    }\n\n    /**\n     * Validate field equation expression\n     *\n     * @param {string} mathExpr - Math expression (e.g., \"sin(x) + y\")\n     * @param {Object} context - { dimension: 0, totalDims: 2 }\n     * @returns {{valid: boolean, error?: string}}\n     */\n    validate(mathExpr, context = {}) {\n        if (!mathExpr || !mathExpr.trim()) {\n            return { valid: false, error: 'Expression is empty' };\n        }\n\n        if (context.dimension === undefined) {\n            return { valid: false, error: 'Context must include dimension index' };\n        }\n\n        if (context.totalDims === undefined) {\n            return { valid: false, error: 'Context must include totalDims' };\n        }\n\n        return { valid: true };\n    }\n\n    /**\n     * Generate GLSL code for a single field equation\n     *\n     * @param {string} mathExpr - Math expression (e.g., \"-y\")\n     * @param {Notebook} notebook - Notebook instance (for function expansion)\n     * @param {Object} context - { dimension: 0, totalDims: 2 }\n     * @returns {string} GLSL expression (e.g., \"-pos.y\")\n     * @throws {Error} If generation fails\n     */\n    generate(mathExpr, notebook, context = {}) {\n        // Validate input\n        const validation = this.validate(mathExpr, context);\n        if (!validation.valid) {\n            throw new Error(`Validation failed: ${validation.error}`);\n        }\n\n        const { dimension, totalDims } = context;\n\n        // Step 1: Expand functions using notebook context\n        let expanded = mathExpr;\n        if (notebook) {\n            try {\n                expanded = notebook.expandFunctions(mathExpr);\n                logger.verbose(`Field equation ${dimension}: \"${mathExpr}\" \u2192 \"${expanded}\"`);\n            } catch (error) {\n                logger.warn(`Failed to expand functions for dimension ${dimension}:`, error.message);\n                // Continue with unexpanded expression\n            }\n        }\n\n        // Step 2: Determine variable names\n        const vars = this.variableNames || this._getDefaultVariableNames(totalDims);\n\n        // Step 3: Parse to GLSL\n        try {\n            const glslExpr = parseExpression(expanded, totalDims, vars, 'pos');\n            logger.verbose(`Field equation ${dimension} GLSL: ${glslExpr}`);\n            return glslExpr;\n        } catch (error) {\n            throw new Error(`Failed to parse expression for dimension ${dimension}: ${error.message}`);\n        }\n    }\n\n    /**\n     * Get default variable names for N dimensions\n     * @private\n     */\n    _getDefaultVariableNames(dims) {\n        const names = ['x', 'y', 'z', 'w', 'u', 'v'];\n        return names.slice(0, dims);\n    }\n\n    getDescription() {\n        return 'Vector field equation (dx/dt = ...)';\n    }\n\n    getMathPlaceholder() {\n        return 'Enter field equation (e.g., -y, sin(x), etc.)';\n    }\n\n    getGLSLPlaceholder() {\n        return 'Generated GLSL expression...';\n    }\n}\n", "/**\n * Field Equation Workflow\n *\n * Implements the workflow for vector field equations.\n * Extends GLSLWorkflow base class with field-specific logic.\n *\n * NOTE: The generated GLSL is ephemeral (cached for performance, not saved).\n * Only the original math expressions are persisted to localStorage.\n * On page reload, GLSL is regenerated from saved math expressions.\n *\n * FUTURE WORK: Create similar workflows for other GLSL generation:\n * - JacobianWorkflow - For Newton's method in implicit integrators\n * - ColorExpressionWorkflow - For custom color modes\n * - CustomMapperWorkflow - For custom 2D projections\n * See TODO.md for details.\n */\n\nimport { GLSLWorkflow } from './glsl-workflow.js';\nimport { FieldEquationGenerator } from './field-equation-generator.js';\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Workflow for field equation generation and application\n */\nexport class FieldEquationWorkflow extends GLSLWorkflow {\n    constructor(generator = null) {\n        super(generator || new FieldEquationGenerator());\n    }\n\n    /**\n     * Get generation context for field equations\n     *\n     * @param {number} index - Dimension index\n     * @param {number} totalCount - Total dimensions\n     * @returns {Object} Context with dimension and totalDims\n     */\n    getGenerationContext(index, totalCount) {\n        return {\n            dimension: index,\n            totalDims: totalCount\n        };\n    }\n\n    /**\n     * Apply field equations to renderer\n     *\n     * @param {string[]} glslArray - Generated GLSL expressions\n     * @param {Renderer} renderer - Renderer instance\n     * @param {string[]} expressions - Original math expressions\n     */\n    applyToRenderer(glslArray, renderer, expressions) {\n        // Expand custom functions for JS evaluators\n        // (They need expanded form just like GLSL, but our notebook already did this during generation)\n        // Pass the expanded form that was used for GLSL generation\n        const expandedExprs = expressions.map((expr, i) => {\n            // The GLSL was generated from expanded expressions\n            // We need to expand for JS evaluators too\n            if (window.notebook) {\n                try {\n                    return window.notebook.expandFunctions(expr);\n                } catch (error) {\n                    logger.warn(`Failed to expand \"${expr}\" for JS evaluator:`, error.message);\n                    return expr;\n                }\n            }\n            return expr;\n        });\n\n        renderer.updateConfig({\n            dimensions: expressions.length, // Update dimension count based on expression array length\n            expressions: expandedExprs,     // Expanded math for JS evaluators\n            velocityGLSL: glslArray        // Pre-generated GLSL for shaders\n        });\n    }\n\n    /**\n     * Display errors with dimension labels\n     * @protected\n     */\n    _displayErrors(modal, errors) {\n        const errorHtml = errors.map(e => {\n            const label = e.index >= 0 ? `Dimension ${e.index}` : 'Global';\n            return `<div style=\"color: #f44336; margin: 4px 0;\">\n                <strong>${label}:</strong> ${e.error}\n            </div>`;\n        }).join('');\n\n        modal.showError(errorHtml);\n    }\n}\n", "/**\n * Web Component Control Registry\n * Handles async registration of Web Components with ControlManager\n */\n\n/**\n * WebComponentControlRegistry\n * Manages registration of Web Components with ControlManager\n */\nexport class WebComponentControlRegistry {\n    constructor(manager) {\n        this.manager = manager;\n        this.registrationPromises = [];\n    }\n\n    /**\n     * Register a Web Component control\n     * @param {string} tagName - The custom element tag name (e.g., 'log-slider')\n     * @param {string} elementId - The ID of the element in the DOM\n     * @returns {Promise<HTMLElement>} Promise that resolves to the registered element\n     */\n    register(tagName, elementId) {\n        const promise = customElements.whenDefined(tagName).then(() => {\n            return new Promise((resolve) => {\n                requestAnimationFrame(() => {\n                    const element = document.getElementById(elementId);\n                    if (element && element._initialized) {\n                        // Register with ControlManager\n                        this.manager.register(element);\n\n                        // Manually attach listeners since initializeControls() already ran\n                        const debouncedCallback = () => this.manager.debouncedApply();\n                        element.attachListeners(debouncedCallback);\n\n                        resolve(element);\n                    } else {\n                        console.warn(`Web Component ${tagName}#${elementId} not found or not initialized`);\n                        resolve(null);\n                    }\n                });\n            });\n        });\n\n        this.registrationPromises.push(promise);\n        return promise;\n    }\n\n    /**\n     * Wait for all Web Components to be ready\n     * @returns {Promise<Array<HTMLElement>>} Promise that resolves to array of registered elements\n     */\n    whenAllReady() {\n        return Promise.all(this.registrationPromises);\n    }\n\n    /**\n     * Restore settings to all registered Web Components\n     * @param {Object} settings - Settings object\n     */\n    async restoreSettings(settings) {\n        const elements = await this.whenAllReady();\n\n        for (const element of elements) {\n            if (element && settings[element.settingsKey] !== undefined) {\n                element.setValue(settings[element.settingsKey]);\n            }\n        }\n    }\n\n    /**\n     * Apply settings after all Web Components are ready\n     * @param {Object} settings - Settings object (optional)\n     * @returns {Promise} Promise that resolves when settings are applied\n     */\n    async applyWhenReady(settings = null) {\n        // Wait for all components to be ready\n        await this.whenAllReady();\n\n        // Apply settings if provided\n        if (settings) {\n            this.manager.applySettings(settings);\n\n            // Restore Web Component values\n            await this.restoreSettings(settings);\n        }\n\n        // Trigger final apply to renderer\n        this.manager.apply();\n    }\n}\n", "/**\n * Equation Overlay Manager\n *\n * Displays mathematical equations over the canvas using MathJax\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { renderTeX, createSystemLatex } from '../utils/math-renderer.js';\n\nexport class EquationOverlay {\n    constructor() {\n        this.overlayElement = null;\n        this.visible = false;\n        this.currentExpressions = [];\n        this.currentVariables = [];\n        this.visibleOpacity = '60%';\n    }\n\n    /**\n     * Initialize the overlay manager\n     * @param {string} overlayId - ID of the overlay div element\n     */\n    initialize(overlayId = 'equation-overlay') {\n        this.overlayElement = document.getElementById(overlayId);\n\n        if (!this.overlayElement) {\n            logger.error(`Equation overlay element not found: #${overlayId}`);\n            return;\n        }\n\n        // Create a content wrapper for equations\n        this.contentElement = document.createElement('div');\n        this.contentElement.className = 'equation-content';\n        this.overlayElement.appendChild(this.contentElement);\n\n        // Re-scale equations on window resize\n        window.addEventListener('resize', () => {\n            if (this.visible) {\n                this.scaleToFit();\n            }\n        });\n\n        logger.info('Equation overlay initialized');\n    }\n\n    /**\n     * Show the overlay\n     */\n    show() {\n        if (!this.overlayElement) return;\n\n        this.visible = true;\n        this.overlayElement.classList.add('visible');\n        this.overlayElement.style.opacity = this.visibleOpacity || '1';\n        logger.verbose('Equation overlay shown');\n    }\n\n    /**\n     * Hide the overlay\n     */\n    hide() {\n        if (!this.overlayElement) return;\n\n        this.visible = false;\n        this.overlayElement.classList.remove('visible');\n        this.overlayElement.style.opacity = '0';\n        logger.verbose('Equation overlay hidden');\n    }\n\n    /**\n     * Toggle overlay visibility\n     * @param {boolean} visible - Whether to show the overlay\n     */\n    setVisible(visible) {\n        if (visible) {\n            this.show();\n        } else {\n            this.hide();\n        }\n    }\n\n    /**\n     * Update the equations displayed in the overlay\n     * @param {string[]} expressions - Array of expression strings\n     * @param {string[]} variables - Array of variable names (x, y, z, etc.)\n     */\n    async updateEquations(expressions, variables) {\n        if (!this.overlayElement || !this.contentElement) return;\n\n        // Store current state\n        this.currentExpressions = expressions;\n        this.currentVariables = variables;\n\n        // Don't render if not visible\n        if (!this.visible) {\n            return;\n        }\n\n        try {\n            // Create LaTeX system\n            const latex = createSystemLatex(expressions, variables);\n\n            if (!latex) {\n                this.contentElement.innerHTML = '<em>No equations</em>';\n                return;\n            }\n\n            // Render with MathJax into content wrapper (not the main overlay)\n            await renderTeX(this.contentElement, latex);\n\n            // Scale equations to fit if needed\n            this.scaleToFit();\n\n            logger.verbose(`Updated equation overlay with ${expressions.length} equations`);\n        } catch (error) {\n            logger.error('Failed to update equation overlay:', error);\n            this.contentElement.innerHTML = '<em>Error rendering equations</em>';\n        }\n    }\n\n    /**\n     * Scale equations to fit container width if needed\n     */\n    scaleToFit() {\n        if (!this.overlayElement || !this.contentElement) return;\n\n        // Find the MathJax container in the content wrapper\n        const mjxContainer = this.contentElement.querySelector('mjx-container');\n        if (!mjxContainer) return;\n\n        // Hide during resize to avoid visual bouncing (use opacity so we can still measure)\n        this.overlayElement.style.opacity = '0';\n\n        // Reset any previous scaling FIRST\n        mjxContainer.style.transform = '';\n        mjxContainer.style.transformOrigin = 'top left';\n        mjxContainer.style.fontSize = '';\n\n        // Measure actual width vs available width\n        // Wait longer for MathJax to complete its layout calculations\n        // MathJax SVG rendering can take time, especially with complex equations\n        setTimeout(() => {\n            // Force a reflow to ensure measurements are accurate\n            void mjxContainer.offsetWidth;\n\n            // Always use max-width from CSS, not current width (which may have been resized)\n            // max-width is calc(100vw - 810px)\n            const maxWidth = window.innerWidth - 810;\n            const availableWidth = maxWidth - 40; // Subtract padding (20px left + 20px right)\n\n            // MathJax creates SVG content inside mjx-container\n            // We need to measure the SVG's actual width, not the container\n            const svg = mjxContainer.querySelector('svg');\n            let contentWidth;\n\n            if (svg) {\n                // Get the SVG's natural width (viewBox or actual rendered width)\n                const svgRect = svg.getBoundingClientRect();\n                contentWidth = svgRect.width;\n            } else {\n                // Fallback: use scrollWidth which includes overflow\n                contentWidth = mjxContainer.scrollWidth;\n            }\n\n            logger.verbose(`Equation sizing: SVG content=${contentWidth.toFixed(1)}px, available=${availableWidth}px (max-width=${maxWidth}px - 40px padding)`);\n            logger.verbose(`  mjx-container: getBBox=${mjxContainer.getBoundingClientRect().width.toFixed(1)}px, scrollWidth=${mjxContainer.scrollWidth}px`);\n\n            // Helper to resize panel to fit SVG after scaling/font changes\n            const fitPanelToSVG = () => {\n                // Wait for transforms/font-size to apply\n                setTimeout(() => {\n                    // Measure final SVG size\n                    const finalSvg = mjxContainer.querySelector('svg');\n                    const finalRect = finalSvg ? finalSvg.getBoundingClientRect() : mjxContainer.getBoundingClientRect();\n\n                    const newWidth = Math.ceil(finalRect.width + 40); // Add padding (20px left + 20px right)\n                    const newHeight = Math.ceil(finalRect.height + 32); // Add padding (16px top + 16px bottom)\n\n                    this.overlayElement.style.width = `${newWidth}px`;\n                    this.overlayElement.style.height = `${newHeight}px`;\n\n                    // Restore opacity now that sizing is complete\n                    this.overlayElement.style.opacity = this.visibleOpacity || '1';\n\n                    logger.verbose(`Final panel size: ${newWidth}px \u00D7 ${newHeight}px (SVG: ${finalRect.width.toFixed(1)}px \u00D7 ${finalRect.height.toFixed(1)}px)`);\n                }, 100);\n            };\n\n            if (contentWidth > availableWidth) {\n                const ratio = contentWidth / availableWidth;\n\n                // Strategy: Try font-size reduction first (better readability than scaling)\n                if (ratio < 1.5) {\n                    // Mild overflow: just reduce font size\n                    const fontSize = Math.max(0.7, 1.0 / ratio);\n                    mjxContainer.style.fontSize = `${(fontSize * 100).toFixed(0)}%`;\n                    logger.verbose(`Reduced equation font size to ${(fontSize * 100).toFixed(0)}% to fit (${contentWidth.toFixed(1)}px \u2192 ${availableWidth}px)`);\n                } else {\n                    // Severe overflow: reduce font to 70% and apply scaling\n                    // After 70% font-size, content will be: contentWidth * 0.7\n                    // Then we scale to fit: (contentWidth * 0.7) * scaleFactor = availableWidth\n                    // So: scaleFactor = availableWidth / (contentWidth * 0.7)\n                    mjxContainer.style.fontSize = '70%';\n                    const scaleFactor = Math.max(0.4, availableWidth / (contentWidth * 0.7));\n                    mjxContainer.style.transform = `scale(${scaleFactor})`;\n                    logger.verbose(`Reduced font to 70% and scaled by ${(scaleFactor * 100).toFixed(0)}% to fit (${contentWidth.toFixed(1)}px \u2192 ${availableWidth}px)`);\n                }\n\n                // Resize panel to fit the scaled SVG\n                fitPanelToSVG();\n            } else {\n                // Content fits naturally\n                logger.verbose(`Equations fit naturally (no scaling needed)`);\n\n                // Resize panel to fit the SVG\n                fitPanelToSVG();\n            }\n        }, 250); // Longer timeout for complex MathJax rendering\n    }\n\n    /**\n     * Re-render current equations (useful after showing overlay)\n     */\n    async refresh() {\n        if (this.currentExpressions.length > 0) {\n            await this.updateEquations(this.currentExpressions, this.currentVariables);\n        }\n    }\n\n    /**\n     * Get current visibility state\n     * @returns {boolean}\n     */\n    isVisible() {\n        return this.visible;\n    }\n}\n\n// Export singleton instance\nexport const equationOverlay = new EquationOverlay();\n", "/**\n * MathJax rendering utilities\n *\n * Provides helpers for rendering LaTeX mathematical notation using MathJax v3\n */\n\nimport { logger } from './debug-logger.js';\nimport { parseExpressionToTeX } from '../math/parser.js';\n\n/**\n * Wait for MathJax to be ready\n * @returns {Promise<void>}\n */\nexport async function waitForMathJax() {\n    // If MathJax has a startup promise, wait for that\n    if (window.MathJax && window.MathJax.startup && window.MathJax.startup.promise) {\n        await window.MathJax.startup.promise;\n        logger.info('MathJax fully initialized via startup.promise');\n        return;\n    }\n\n    // Otherwise, poll for MathJax to be available\n    if (window.MathJax && window.MathJax.typesetPromise) {\n        logger.info('MathJax already available');\n        return Promise.resolve();\n    }\n\n    logger.info('Waiting for MathJax to load...');\n    return new Promise((resolve) => {\n        const checkInterval = setInterval(() => {\n            if (window.MathJax && window.MathJax.typesetPromise) {\n                clearInterval(checkInterval);\n                logger.info('MathJax loaded and ready');\n                resolve();\n            }\n        }, 100);\n\n        // Timeout after 10 seconds\n        setTimeout(() => {\n            clearInterval(checkInterval);\n            if (!window.MathJax) {\n                logger.error('MathJax failed to load after 10 seconds');\n            }\n            resolve();\n        }, 10000);\n    });\n}\n\n/**\n * Render LaTeX string to an HTML element\n * @param {HTMLElement} element - Element to render into\n * @param {string} latex - LaTeX string to render\n * @returns {Promise<void>}\n */\nexport async function renderTeX(element, latex) {\n    await waitForMathJax();\n\n    if (!window.MathJax) {\n        logger.error('MathJax not available after wait, falling back to plain text');\n        element.textContent = latex;\n        return;\n    }\n\n    try {\n        // Clear element first\n        element.innerHTML = '';\n\n        logger.info(`Rendering LaTeX:`, latex);\n\n        // Use MathJax's SVG conversion method (tex2svg)\n        // SVG doesn't require font loading - renders as vector paths\n        const renderedNode = window.MathJax.tex2svg(latex, {\n            display: true  // Display mode (centered, larger)\n        });\n\n        // Append the rendered node to the element\n        element.appendChild(renderedNode);\n\n        logger.info(`Rendered LaTeX successfully`);\n    } catch (error) {\n        logger.error('Failed to render LaTeX:', error);\n        logger.error('Error stack:', error.stack);\n        logger.error('LaTeX content:', latex);\n        element.textContent = latex; // Fallback to plain text\n    }\n}\n\n/**\n * Render LaTeX with automatic scaling to fit container width\n * @param {HTMLElement} element - Element to render into\n * @param {string} latex - LaTeX string to render\n * @param {number} maxWidth - Maximum width in pixels (defaults to element's clientWidth)\n * @returns {Promise<void>}\n */\nexport async function renderTeXScaled(element, latex, maxWidth = null) {\n    await waitForMathJax();\n\n    if (!window.MathJax) {\n        logger.error('MathJax not available after wait, falling back to plain text');\n        element.textContent = latex;\n        return;\n    }\n\n    try {\n        // Clear element first\n        element.innerHTML = '';\n\n        const renderedNode = window.MathJax.tex2svg(latex, { display: true });\n\n        // Apply scaling with proper width constraint\n        // Wrapper sized to target width to prevent overflow\n        const wrapper = document.createElement('div');\n\n        // Inner div with transform, positioned absolutely to not affect layout\n        const scaler = document.createElement('div');\n        scaler.style.cssText = `\n            transform-origin: right center;\n            display: inline-block;\n            position: absolute;\n            right: 0;\n        `;\n        scaler.appendChild(renderedNode);\n\n        // Spacer to give wrapper proper height\n        const spacer = document.createElement('div');\n        spacer.style.cssText = 'visibility: hidden';\n\n        wrapper.appendChild(scaler);\n        wrapper.appendChild(spacer);\n        element.appendChild(wrapper);\n\n        // Measure\n        const renderedRect = wrapper.getBoundingClientRect();\n        const renderedWidth = scaler.offsetWidth;\n        const targetWidth = maxWidth || element.clientWidth;\n\n        logger.info(`Rendered TeX size: ${renderedWidth}px (measured), target: ${targetWidth}px`);\n\n        // Calculate scale factor if needed\n        let scale = 1.0;\n        if (renderedWidth > targetWidth && targetWidth > 0) {\n            scale = targetWidth / renderedWidth;\n            logger.info(`Scaling TeX: ${renderedWidth}px -> ${targetWidth}px (scale: ${scale.toFixed(3)}x)`);\n        } else {\n            logger.info(`No scaling needed: rendered ${renderedWidth}px, target ${targetWidth}px`);\n        }\n\n        const heightToUse = scaler.offsetHeight;\n        wrapper.style.display = \"block\";\n        wrapper.style.position = \"relative\";\n        wrapper.style.minHeight = `${heightToUse}px`;\n        wrapper.style.maxWidth = `${targetWidth}px`;\n        scaler.style.transform = `scale(${scale})`;\n        spacer.style.height = `height: ${heightToUse * scale}px`;\n        scaler.style.visibility = \"visible\";\n        wrapper.style.visibility = \"visible\";\n\n        // Log actual rendered dimensions for debugging\n        logger.info(`Actual rendered: wrapper=${wrapper.offsetWidth}px, scaler=${scaler.offsetWidth}px, spacer=${spacer.offsetHeight}px`);\n\n        logger.info(`Rendered LaTeX successfully with scale ${scale.toFixed(3)}`);\n\n    } catch (error) {\n        logger.error('Failed to render LaTeX:', error);\n        element.textContent = latex; // Fallback to plain text\n    }\n}\n\n/**\n * Convert expression to LaTeX derivative notation\n * @param {string} expr - Expression string\n * @param {string} variable - Variable name (x, y, z, etc.)\n * @param {number} dimensions - Number of dimensions in the system\n * @returns {string} - LaTeX string\n */\nexport function toDerivativeNotation(expr, variable, dimensions) {\n    // Parse expression to LaTeX using the parser\n    logger.verbose(`Converting to derivative notation: d${variable}/dt = ${expr}`);\n    const exprLatex = parseExpressionToTeX(expr, dimensions);\n    logger.verbose(`Generated LaTeX: ${exprLatex}`);\n    // Format: \\frac{d variable}{dt} = expression\n    return `\\\\frac{d${variable}}{dt} = ${exprLatex}`;\n}\n\n/**\n * Create LaTeX system of equations from expressions array\n * @param {string[]} expressions - Array of expression strings\n * @param {string[]} variables - Array of variable names (x, y, z, etc.)\n * @returns {string} - LaTeX string for system of equations\n */\nexport function createSystemLatex(expressions, variables) {\n    logger.verbose(`createSystemLatex called with ${expressions.length} expressions:`, expressions);\n    logger.verbose(`Variables:`, variables);\n\n    if (!expressions || expressions.length === 0) {\n        return '';\n    }\n\n    const dimensions = expressions.length;\n\n    // Create simple array of equations\n    // Use \\displaystyle to force vertical fractions and proper spacing\n    const equations = expressions.map((expr, i) => {\n        const variable = variables[i] || `x_{${i}}`;\n        return `\\\\displaystyle ${toDerivativeNotation(expr, variable, dimensions)}`;\n    });\n\n    // Join with line breaks using array environment\n    return `\\\\begin{array}{l}\\n${equations.join(' \\\\\\\\\\n')}\\n\\\\end{array}`;\n}\n", "/**\n * AnimationController - Alpha-based parameter animation system\n *\n * Manages interactive real-time parameter animation using a simple alpha variable (0.0-1.0).\n * This is separate from the Animator keyframe system (animator.js), which is used for\n * professional batch rendering with complex timelines.\n *\n * Responsibilities:\n * - Manage animation alpha state and playback loop\n * - Query and update animatable controls\n * - Frame capture during animation\n * - Timing smoothing with EMA\n * - Shader lock management\n * - Integration with renderer\n *\n * Usage:\n *   const controller = new AnimationController(renderer, controlManager);\n *   controller.setAlpha(0.5);  // Manual alpha change\n *   controller.start();         // Begin auto-animation\n *   controller.stop();          // Stop auto-animation\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { AnimatableParameterControl } from '../ui/parameter-control.js';\n\nexport class AnimationController {\n    constructor(renderer, controlManager) {\n        this.renderer = renderer;\n        this.controlManager = controlManager;\n\n        // Animation state\n        this.isRunning = false;\n        this.animationFrameId = null;\n        this.direction = 1; // 1 for forward, -1 for backward\n        this.alpha = 0.0;\n\n        // Speed and timing\n        this.stepsPerIncrement = 10;\n        this.stepCounter = 0;\n\n        // Options (set via setOptions)\n        this.options = {\n            clearParticles: false,\n            clearScreen: false,\n            smoothTiming: false,\n            lockShaders: false\n        };\n\n        // Timing smoothing state - Asymmetric EMA to track high percentile (slow frames)\n        this.ALPHA_STEP_TIME_TARGET_PERCENTILE = 95;\n        this.ALPHA_STEP_TIME_DECAY = 0.002;\n        this.ALPHA_STEP_TIME_UPWARD = (this.ALPHA_STEP_TIME_TARGET_PERCENTILE / (100 - this.ALPHA_STEP_TIME_TARGET_PERCENTILE)) * this.ALPHA_STEP_TIME_DECAY;\n        this.ALPHA_STEP_TIME_WARMUP_CYCLES = 3;\n        this.ALPHA_STEP_TIME_DISPLAY_INTERVAL = 10;\n        this.alphaStepTimeEMA = null;\n        this.alphaStepStartTime = null;\n        this.alphaStepWarmupCounter = 0;\n        this.alphaStepDisplayCounter = 0;\n\n        // Caching for performance\n        this.cachedAnimatableControls = null;\n        this.cachedAnimatableParams = null;\n        this.lastAppliedSettings = null;\n\n        // Shader lock tracking\n        this.shaderLockWasEnabled = false;\n\n        // Logger verbosity during animation\n        this.savedLoggerVerbosity = null;\n\n        // Frame capture state\n        this.frameCaptureMode = null; // null, 'continuous', or 'fixed'\n        this.frameCaptureTotal = 0;\n        this.frameCaptureCount = 0;\n        this.frameCaptureAlphaIncrement = 0.01;\n        this.capturedFrames = [];\n        this.frameCaptureOnProgress = null;\n        this.frameCaptureOnComplete = null;\n\n        // Event listeners\n        this._alphaChangedListeners = [];\n    }\n\n    /**\n     * Set current alpha value and optionally update animatable controls\n     * @param {number} alpha - Alpha value (0.0 to 1.0)\n     * @param {boolean} updateControls - Whether to update animatable controls\n     */\n    setAlpha(alpha, updateControls = true) {\n        this.alpha = Math.max(0.0, Math.min(1.0, alpha));\n\n        // Update renderer\n        if (this.renderer) {\n            this.renderer.setAnimationAlpha(this.alpha);\n        }\n\n        // Update animatable controls if requested\n        if (updateControls) {\n            this._updateAnimatableControls(this.alpha);\n\n            // Apply changed settings to renderer\n            this._applyChangedSettings();\n\n            // Handle clear options\n            if (this.options.clearParticles && this.renderer) {\n                this.renderer.resetParticles();\n            }\n            if (this.options.clearScreen && this.renderer) {\n                this.renderer.clearRenderBuffer();\n            }\n        }\n\n        // Notify listeners\n        this._emitAlphaChanged(this.alpha);\n    }\n\n    /**\n     * Get current alpha value\n     * @returns {number} Current alpha (0.0 to 1.0)\n     */\n    getAlpha() {\n        return this.alpha;\n    }\n\n    /**\n     * Set animation speed (steps per increment)\n     * @param {number} stepsPerIncrement - Number of integration steps before incrementing alpha\n     */\n    setSpeed(stepsPerIncrement) {\n        this.stepsPerIncrement = Math.max(1, Math.round(stepsPerIncrement));\n    }\n\n    /**\n     * Set animation options\n     * @param {Object} options - Animation options\n     * @param {boolean} options.clearParticles - Clear particles on alpha change\n     * @param {boolean} options.clearScreen - Clear screen on alpha change (freeze mode)\n     * @param {boolean} options.smoothTiming - Enable timing smoothing with EMA\n     * @param {boolean} options.lockShaders - Lock shader recompilation during animation\n     */\n    setOptions(options) {\n        Object.assign(this.options, options);\n    }\n\n    /**\n     * Start auto-animation\n     * @param {Object} captureOptions - Optional frame capture configuration\n     * @param {boolean} captureOptions.captureFrames - Whether to capture frames\n     * @param {number} captureOptions.totalFrames - Total frames to capture\n     * @param {number} captureOptions.loops - Number of loops\n     * @param {boolean} captureOptions.halfLoops - Whether to count as half-loops\n     * @param {Function} captureOptions.onProgress - Progress callback (frameCount, totalFrames, alpha)\n     * @param {Function} captureOptions.onComplete - Completion callback (frames)\n     */\n    start(captureOptions = {}) {\n        // Stop if already running\n        if (this.isRunning) return;\n\n        const {\n            captureFrames = false,\n            totalFrames = 0,\n            loops = 1,\n            halfLoops = false,\n            onProgress = null,\n            onComplete = null\n        } = captureOptions;\n\n        // Setup frame capture if requested\n        if (captureFrames) {\n            this.frameCaptureMode = 'fixed';\n            this.frameCaptureTotal = totalFrames;\n            this.frameCaptureCount = 0;\n            this.capturedFrames = [];\n            this.frameCaptureOnProgress = onProgress;\n            this.frameCaptureOnComplete = onComplete;\n\n            // Calculate alpha increment based on half-loops mode\n            // halfLoops=false: each loop goes 0->1->0 (2 ranges per loop)\n            // halfLoops=true: each loop goes 0->1 (1 range per loop)\n            const rangesPerLoop = halfLoops ? 1.0 : 2.0;\n            this.frameCaptureAlphaIncrement = (loops * rangesPerLoop) / totalFrames;\n        } else {\n            this.frameCaptureMode = 'continuous';\n            this.frameCaptureAlphaIncrement = 0.01;\n        }\n\n        // Start animation\n        this.isRunning = true;\n\n        // Pause main renderer loop so we have full control\n        if (this.renderer) {\n            this.renderer.stop();\n        }\n\n        // Reset timing state\n        this._resetTimingState();\n\n        // Lock shaders if enabled\n        if (this.options.lockShaders && this.renderer) {\n            this.renderer.lockShaderRecompilation = true;\n            this.shaderLockWasEnabled = true;\n            logger.info('Shader recompilation lock ENABLED (animation started)', null, false);\n        } else {\n            this.shaderLockWasEnabled = false;\n        }\n\n        // Buffer logs during animation\n        this.savedLoggerVerbosity = logger.verbosity;\n        logger.setVerbosity('silent');\n\n        // Cache animatable controls\n        this._cacheAnimatableControls();\n\n        // Start the animation loop\n        this._renderLoop();\n    }\n\n    /**\n     * Stop auto-animation\n     */\n    stop() {\n        this.isRunning = false;\n\n        if (this.animationFrameId !== null) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n        }\n\n        // Resume main renderer loop\n        if (this.renderer && !this.renderer.isRunning) {\n            this.renderer.start();\n        }\n\n        // Hide step time counter\n        const stepTimeCounter = document.getElementById('step-time-counter');\n        if (stepTimeCounter) {\n            stepTimeCounter.style.display = 'none';\n        }\n\n        // Clear caches\n        this.cachedAnimatableControls = null;\n        this.cachedAnimatableParams = null;\n        this.lastAppliedSettings = null;\n\n        // Restore logger verbosity (auto-flushes buffered logs)\n        if (this.savedLoggerVerbosity !== null) {\n            logger.setVerbosity(this.savedLoggerVerbosity);\n            this.savedLoggerVerbosity = null;\n        }\n\n        // Unlock shaders if we locked them\n        if (this.shaderLockWasEnabled && this.renderer) {\n            this.renderer.lockShaderRecompilation = false;\n            this.shaderLockWasEnabled = false;\n            logger.info('Shader recompilation lock DISABLED (animation stopped)');\n        }\n\n        // Reset frame capture mode\n        this.frameCaptureMode = null;\n    }\n\n    /**\n     * Get captured frames\n     * @returns {Array<Blob>} Array of captured frame blobs\n     */\n    getFrames() {\n        return this.capturedFrames;\n    }\n\n    /**\n     * Add listener for alpha changes\n     * @param {Function} listener - Callback function (alpha)\n     */\n    onAlphaChanged(listener) {\n        this._alphaChangedListeners.push(listener);\n    }\n\n    /**\n     * Remove listener for alpha changes\n     * @param {Function} listener - Callback function to remove\n     */\n    offAlphaChanged(listener) {\n        const index = this._alphaChangedListeners.indexOf(listener);\n        if (index !== -1) {\n            this._alphaChangedListeners.splice(index, 1);\n        }\n    }\n\n    // ========================================\n    // Private Methods\n    // ========================================\n\n    /**\n     * Reset timing state for new animation\n     * @private\n     */\n    _resetTimingState() {\n        this.stepCounter = 0;\n        this.alphaStepTimeEMA = null;\n        this.alphaStepStartTime = null;\n        this.alphaStepWarmupCounter = 0;\n        this.alphaStepDisplayCounter = 0;\n        this.lastAppliedSettings = null;\n    }\n\n    /**\n     * Cache animatable controls for performance\n     * @private\n     */\n    _cacheAnimatableControls() {\n        // Cache regular animatable controls\n        this.cachedAnimatableControls = [];\n        this.controlManager.controls.forEach((control) => {\n            if (control && typeof control.animationEnabled !== 'undefined' && control.updateFromAlpha) {\n                this.cachedAnimatableControls.push(control);\n            }\n        });\n\n        // Cache animatable parameter controls\n        this.cachedAnimatableParams = [];\n        const transformParamsControl = this.controlManager.controls.get('transform-params');\n        if (transformParamsControl && transformParamsControl.parameterControls) {\n            transformParamsControl.parameterControls.forEach((paramControl) => {\n                if (paramControl instanceof AnimatableParameterControl) {\n                    this.cachedAnimatableParams.push(paramControl);\n                }\n            });\n        }\n    }\n\n    /**\n     * Update all animatable controls based on current alpha\n     * @private\n     * @param {number} alpha - Alpha value (0.0 to 1.0)\n     */\n    _updateAnimatableControls(alpha) {\n        // Build cache if not available (for manual setAlpha calls)\n        if (!this.cachedAnimatableControls) {\n            this._cacheAnimatableControls();\n        }\n\n        // Update regular animatable controls\n        for (let i = 0; i < this.cachedAnimatableControls.length; i++) {\n            const control = this.cachedAnimatableControls[i];\n            if (control.animationEnabled) {\n                control.updateFromAlpha(alpha);\n            }\n        }\n\n        // Update animatable parameter controls\n        for (let i = 0; i < this.cachedAnimatableParams.length; i++) {\n            const paramControl = this.cachedAnimatableParams[i];\n            if (paramControl.animationEnabled) {\n                paramControl.updateFromAlpha(alpha);\n            }\n        }\n    }\n\n    /**\n     * Apply changed settings to renderer\n     * @private\n     */\n    _applyChangedSettings() {\n        if (!this.renderer || !this.cachedAnimatableControls) return;\n\n        // Build changed settings directly from animatable controls\n        const changedSettings = {};\n\n        // Collect values from animatable sliders\n        for (let i = 0; i < this.cachedAnimatableControls.length; i++) {\n            const control = this.cachedAnimatableControls[i];\n            const newValue = control.getValue();\n            if (this.lastAppliedSettings === null || newValue !== this.lastAppliedSettings[control.settingsKey]) {\n                changedSettings[control.settingsKey] = newValue;\n            }\n        }\n\n        // Collect values from animatable parameters\n        for (let i = 0; i < this.cachedAnimatableParams.length; i++) {\n            const paramControl = this.cachedAnimatableParams[i];\n            const newValue = paramControl.getValue();\n            const paramKey = paramControl.parameterName;\n\n            // Build transformParams object\n            if (!changedSettings.transformParams) {\n                changedSettings.transformParams = this.lastAppliedSettings?.transformParams\n                    ? {...this.lastAppliedSettings.transformParams}\n                    : {};\n            }\n\n            if (this.lastAppliedSettings === null || newValue !== this.lastAppliedSettings.transformParams?.[paramKey]) {\n                changedSettings.transformParams[paramKey] = newValue;\n            }\n        }\n\n        // Apply changed settings to renderer (only if there are changes)\n        if (Object.keys(changedSettings).length > 0) {\n            try {\n                this.renderer.updateConfig(changedSettings);\n\n                // Update last applied settings\n                if (this.lastAppliedSettings === null) {\n                    this.lastAppliedSettings = {};\n                }\n                Object.assign(this.lastAppliedSettings, changedSettings);\n            } catch (error) {\n                logger.error('Failed to apply animation settings:', error);\n            }\n        } else if (this.lastAppliedSettings === null) {\n            // First cycle with no animatable settings - initialize tracking\n            this.lastAppliedSettings = {};\n        }\n    }\n\n    /**\n     * Main animation render loop\n     * @private\n     */\n    _renderLoop() {\n        if (!this.isRunning) {\n            return; // Animation was stopped\n        }\n\n        // Increment step counter\n        this.stepCounter++;\n\n        // Start timing on first step of alpha cycle\n        if (this.stepCounter === 1) {\n            // Clear shader recompilation flag\n            if (this.renderer && this.renderer.shadersJustRecompiled) {\n                this.renderer.shadersJustRecompiled = false;\n            }\n            this.alphaStepStartTime = performance.now();\n        }\n\n        // Check if we should increment alpha\n        if (this.stepCounter >= this.stepsPerIncrement) {\n            this.stepCounter = 0;\n\n            // If freeze mode: accumulate final step, display the buffer, THEN clear for next cycle\n            if (this.options.clearScreen && this.renderer) {\n                this.renderer.render(true);\n            }\n\n            // Calculate elapsed time for this alpha cycle\n            const alphaStepEndTime = performance.now();\n            const alphaStepElapsed = alphaStepEndTime - this.alphaStepStartTime;\n\n            // Update timing EMA\n            this._updateTimingEMA(alphaStepElapsed);\n\n            // Update alpha value\n            this.alpha += this.direction * this.frameCaptureAlphaIncrement;\n\n            // Bounce at boundaries\n            if (this.alpha >= 1.0) {\n                this.alpha = 1.0;\n                this.direction = -1;\n            } else if (this.alpha <= 0.0) {\n                this.alpha = 0.0;\n                this.direction = 1;\n            }\n\n            // Update controls and renderer\n            this._updateAnimatableControls(this.alpha);\n            if (this.renderer) {\n                this.renderer.setAnimationAlpha(this.alpha);\n            }\n            this._applyChangedSettings();\n\n            // Notify listeners (web components)\n            this._emitAlphaChanged(this.alpha);\n\n            // Handle clear options\n            if (this.options.clearParticles && this.renderer) {\n                this.renderer.resetParticles();\n            }\n\n            // Render\n            if (this.renderer) {\n                if (!this.options.clearScreen) {\n                    this.renderer.render(true);\n                }\n\n                if (this.options.clearScreen) {\n                    this.renderer.clearRenderBuffer(true);\n                }\n            }\n\n            // Capture frame if in frame capture mode\n            if (this.frameCaptureMode === 'fixed') {\n                this._captureFrame();\n            }\n\n            // Alpha cycle complete - check if we need to delay for timing smoothing\n            if (this.options.smoothTiming && this.alphaStepTimeEMA !== null && alphaStepElapsed < this.alphaStepTimeEMA) {\n                const delayNeeded = this.alphaStepTimeEMA - alphaStepElapsed;\n                setTimeout(() => {\n                    if (this.isRunning) {\n                        this.animationFrameId = requestAnimationFrame(() => this._renderLoop());\n                    }\n                }, delayNeeded);\n                return; // Exit early, setTimeout will continue the loop\n            }\n        } else {\n            // Between alpha changes (steps 1 to N-1)\n            if (this.renderer) {\n                if (this.options.clearScreen) {\n                    // Freeze mode: accumulate in hidden buffer (don't display yet)\n                    this.renderer.render(false);\n                } else {\n                    // Normal mode: render and display continuously\n                    this.renderer.render(true);\n                }\n            }\n        }\n\n        // Continue animation loop if still running\n        if (this.isRunning) {\n            this.animationFrameId = requestAnimationFrame(() => this._renderLoop());\n        }\n    }\n\n    /**\n     * Update timing EMA for smoothing\n     * @private\n     * @param {number} elapsed - Elapsed time in milliseconds\n     */\n    _updateTimingEMA(elapsed) {\n        // Update asymmetric EMA (tracks ~95th percentile) after warm-up\n        if (this.alphaStepWarmupCounter < this.ALPHA_STEP_TIME_WARMUP_CYCLES) {\n            // Still warming up - skip this cycle\n            this.alphaStepWarmupCounter++;\n        } else if (this.alphaStepTimeEMA === null) {\n            // Warm-up complete - initialize EMA from this cycle\n            this.alphaStepTimeEMA = elapsed;\n        } else {\n            // Use asymmetric smoothing: fast upward tracking, slow downward decay\n            if (elapsed > this.alphaStepTimeEMA) {\n                // Slower than EMA - track upward quickly\n                this.alphaStepTimeEMA = this.ALPHA_STEP_TIME_UPWARD * elapsed +\n                                      (1 - this.ALPHA_STEP_TIME_UPWARD) * this.alphaStepTimeEMA;\n            } else {\n                // Faster than EMA - decay slowly\n                this.alphaStepTimeEMA = this.ALPHA_STEP_TIME_DECAY * elapsed +\n                                      (1 - this.ALPHA_STEP_TIME_DECAY) * this.alphaStepTimeEMA;\n            }\n        }\n\n        // Update step time display if smoothing is enabled (throttled)\n        if (this.options.smoothTiming) {\n            this.alphaStepDisplayCounter++;\n            if (this.alphaStepDisplayCounter >= this.ALPHA_STEP_TIME_DISPLAY_INTERVAL) {\n                this.alphaStepDisplayCounter = 0;\n                const stepTimeCounter = document.getElementById('step-time-counter');\n                if (stepTimeCounter) {\n                    if (this.alphaStepTimeEMA === null) {\n                        stepTimeCounter.textContent = `Step: ${elapsed.toFixed(1)}ms (warming up...)`;\n                    } else {\n                        stepTimeCounter.textContent = `Step: ${elapsed.toFixed(1)}ms (EMA: ${this.alphaStepTimeEMA.toFixed(1)}ms)`;\n                    }\n                    stepTimeCounter.style.display = 'block';\n                }\n            }\n        } else {\n            const stepTimeCounter = document.getElementById('step-time-counter');\n            if (stepTimeCounter) {\n                stepTimeCounter.style.display = 'none';\n            }\n        }\n    }\n\n    /**\n     * Capture current frame\n     * @private\n     */\n    async _captureFrame() {\n        if (!this.renderer) return;\n\n        try {\n            const blob = await this.renderer.captureRenderBuffer();\n            this.capturedFrames.push(blob);\n            this.frameCaptureCount++;\n\n            // Call progress callback\n            if (this.frameCaptureOnProgress) {\n                this.frameCaptureOnProgress(this.frameCaptureCount, this.frameCaptureTotal, this.alpha);\n            }\n\n            // Check if we're done\n            if (this.frameCaptureCount >= this.frameCaptureTotal) {\n                this.stop();\n                if (this.frameCaptureOnComplete) {\n                    this.frameCaptureOnComplete(this.capturedFrames);\n                }\n            }\n        } catch (error) {\n            console.error('Failed to capture animation frame:', error);\n            this.stop();\n            alert('Failed to capture animation frame. Check console for details.');\n        }\n    }\n\n    /**\n     * Emit alpha changed event to listeners\n     * @private\n     * @param {number} alpha - New alpha value\n     */\n    _emitAlphaChanged(alpha) {\n        for (const listener of this._alphaChangedListeners) {\n            listener(alpha);\n        }\n    }\n}\n", "/**\n * Centralized Z-Index Management\n *\n * Single source of truth for all z-index values in the application.\n * This eliminates 20+ scattered z-index definitions across multiple files.\n *\n * @module ui/utils/z-index\n */\n\n/**\n * Z-Index hierarchy constants\n * Values are ordered from lowest (background) to highest (foreground)\n */\nexport const ZIndex = {\n    /** Grid canvas overlay (background) */\n    GRID: 1,\n\n    /** Info counters (step time, FPS) */\n    COUNTERS: 10,\n\n    /** Main controls panel (desktop) */\n    CONTROLS_PANEL: 200,\n\n    /** Coordinate editor floating panel */\n    COORDINATE_EDITOR: 300,\n\n    /** Gradient editor floating panel */\n    GRADIENT_PANEL: 325,\n\n    /** Rendering effects floating panel */\n    RENDERING_PANEL: 350,\n\n    /** Mobile view control buttons */\n    MOBILE_VIEW_CONTROLS: 9998,\n\n    /** Mobile menu bar (side panel) */\n    MOBILE_MENU_BAR: 10000,\n\n    /** Desktop menu bar (top) */\n    MENU_BAR: 10001,\n\n    /** Menu bar lowered state (when panels are open on mobile) */\n    MENU_BAR_LOWERED: 1,\n\n    /** Mobile panel overlay (full screen) */\n    MOBILE_PANEL: 20000,\n\n    /** Close buttons (above everything) */\n    CLOSE_BUTTON: 99999\n};\n\n/**\n * Lower the menu bar z-index (used when panels are open on mobile)\n * This ensures panels appear above the menu bar\n */\nexport function lowerMenuBar() {\n    $('#menu-bar').css('z-index', ZIndex.MENU_BAR_LOWERED);\n}\n\n/**\n * Restore the menu bar to its normal z-index\n * Called when panels are closed on mobile\n */\nexport function restoreMenuBar() {\n    $('#menu-bar').css('z-index', ZIndex.MENU_BAR);\n}\n\n/**\n * Get the z-index value for a specific layer\n * Useful for debugging or dynamic z-index management\n *\n * @param {string} layerName - Name of the layer (e.g., 'MENU_BAR')\n * @returns {number|undefined} The z-index value or undefined if not found\n */\nexport function getZIndex(layerName) {\n    return ZIndex[layerName];\n}\n\n/**\n * Get all z-index layers sorted by value\n * Useful for debugging the stacking context\n *\n * @returns {Array<{name: string, value: number}>} Sorted array of z-index layers\n */\nexport function getLayersSorted() {\n    return Object.entries(ZIndex)\n        .map(([name, value]) => ({ name, value }))\n        .sort((a, b) => a.value - b.value);\n}\n", "/**\n * Mobile Detection Utilities\n *\n * Single source of truth for mobile breakpoint detection.\n * This eliminates 5+ hardcoded breakpoint checks throughout the codebase.\n *\n * @module ui/utils/mobile\n */\n\n/**\n * Mobile breakpoint in pixels\n * Screens <= this width are considered mobile\n */\nexport const MOBILE_BREAKPOINT = 768;\n\n/**\n * Check if the current viewport is mobile size\n *\n * @returns {boolean} True if viewport width is <= mobile breakpoint\n *\n * @example\n * if (isMobile()) {\n *     // Apply mobile-specific behavior\n * }\n */\nexport function isMobile() {\n    return window.innerWidth <= MOBILE_BREAKPOINT;\n}\n\n/**\n * Check if the current viewport is desktop size\n *\n * @returns {boolean} True if viewport width is > mobile breakpoint\n */\nexport function isDesktop() {\n    return window.innerWidth > MOBILE_BREAKPOINT;\n}\n\n/**\n * Register a callback for when the viewport crosses the mobile breakpoint\n *\n * @param {Function} callback - Function to call when breakpoint changes\n * @returns {Function} Cleanup function to remove the listener\n *\n * @example\n * const cleanup = onBreakpointChange((isMobile) => {\n *     console.log('Mobile mode:', isMobile);\n * });\n *\n * // Later, to stop listening:\n * cleanup();\n */\nexport function onBreakpointChange(callback) {\n    const mediaQuery = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT}px)`);\n\n    // Call immediately with current state\n    callback(mediaQuery.matches);\n\n    // Listen for changes\n    const handler = (e) => callback(e.matches);\n    mediaQuery.addEventListener('change', handler);\n\n    // Return cleanup function\n    return () => mediaQuery.removeEventListener('change', handler);\n}\n\n/**\n * Execute different functions based on mobile/desktop state\n *\n * @param {Object} options\n * @param {Function} options.mobile - Function to execute on mobile\n * @param {Function} options.desktop - Function to execute on desktop\n *\n * @example\n * executeForViewport({\n *     mobile: () => showMobileMenu(),\n *     desktop: () => showDesktopMenu()\n * });\n */\nexport function executeForViewport({ mobile, desktop }) {\n    if (isMobile() && mobile) {\n        mobile();\n    } else if (isDesktop() && desktop) {\n        desktop();\n    }\n}\n\n/**\n * Get a CSS media query string for the mobile breakpoint\n *\n * @returns {string} Media query string\n *\n * @example\n * const mq = getMobileMediaQuery();\n * // Returns: \"(max-width: 768px)\"\n */\nexport function getMobileMediaQuery() {\n    return `(max-width: ${MOBILE_BREAKPOINT}px)`;\n}\n\n/**\n * Get a CSS media query string for the desktop breakpoint\n *\n * @returns {string} Media query string\n *\n * @example\n * const mq = getDesktopMediaQuery();\n * // Returns: \"(min-width: 769px)\"\n */\nexport function getDesktopMediaQuery() {\n    return `(min-width: ${MOBILE_BREAKPOINT + 1}px)`;\n}\n", "/**\n * Panel Manager - Unified Panel Show/Hide Logic\n *\n * Eliminates 42+ duplicate show/hide operations across the codebase.\n * Provides centralized z-index management for panels on mobile devices.\n *\n * @module ui/utils/panel-manager\n */\n\nimport { ZIndex, lowerMenuBar, restoreMenuBar } from './z-index.js';\nimport { isMobile } from './mobile.js';\n\n/**\n * Manages a single panel's visibility and z-index behavior\n *\n * @class PanelManager\n *\n * @example\n * const gradientPanel = new PanelManager('#gradient-panel', {\n *     zIndex: ZIndex.GRADIENT_PANEL,\n *     onShow: () => console.log('Panel shown'),\n *     onHide: () => console.log('Panel hidden')\n * });\n *\n * gradientPanel.show(); // Shows panel with correct z-index\n * gradientPanel.hide(); // Hides panel and restores menu bar\n */\nexport class PanelManager {\n    /**\n     * Create a new panel manager\n     *\n     * @param {string} panelSelector - jQuery selector for the panel element\n     * @param {Object} options - Configuration options\n     * @param {Function} [options.onShow] - Callback when panel is shown\n     * @param {Function} [options.onHide] - Callback when panel is hidden\n     * @param {number} [options.zIndex] - Z-index to use on mobile (default: ZIndex.MOBILE_PANEL)\n     * @param {boolean} [options.manageMobileOnly=true] - Only manage z-index on mobile\n     */\n    constructor(panelSelector, options = {}) {\n        this.panel = $(panelSelector);\n        this.panelSelector = panelSelector;\n        this.closeButton = this.panel.find('.floating-panel-close, .mobile-overlay-close');\n        this.onShow = options.onShow;\n        this.onHide = options.onHide;\n        this.zIndex = options.zIndex || ZIndex.MOBILE_PANEL;\n        this.manageMobileOnly = options.manageMobileOnly !== false;\n\n        if (!this.panel.length) {\n            console.warn(`PanelManager: Panel not found: ${panelSelector}`);\n        }\n    }\n\n    /**\n     * Show the panel\n     * On mobile, automatically manages z-index and lowers menu bar\n     */\n    show() {\n        if (!this.panel.length) return;\n\n        this.panel.show();\n\n        // On mobile, ensure proper z-index stacking\n        if (!this.manageMobileOnly || isMobile()) {\n            this.panel.css('z-index', this.zIndex);\n            this.closeButton.css('z-index', ZIndex.CLOSE_BUTTON);\n            lowerMenuBar();\n        }\n\n        // Call custom show callback\n        if (this.onShow) {\n            this.onShow();\n        }\n    }\n\n    /**\n     * Hide the panel\n     * On mobile, restores menu bar z-index\n     */\n    hide() {\n        if (!this.panel.length) return;\n\n        this.panel.hide();\n\n        // On mobile, restore menu bar\n        if (!this.manageMobileOnly || isMobile()) {\n            restoreMenuBar();\n        }\n\n        // Call custom hide callback\n        if (this.onHide) {\n            this.onHide();\n        }\n    }\n\n    /**\n     * Toggle panel visibility\n     */\n    toggle() {\n        if (this.isVisible()) {\n            this.hide();\n        } else {\n            this.show();\n        }\n    }\n\n    /**\n     * Check if panel is currently visible\n     *\n     * @returns {boolean} True if panel is visible\n     */\n    isVisible() {\n        return this.panel.is(':visible');\n    }\n\n    /**\n     * Set the z-index for this panel\n     *\n     * @param {number} zIndex - New z-index value\n     */\n    setZIndex(zIndex) {\n        this.zIndex = zIndex;\n        if (this.isVisible() && (!this.manageMobileOnly || isMobile())) {\n            this.panel.css('z-index', zIndex);\n        }\n    }\n\n    /**\n     * Get the panel jQuery element\n     *\n     * @returns {jQuery} The panel element\n     */\n    getPanel() {\n        return this.panel;\n    }\n\n    /**\n     * Wire up the close button to hide the panel\n     * Call this during initialization if needed\n     */\n    wireCloseButton() {\n        this.closeButton.off('click.panelManager').on('click.panelManager', () => {\n            this.hide();\n        });\n    }\n\n    /**\n     * Enable click-outside-to-close behavior\n     *\n     * @param {Array<string>} excludeSelectors - jQuery selectors for elements that shouldn't trigger close\n     * @example\n     * panelManager.enableClickOutside(['#open-button', '#mobile-menu-button']);\n     */\n    enableClickOutside(excludeSelectors = []) {\n        this.clickOutsideExclusions = [this.panelSelector, ...excludeSelectors];\n\n        // Remove any existing handler\n        $(document).off('click.panelManager' + this.panelSelector);\n\n        // Add new handler\n        $(document).on('click.panelManager' + this.panelSelector, (e) => {\n            // Check if click is inside panel or any excluded elements\n            for (const selector of this.clickOutsideExclusions) {\n                if ($(e.target).is(selector) || $(e.target).closest(selector).length > 0) {\n                    return; // Don't close\n                }\n            }\n\n            // Click is outside - close panel if visible\n            if (this.isVisible()) {\n                this.hide();\n            }\n        });\n\n        // Prevent clicks inside panel from propagating\n        this.panel.off('click.panelManagerStop').on('click.panelManagerStop', (e) => {\n            e.stopPropagation();\n        });\n    }\n\n    /**\n     * Disable click-outside-to-close behavior\n     */\n    disableClickOutside() {\n        $(document).off('click.panelManager' + this.panelSelector);\n        this.panel.off('click.panelManagerStop');\n        this.clickOutsideExclusions = null;\n    }\n\n    /**\n     * Clean up event listeners\n     * Call this when destroying the panel manager\n     */\n    destroy() {\n        this.closeButton.off('click.panelManager');\n        this.disableClickOutside();\n    }\n}\n\n/**\n * Create and manage multiple panels as a group\n *\n * @class PanelGroup\n *\n * @example\n * const group = new PanelGroup({\n *     gradient: '#gradient-panel',\n *     rendering: '#rendering-panel'\n * });\n *\n * group.show('gradient'); // Shows gradient, hides others\n * group.hideAll(); // Hides all panels\n */\nexport class PanelGroup {\n    /**\n     * Create a panel group\n     *\n     * @param {Object<string, string|PanelManager>} panels - Map of panel names to selectors or PanelManagers\n     * @param {Object} options - Configuration options\n     * @param {boolean} [options.exclusive=true] - Only show one panel at a time\n     */\n    constructor(panels, options = {}) {\n        this.panels = {};\n        this.exclusive = options.exclusive !== false;\n        this.currentPanel = null;\n\n        // Initialize panel managers\n        for (const [name, panelOrSelector] of Object.entries(panels)) {\n            if (panelOrSelector instanceof PanelManager) {\n                this.panels[name] = panelOrSelector;\n            } else {\n                this.panels[name] = new PanelManager(panelOrSelector, options);\n            }\n        }\n    }\n\n    /**\n     * Show a panel by name\n     *\n     * @param {string} name - Panel name\n     */\n    show(name) {\n        const panel = this.panels[name];\n        if (!panel) {\n            console.warn(`PanelGroup: Panel not found: ${name}`);\n            return;\n        }\n\n        // If exclusive, hide current panel\n        if (this.exclusive && this.currentPanel && this.currentPanel !== name) {\n            this.hide(this.currentPanel);\n        }\n\n        panel.show();\n        this.currentPanel = name;\n    }\n\n    /**\n     * Hide a panel by name\n     *\n     * @param {string} name - Panel name\n     */\n    hide(name) {\n        const panel = this.panels[name];\n        if (!panel) {\n            console.warn(`PanelGroup: Panel not found: ${name}`);\n            return;\n        }\n\n        panel.hide();\n\n        if (this.currentPanel === name) {\n            this.currentPanel = null;\n        }\n    }\n\n    /**\n     * Toggle a panel by name\n     *\n     * @param {string} name - Panel name\n     */\n    toggle(name) {\n        const panel = this.panels[name];\n        if (!panel) {\n            console.warn(`PanelGroup: Panel not found: ${name}`);\n            return;\n        }\n\n        if (panel.isVisible()) {\n            this.hide(name);\n        } else {\n            this.show(name);\n        }\n    }\n\n    /**\n     * Hide all panels in the group\n     */\n    hideAll() {\n        for (const name of Object.keys(this.panels)) {\n            this.hide(name);\n        }\n    }\n\n    /**\n     * Get the currently visible panel name\n     *\n     * @returns {string|null} Panel name or null if none visible\n     */\n    getCurrentPanel() {\n        return this.currentPanel;\n    }\n\n    /**\n     * Get a specific panel manager\n     *\n     * @param {string} name - Panel name\n     * @returns {PanelManager|undefined} The panel manager\n     */\n    getPanel(name) {\n        return this.panels[name];\n    }\n}\n", "/**\n * Control Visibility Management\n *\n * Handles show/hide logic for UI controls based on other control states.\n * Pure UI visibility functions with no state management.\n */\n\n/**\n * Update white point visibility based on tonemap operator\n * @param {string} operator - The selected tonemap operator\n */\nexport function updateWhitePointVisibility(operator) {\n    const operatorsWithWhitePoint = ['reinhard_extended', 'uncharted2', 'hable', 'luminance_extended'];\n    const showWhitePoint = operatorsWithWhitePoint.includes(operator);\n    $('#white-point-control').toggle(showWhitePoint);\n}\n\n/**\n * Update expression controls visibility based on color mode\n * @param {string} colorMode - The selected color mode\n */\nexport function updateExpressionControls(colorMode) {\n    if (colorMode === 'expression') {\n        $('#expression-controls').show();\n    } else {\n        $('#expression-controls').hide();\n    }\n}\n\n/**\n * Update gradient button visibility based on color mode\n * @param {string} colorMode - The selected color mode\n */\nexport function updateGradientButtonVisibility(colorMode) {\n    const supportsGradient = colorMode === 'expression' ||\n                              colorMode === 'velocity_magnitude' ||\n                              colorMode === 'velocity_angle' ||\n                              colorMode === 'velocity_combined';\n\n    if (supportsGradient) {\n        $('#gradient-button-container').show();\n    } else {\n        $('#gradient-button-container').hide();\n    }\n\n    // Show/hide preset toggle based on mode\n    if (colorMode === 'expression') {\n        $('#gradient-preset-toggle').hide();\n    } else {\n        $('#gradient-preset-toggle').show();\n    }\n}\n\n/**\n * Update velocity scaling controls visibility based on color mode\n * @param {string} colorMode - The selected color mode\n */\nexport function updateVelocityScalingVisibility(colorMode) {\n    const usesVelocity = colorMode === 'velocity_magnitude' ||\n                         colorMode === 'velocity_combined';\n\n    if (usesVelocity) {\n        $('#velocity-scaling-container').show();\n        $('#velocity-log-container').show();\n    } else {\n        $('#velocity-scaling-container').hide();\n        $('#velocity-log-container').hide();\n    }\n}\n", "/**\n * Settings Management Module\n *\n * Handles loading, saving, encoding/decoding, and sharing of application settings.\n * Supports:\n * - URL parameter sharing (?s=base64)\n * - localStorage persistence\n * - Coordinate system save/restore\n * - Bbox (pan/zoom state) save/restore\n * - URL clipboard sharing\n */\n\nimport { CoordinateSystem, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { logger } from '../utils/debug-logger.js';\n\n// ========================================\n// URL Encoding/Decoding Functions\n// ========================================\n\n/**\n * Decode settings from base64 URL string\n * @param {string} base64 - Base64-encoded settings string\n * @returns {Object|null} Decoded settings object or null on error\n */\nfunction decodeSettings(base64) {\n    try {\n        // Restore standard base64 characters\n        let normalized = base64\n            .replace(/-/g, '+')\n            .replace(/_/g, '/');\n\n        // Restore padding\n        while (normalized.length % 4) {\n            normalized += '=';\n        }\n\n        const json = atob(normalized);\n        return JSON.parse(json);\n    } catch (e) {\n        console.error('Failed to decode settings:', e);\n        return null;\n    }\n}\n\n/**\n * Encode settings to base64 URL string\n * @param {Object} settings - Settings object to encode\n * @returns {string|null} Base64-encoded settings string or null on error\n */\nfunction encodeSettings(settings) {\n    try {\n        const json = JSON.stringify(settings);\n        // Use btoa for base64 encoding, with URL-safe replacements\n        const base64 = btoa(json)\n            .replace(/\\+/g, '-')\n            .replace(/\\//g, '_')\n            .replace(/=+$/, ''); // Remove padding\n        return base64;\n    } catch (e) {\n        console.error('Failed to encode settings:', e);\n        return null;\n    }\n}\n\n// ========================================\n// Settings Loading\n// ========================================\n\n/**\n * Load settings from URL parameter or localStorage\n * Priority: URL parameter (?s=base64) > localStorage\n * If loaded from URL, saves to localStorage and cleans URL\n *\n * @returns {Object|null} Settings object or null if none found\n */\nexport function loadSettingsFromURLOrStorage() {\n    try {\n        // First, check for URL parameter (?s=base64string)\n        const urlParams = new URLSearchParams(window.location.search);\n        const urlSettings = urlParams.get('s');\n\n        let settings = null;\n\n        if (urlSettings) {\n            // Decode from URL parameter\n            settings = decodeSettings(urlSettings);\n            if (settings) {\n                console.log('Loaded settings from URL parameter');\n                // Save to localStorage for future visits\n                localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n\n                // Clean URL by removing the 's' parameter (keep other params like 'storage')\n                urlParams.delete('s');\n                const newSearch = urlParams.toString();\n                const newUrl = window.location.pathname + (newSearch ? '?' + newSearch : '');\n                window.history.replaceState({}, '', newUrl);\n                console.log('URL cleaned, settings now in localStorage');\n            }\n        } else {\n            // Fall back to localStorage\n            const saved = localStorage.getItem('vectorFieldSettings');\n            if (saved) {\n                settings = JSON.parse(saved);\n                console.log('Loaded settings from localStorage');\n            }\n        }\n\n        return settings;\n    } catch (e) {\n        console.warn('Failed to load settings:', e);\n        return null;\n    }\n}\n\n// ========================================\n// Settings Saving\n// ========================================\n\n/**\n * Save settings to localStorage with bbox and coordinate system\n * @param {ControlManager} manager - The control manager instance\n * @param {Renderer} renderer - The renderer instance\n * @returns {Object} The saved settings object\n */\nexport function saveAllSettings(manager, renderer) {\n    const settings = manager.getSettings();\n\n    // Add bbox from renderer\n    if (renderer && renderer.bbox) {\n        settings.bbox = {\n            min: [...renderer.bbox.min],\n            max: [...renderer.bbox.max]\n        };\n    }\n\n    // Add coordinate system from renderer\n    if (renderer && renderer.coordinateSystem) {\n        settings.coordinateSystem = renderer.coordinateSystem.toJSON();\n    }\n\n    // Save to localStorage\n    localStorage.setItem('vectorFieldSettings', JSON.stringify(settings));\n    return settings;\n}\n\n// ========================================\n// Settings Sharing (URL Generation)\n// ========================================\n\n/**\n * Share settings via URL (copies to clipboard)\n * Generates a shareable URL with settings encoded as base64\n * Preserves the storage parameter if present\n *\n * @param {Object} settings - Settings object to share\n */\nexport function shareSettings(settings) {\n    const encoded = encodeSettings(settings);\n\n    if (!encoded) {\n        alert('Failed to encode settings');\n        return;\n    }\n\n    // Build URL with settings parameter\n    const url = new URL(window.location.href);\n    // Keep storage parameter if present\n    url.search = '';\n    const storageParam = new URLSearchParams(window.location.search).get('storage');\n    if (storageParam) {\n        url.searchParams.set('storage', storageParam);\n    }\n    url.searchParams.set('s', encoded);\n\n    const shareUrl = url.toString();\n\n    // Copy to clipboard (only available in secure contexts: HTTPS or localhost)\n    if (navigator.clipboard && navigator.clipboard.writeText) {\n        navigator.clipboard.writeText(shareUrl).then(() => {\n            const button = $('#share-url');\n            const originalText = button.text();\n            button.text('URL Copied!');\n            setTimeout(() => {\n                button.text(originalText);\n            }, 2000);\n        }).catch(err => {\n            console.error('Failed to copy URL to clipboard:', err);\n            // Fallback: show the URL in an alert\n            alert('Share this URL:\\n\\n' + shareUrl);\n        });\n    } else {\n        // Clipboard API not available (HTTP, not HTTPS)\n        // Fallback: select the URL in a temporary input field\n        const tempInput = document.createElement('input');\n        tempInput.value = shareUrl;\n        document.body.appendChild(tempInput);\n        tempInput.select();\n        tempInput.setSelectionRange(0, 99999); // For mobile\n\n        try {\n            // Try old execCommand method\n            const success = document.execCommand('copy');\n            document.body.removeChild(tempInput);\n\n            if (success) {\n                const button = $('#share-url');\n                const originalText = button.text();\n                button.text('URL Copied!');\n                setTimeout(() => {\n                    button.text(originalText);\n                }, 2000);\n            } else {\n                throw new Error('execCommand failed');\n            }\n        } catch (err) {\n            document.body.removeChild(tempInput);\n            // Final fallback: show the URL\n            alert('Copy this URL to share:\\n\\n' + shareUrl);\n        }\n    }\n}\n\n// ========================================\n// Coordinate System Restoration\n// ========================================\n\n/**\n * Restore coordinate system from saved settings\n * Validates dimension matching and falls back to Cartesian on error\n *\n * @param {Object} savedSettings - Settings object containing coordinateSystem\n * @param {Renderer} renderer - The renderer instance\n * @param {DimensionInputsControl} expressionsControl - The dimension inputs control\n * @returns {boolean} True if coordinate system was restored successfully\n */\nexport function restoreCoordinateSystem(savedSettings, renderer, expressionsControl) {\n    if (!savedSettings || !savedSettings.coordinateSystem || !savedSettings.dimensions) {\n        return false;\n    }\n\n    try {\n        const coordSystemData = savedSettings.coordinateSystem;\n\n        // Convert Unicode symbols to ASCII in forward transforms\n        if (coordSystemData.forwardTransforms && window.UnicodeAutocomplete) {\n            coordSystemData.forwardTransforms = coordSystemData.forwardTransforms.map(transform => {\n                if (typeof transform === 'string' && window.UnicodeAutocomplete.unicodeToAscii) {\n                    return window.UnicodeAutocomplete.unicodeToAscii(transform);\n                }\n                return transform;\n            });\n        }\n\n        const coordinateSystem = CoordinateSystem.fromJSON(coordSystemData);\n\n        // Validate that coordinate system dimensions match saved dimensions\n        if (coordinateSystem.dimensions === savedSettings.dimensions) {\n            renderer.coordinateSystem = coordinateSystem;\n            expressionsControl.setCoordinateSystem(coordinateSystem, false);\n            console.log('Restored coordinate system:', coordinateSystem.name);\n            return true;\n        } else {\n            // Dimension mismatch - reset to Cartesian for the correct dimensions\n            console.warn(`Coordinate system dimension mismatch: system has ${coordinateSystem.dimensions}D but settings use ${savedSettings.dimensions}D. Resetting to Cartesian.`);\n            const cartesianSystem = getCartesianSystem(savedSettings.dimensions);\n            renderer.coordinateSystem = cartesianSystem;\n            expressionsControl.setCoordinateSystem(cartesianSystem, false);\n            return false;\n        }\n    } catch (error) {\n        console.warn('Failed to restore coordinate system:', error);\n        // Fall back to Cartesian\n        if (savedSettings.dimensions) {\n            const cartesianSystem = getCartesianSystem(savedSettings.dimensions);\n            renderer.coordinateSystem = cartesianSystem;\n            expressionsControl.setCoordinateSystem(cartesianSystem, false);\n        }\n        return false;\n    }\n}\n\n/**\n * Convert Unicode symbols to ASCII in expressions\n * (\u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.)\n *\n * @param {Object} settings - Settings object that may contain expressions\n */\nexport function convertUnicodeToAscii(settings) {\n    // Convert Unicode to ASCII in expressions\n    if (settings.expressions && Array.isArray(settings.expressions) && window.UnicodeAutocomplete) {\n        settings.expressions = settings.expressions.map(expr => {\n            if (typeof expr === 'string' && window.UnicodeAutocomplete.unicodeToAscii) {\n                return window.UnicodeAutocomplete.unicodeToAscii(expr);\n            }\n            return expr;\n        });\n    }\n}\n\n/**\n * Validate and fix mapper params if needed\n * For select mapper, ensures dim2 is different from dim1\n *\n * @param {Object} settings - Settings object that may contain mapperParams\n */\nexport function fixMapperParams(settings) {\n    if (settings.mapperParams) {\n        const params = settings.mapperParams;\n        // For select mapper, ensure dim2 is different from dim1 and defaults to 1\n        if (params.dim1 !== undefined && params.dim2 !== undefined) {\n            if (params.dim1 === params.dim2) {\n                console.warn('Invalid mapper params: dim1 and dim2 are the same, fixing to default');\n                settings.mapperParams = { dim1: 0, dim2: 1 };\n            }\n        }\n    }\n}\n\n// ========================================\n// Aspect Ratio Utilities\n// ========================================\n\n/**\n * Expand bbox to fit canvas aspect ratio (ensure WHOLE bbox is visible)\n * @param {Object} bbox - Original bbox with min/max arrays\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @returns {Object} Expanded bbox that fits aspect ratio\n */\nexport function expandBBoxForAspectRatio(bbox, canvas) {\n    if (!canvas) return bbox;\n\n    const canvasAspect = canvas.width / canvas.height;\n    const bboxWidth = bbox.max[0] - bbox.min[0];\n    const bboxHeight = bbox.max[1] - bbox.min[1];\n    const bboxAspect = bboxWidth / bboxHeight;\n\n    const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n    const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n    let newWidth = bboxWidth;\n    let newHeight = bboxHeight;\n\n    if (canvasAspect > bboxAspect) {\n        // Canvas is wider than bbox - expand width to match aspect ratio\n        newWidth = bboxHeight * canvasAspect;\n    } else {\n        // Canvas is taller than bbox - expand height to match aspect ratio\n        newHeight = bboxWidth / canvasAspect;\n    }\n\n    return {\n        min: [centerX - newWidth / 2, centerY - newHeight / 2],\n        max: [centerX + newWidth / 2, centerY + newHeight / 2]\n    };\n}\n\n// ========================================\n// Settings Application (Initialization)\n// ========================================\n\n/**\n * Apply initial settings after all web components are ready\n * Handles coordinate system restoration, Unicode conversion, and validation\n *\n * @param {Object} savedSettings - Settings loaded from URL or localStorage\n * @param {ControlManager} manager - The control manager instance\n * @param {Renderer} renderer - The renderer instance\n * @param {Function} callback - Called when settings have been applied\n */\nexport function applyInitialSettings(savedSettings, manager, renderer, callback) {\n    if (!savedSettings) {\n        if (callback) callback();\n        return;\n    }\n\n    // Restore coordinate system if present and dimensions match\n    const expressionsControl = manager.get('dimension-inputs');\n    if (expressionsControl) {\n        restoreCoordinateSystem(savedSettings, renderer, expressionsControl);\n    }\n\n    // Convert Unicode to ASCII in expressions (\u03B8 \u2192 theta, \u03C6 \u2192 phi, etc.)\n    convertUnicodeToAscii(savedSettings);\n\n    // Validate and fix mapper params if needed\n    fixMapperParams(savedSettings);\n\n    // Apply settings after all Web Components are ready\n    if (manager.webComponentRegistry) {\n        manager.webComponentRegistry.applyWhenReady(savedSettings).then(() => {\n            if (callback) callback();\n        });\n    } else {\n        // Fallback if registry not available (shouldn't happen)\n        manager.applySettings(savedSettings);\n        manager.apply();\n        if (callback) callback();\n    }\n}\n\n/**\n * Restore bbox (pan/zoom state) from saved settings\n * Expands bbox to fit current canvas aspect ratio\n *\n * @param {Object} savedSettings - Settings object containing bbox\n * @param {Renderer} renderer - The renderer instance\n */\nexport function restoreBBox(savedSettings, renderer) {\n    if (savedSettings && savedSettings.bbox && renderer) {\n        const canvas = renderer.gl?.canvas;\n        const expandedBBox = expandBBoxForAspectRatio(savedSettings.bbox, canvas);\n        renderer.updateConfig({\n            bbox: expandedBBox,\n            reinitializeParticles: false\n        });\n        logger.verbose('Restored bbox expanded for aspect ratio');\n    }\n}\n", "/**\n * Preset management system for loading, saving, and managing presets\n * Handles both built-in presets and custom user-created presets\n */\n\nimport { CoordinateSystem, getCartesianSystem } from '../math/coordinate-systems.js';\nimport { logger } from '../utils/debug-logger.js';\nimport { FieldEquationWorkflow } from '../math/field-equation-workflow.js';\n\n// LocalStorage key for custom presets\nconst CUSTOM_PRESETS_KEY = 'customPresets';\n\n/**\n * Initialize built-in presets data\n * Creates window.presets object with 12 example dynamical systems\n */\nexport function loadPresets() {\n    window.presets = {\n        '2d_rotation': {\n            dimensions: 2,\n            expressions: ['-y', 'x'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: 'Simple Rotation',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '2d_vortex': {\n            dimensions: 2,\n            expressions: ['-y + x*(1 - x*x - y*y)', 'x + y*(1 - x*x - y*y)'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            bbox: {\n                min: [-3, -3],\n                max: [3, 3]\n            },\n            name: 'Vortex',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '2d_vanderpol': {\n            dimensions: 2,\n            expressions: ['y', '(1 - x*x)*y - x'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: 'Van der Pol Oscillator',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '3d_lorenz': {\n            dimensions: 3,\n            expressions: ['10*(y - x)', 'x*(28 - z) - y', 'x*y - 2.67*z'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: 'Lorenz Attractor',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '3d_rossler': {\n            dimensions: 3,\n            expressions: ['-y - z', 'x + 0.2*y', '0.2 + z*(x - 5.7)'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: 'R\u00F6ssler Attractor',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '4d_hypersphere': {\n            dimensions: 4,\n            expressions: ['-y', 'x', '-w', 'z'],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: '4D Hypersphere Rotation',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '2d_fluid_stirring': {\n            dimensions: 2,\n            expressions: [\n                '-y + sin(x)*cos(y)*3.0 - 0.1*x',\n                'x + cos(x)*sin(y)*3.0 - 0.1*y'\n            ],\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            name: 'Fluid Transport with Stirring',\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '4d_double_pendulum': {\n            dimensions: 4,\n            expressions: [\n                'z',  // d\u03B8\u2081/dt = \u03C9\u2081\n                'w',  // d\u03B8\u2082/dt = \u03C9\u2082\n                '(-10*(2*sin(x) + sin(x - 2*y)) - 2*sin(x - y)*(w*w + z*z*cos(x - y))) / (3 - cos(2*x - 2*y))',  // d\u03C9\u2081/dt\n                '(2*sin(x - y)*(2*z*z + 20*cos(x) + w*w*cos(x - y))) / (3 - cos(2*x - 2*y))'  // d\u03C9\u2082/dt\n            ],\n            name: 'Double Pendulum (Chaotic)',\n            timestep: 0.005,\n            colorMode: 'velocity_angle',\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.001,\n            implicitIterations: 3,\n            particleCount: 500000,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            mapperType: 'custom',\n            mapperParams: {\n                horizontalExpr: 'sin(x) + sin(y)',\n                verticalExpr: '-cos(x) - cos(y)',\n                depthExpr: ''\n            },\n\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n        },\n        '2d_strange_attractor': {\n            dimensions: 2,\n            expressions: [\n                '-y + x*(1 - x*x*x*x - y*y*y*y)',\n                'x + y*(1 - x*x*x*x - y*y*y*y)'\n            ],\n            bbox: {\n                min: [-3.5719104227544065, -1.7259582784950003],\n                max: [3.5719104227544065, 1.7259582784950003]\n            },\n            integratorType: 'implicit-euler',\n            solutionMethod: 'fixed-point',\n            timestep: 0.472,\n            implicitIterations: 3,\n            particleCount: 880100,\n            fadeOpacity: 0.9999,\n            frameLimit: 300,\n            frameLimitEnabled: true,\n            dropProbability: 0.03,\n            colorMode: 'velocity_angle',\n            // Rendering settings\n            supersampleFactor: 2,\n            smaaEnabled: true,\n            'smaa-intensity': 1,\n            'smaa-threshold': 0,\n            bilateralEnabled: true,\n            bilateralSpatialSigma: 5,\n            bilateralIntensitySigma: 0.5,\n            // Tone mapping\n            tonemapOperator: 'luminance_extended',\n            exposure: 0.010232929922807544,\n            gamma: 0.7803178779033633,\n            luminanceGamma: 1.2188608780748513,\n            highlightCompression: 9.999999999999993,\n            compressionThreshold: 100000.00000000001,\n            whitePoint: 3.443499307633384,\n            particleIntensity: 47.31512589614813,\n            particleSize: 0.10000000000000002,\n            particleRenderMode: 'points',\n            colorSaturation: 0.429,\n            brightnessDesaturation: 0.685,\n            brightnessSaturation: 0.13,\n            name: 'Strange Attractor (Chaotic Limit Cycle)'\n        }\n    };\n}\n\n/**\n * Expand bbox to fit canvas aspect ratio (ensure WHOLE bbox is visible)\n * @param {Object} bbox - Original bbox with min/max arrays\n * @param {HTMLCanvasElement} canvas - Canvas element\n * @returns {Object} Expanded bbox that fits aspect ratio\n */\nfunction expandBBoxForAspectRatio(bbox, canvas) {\n    if (!canvas) return bbox;\n\n    const canvasAspect = canvas.width / canvas.height;\n    const bboxWidth = bbox.max[0] - bbox.min[0];\n    const bboxHeight = bbox.max[1] - bbox.min[1];\n    const bboxAspect = bboxWidth / bboxHeight;\n\n    const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n    const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n    let newWidth = bboxWidth;\n    let newHeight = bboxHeight;\n\n    if (canvasAspect > bboxAspect) {\n        // Canvas is wider than bbox - expand width to match aspect ratio\n        newWidth = bboxHeight * canvasAspect;\n    } else {\n        // Canvas is taller than bbox - expand height to match aspect ratio\n        newHeight = bboxWidth / canvasAspect;\n    }\n\n    return {\n        min: [centerX - newWidth / 2, centerY - newHeight / 2],\n        max: [centerX + newWidth / 2, centerY + newHeight / 2]\n    };\n}\n\n/**\n * Load a specific preset (built-in or custom)\n * @param {string} name - Preset identifier\n * @param {ControlManager} manager - Control manager instance\n */\nexport function loadPreset(name, manager) {\n    // Check built-in presets first, then custom presets\n    let preset = window.presets[name];\n    if (!preset) {\n        const customPresets = loadCustomPresets();\n        preset = customPresets[name];\n    }\n\n    if (!preset) {\n        console.error('Preset not found:', name);\n        logger.error(`Preset not found: ${name}`);\n        return;\n    }\n\n    logger.info(`Loading preset: ${preset.name || name} (dimensions=${preset.dimensions}, expressions=${preset.expressions.length})`);\n\n    // Reset all controls to defaults before loading preset\n    // This ensures no state leaks from previous presets\n    manager.resetAll();\n\n    // Reset coordinate system to Cartesian unless preset specifies otherwise\n    // Presets expressions are written for Cartesian coordinates by default\n    if (preset.dimensions) {\n        let coordinateSystem;\n        if (preset.coordinateSystem) {\n            // Preset specifies a coordinate system - use it\n            coordinateSystem = CoordinateSystem.fromJSON(preset.coordinateSystem);\n        } else {\n            // No coordinate system specified - use Cartesian for the preset dimensions\n            coordinateSystem = getCartesianSystem(preset.dimensions);\n        }\n\n        // Update renderer and UI\n        if (window.renderer) {\n            window.renderer.coordinateSystem = coordinateSystem;\n        }\n\n        const expressionsControl = manager.get('dimension-inputs');\n        if (expressionsControl) {\n            expressionsControl.setCoordinateSystem(coordinateSystem);\n        }\n\n        logger.info(`Preset loaded with coordinate system: ${coordinateSystem.name}`);\n    }\n\n    // Use the same loading logic as for loading settings from localStorage\n    // This ensures consistent behavior and handles all control types properly\n    // Apply settings after all Web Components are ready\n    if (manager.webComponentRegistry) {\n        manager.webComponentRegistry.applyWhenReady(preset);\n    } else {\n        // Fallback if registry not available (shouldn't happen)\n        manager.applySettings(preset);\n        manager.apply();\n    }\n\n    // Make sure UI controls are updated after restoring settings\n    const expressionsControl = manager.get('dimension-inputs');\n    if (expressionsControl && preset.dimensions) {\n        expressionsControl.updateInputs(preset.dimensions);\n    }\n\n    const mapperParamsControl = manager.get('mapper-params');\n    if (mapperParamsControl) {\n        mapperParamsControl.updateControls();\n    }\n\n    const transformParamsControl = manager.get('transform-params');\n    if (transformParamsControl) {\n        transformParamsControl.updateControls();\n    }\n\n    // Get settings from controls and merge bbox if present in preset\n    const settings = manager.getSettings();\n\n    // Add bbox to settings if present in preset\n    if (preset.bbox) {\n        // Expand bbox to fit canvas aspect ratio (ensure WHOLE bbox is visible)\n        const canvas = window.renderer?.gl?.canvas;\n        const expandedBBox = expandBBoxForAspectRatio(preset.bbox, canvas);\n        settings.bbox = expandedBBox;\n\n        const bboxWidth = preset.bbox.max[0] - preset.bbox.min[0];\n        const bboxHeight = preset.bbox.max[1] - preset.bbox.min[1];\n        const newWidth = expandedBBox.max[0] - expandedBBox.min[0];\n        const newHeight = expandedBBox.max[1] - expandedBBox.min[1];\n\n        if (canvas) {\n            logger.info(`Preset bbox expanded from [${bboxWidth.toFixed(2)} x ${bboxHeight.toFixed(2)}] to [${newWidth.toFixed(2)} x ${newHeight.toFixed(2)}] for aspect ratio ${(canvas.width / canvas.height).toFixed(2)}`);\n        } else {\n            logger.info(`Preset bbox: min=${preset.bbox.min}, max=${preset.bbox.max}`);\n        }\n    }\n\n    // Transform implicitIterations into integratorParams (same as in onApply)\n    if (settings.implicitIterations !== undefined) {\n        settings.integratorParams = { iterations: settings.implicitIterations };\n    }\n\n    // Extract expressions from settings (will be applied via workflow)\n    const expressions = settings.expressions;\n    delete settings.expressions;\n\n    // Apply all settings EXCEPT expressions to renderer\n    if (window.renderer) {\n        window.renderer.updateConfig(settings);\n    }\n\n    // Apply expressions via automated workflow (validates, generates GLSL, applies)\n    if (expressions && expressions.length > 0 && window.renderer && window.notebook) {\n        try {\n            const workflow = new FieldEquationWorkflow();\n            workflow.executeAutomated(expressions, window.notebook, window.renderer);\n            logger.info(`Applied ${expressions.length} field equations via workflow`);\n        } catch (error) {\n            logger.error(`Failed to apply field equations from preset:`, error.message);\n            // Don't throw - preset partially applied, user can fix expressions manually\n        }\n    }\n\n    logger.info(`Preset ${preset.name || name} loaded successfully`);\n}\n\n/**\n * Load custom presets from localStorage\n * @returns {Object} Map of preset names to preset objects\n */\nfunction loadCustomPresets() {\n    try {\n        const stored = localStorage.getItem(CUSTOM_PRESETS_KEY);\n        return stored ? JSON.parse(stored) : {};\n    } catch (e) {\n        console.error('Failed to load custom presets:', e);\n        return {};\n    }\n}\n\n/**\n * Save a custom preset to localStorage\n * @param {string} name - Preset name\n * @param {Object} preset - Preset settings object\n */\nfunction saveCustomPreset(name, preset) {\n    const presets = loadCustomPresets();\n    presets[name] = preset;\n    try {\n        localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(presets));\n    } catch (e) {\n        console.error('Failed to save custom preset:', e);\n        alert('Failed to save preset: ' + e.message);\n    }\n}\n\n/**\n * Delete a custom preset from localStorage\n * @param {string} name - Preset name to delete\n */\nfunction deleteCustomPreset(name) {\n    const presets = loadCustomPresets();\n    delete presets[name];\n    try {\n        localStorage.setItem(CUSTOM_PRESETS_KEY, JSON.stringify(presets));\n    } catch (e) {\n        console.error('Failed to delete custom preset:', e);\n    }\n}\n\n/**\n * Refresh the custom presets dropdown with current saved presets\n */\nfunction refreshCustomPresetsDropdown() {\n    const customPresets = loadCustomPresets();\n    const $group = $('#custom-presets-group');\n\n    // Clear existing options\n    $group.empty();\n\n    // Add custom presets\n    const presetNames = Object.keys(customPresets).sort();\n    if (presetNames.length > 0) {\n        $group.show();\n        presetNames.forEach(name => {\n            const preset = customPresets[name];\n            const displayName = preset.name || name;\n            $group.append(`<option value=\"${name}\">${displayName}</option>`);\n        });\n    } else {\n        $group.hide();\n    }\n}\n\n/**\n * Initialize preset controls (dropdown, save/delete buttons)\n * Sets up event handlers for preset selector and management buttons\n * @param {ControlManager} manager - Control manager instance\n */\nexport function initPresetControls(manager) {\n    // Preset selector (loads presets, doesn't save)\n    $('#preset-selector').on('change', function() {\n        const presetName = $(this).val();\n        if (presetName) {\n            loadPreset(presetName, manager);\n            $(this).val(''); // Reset to placeholder\n\n            // Show delete button if it's a custom preset\n            const customPresets = loadCustomPresets();\n            if (customPresets[presetName]) {\n                $('#preset-name-input').val(presetName);\n                $('#delete-preset-btn').show();\n            } else {\n                $('#preset-name-input').val('');\n                $('#delete-preset-btn').hide();\n            }\n        }\n    });\n\n    // Save Preset button\n    $('#save-preset-btn').on('click', function() {\n        const presetName = $('#preset-name-input').val().trim();\n        if (!presetName) {\n            alert('Please enter a preset name');\n            return;\n        }\n\n        // Get current settings (using the same method as localStorage saving)\n        const settings = manager.getSettings();\n\n        // Add name to the preset\n        const preset = {\n            ...settings,\n            name: presetName\n        };\n\n        // Save to localStorage\n        saveCustomPreset(presetName, preset);\n\n        // Refresh preset dropdown\n        refreshCustomPresetsDropdown();\n\n        // Show delete button\n        $('#delete-preset-btn').show();\n\n        logger.info('Preset saved: ' + presetName);\n    });\n\n    // Delete Preset button\n    $('#delete-preset-btn').on('click', function() {\n        const presetName = $('#preset-name-input').val().trim();\n        if (!presetName) return;\n\n        if (confirm(`Delete preset \"${presetName}\"?`)) {\n            deleteCustomPreset(presetName);\n            refreshCustomPresetsDropdown();\n            $('#preset-name-input').val('');\n            $('#delete-preset-btn').hide();\n            logger.info('Preset deleted: ' + presetName);\n        }\n    });\n\n    // Load custom presets on init\n    refreshCustomPresetsDropdown();\n}\n", "/**\n * Gradient Panel Controller\n *\n * Manages the gradient editor floating panel including:\n * - Panel visibility and lifecycle\n * - Gradient editor initialization and updates\n * - Button event handlers (open, reset)\n * - Click-outside-to-close behavior\n * - Gradient button visibility based on color mode\n *\n * Extracted from controls-v2.js as part of Phase 2 refactoring.\n */\n\nimport { PanelManager } from '../utils/panel-manager.js';\nimport { ZIndex } from '../utils/z-index.js';\nimport { initGradientEditor } from '../gradient-editor.js';\nimport { getDefaultGradient } from '../../math/gradients.js';\n\n/**\n * Update gradient button visibility based on color mode\n * @param {string} colorMode - Current color mode\n */\nfunction updateGradientButtonVisibility(colorMode) {\n    const supportsGradient = colorMode === 'expression' ||\n                              colorMode === 'velocity_magnitude' ||\n                              colorMode === 'velocity_angle' ||\n                              colorMode === 'velocity_combined';\n\n    if (supportsGradient) {\n        $('#gradient-button-container').show();\n    } else {\n        $('#gradient-button-container').hide();\n    }\n\n    // Show/hide preset toggle based on mode\n    if (colorMode === 'expression') {\n        $('#gradient-preset-toggle').hide();\n    } else {\n        $('#gradient-preset-toggle').show();\n    }\n}\n\n/**\n * Initialize gradient panel controller\n * @param {ControlManager} manager - The control manager instance\n * @param {GradientControl} gradientControl - The gradient control instance\n * @returns {{showGradientPanel: Function, hideGradientPanel: Function, gradientEditor: Object|null}}\n */\nexport function initGradientPanel(manager, gradientControl) {\n    let gradientEditor = null;\n\n    // Create panel manager for gradient panel (Phase 1 refactoring)\n    const gradientPanelManager = new PanelManager('#gradient-panel', {\n        zIndex: ZIndex.GRADIENT_PANEL,\n        onShow: () => {\n            updateGradientButtonVisibility(manager.get('color-mode').getValue());\n\n            // Initialize gradient editor if not already done\n            if (!gradientEditor) {\n                gradientEditor = initGradientEditor(\n                    'main-gradient-editor',\n                    gradientControl.getValue(),\n                    (newGradient) => {\n                        gradientControl.notifyChange(newGradient);\n                    }\n                );\n                gradientControl.setGradientEditor(gradientEditor);\n            } else {\n                // Update gradient if it changed while editor was hidden\n                gradientEditor.setGradient(gradientControl.getValue());\n            }\n        }\n    });\n\n    function showGradientPanel() {\n        gradientPanelManager.show();\n    }\n\n    function hideGradientPanel() {\n        gradientPanelManager.hide();\n    }\n\n    // Open gradient editor button\n    $('#open-gradient-editor').on('click', function() {\n        showGradientPanel();\n    });\n\n    // Reset gradient to default button\n    $('#reset-gradient').on('click', function() {\n        const defaultGradient = getDefaultGradient();\n        if (gradientEditor) {\n            gradientEditor.setGradient(defaultGradient);\n            gradientControl.notifyChange(defaultGradient);\n        }\n    });\n\n    // Enable click-outside-to-close behavior\n    gradientPanelManager.enableClickOutside(['#open-gradient-editor']);\n\n    return {\n        showGradientPanel,\n        hideGradientPanel,\n        gradientEditor\n    };\n}\n", "/**\n * Rendering Panel Controller\n *\n * Manages the rendering settings floating panel including:\n * - Panel visibility and lifecycle\n * - White point visibility updates based on tonemap operator\n * - Button event handlers (open, close)\n * - Click-outside-to-close behavior\n * - Mobile panel manager integration\n *\n * Extracted from controls-v2.js as part of Phase 2 refactoring.\n */\n\nimport { PanelManager } from '../utils/panel-manager.js';\nimport { ZIndex } from '../utils/z-index.js';\nimport { updateWhitePointVisibility } from '../visibility-manager.js';\n\n/**\n * Initialize rendering panel controller\n * @param {ControlManager} manager - The control manager instance\n * @returns {{showRenderingPanel: Function, hideRenderingPanel: Function}}\n */\nexport function initRenderingPanel(manager) {\n    // Create panel manager for rendering panel (Phase 1 refactoring)\n    const renderingPanelManager = new PanelManager('#rendering-panel', {\n        zIndex: ZIndex.RENDERING_PANEL,\n        onShow: () => {\n            // Update white point visibility when panel is shown\n            updateWhitePointVisibility(manager.get('tonemap-operator').getValue());\n        }\n    });\n\n    function showRenderingPanel() {\n        renderingPanelManager.show();\n    }\n\n    function hideRenderingPanel() {\n        renderingPanelManager.hide();\n    }\n\n    // Open rendering settings button handler\n    $('#open-rendering-settings').on('click', function() {\n        showRenderingPanel();\n    });\n\n    // Close button handler (supports mobile panel manager)\n    $('#rendering-panel .floating-panel-close').on('click', function() {\n        // If opened via mobile menu, use mobile panel manager\n        if (window.mobilePanelManager && window.mobilePanelManager.getCurrentPanel() === 'rendering') {\n            window.mobilePanelManager.hidePanel('rendering');\n        } else {\n            // Otherwise use regular hide function\n            hideRenderingPanel();\n        }\n    });\n\n    // Enable click-outside-to-close behavior\n    renderingPanelManager.enableClickOutside([\n        '#open-rendering-settings',\n        '#mobile-menu-rendering'\n    ]);\n\n    return {\n        showRenderingPanel,\n        hideRenderingPanel,\n        renderingPanelManager  // Export the PanelManager instance for mobile integration\n    };\n}\n", "/**\n * Animation system setup and controls\n *\n * Manages animation-related UI controls including:\n * - AnimationController initialization\n * - Animation alpha/speed component registration\n * - Frame capture with progress tracking\n * - Animation export to ZIP (with multi-part splitting)\n * - Animation template JSON export\n *\n * @module ui/animation-setup\n */\n\nimport { AnimationController } from '../animation/animation-controller.js';\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Initialize animation controls and setup\n *\n * @param {ControlManager} manager - The control manager instance\n * @param {Renderer} renderer - The renderer instance\n * @param {WebComponentControlRegistry} webComponentRegistry - Web component registry\n * @returns {AnimationController} The initialized animation controller\n */\nexport function initAnimationControls(manager, renderer, webComponentRegistry) {\n    // ========================================\n    // Create Animation Controller\n    // ========================================\n\n    const animationController = new AnimationController(renderer, manager);\n    // Make it globally accessible for debugging\n    window.animationController = animationController;\n\n    // ========================================\n    // Animation Panel Setup\n    // ========================================\n\n    // Register animation web components and set controller\n    const animationAlphaElement = document.getElementById('animation-alpha');\n    const animationSpeedElement = document.getElementById('animation-speed');\n\n    if (animationAlphaElement) {\n        animationAlphaElement.setController(animationController);\n        // Register with control manager for save/restore\n        webComponentRegistry.register('animation-alpha', 'animation-alpha');\n        logger.info('Animation alpha web component registered');\n    }\n\n    if (animationSpeedElement) {\n        animationSpeedElement.setController(animationController);\n        logger.info('Animation speed web component registered');\n    }\n\n    // Sync steps-per-increment to frame limit\n    const frameLimitElement = document.getElementById('frame-limit');\n    const frameLimitEnabledCheckbox = document.getElementById('frame-limit-enabled');\n    const syncCheckboxElement = document.getElementById('sync-steps-to-frame-limit');\n\n    /**\n     * Sync steps-per-increment to frame limit value\n     * When enabled, this keeps the frame limit in sync with animation speed\n     * and automatically enables frame limiting with screen/particle reset\n     */\n    function syncStepsToFrameLimit() {\n        try {\n            console.log('syncStepsToFrameLimit called');\n            if (typeof syncCheckboxElement?.getValue !== 'function') { console.log('bail: syncCheckbox no getValue'); return; }\n            if (!syncCheckboxElement.getValue()) { console.log('bail: syncCheckbox not checked'); return; }\n            if (typeof animationSpeedElement?.getValue !== 'function') { console.log('bail: animationSpeed no getValue'); return; }\n            if (typeof frameLimitElement?.setValue !== 'function') { console.log('bail: frameLimit no setValue'); return; }\n\n            const steps = animationSpeedElement.getValue();\n            console.log('syncing steps:', steps);\n\n            // Update UI\n            frameLimitElement.setValue(steps);\n\n            // Enable frame limiting if not already\n            if (frameLimitEnabledCheckbox && !frameLimitEnabledCheckbox.getValue()) {\n                frameLimitEnabledCheckbox.setValue(true);\n            }\n\n            // Update renderer and restart\n            if (window.renderer) {\n                window.renderer.frameLimit = steps;\n                window.renderer.frameLimitEnabled = true;\n                window.renderer.totalFrames = 0; // Reset frame counter\n                window.renderer.clearRenderBuffer(); // Clear screen\n                window.renderer.resetParticles(); // Reset particle positions\n                if (!window.renderer.isRunning) {\n                    window.renderer.start();\n                }\n            }\n        } catch (e) {\n            console.warn('syncStepsToFrameLimit error:', e);\n        }\n    }\n\n    // Sync when checkbox is checked (web component fires 'change' event)\n    syncCheckboxElement?.addEventListener('change', function() {\n        try {\n            if (typeof syncCheckboxElement.getValue === 'function' && syncCheckboxElement.getValue()) {\n                syncStepsToFrameLimit();\n            }\n        } catch (e) {\n            console.warn('sync checkbox change error:', e);\n        }\n    });\n\n    // Sync when animation speed changes (if checkbox is checked)\n    if (animationSpeedElement) {\n        animationSpeedElement.onChange = syncStepsToFrameLimit;\n    }\n\n    // Register sync checkbox with web component registry\n    if (syncCheckboxElement) {\n        webComponentRegistry.register('check-box', 'sync-steps-to-frame-limit');\n    }\n\n    // ========================================\n    // Animation Options Checkboxes\n    // ========================================\n\n    // Wire animation checkboxes to controller options\n    const animClearParticles = document.getElementById('animation-clear-particles');\n    const animClearScreen = document.getElementById('animation-clear-screen');\n    const animSmoothTiming = document.getElementById('animation-smooth-timing');\n    const animLockShaders = document.getElementById('animation-lock-shaders');\n\n    if (animClearParticles) {\n        animClearParticles.addEventListener('change', function() {\n            animationController.setOptions({ clearParticles: animClearParticles.getValue() });\n        });\n    }\n\n    if (animClearScreen) {\n        animClearScreen.addEventListener('change', function() {\n            animationController.setOptions({ clearScreen: animClearScreen.getValue() });\n        });\n    }\n\n    if (animSmoothTiming) {\n        animSmoothTiming.addEventListener('change', function() {\n            animationController.setOptions({ smoothTiming: animSmoothTiming.getValue() });\n        });\n    }\n\n    if (animLockShaders) {\n        animLockShaders.addEventListener('change', function() {\n            animationController.setOptions({ lockShaders: animLockShaders.getValue() });\n        });\n    }\n\n    // Update loops info text based on half-loops checkbox\n    const halfLoopsElement = document.getElementById('animation-half-loops');\n    if (halfLoopsElement) {\n        halfLoopsElement.addEventListener('change', function() {\n            const isHalfLoops = halfLoopsElement.getValue();\n            const infoText = isHalfLoops\n                ? 'Number of half cycles (1 = 0.0 \u2192 1.0, 2 = 0.0 \u2192 1.0 \u2192 0.0)'\n                : 'Number of complete alpha cycles (0.0 \u2192 1.0 \u2192 0.0)';\n            $('#animation-loops-info').text(infoText);\n        });\n    }\n\n    // ========================================\n    // Create Animation Button\n    // ========================================\n\n    /**\n     * Create Animation button - captures frames during alpha animation\n     * Toggles between \"Create\" and \"Stop\" modes during animation\n     */\n    const createAnimBtn = document.getElementById('animation-create-btn');\n    if (createAnimBtn) {\n        createAnimBtn.addEventListener('action', function() {\n            // Check if animation is currently running (stop mode)\n            if (animationController.isRunning) {\n                // Stop the animation early\n                animationController.stop();\n\n                // Restore button state\n                createAnimBtn.setLabel('Create Animation');\n                createAnimBtn.setIcon('\u25B6');\n                createAnimBtn.setStyle('#4CAF50');\n\n                // Re-enable inputs\n                const framesInput = document.getElementById('animation-frames');\n                const loopsInput = document.getElementById('animation-loops');\n                const halfLoopsCheckbox = document.getElementById('animation-half-loops');\n                const downloadBtn = document.getElementById('animation-download-btn');\n\n                if (framesInput) framesInput.disabled = false;\n                if (loopsInput) loopsInput.disabled = false;\n                if (halfLoopsCheckbox) halfLoopsCheckbox.disabled = false;\n                if (downloadBtn) downloadBtn.setEnabled(animationController.getFrames().length > 0);\n\n                // Update progress to show it was stopped\n                $('#progress-text').text(`Stopped: ${animationController.getFrames().length} frames captured`);\n\n                logger.info(`Animation stopped early: ${animationController.getFrames().length} frames captured`);\n                return;\n            }\n\n            // Get parameters from number-input web components\n            const framesInput = document.getElementById('animation-frames');\n            const loopsInput = document.getElementById('animation-loops');\n            const halfLoopsCheckbox = document.getElementById('animation-half-loops');\n            const downloadBtn = document.getElementById('animation-download-btn');\n\n            const totalFrames = framesInput ? framesInput.getValue() : 100;\n            const loops = loopsInput ? loopsInput.getValue() : 1;\n            const isHalfLoops = halfLoopsCheckbox?.getValue ? halfLoopsCheckbox.getValue() : false;\n\n            // Update UI - button becomes stop button\n            createAnimBtn.setLabel('Stop Animation');\n            createAnimBtn.setIcon('\u23F9');\n            createAnimBtn.setStyle('#f44336');\n\n            // Disable inputs\n            if (framesInput) framesInput.disabled = true;\n            if (loopsInput) loopsInput.disabled = true;\n            if (halfLoopsCheckbox) halfLoopsCheckbox.disabled = true;\n            if (downloadBtn) downloadBtn.setEnabled(false);\n\n            // Show progress\n            $('#animation-progress').show();\n            $('#progress-bar').css('width', '0%');\n            $('#progress-text').text(`Frame 0 / ${totalFrames}`);\n            $('#progress-alpha').text('\u03B1: 0.00');\n\n            // Start animation with frame capture\n            animationController.start({\n                captureFrames: true,\n                totalFrames: totalFrames,\n                loops: loops,\n                halfLoops: isHalfLoops,\n                onProgress: (frameCount, total, alpha) => {\n                    const progress = (frameCount / total) * 100;\n                    $('#progress-bar').css('width', `${progress}%`);\n                    $('#progress-text').text(`Frame ${frameCount} / ${total}`);\n                    $('#progress-alpha').text(`\u03B1: ${alpha.toFixed(2)}`);\n                },\n                onComplete: (frames) => {\n                    // Restore button state\n                    createAnimBtn.setLabel('Create Animation');\n                    createAnimBtn.setIcon('\u25B6');\n                    createAnimBtn.setStyle('#4CAF50');\n\n                    // Re-enable inputs\n                    if (framesInput) framesInput.disabled = false;\n                    if (loopsInput) loopsInput.disabled = false;\n                    if (halfLoopsCheckbox) halfLoopsCheckbox.disabled = false;\n                    if (downloadBtn) downloadBtn.setEnabled(true);\n\n                    // Update progress\n                    $('#progress-bar').css('width', '100%');\n                    $('#progress-text').text(`Complete: ${frames.length} frames`);\n\n                    logger.info(`Animation creation complete: ${frames.length} frames captured`);\n                }\n            });\n        });\n    }\n\n    // ========================================\n    // Download Animation Button\n    // ========================================\n\n    /**\n     * Download Animation button - exports captured frames to ZIP\n     * Automatically splits large animations into multiple ZIP files (300 frames each)\n     * to avoid browser memory issues and download size limits\n     */\n    const downloadBtn = document.getElementById('animation-download-btn');\n    if (downloadBtn) {\n        downloadBtn.addEventListener('action', async function() {\n            const capturedFrames = animationController.getFrames();\n\n            if (capturedFrames.length === 0) {\n                alert('No frames to download. Create an animation first.');\n                return;\n            }\n\n            downloadBtn.setLoading(true, 'Creating ZIP...');\n\n            try {\n                const MAX_FRAMES_PER_ZIP = 300;\n                const totalFrames = capturedFrames.length;\n                const numParts = Math.ceil(totalFrames / MAX_FRAMES_PER_ZIP);\n                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);\n\n                logger.info(`Splitting ${totalFrames} frames into ${numParts} ZIP file(s)`);\n\n                // Create and download each ZIP part\n                for (let part = 0; part < numParts; part++) {\n                    const startIdx = part * MAX_FRAMES_PER_ZIP;\n                    const endIdx = Math.min((part + 1) * MAX_FRAMES_PER_ZIP, totalFrames);\n\n                    downloadBtn.setLoading(true, `Creating ZIP ${part + 1}/${numParts}...`);\n\n                    // Create ZIP file using JSZip\n                    const zip = new JSZip();\n                    const framesFolder = zip.folder('frames');\n\n                    // Add frames to this ZIP part\n                    for (let i = startIdx; i < endIdx; i++) {\n                        const paddedIndex = String(i).padStart(5, '0');\n                        framesFolder.file(`frame_${paddedIndex}.png`, capturedFrames[i]);\n                    }\n\n                    // Generate ZIP file\n                    const zipBlob = await zip.generateAsync({ type: 'blob' });\n\n                    // Create download link\n                    const url = URL.createObjectURL(zipBlob);\n                    const link = document.createElement('a');\n                    const partSuffix = numParts > 1 ? `.${part + 1}` : '';\n                    link.download = `animation-${timestamp}${partSuffix}.zip`;\n                    link.href = url;\n                    document.body.appendChild(link);\n                    link.click();\n                    document.body.removeChild(link);\n\n                    // Clean up\n                    URL.revokeObjectURL(url);\n\n                    logger.info(`Part ${part + 1}/${numParts} downloaded: frames ${startIdx}-${endIdx - 1}`);\n\n                    // Small delay between downloads to avoid browser issues\n                    if (part < numParts - 1) {\n                        await new Promise(resolve => setTimeout(resolve, 500));\n                    }\n                }\n\n                logger.info(`Animation download complete: ${totalFrames} frames in ${numParts} ZIP file(s)`);\n                if (numParts > 1) {\n                    alert(`Animation split into ${numParts} ZIP files. Use create-video.sh with the base filename (without .1, .2, etc) to reconstruct.`);\n                }\n            } catch (error) {\n                logger.error('Failed to create ZIP:', error);\n                alert('Failed to create ZIP file: ' + error.message);\n            } finally {\n                downloadBtn.setLoading(false);\n            }\n        });\n    }\n\n    // ========================================\n    // Export Animation JSON Button\n    // ========================================\n\n    /**\n     * Export Animation JSON button - creates animation template JSON\n     * Exports current settings as a base for complex keyframe animations\n     */\n    const exportJsonBtn = document.getElementById('export-animation-json');\n    if (exportJsonBtn) {\n        exportJsonBtn.addEventListener('action', function() {\n            const settings = manager.getSettings();\n\n            // Add bbox from renderer\n            if (renderer && renderer.bbox) {\n                settings.bbox = {\n                    min: [renderer.bbox.min[0], renderer.bbox.min[1]],\n                    max: [renderer.bbox.max[0], renderer.bbox.max[1]]\n                };\n            }\n\n            // Remove animationAlpha from export (it's test-only)\n            delete settings.animationAlpha;\n\n            // Create animation template\n            const animationTemplate = {\n                name: \"Untitled Animation\",\n                description: \"Animation created from current settings\",\n                fps: 30,\n                baseSettings: settings,\n                timeline: [\n                    {\n                        time: 0.0,\n                        settings: {},\n                        easing: \"linear\"\n                    },\n                    {\n                        time: 10.0,\n                        settings: {\n                            // Add your parameter changes here\n                        },\n                        easing: \"linear\"\n                    }\n                ],\n                frameConfig: {\n                    burnInSteps: 5000,\n                    clearAfterBurnIn: true,\n                    accumulationSteps: 2000\n                }\n            };\n\n            // Download as JSON\n            const blob = new Blob([JSON.stringify(animationTemplate, null, 2)], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = 'animation-template.json';\n            document.body.appendChild(a);\n            a.click();\n            document.body.removeChild(a);\n            URL.revokeObjectURL(url);\n\n            logger.info('Exported animation template JSON');\n        });\n    }\n\n    // ========================================\n    // Return animation controller for external access\n    // ========================================\n\n    return animationController;\n}\n", "/**\n * Mobile Panel Manager\n *\n * Manages mobile overlay panels and their interactions:\n * - Controls panel (main UI controls)\n * - Rendering panel (floating panel via PanelManager)\n * - Mobile menu buttons and close buttons\n * - Z-index management for proper layering\n * - Integration with rendering panel manager\n * - Mobile controls component synchronization\n */\n\nimport { logger } from '../../utils/debug-logger.js';\nimport { ZIndex } from '../utils/z-index.js';\n\n/**\n * Initialize mobile panel manager\n * @param {PanelManager} renderingPanelManager - The rendering panel manager instance\n * @returns {Object} Mobile panel manager API\n */\nexport function initMobilePanelManager(renderingPanelManager) {\n    const panels = {\n        'controls': $('#controls'),\n        'rendering': $('#rendering-panel')\n    };\n\n    let currentPanel = null;\n\n    /**\n     * Show a mobile panel\n     * @param {string} panelName - Name of panel to show ('controls' or 'rendering')\n     */\n    function showPanel(panelName) {\n        // Hide any currently open panel\n        if (currentPanel) {\n            hidePanel(currentPanel);\n        }\n\n        const panel = panels[panelName];\n        if (!panel) {\n            logger.warn(`Mobile panel not found: ${panelName}`);\n            return;\n        }\n\n        // For floating panels (rendering), use panel manager\n        // For main panels (controls), add mobile overlay class\n        if (panelName === 'rendering') {\n            // Use the rendering panel manager (Phase 1 refactoring)\n            renderingPanelManager.show();\n        } else {\n            panel.addClass('mobile-overlay active');\n            panel.find('.mobile-overlay-close').show();\n            // Force z-index for mobile (ensure above menu bar)\n            panel.css('z-index', ZIndex.MOBILE_PANEL);\n            panel.find('.mobile-overlay-close').css('z-index', ZIndex.CLOSE_BUTTON);\n            $('#menu-bar').css('z-index', ZIndex.MENU_BAR_LOWERED);\n        }\n\n        // Mark menu button as active\n        $(`#mobile-menu-${panelName}`).addClass('active');\n\n        currentPanel = panelName;\n    }\n\n    /**\n     * Hide a mobile panel\n     * @param {string} panelName - Name of panel to hide\n     */\n    function hidePanel(panelName) {\n        const panel = panels[panelName];\n        if (!panel) return;\n\n        // For floating panels, use panel manager\n        // For main panels, remove mobile overlay class\n        if (panelName === 'rendering') {\n            // Use the rendering panel manager (Phase 1 refactoring)\n            renderingPanelManager.hide();\n        } else {\n            panel.removeClass('mobile-overlay active');\n            panel.find('.mobile-overlay-close').hide();\n            // Restore menu bar z-index on mobile\n            $('#menu-bar').css('z-index', ZIndex.MENU_BAR);\n        }\n\n        // Remove active state from menu button\n        $(`#mobile-menu-${panelName}`).removeClass('active');\n\n        if (currentPanel === panelName) {\n            currentPanel = null;\n        }\n    }\n\n    /**\n     * Hide all mobile panels\n     */\n    function hideAllPanels() {\n        Object.keys(panels).forEach(hidePanel);\n    }\n\n    // Wire up mobile menu buttons\n    $('#mobile-menu-controls').on('click', function() {\n        if (currentPanel === 'controls') {\n            hidePanel('controls');\n        } else {\n            showPanel('controls');\n        }\n    });\n\n    $('#mobile-menu-rendering').on('click', function() {\n        if (currentPanel === 'rendering') {\n            hidePanel('rendering');\n        } else {\n            showPanel('rendering');\n        }\n    });\n\n    // Wire up close buttons in panels\n    $('.mobile-overlay-close').on('click', function() {\n        const panel = $(this).closest('[id]');\n        const panelId = panel.attr('id');\n\n        // Map panel IDs to panel names\n        const panelMap = {\n            'controls': 'controls'\n        };\n\n        const panelName = panelMap[panelId];\n        if (panelName) {\n            hidePanel(panelName);\n        }\n    });\n\n    // Export for external access\n    return {\n        showPanel,\n        hidePanel,\n        hideAllPanels,\n        getCurrentPanel: () => currentPanel\n    };\n}\n\n/**\n * Setup mobile controls component synchronization\n * Syncs the mobile controls component with main controls (timestep, frame limit)\n *\n * @param {ControlManager} manager - The control manager instance\n * @param {Object} mobilePanelManager - The mobile panel manager (unused but kept for consistency)\n */\nexport function setupMobileControlsSync(manager, mobilePanelManager) {\n    const mobileControls = document.getElementById('mobile-controls');\n\n    if (!mobileControls) {\n        logger.info('Mobile controls component not found, skipping sync setup');\n        return;\n    }\n\n    /**\n     * Sync mobile controls with main controls\n     */\n    function syncMobileControls() {\n        const timestepControl = manager.get('timestep');\n        if (timestepControl) {\n            mobileControls.setTimestep(timestepControl.getValue());\n        }\n    }\n\n    // Listen to main timestep changes\n    $('#timestep').on('input change', syncMobileControls);\n\n    // Update main controls when mobile controls change\n    mobileControls.onTimestepChange = (value) => {\n        const timestepControl = manager.get('timestep');\n        if (timestepControl) {\n            timestepControl.setValue(value);\n            manager.debouncedApply();\n        }\n    };\n\n    mobileControls.onFrameLimitEnabledChange = (enabled) => {\n        const control = manager.get('frame-limit-enabled');\n        if (control) {\n            control.setValue(enabled);\n            manager.debouncedApply();\n        }\n    };\n\n    mobileControls.onFrameLimitChange = (limit) => {\n        const control = manager.get('frame-limit');\n        if (control) {\n            control.setValue(limit);\n            manager.debouncedApply();\n        }\n    };\n\n    // Initialize mobile controls with current values (after all web components are ready)\n    // Use a slight delay to ensure settings have been restored\n    const webComponentRegistry = manager.webComponentRegistry;\n    if (webComponentRegistry) {\n        webComponentRegistry.whenAllReady().then(() => {\n            setTimeout(() => {\n                syncMobileControls();\n\n                const frameLimitEnabledControl = manager.get('frame-limit-enabled');\n                const frameLimitControl = manager.get('frame-limit');\n\n                if (frameLimitEnabledControl) {\n                    mobileControls.setFrameLimitEnabled(frameLimitEnabledControl.getValue());\n                }\n                if (frameLimitControl) {\n                    mobileControls.setFrameLimit(frameLimitControl.getValue());\n                }\n            }, 100);\n        });\n    } else {\n        logger.warn('Web component registry not found on manager, mobile controls sync may not work properly');\n    }\n}\n", "/**\n * Main entry point for N-dimensional vector field renderer\n */\n\nimport { Renderer } from './webgl/renderer.js';\nimport { initControls, loadPreset } from './ui/controls-registry.js';\nimport { logger } from './utils/debug-logger.js';\nimport { Animator } from './animation/animator.js';\nimport { setCustomFunctions, getCustomFunctions } from './math/parser.js';\nimport { initializeModal } from './ui/modal.js';\nimport { NotebookDebugTab } from './ui/tabs/notebook-debug-tab.js';\nimport { DebugTab } from './ui/tabs/debug-tab.js';\nimport { DocsTab } from './ui/tabs/docs-tab.js';\nimport { registerControlElements } from './ui/web-components/index.js';\nimport { notebookEditor } from './ui/notebook-editor.js';\nimport { createCASEngine, getSelectedEngineType } from './math/cas/cas-factory.js';\nimport { Notebook } from './math/notebook.js';\nimport { setNotebook as setJacobianNotebook } from './math/jacobian.js';\nimport { setNotebook as setInverseSolverNotebook } from './math/inverse-solver.js';\nimport { FieldEquationsEditor } from './ui/components/field-equations-editor.js';\n\n// Expose MathParser API to window for use in UI controls\nwindow.MathParser = {\n    setCustomFunctions,\n    getCustomFunctions\n};\n\n// Helper functions for help icons (prevents accordion toggle when clicking icons)\nwindow.showDocs = function(event, section) {\n    event.stopPropagation();\n    window.appModal?.show('docs', section);\n};\n\nwindow.showFieldEditor = function(event) {\n    event.stopPropagation();\n    window.getFieldEquationsEditor?.()?.show();\n};\n\n// Register Web Components\nregisterControlElements();\n\n// Initialize when DOM is ready\n$(document).ready(async function() {\n    // Step 1: Initialize logger\n    // Make logger globally available\n    window.logger = logger;\n\n    // Hook console methods to echo to debug console\n    logger.hookConsole();\n\n    logger.info('Logger initialized');\n\n    // Step 1.5: Initialize CAS Engine and Notebook\n    try {\n        const engineType = getSelectedEngineType();\n        logger.info(`Initializing CAS engine: ${engineType}`);\n        const casEngine = await createCASEngine(engineType);\n\n        // Create Notebook with CAS engine\n        const notebook = new Notebook(casEngine);\n\n        // Load saved notebook from localStorage\n        notebook.load();\n\n        // Inject Notebook into math modules (they use notebook, not CAS directly)\n        setJacobianNotebook(notebook);\n        setInverseSolverNotebook(notebook);\n\n        // Make Notebook and CAS engine globally available\n        window.notebook = notebook;\n        window.casEngine = casEngine; // Keep for backward compatibility\n\n        logger.info(`Notebook initialized with ${casEngine.getName()} engine`);\n    } catch (error) {\n        logger.error('Failed to initialize math system:', error);\n        alert('Failed to initialize math engine: ' + error.message);\n        return; // Don't proceed if initialization fails\n    }\n\n    // Step 2: Initialize renderer and canvas\n    function initRenderer(callback) {\n        const canvas = document.getElementById('canvas');\n        let renderer = null;\n\n        // Set canvas size and maintain square aspect ratio for coordinate space\n        function resizeCanvas() {\n            canvas.width = window.innerWidth;\n            canvas.height = window.innerHeight;\n            if (renderer) {\n                renderer.resize(canvas.width, canvas.height);\n\n                // Adjust bbox to maintain square coordinate grid\n                const aspectRatio = canvas.width / canvas.height;\n                const bbox = renderer.bbox;\n                const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n                const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n                const currentHeight = bbox.max[1] - bbox.min[1];\n\n                // Set width based on aspect ratio to maintain square grid\n                const newWidth = currentHeight * aspectRatio;\n\n                bbox.min[0] = centerX - newWidth / 2;\n                bbox.max[0] = centerX + newWidth / 2;\n\n                renderer.updateConfig({ bbox: bbox });\n            }\n        }\n\n        resizeCanvas();\n        window.addEventListener('resize', resizeCanvas);\n\n        // Create renderer with storage strategy from controls\n        try {\n            // Get storage strategy from URL or default to Float (best precision)\n            const urlParams = new URLSearchParams(window.location.search);\n            const storageStrategy = urlParams.get('storage') || 'float';\n\n            renderer = new Renderer(canvas, { storageStrategy });\n            callback(renderer, canvas);\n        } catch (error) {\n            logger.error('Failed to initialize renderer', error);\n            alert('Failed to initialize WebGL renderer: ' + (error.message || error));\n        }\n    }\n\n    // Step 3: Initialize UI and start rendering\n    function initUI(renderer, canvas) {\n        // Initialize UI controls\n        const manager = initControls(renderer, function(controlsData) {\n            const { manager, state, saveSettings } = controlsData;\n\n            // Get initial settings and apply to renderer\n            // ControlManager settings keys match renderer config keys exactly,\n            // so we can pass the settings object directly (no manual mapping!)\n            const settings = manager.getSettings();\n            renderer.updateConfig(settings);\n\n            // Controls are ready, start rendering\n            renderer.start();\n\n            // Setup animation panel\n            setupAnimationPanel(renderer, manager);\n\n            // Make utilities globally available for debugging\n            window.renderer = renderer;\n            window.loadPreset = loadPreset;\n            window.logger = logger;\n            window.saveSettings = saveSettings; // Make saveSettings available globally\n            window.manager = manager; // Make manager available for debugging\n\n            // Initialize modal window and tabs\n            const modal = initializeModal();\n\n            // Register tabs in display order (left to right)\n\n            // Register Debug Console tab\n            const debugTab = new DebugTab(logger);\n            modal.registerTab(debugTab);\n\n            // Register Notebook Debug tab\n            const notebookDebugTab = new NotebookDebugTab();\n            modal.registerTab(notebookDebugTab);\n\n            // Register Documentation tab\n            const docsTab = new DocsTab();\n            modal.registerTab(docsTab);\n\n            // Make modal globally available\n            window.appModal = modal;\n\n            // Make notebook editor globally available\n            window.notebookEditor = notebookEditor;\n\n            // Field equations editor will be created lazily when first opened\n            window.fieldEquationsEditor = null;\n            window.getFieldEquationsEditor = () => {\n                if (!window.fieldEquationsEditor) {\n                    window.fieldEquationsEditor = new FieldEquationsEditor(renderer);\n                }\n                return window.fieldEquationsEditor;\n            };\n\n            logger.info('N-Dimensional Vector Field Renderer initialized!');\n            logger.info('Available presets: ' + Object.keys(window.presets).join(', '));\n            logger.info('Try: loadPreset(\"3d_lorenz\")');\n        });\n    }\n\n    // Step 4: Setup pan/zoom (after renderer is created)\n    function setupPanZoom(renderer, canvas) {\n        // Pan and zoom handling\n        let isDragging = false;\n        let lastX = 0;\n        let lastY = 0;\n\n        // Debounced save for pan/zoom (saves 500ms after last interaction)\n        let saveTimeout = null;\n        function debouncedSave() {\n            if (saveTimeout) {\n                clearTimeout(saveTimeout);\n            }\n            saveTimeout = setTimeout(() => {\n                if (window.saveSettings) {\n                    window.saveSettings();\n                }\n            }, 500);\n        }\n\n        canvas.addEventListener('mousedown', (e) => {\n            if (e.target === canvas) {\n                isDragging = true;\n                lastX = e.clientX;\n                lastY = e.clientY;\n            }\n        });\n\n        canvas.addEventListener('mousemove', (e) => {\n            if (isDragging) {\n                const dx = e.clientX - lastX;\n                const dy = e.clientY - lastY;\n\n                const bbox = renderer.bbox;\n                const width = bbox.max[0] - bbox.min[0];\n                const height = bbox.max[1] - bbox.min[1];\n\n                const scale = width / canvas.width;\n\n                bbox.min[0] -= dx * scale;\n                bbox.max[0] -= dx * scale;\n                bbox.min[1] += dy * scale;\n                bbox.max[1] += dy * scale;\n\n                renderer.updateConfig({ bbox: bbox });\n\n                lastX = e.clientX;\n                lastY = e.clientY;\n            }\n        });\n\n        canvas.addEventListener('mouseup', () => {\n            isDragging = false;\n            debouncedSave(); // Save after panning ends\n        });\n\n        canvas.addEventListener('mouseleave', () => {\n            isDragging = false;\n            if (!isDragging) {\n                debouncedSave(); // Save if we were panning\n            }\n        });\n\n        canvas.addEventListener('wheel', (e) => {\n            e.preventDefault();\n\n            const zoomFactor = e.deltaY > 0 ? 1.1 : 0.9;\n\n            const rect = canvas.getBoundingClientRect();\n            const mouseX = e.clientX - rect.left;\n            const mouseY = e.clientY - rect.top;\n\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            // Zoom towards mouse position\n            const centerX = bbox.min[0] + width * (mouseX / canvas.width);\n            const centerY = bbox.max[1] - height * (mouseY / canvas.height);\n\n            const newHeight = height * zoomFactor;\n            const aspectRatio = canvas.width / canvas.height;\n            const newWidth = newHeight * aspectRatio;\n\n            const ratioX = (centerX - bbox.min[0]) / width;\n            const ratioY = (bbox.max[1] - centerY) / height;\n\n            bbox.min[0] = centerX - newWidth * ratioX;\n            bbox.max[0] = centerX + newWidth * (1 - ratioX);\n            bbox.min[1] = centerY - newHeight * (1 - ratioY);\n            bbox.max[1] = centerY + newHeight * ratioY;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave(); // Save after zoom\n        });\n\n        // Touch support for mobile\n        let lastTouchDistance = 0;\n\n        canvas.addEventListener('touchstart', (e) => {\n            if (e.touches.length === 1) {\n                isDragging = true;\n                lastX = e.touches[0].clientX;\n                lastY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                isDragging = false;\n                const dx = e.touches[1].clientX - e.touches[0].clientX;\n                const dy = e.touches[1].clientY - e.touches[0].clientY;\n                lastTouchDistance = Math.sqrt(dx * dx + dy * dy);\n            }\n            e.preventDefault();\n        });\n\n        canvas.addEventListener('touchmove', (e) => {\n            if (e.touches.length === 1 && isDragging) {\n                const dx = e.touches[0].clientX - lastX;\n                const dy = e.touches[0].clientY - lastY;\n\n                const bbox = renderer.bbox;\n                const width = bbox.max[0] - bbox.min[0];\n                const height = bbox.max[1] - bbox.min[1];\n\n                const scale = width / canvas.width;\n\n                bbox.min[0] -= dx * scale;\n                bbox.max[0] -= dx * scale;\n                bbox.min[1] += dy * scale;\n                bbox.max[1] += dy * scale;\n\n                renderer.updateConfig({ bbox: bbox });\n\n                lastX = e.touches[0].clientX;\n                lastY = e.touches[0].clientY;\n            } else if (e.touches.length === 2) {\n                const dx = e.touches[1].clientX - e.touches[0].clientX;\n                const dy = e.touches[1].clientY - e.touches[0].clientY;\n                const distance = Math.sqrt(dx * dx + dy * dy);\n\n                if (lastTouchDistance > 0) {\n                    const zoomFactor = lastTouchDistance / distance;\n\n                    const bbox = renderer.bbox;\n                    const height = bbox.max[1] - bbox.min[1];\n\n                    const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n                    const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n                    const newHeight = height * zoomFactor;\n                    const aspectRatio = canvas.width / canvas.height;\n                    const newWidth = newHeight * aspectRatio;\n\n                    bbox.min[0] = centerX - newWidth / 2;\n                    bbox.max[0] = centerX + newWidth / 2;\n                    bbox.min[1] = centerY - newHeight / 2;\n                    bbox.max[1] = centerY + newHeight / 2;\n\n                    renderer.updateConfig({ bbox: bbox });\n                }\n\n                lastTouchDistance = distance;\n            }\n            e.preventDefault();\n        });\n\n        canvas.addEventListener('touchend', () => {\n            isDragging = false;\n            lastTouchDistance = 0;\n            debouncedSave(); // Save after touch interaction ends\n        });\n\n        // ========================================\n        // Zoom/Pan Button Controls\n        // ========================================\n\n        // Helper function to zoom towards center\n        function zoomToCenter(zoomFactor) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const centerX = (bbox.min[0] + bbox.max[0]) / 2;\n            const centerY = (bbox.min[1] + bbox.max[1]) / 2;\n\n            const newHeight = height * zoomFactor;\n            const aspectRatio = canvas.width / canvas.height;\n            const newWidth = newHeight * aspectRatio;\n\n            bbox.min[0] = centerX - newWidth / 2;\n            bbox.max[0] = centerX + newWidth / 2;\n            bbox.min[1] = centerY - newHeight / 2;\n            bbox.max[1] = centerY + newHeight / 2;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave();\n        }\n\n        // Helper function to pan\n        function panView(dx, dy) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            // Pan by 10% of the current view\n            const panX = width * dx * 0.1;\n            const panY = height * dy * 0.1;\n\n            bbox.min[0] += panX;\n            bbox.max[0] += panX;\n            bbox.min[1] += panY;\n            bbox.max[1] += panY;\n\n            renderer.updateConfig({ bbox: bbox });\n            debouncedSave();\n        }\n\n        // Zoom buttons\n        $('#zoom-in').on('click', () => zoomToCenter(0.9)); // Zoom in (0.9 = 10% closer)\n        $('#zoom-out').on('click', () => zoomToCenter(1.11)); // Zoom out (1.11 = 11% farther)\n\n        // Pan buttons\n        $('#pan-up').on('click', () => panView(0, 1));\n        $('#pan-down').on('click', () => panView(0, -1));\n        $('#pan-left').on('click', () => panView(-1, 0));\n        $('#pan-right').on('click', () => panView(1, 0));\n\n        // Diagonal pan buttons\n        $('#pan-up-left').on('click', () => panView(-1, 1));\n        $('#pan-up-right').on('click', () => panView(1, 1));\n        $('#pan-down-left').on('click', () => panView(-1, -1));\n        $('#pan-down-right').on('click', () => panView(1, -1));\n\n        // Center View at Origin button - centers view at (0,0) while keeping current zoom\n        $('#pan-reset').on('click', function() {\n            const currentBBox = renderer.bbox;\n            const currentWidth = currentBBox.max[0] - currentBBox.min[0];\n            const currentHeight = currentBBox.max[1] - currentBBox.min[1];\n\n            renderer.updateConfig({\n                bbox: {\n                    min: [-currentWidth / 2, -currentHeight / 2],\n                    max: [currentWidth / 2, currentHeight / 2]\n                },\n                reinitializeParticles: false\n            });\n            debouncedSave();\n        });\n\n        // Mobile compact view controls\n        $('#mobile-zoom-in').on('click', () => zoomToCenter(0.9)); // Zoom in\n        $('#mobile-zoom-out').on('click', () => zoomToCenter(1.11)); // Zoom out\n        $('#mobile-center').on('click', function() {\n            // Center view at origin (same as pan-reset)\n            const currentBBox = renderer.bbox;\n            const currentWidth = currentBBox.max[0] - currentBBox.min[0];\n            const currentHeight = currentBBox.max[1] - currentBBox.min[1];\n\n            renderer.updateConfig({\n                bbox: {\n                    min: [-currentWidth / 2, -currentHeight / 2],\n                    max: [currentWidth / 2, currentHeight / 2]\n                },\n                reinitializeParticles: false\n            });\n            debouncedSave();\n        });\n    }\n\n    // Step 5: Setup grid and cursor display\n    function setupGridAndCursor(renderer, canvas) {\n        const gridCanvas = document.getElementById('grid-canvas');\n        const gridCtx = gridCanvas.getContext('2d');\n        const cursorDiv = $('#cursor-position');\n\n        const showGridCheckbox = document.getElementById('show-grid');\n        let showGrid = showGridCheckbox?.getValue ? showGridCheckbox.getValue() : true;\n        let cursorX = 0;\n        let cursorY = 0;\n\n        // Resize grid canvas to match main canvas\n        function resizeGridCanvas() {\n            gridCanvas.width = canvas.width;\n            gridCanvas.height = canvas.height;\n            drawGrid();\n        }\n\n        // Convert screen coordinates to world coordinates\n        function screenToWorld(screenX, screenY) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const worldX = bbox.min[0] + (screenX / canvas.width) * width;\n            const worldY = bbox.max[1] - (screenY / canvas.height) * height;\n\n            return { x: worldX, y: worldY };\n        }\n\n        // Convert world coordinates to screen coordinates\n        function worldToScreen(worldX, worldY) {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n            const height = bbox.max[1] - bbox.min[1];\n\n            const screenX = ((worldX - bbox.min[0]) / width) * canvas.width;\n            const screenY = ((bbox.max[1] - worldY) / height) * canvas.height;\n\n            return { x: screenX, y: screenY };\n        }\n\n        // Calculate appropriate grid spacing\n        function getGridSpacing() {\n            const bbox = renderer.bbox;\n            const width = bbox.max[0] - bbox.min[0];\n\n            // Target ~10 grid lines across the view\n            const targetLines = 10;\n            const rawSpacing = width / targetLines;\n\n            // Round to nice numbers (1, 2, 5, 10, 20, 50, etc.)\n            const magnitude = Math.pow(10, Math.floor(Math.log10(rawSpacing)));\n            const normalized = rawSpacing / magnitude;\n\n            let spacing;\n            if (normalized < 1.5) spacing = 1 * magnitude;\n            else if (normalized < 3.5) spacing = 2 * magnitude;\n            else if (normalized < 7.5) spacing = 5 * magnitude;\n            else spacing = 10 * magnitude;\n\n            return spacing;\n        }\n\n        // Draw coordinate grid\n        function drawGrid() {\n            if (!showGrid) {\n                gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);\n                return;\n            }\n\n            gridCtx.clearRect(0, 0, gridCanvas.width, gridCanvas.height);\n\n            const bbox = renderer.bbox;\n            const spacing = getGridSpacing();\n\n            // Draw vertical grid lines\n            const startX = Math.floor(bbox.min[0] / spacing) * spacing;\n            const endX = Math.ceil(bbox.max[0] / spacing) * spacing;\n\n            gridCtx.strokeStyle = 'rgba(255, 255, 255, 0.1)';\n            gridCtx.lineWidth = 1;\n            gridCtx.font = '10px Courier New';\n            gridCtx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n\n            for (let x = startX; x <= endX; x += spacing) {\n                const screen = worldToScreen(x, 0);\n\n                // Draw line\n                gridCtx.beginPath();\n                gridCtx.moveTo(screen.x, 0);\n                gridCtx.lineTo(screen.x, gridCanvas.height);\n                gridCtx.stroke();\n\n                // Draw label\n                if (Math.abs(x) < 0.0001) continue; // Skip zero\n                const label = x.toFixed(Math.max(0, -Math.floor(Math.log10(spacing))));\n                gridCtx.fillText(label, screen.x + 3, gridCanvas.height - 5);\n            }\n\n            // Draw horizontal grid lines\n            const startY = Math.floor(bbox.min[1] / spacing) * spacing;\n            const endY = Math.ceil(bbox.max[1] / spacing) * spacing;\n\n            for (let y = startY; y <= endY; y += spacing) {\n                const screen = worldToScreen(0, y);\n\n                // Draw line\n                gridCtx.beginPath();\n                gridCtx.moveTo(0, screen.y);\n                gridCtx.lineTo(gridCanvas.width, screen.y);\n                gridCtx.stroke();\n\n                // Draw label\n                if (Math.abs(y) < 0.0001) continue; // Skip zero\n                const label = y.toFixed(Math.max(0, -Math.floor(Math.log10(spacing))));\n                gridCtx.fillText(label, 5, screen.y - 3);\n            }\n\n            // Draw axes (thicker)\n            const origin = worldToScreen(0, 0);\n\n            gridCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';\n            gridCtx.lineWidth = 2;\n\n            // X-axis\n            if (origin.y >= 0 && origin.y <= gridCanvas.height) {\n                gridCtx.beginPath();\n                gridCtx.moveTo(0, origin.y);\n                gridCtx.lineTo(gridCanvas.width, origin.y);\n                gridCtx.stroke();\n                gridCtx.fillText('0', origin.x + 3, origin.y - 3);\n            }\n\n            // Y-axis\n            if (origin.x >= 0 && origin.x <= gridCanvas.width) {\n                gridCtx.beginPath();\n                gridCtx.moveTo(origin.x, 0);\n                gridCtx.lineTo(origin.x, gridCanvas.height);\n                gridCtx.stroke();\n            }\n        }\n\n        // Update cursor position display\n        function updateCursorDisplay() {\n            const world = screenToWorld(cursorX, cursorY);\n\n            // Read pixel values at cursor position\n            const rect = canvas.getBoundingClientRect();\n            const canvasX = cursorX - rect.left;\n            const canvasY = cursorY - rect.top;\n            const pixelData = renderer.readPixelAt(canvasX, canvasY);\n\n            let displayText = `x: ${world.x.toFixed(3)}, y: ${world.y.toFixed(3)}`;\n\n            if (pixelData) {\n                if (pixelData.hdr) {\n                    const [r, g, b] = pixelData.hdr;\n                    displayText += `\\nHDR: (${r.toFixed(3)}, ${g.toFixed(3)}, ${b.toFixed(3)})`;\n                }\n                if (pixelData.ldr) {\n                    const [r, g, b] = pixelData.ldr;\n                    displayText += `\\nLDR: (${r.toFixed(3)}, ${g.toFixed(3)}, ${b.toFixed(3)})`;\n                }\n            }\n\n            cursorDiv.html(displayText.replace(/\\n/g, '<br>'));\n        }\n\n        // Track mouse position\n        canvas.addEventListener('mousemove', (e) => {\n            cursorX = e.clientX;\n            cursorY = e.clientY;\n            updateCursorDisplay();\n        });\n\n        // Toggle grid\n        if (showGridCheckbox) {\n            showGridCheckbox.addEventListener('change', function() {\n                showGrid = showGridCheckbox.getValue();\n                drawGrid();\n            });\n        }\n\n        // Redraw grid when window resizes\n        window.addEventListener('resize', resizeGridCanvas);\n\n        // Redraw grid periodically to catch bbox changes\n        setInterval(drawGrid, 100);\n\n        // Update FPS counter\n        const fpsDisplay = document.querySelector('#fps-counter .fps-display');\n        const mobileControls = document.getElementById('mobile-controls');\n\n        function formatFrameCount(count) {\n            if (count >= 1000) {\n                const k = count / 1000;\n                // Show one decimal place for values like 1.5k, but not for 1k, 2k, etc.\n                if (k % 1 === 0) {\n                    return `${Math.floor(k)}k`;\n                } else {\n                    return `${k.toFixed(1)}k`;\n                }\n            }\n            return count.toString();\n        }\n\n        function updateFPS() {\n            if (renderer && renderer.fps !== undefined) {\n                const framesText = renderer.totalFrames !== undefined\n                    ? ` | ${formatFrameCount(renderer.totalFrames)} frames`\n                    : '';\n                const fpsText = `${renderer.fps}${framesText}`;\n\n                // Update desktop FPS display\n                if (fpsDisplay) {\n                    fpsDisplay.textContent = `FPS: ${fpsText}`;\n                }\n\n                // Update mobile controls FPS display\n                if (mobileControls && mobileControls.setFPS) {\n                    mobileControls.setFPS(fpsText);\n                }\n            }\n        }\n        setInterval(updateFPS, 500); // Update every 500ms\n\n        // Histogram panel\n        const histogramPanel = $('#histogram-panel');\n        const histogramCanvas = document.getElementById('histogram-canvas');\n        const histogramCtx = histogramCanvas.getContext('2d');\n\n        // Make histogram panel collapsible\n        $('#histogram-header').on('click', function() {\n            histogramPanel.toggleClass('collapsed');\n            $('#histogram-expand').text(histogramPanel.hasClass('collapsed') ? '\u25B6' : '\u25BC');\n        });\n\n        // Draw histogram\n        function drawHistogram() {\n            if (!renderer) return;\n\n            const stats = renderer.getBufferStats();\n            if (!stats || !stats.histogram || stats.histogram.length === 0) return;\n\n            const canvas = histogramCanvas;\n            const ctx = histogramCtx;\n            const dpr = window.devicePixelRatio || 1;\n\n            // Set canvas resolution\n            canvas.width = canvas.clientWidth * dpr;\n            canvas.height = canvas.clientHeight * dpr;\n            ctx.scale(dpr, dpr);\n\n            const width = canvas.clientWidth;\n            const height = canvas.clientHeight;\n\n            // Clear\n            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\n            ctx.fillRect(0, 0, width, height);\n\n            // Find max count for scaling\n            const maxCount = Math.max(...stats.histogram);\n            if (maxCount === 0) return;\n\n            // Draw bars\n            const barWidth = width / stats.histogram.length;\n            ctx.fillStyle = '#4CAF50';\n\n            stats.histogram.forEach((count, i) => {\n                const barHeight = (count / maxCount) * (height - 4);\n                const x = i * barWidth;\n                const y = height - barHeight;\n                ctx.fillRect(x, y, barWidth - 1, barHeight);\n            });\n\n            // Update info\n            $('#hist-avg').text(stats.avgBrightness.toFixed(1));\n            $('#hist-max').text(stats.maxBrightness.toFixed(0));\n\n            // Check if velocity is available\n            if (stats.maxVelocity !== undefined && stats.maxVelocity !== null) {\n                $('#hist-vel').text(stats.maxVelocity.toFixed(2));\n            } else {\n                $('#hist-vel').text('--');\n            }\n        }\n\n        setInterval(drawHistogram, 1000); // Update every second\n\n        resizeGridCanvas();\n        updateCursorDisplay();\n    }\n\n    // Step 6: Setup keyboard shortcuts\n    function setupKeyboardShortcuts(renderer) {\n        document.addEventListener('keydown', (e) => {\n            // Close mobile panels or floating panels: Press 'Escape' key\n            if (e.key === 'Escape') {\n                // Check if mobile panel manager exists and has an open panel\n                if (window.mobilePanelManager && window.mobilePanelManager.getCurrentPanel()) {\n                    e.preventDefault();\n                    window.mobilePanelManager.hideAllPanels();\n                    logger.verbose('Mobile panel closed via Escape key');\n                    return;\n                }\n\n                // Check if any floating panels are open\n                const openFloatingPanels = $('.floating-panel:visible');\n                if (openFloatingPanels.length > 0) {\n                    e.preventDefault();\n                    openFloatingPanels.hide();\n                    logger.verbose('Floating panel closed via Escape key');\n                    return;\n                }\n            }\n\n            // Clear screen: Press 'C' key (with no modifiers to avoid conflicts)\n            if (e.key === 'c' && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {\n                // Don't trigger if user is typing in an input field\n                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\n                    return;\n                }\n\n                e.preventDefault();\n                renderer.clearScreen();\n                logger.info('Screen cleared via keyboard shortcut (C)');\n            }\n        });\n    }\n\n    // Step 7: Setup animation panel\n    function setupAnimationPanel(renderer, manager) {\n        let animator = null;\n\n        // Load animation script\n        $('#animation-script-input').on('change', function(e) {\n            const file = e.target.files[0];\n            if (!file) return;\n\n            const reader = new FileReader();\n            reader.onload = function(event) {\n                try {\n                    const scriptData = JSON.parse(event.target.result);\n\n                    // Create animator\n                    animator = new Animator(renderer, manager);\n                    const script = animator.loadScript(scriptData);\n\n                    // Update UI with script info\n                    $('#anim-name').text(script.name);\n\n                    // Timeline-based animation (new format)\n                    const duration = script.timeline[script.timeline.length - 1].time;\n                    const totalFrames = Math.ceil(duration * script.fps);\n\n                    $('#anim-param').text(`${script.timeline.length} keyframes`);\n                    $('#anim-range').text(`0s \u2192 ${duration}s`);\n                    $('#anim-frames').text(totalFrames);\n                    $('#anim-fps').text(script.fps);\n                    $('#anim-duration').text(`${duration.toFixed(1)}s`);\n\n                    // Show info and enable run button\n                    $('#animation-info').show();\n                    $('#animation-run-btn').prop('disabled', false);\n                    $('#animation-download-btn').prop('disabled', true);\n\n                    logger.info(`Animation script loaded: ${script.name}`);\n                } catch (error) {\n                    alert('Failed to load animation script: ' + error.message);\n                    logger.error('Animation script load failed', error);\n                }\n            };\n            reader.readAsText(file);\n        });\n\n        // Run animation\n        $('#animation-run-btn').on('click', async function() {\n            if (!animator) return;\n\n            try {\n                // Disable controls\n                $('#animation-run-btn').prop('disabled', true);\n                $('#animation-pause-btn').prop('disabled', false);\n                $('#animation-stop-btn').prop('disabled', false);\n                $('#animation-script-input').prop('disabled', true);\n\n                // Show progress\n                $('#animation-progress').show();\n\n                // Run with progress callback\n                await animator.run((frameNum, totalFrames, time) => {\n                    const percent = (frameNum / totalFrames) * 100;\n                    $('#progress-bar').css('width', percent + '%');\n                    $('#progress-text').text(`Frame ${frameNum} / ${totalFrames}`);\n                    $('#progress-param').text(`Time: ${time.toFixed(2)}s`);\n                });\n\n                // Animation complete\n                logger.info('Animation complete!');\n                alert('Animation complete! ' + animator.frames.length + ' frames captured.');\n\n                // Enable download button\n                $('#animation-download-btn').prop('disabled', false);\n\n            } catch (error) {\n                logger.error('Animation failed', error);\n                alert('Animation failed: ' + error.message);\n            } finally {\n                // Re-enable controls\n                $('#animation-run-btn').prop('disabled', false);\n                $('#animation-pause-btn').prop('disabled', true);\n                $('#animation-stop-btn').prop('disabled', true);\n                $('#animation-script-input').prop('disabled', false);\n            }\n        });\n\n        // Pause animation\n        $('#animation-pause-btn').on('click', function() {\n            if (!animator) return;\n\n            if (animator.isPaused) {\n                animator.resume();\n                $(this).text('\u23F8 Pause');\n                logger.info('Animation resumed');\n            } else {\n                animator.pause();\n                $(this).text('\u25B6 Resume');\n                logger.info('Animation paused');\n            }\n        });\n\n        // Stop animation\n        $('#animation-stop-btn').on('click', function() {\n            if (!animator) return;\n\n            animator.stop();\n            logger.info('Animation stopped');\n\n            // Reset UI\n            $('#animation-run-btn').prop('disabled', false);\n            $('#animation-pause-btn').prop('disabled', true);\n            $('#animation-stop-btn').prop('disabled', true);\n            $('#animation-script-input').prop('disabled', false);\n        });\n\n        // Download frames\n        $('#animation-download-btn').on('click', async function() {\n            if (!animator || animator.frames.length === 0) return;\n\n            try {\n                $(this).prop('disabled', true);\n                $(this).text('\uD83D\uDCBE Downloading...');\n\n                await animator.downloadFrames();\n\n                $(this).text('\u2713 Downloaded');\n                setTimeout(() => {\n                    $(this).text('\uD83D\uDCBE Download Frames (ZIP)');\n                    $(this).prop('disabled', false);\n                }, 2000);\n\n            } catch (error) {\n                logger.error('Download failed', error);\n                alert('Download failed: ' + error.message);\n                $(this).text('\uD83D\uDCBE Download Frames (ZIP)');\n                $(this).prop('disabled', false);\n            }\n        });\n\n        logger.info('Animation panel initialized');\n    }\n\n    // Step 8: Initialize accordion for controls sections\n    function initAccordion() {\n        const ACCORDION_STATE_KEY = 'accordionState';\n\n        // Load saved accordion state from localStorage\n        let savedState = {};\n        try {\n            const saved = localStorage.getItem(ACCORDION_STATE_KEY);\n            if (saved) {\n                savedState = JSON.parse(saved);\n            }\n        } catch (e) {\n            console.warn('Failed to load accordion state', e);\n        }\n\n        // Get all h2 headers in the controls panel\n        $('#controls h2').each(function(index) {\n            const $header = $(this);\n            const $section = $header.next('.accordion-section');\n\n            if ($section.length === 0) return; // Skip if no accordion section follows\n\n            // Use the header text as a unique identifier\n            const sectionId = $header.text().trim();\n\n            // Determine initial state (default to expanded for first section, collapsed for others)\n            const isCollapsed = savedState.hasOwnProperty(sectionId)\n                ? savedState[sectionId]\n                : (index > 0); // First section open, rest collapsed\n\n            // Set initial state\n            if (isCollapsed) {\n                $header.addClass('collapsed');\n                $section.addClass('collapsed');\n            } else {\n                // Set max-height for smooth transition\n                $section.css('max-height', $section[0].scrollHeight + 'px');\n            }\n\n            // Add click handler\n            $header.on('click', function() {\n                const $h2 = $(this);\n                const $content = $h2.next('.accordion-section');\n                const isCurrentlyCollapsed = $h2.hasClass('collapsed');\n\n                if (isCurrentlyCollapsed) {\n                    // Expand\n                    $h2.removeClass('collapsed');\n                    $content.css('max-height', $content[0].scrollHeight + 'px');\n                    $content.removeClass('collapsed');\n                } else {\n                    // Collapse\n                    $content.css('max-height', $content[0].scrollHeight + 'px');\n                    // Force reflow\n                    $content[0].offsetHeight;\n                    $content.css('max-height', '0');\n                    $h2.addClass('collapsed');\n                    $content.addClass('collapsed');\n                }\n\n                // Save state to localStorage\n                savedState[sectionId] = !isCurrentlyCollapsed;\n                try {\n                    localStorage.setItem(ACCORDION_STATE_KEY, JSON.stringify(savedState));\n                } catch (e) {\n                    console.warn('Failed to save accordion state', e);\n                }\n            });\n\n            // Update max-height when window resizes or content changes\n            const updateMaxHeight = () => {\n                if (!$section.hasClass('collapsed')) {\n                    $section.css('max-height', $section[0].scrollHeight + 'px');\n                }\n            };\n\n            // Create a ResizeObserver to watch for content changes\n            if (typeof ResizeObserver !== 'undefined') {\n                const observer = new ResizeObserver(updateMaxHeight);\n                observer.observe($section[0]);\n            }\n        });\n\n        logger.info('Accordion initialized with ' + $('#controls h2').length + ' sections');\n    }\n\n    // Run initialization sequence in order\n    initAccordion(); // Initialize accordion early (doesn't depend on renderer)\n    initRenderer(function(renderer, canvas) {\n        setupPanZoom(renderer, canvas);\n        setupGridAndCursor(renderer, canvas);\n        setupKeyboardShortcuts(renderer);\n        initUI(renderer, canvas);\n    });\n});\n", "/**\n * Keyframe-based animation system for rendering particle flow animations\n * Supports timeline with multiple simultaneous parameter changes,\n * easing functions, and proper burn-in/accumulation workflow\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\n/**\n * Easing functions for smooth parameter interpolation\n */\nconst EASING_FUNCTIONS = {\n    linear: t => t,\n    easeIn: t => t * t,\n    easeOut: t => 1 - Math.pow(1 - t, 2),\n    easeInOut: t => t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2,\n    easeInCubic: t => t * t * t,\n    easeOutCubic: t => 1 - Math.pow(1 - t, 3),\n    easeInOutCubic: t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2,\n    elastic: t => {\n        const c4 = (2 * Math.PI) / 3;\n        return t === 0 ? 0 : t === 1 ? 1 : -Math.pow(2, 10 * t - 10) * Math.sin((t * 10 - 10.75) * c4);\n    },\n    bounce: t => {\n        const n1 = 7.5625;\n        const d1 = 2.75;\n        if (t < 1 / d1) {\n            return n1 * t * t;\n        } else if (t < 2 / d1) {\n            return n1 * (t -= 1.5 / d1) * t + 0.75;\n        } else if (t < 2.5 / d1) {\n            return n1 * (t -= 2.25 / d1) * t + 0.9375;\n        } else {\n            return n1 * (t -= 2.625 / d1) * t + 0.984375;\n        }\n    }\n};\n\n/**\n * Animation script executor with keyframe timeline\n */\nexport class Animator {\n    constructor(renderer, controlManager) {\n        this.renderer = renderer;\n        this.manager = controlManager;\n        this.frames = [];\n        this.isRunning = false;\n        this.isPaused = false;\n        this.script = null;\n    }\n\n    /**\n     * Load and validate animation script\n     */\n    loadScript(scriptData) {\n        // Validate required fields\n        if (!scriptData.baseSettings) {\n            throw new Error('Animation script missing baseSettings');\n        }\n        if (!scriptData.timeline || !Array.isArray(scriptData.timeline)) {\n            throw new Error('Animation script missing timeline array');\n        }\n        if (scriptData.timeline.length < 2) {\n            throw new Error('Timeline must have at least 2 keyframes');\n        }\n\n        // Validate timeline is sorted by time\n        for (let i = 1; i < scriptData.timeline.length; i++) {\n            if (scriptData.timeline[i].time <= scriptData.timeline[i - 1].time) {\n                throw new Error('Timeline keyframes must be sorted by time');\n            }\n        }\n\n        // Set defaults\n        this.script = {\n            name: scriptData.name || 'Untitled Animation',\n            description: scriptData.description || '',\n            fps: scriptData.fps || 30,\n            baseSettings: scriptData.baseSettings,\n            timeline: scriptData.timeline.map(kf => ({\n                time: kf.time,\n                settings: kf.settings || {},\n                easing: kf.easing || 'linear',\n                convergenceSteps: kf.convergenceSteps || 0\n            })),\n            frameConfig: {\n                burnInSteps: scriptData.frameConfig?.burnInSteps || 5000,\n                clearAfterBurnIn: scriptData.frameConfig?.clearAfterBurnIn !== undefined\n                    ? scriptData.frameConfig.clearAfterBurnIn : true,\n                accumulationSteps: scriptData.frameConfig?.accumulationSteps || 2000\n            }\n        };\n\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        const totalFrames = Math.ceil(duration * this.script.fps);\n\n        logger.info(`Loaded animation: ${this.script.name}`);\n        logger.info(`  Duration: ${duration}s @ ${this.script.fps} fps = ${totalFrames} frames`);\n        logger.info(`  Keyframes: ${this.script.timeline.length}`);\n\n        return this.script;\n    }\n\n    /**\n     * Get keyframe indices and interpolation factor for a given time\n     */\n    getKeyframeIndices(time) {\n        const timeline = this.script.timeline;\n\n        // Handle edge cases\n        if (time <= timeline[0].time) {\n            return { prev: 0, next: 0, t: 0 };\n        }\n        if (time >= timeline[timeline.length - 1].time) {\n            return { prev: timeline.length - 1, next: timeline.length - 1, t: 1 };\n        }\n\n        // Find surrounding keyframes\n        for (let i = 1; i < timeline.length; i++) {\n            if (time <= timeline[i].time) {\n                const prev = i - 1;\n                const next = i;\n                const t = (time - timeline[prev].time) / (timeline[next].time - timeline[prev].time);\n                return { prev, next, t };\n            }\n        }\n\n        // Should never reach here\n        return { prev: timeline.length - 1, next: timeline.length - 1, t: 1 };\n    }\n\n    /**\n     * Interpolate between two values\n     */\n    interpolateValue(start, end, t, easingName = 'linear') {\n        const easingFunc = EASING_FUNCTIONS[easingName] || EASING_FUNCTIONS.linear;\n        const easedT = easingFunc(t);\n\n        // Handle different value types\n        if (typeof start === 'number' && typeof end === 'number') {\n            return start + (end - start) * easedT;\n        }\n\n        // For arrays (like expressions or bbox)\n        if (Array.isArray(start) && Array.isArray(end)) {\n            return start.map((v, i) => {\n                const endValue = end[i] !== undefined ? end[i] : v;\n                if (typeof v === 'number') {\n                    return v + (endValue - v) * easedT;\n                }\n                // For string expressions, just switch at t > 0.5\n                return easedT < 0.5 ? v : endValue;\n            });\n        }\n\n        // For objects (like mapperParams, transformParams)\n        if (typeof start === 'object' && start !== null && typeof end === 'object' && end !== null) {\n            const result = { ...start };\n            for (const key in end) {\n                if (start[key] !== undefined) {\n                    result[key] = this.interpolateValue(start[key], end[key], easedT, easingName);\n                } else {\n                    result[key] = end[key];\n                }\n            }\n            return result;\n        }\n\n        // For other types (strings, booleans), just switch at t > 0.5\n        return easedT < 0.5 ? start : end;\n    }\n\n    /**\n     * Get interpolated settings for a given time\n     */\n    getInterpolatedSettings(time) {\n        const { prev, next, t } = this.getKeyframeIndices(time);\n        const timeline = this.script.timeline;\n\n        // If at a keyframe, use its settings directly\n        if (prev === next) {\n            return { ...this.script.baseSettings, ...timeline[prev].settings };\n        }\n\n        // Interpolate between keyframes\n        const prevSettings = { ...this.script.baseSettings, ...timeline[prev].settings };\n        const nextSettings = { ...this.script.baseSettings, ...timeline[next].settings };\n        const easing = timeline[next].easing;\n\n        const interpolated = { ...prevSettings };\n\n        // Interpolate each setting that exists in next keyframe\n        for (const key in nextSettings) {\n            if (prevSettings[key] !== undefined) {\n                interpolated[key] = this.interpolateValue(\n                    prevSettings[key],\n                    nextSettings[key],\n                    t,\n                    easing\n                );\n            } else {\n                interpolated[key] = nextSettings[key];\n            }\n        }\n\n        return interpolated;\n    }\n\n    /**\n     * Calculate animation alpha (0.0-1.0) for the entire animation duration\n     */\n    getAnimationAlpha(time) {\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        return Math.max(0, Math.min(1, time / duration));\n    }\n\n    /**\n     * Wait for a single animation frame\n     */\n    waitFrame() {\n        return new Promise(resolve => requestAnimationFrame(resolve));\n    }\n\n    /**\n     * Capture current render buffer as PNG blob at scaled resolution\n     */\n    async captureFrame() {\n        return this.renderer.captureRenderBuffer();\n    }\n\n    /**\n     * Render a single animation frame with proper workflow\n     */\n    async renderAnimationFrame(time, frameNum, totalFrames) {\n        const { frameConfig } = this.script;\n\n        // Step 1: Get interpolated settings for this time\n        const settings = this.getInterpolatedSettings(time);\n        const alpha = this.getAnimationAlpha(time);\n\n        logger.info(`Frame ${frameNum + 1}/${totalFrames}: t=${time.toFixed(3)}s, alpha=${alpha.toFixed(3)}`);\n\n        // Step 2: Apply settings (may trigger shader recompilation)\n        this.manager.setSettings(settings);\n        this.renderer.setAnimationAlpha(alpha);\n        await this.waitFrame();\n\n        // Step 3: Clear render buffer and reset particles\n        this.renderer.clearRenderBuffer();\n        this.renderer.resetParticles();\n\n        // Step 4: Run burn-in steps (let particles settle into attractor)\n        if (frameConfig.burnInSteps > 0) {\n            logger.verbose(`  Burn-in: ${frameConfig.burnInSteps} steps`);\n            this.renderer.step(frameConfig.burnInSteps);\n        }\n\n        // Step 5: Optionally clear render buffer again (keep particles)\n        if (frameConfig.clearAfterBurnIn) {\n            this.renderer.clearRenderBuffer();\n        }\n\n        // Step 6: Run accumulation steps (build up trails)\n        if (frameConfig.accumulationSteps > 0) {\n            logger.verbose(`  Accumulation: ${frameConfig.accumulationSteps} steps`);\n            for (let i = 0; i < frameConfig.accumulationSteps; i++) {\n                this.renderer.updatePositions();\n                this.renderer.drawParticles();\n                this.renderer.fadeScreen();\n            }\n        }\n\n        // Step 7: Final render pass for output\n        this.renderer.render();\n        await this.waitFrame();\n\n        // Step 8: Capture frame\n        const blob = await this.captureFrame();\n\n        return blob;\n    }\n\n    /**\n     * Run the animation and capture frames\n     */\n    async run(progressCallback) {\n        if (this.isRunning) {\n            throw new Error('Animation already running');\n        }\n\n        if (!this.script) {\n            throw new Error('No animation script loaded');\n        }\n\n        this.isRunning = true;\n        this.isPaused = false;\n        this.frames = [];\n\n        const duration = this.script.timeline[this.script.timeline.length - 1].time;\n        const totalFrames = Math.ceil(duration * this.script.fps);\n\n        try {\n            // Apply base settings\n            logger.info('Applying base settings...');\n\n            // Apply settings (exclude coordinateSystem - will apply it after)\n            const settingsWithoutCoordSystem = { ...this.script.baseSettings };\n            delete settingsWithoutCoordSystem.coordinateSystem;\n            this.manager.setSettings(settingsWithoutCoordSystem);\n\n            // Apply coordinate system AFTER other settings (so dimension change doesn't reset it)\n            if (this.script.baseSettings.coordinateSystem) {\n                const { CoordinateSystem } = await import('../math/coordinate-systems.js');\n                const coordSystem = CoordinateSystem.fromJSON(this.script.baseSettings.coordinateSystem);\n                this.renderer.coordinateSystem = coordSystem;\n                logger.info(`Set coordinate system: ${coordSystem.name}`);\n\n                // Trigger shader recompilation with the coordinate system\n                this.renderer.compileShaders();\n                logger.info('Shaders recompiled with coordinate system');\n            }\n\n            await this.waitFrame();\n\n            // Render each frame\n            for (let frameNum = 0; frameNum < totalFrames; frameNum++) {\n                // Check for pause\n                while (this.isPaused && this.isRunning) {\n                    await new Promise(resolve => setTimeout(resolve, 100));\n                }\n\n                if (!this.isRunning) {\n                    logger.info('Animation stopped');\n                    break;\n                }\n\n                // Calculate time for this frame\n                const time = (frameNum / this.script.fps);\n\n                // Render frame\n                const blob = await this.renderAnimationFrame(time, frameNum, totalFrames);\n\n                this.frames.push({\n                    frameNum,\n                    time,\n                    blob,\n                    timestamp: Date.now()\n                });\n\n                // Progress callback\n                if (progressCallback) {\n                    progressCallback(frameNum + 1, totalFrames, time);\n                }\n            }\n\n            logger.info(`Animation complete: ${this.frames.length} frames captured`);\n            return this.frames;\n\n        } catch (error) {\n            logger.error('Animation failed:', error);\n            throw error;\n        } finally {\n            this.isRunning = false;\n        }\n    }\n\n    /**\n     * Pause animation\n     */\n    pause() {\n        this.isPaused = true;\n    }\n\n    /**\n     * Resume animation\n     */\n    resume() {\n        this.isPaused = false;\n    }\n\n    /**\n     * Stop animation\n     */\n    stop() {\n        this.isRunning = false;\n        this.isPaused = false;\n    }\n\n    /**\n     * Download all captured frames as ZIP\n     */\n    async downloadFrames() {\n        if (this.frames.length === 0) {\n            throw new Error('No frames to download');\n        }\n\n        // Use JSZip if available, otherwise download individually\n        if (window.JSZip) {\n            return await this.downloadAsZip();\n        } else {\n            return await this.downloadIndividually();\n        }\n    }\n\n    /**\n     * Download frames as ZIP archive\n     */\n    async downloadAsZip() {\n        const JSZip = window.JSZip;\n        const zip = new JSZip();\n\n        // Add frames\n        for (const { frameNum, blob } of this.frames) {\n            const filename = `frame_${String(frameNum).padStart(6, '0')}.png`;\n            zip.file(filename, blob);\n        }\n\n        // Add metadata\n        const metadata = {\n            script: this.script,\n            captureDate: new Date().toISOString(),\n            frameCount: this.frames.length\n        };\n        zip.file('metadata.json', JSON.stringify(metadata, null, 2));\n\n        // Generate ZIP\n        logger.info('Generating ZIP archive...');\n        const zipBlob = await zip.generateAsync({ type: 'blob' });\n\n        // Download\n        const filename = `${this.script.name.replace(/\\s+/g, '_')}.zip`;\n        this.downloadBlob(zipBlob, filename);\n\n        logger.info(`Downloaded ${filename}`);\n    }\n\n    /**\n     * Download frames individually\n     */\n    async downloadIndividually() {\n        for (const { frameNum, blob } of this.frames) {\n            const filename = `frame_${String(frameNum).padStart(6, '0')}.png`;\n            this.downloadBlob(blob, filename);\n\n            // Small delay to avoid overwhelming browser\n            await new Promise(resolve => setTimeout(resolve, 100));\n        }\n\n        logger.info(`Downloaded ${this.frames.length} frames`);\n    }\n\n    /**\n     * Download blob as file\n     */\n    downloadBlob(blob, filename) {\n        const url = URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n    }\n}\n", "/**\n * Base class for modal tabs\n *\n * Tabs are lazily loaded - their content is only rendered when activated.\n * Subclasses should override render() and optionally onActivate()/onDeactivate().\n */\nexport class Tab {\n    /**\n     * @param {string} id - Unique identifier for this tab\n     * @param {string} title - Display title for the tab button\n     */\n    constructor(id, title) {\n        this.id = id;\n        this.title = title;\n        this._isRendered = false;\n        this._isActive = false;\n        this._contentElement = null;\n    }\n\n    /**\n     * Get whether this tab has been rendered yet\n     * @returns {boolean}\n     */\n    get isRendered() {\n        return this._isRendered;\n    }\n\n    /**\n     * Get whether this tab is currently active\n     * @returns {boolean}\n     */\n    get isActive() {\n        return this._isActive;\n    }\n\n    /**\n     * Render the tab content. Called once when tab is first activated.\n     * Subclasses MUST override this method.\n     * @param {HTMLElement} container - Container element to render into\n     * @returns {HTMLElement} The rendered content element\n     */\n    render(container) {\n        throw new Error('Tab subclass must implement render() method');\n    }\n\n    /**\n     * Called when tab becomes active.\n     * Override to perform actions when tab is shown.\n     */\n    onActivate() {\n        // Override in subclass if needed\n    }\n\n    /**\n     * Called when tab becomes inactive.\n     * Override to perform cleanup when tab is hidden.\n     */\n    onDeactivate() {\n        // Override in subclass if needed\n    }\n\n    /**\n     * Internal method to activate this tab\n     * @param {HTMLElement} container - Container to render into\n     * @internal\n     */\n    _activate(container) {\n        if (!this._isRendered) {\n            this._contentElement = this.render(container);\n            this._isRendered = true;\n        }\n\n        if (this._contentElement) {\n            this._contentElement.style.display = 'block';\n        }\n\n        this._isActive = true;\n        this.onActivate();\n    }\n\n    /**\n     * Internal method to deactivate this tab\n     * @internal\n     */\n    _deactivate() {\n        if (this._contentElement) {\n            this._contentElement.style.display = 'none';\n        }\n\n        this._isActive = false;\n        this.onDeactivate();\n    }\n\n    /**\n     * Destroy this tab and clean up resources\n     */\n    destroy() {\n        if (this._contentElement && this._contentElement.parentNode) {\n            this._contentElement.parentNode.removeChild(this._contentElement);\n        }\n        this._contentElement = null;\n        this._isRendered = false;\n        this._isActive = false;\n    }\n}\n\n/**\n * Manages tabs within a modal window\n */\nexport class TabManager {\n    constructor() {\n        this._tabs = new Map();\n        this._activeTab = null;\n        this._tabBarElement = null;\n        this._contentElement = null;\n    }\n\n    /**\n     * Register a new tab\n     * @param {Tab} tab - Tab instance to register\n     */\n    register(tab) {\n        if (!(tab instanceof Tab)) {\n            throw new Error('Tab must be an instance of Tab class');\n        }\n\n        if (this._tabs.has(tab.id)) {\n            throw new Error(`Tab with id '${tab.id}' already registered`);\n        }\n\n        this._tabs.set(tab.id, tab);\n\n        // If tab bar exists, add button for this tab\n        if (this._tabBarElement) {\n            this._addTabButton(tab);\n        }\n    }\n\n    /**\n     * Unregister a tab\n     * @param {string} tabId - ID of tab to unregister\n     */\n    unregister(tabId) {\n        const tab = this._tabs.get(tabId);\n        if (!tab) return;\n\n        if (tab === this._activeTab) {\n            this._activeTab = null;\n        }\n\n        tab.destroy();\n        this._tabs.delete(tabId);\n\n        // Remove button if tab bar exists\n        if (this._tabBarElement) {\n            const button = this._tabBarElement.querySelector(`[data-tab-id=\"${tabId}\"]`);\n            if (button) {\n                button.remove();\n            }\n        }\n    }\n\n    /**\n     * Activate a tab by ID\n     * @param {string} tabId - ID of tab to activate\n     * @returns {boolean} True if tab was activated, false if not found\n     */\n    activate(tabId) {\n        const tab = this._tabs.get(tabId);\n        if (!tab) {\n            console.warn(`Tab '${tabId}' not found`);\n            return false;\n        }\n\n        // Deactivate current tab\n        if (this._activeTab && this._activeTab !== tab) {\n            this._activeTab._deactivate();\n            this._updateTabButton(this._activeTab.id, false);\n        }\n\n        // Activate new tab\n        this._activeTab = tab;\n        tab._activate(this._contentElement);\n        this._updateTabButton(tabId, true);\n\n        return true;\n    }\n\n    /**\n     * Get the currently active tab\n     * @returns {Tab|null}\n     */\n    getActiveTab() {\n        return this._activeTab;\n    }\n\n    /**\n     * Get all registered tabs\n     * @returns {Tab[]}\n     */\n    getAllTabs() {\n        return Array.from(this._tabs.values());\n    }\n\n    /**\n     * Initialize UI elements (tab bar and content container)\n     * @param {HTMLElement} tabBarElement - Element to render tab buttons into\n     * @param {HTMLElement} contentElement - Element to render tab content into\n     */\n    initializeUI(tabBarElement, contentElement) {\n        this._tabBarElement = tabBarElement;\n        this._contentElement = contentElement;\n\n        // Render buttons for all registered tabs\n        for (const tab of this._tabs.values()) {\n            this._addTabButton(tab);\n        }\n    }\n\n    /**\n     * Add a button for a tab to the tab bar\n     * @private\n     */\n    _addTabButton(tab) {\n        if (!this._tabBarElement) return;\n\n        const button = document.createElement('button');\n        button.className = 'modal-tab-button';\n        button.textContent = tab.title;\n        button.dataset.tabId = tab.id;\n\n        button.addEventListener('click', () => {\n            this.activate(tab.id);\n        });\n\n        this._tabBarElement.appendChild(button);\n    }\n\n    /**\n     * Update tab button active state\n     * @private\n     */\n    _updateTabButton(tabId, isActive) {\n        if (!this._tabBarElement) return;\n\n        const button = this._tabBarElement.querySelector(`[data-tab-id=\"${tabId}\"]`);\n        if (button) {\n            if (isActive) {\n                button.classList.add('active');\n            } else {\n                button.classList.remove('active');\n            }\n        }\n    }\n\n    /**\n     * Destroy all tabs and clean up\n     */\n    destroy() {\n        for (const tab of this._tabs.values()) {\n            tab.destroy();\n        }\n        this._tabs.clear();\n        this._activeTab = null;\n        this._tabBarElement = null;\n        this._contentElement = null;\n    }\n}\n", "/**\n * Modal window with tabbed interface\n *\n * Provides a full-screen overlay modal with tabs.\n * Single global modal instance - all tabs rendered in the same window.\n */\n\nimport { TabManager } from './tabs/tab-base.js';\n\nexport class Modal {\n    constructor() {\n        this.tabManager = new TabManager();\n        this._modalElement = null;\n        this._isVisible = false;\n        this._onCloseCallback = null;\n        this._wasPaused = false;\n    }\n\n    /**\n     * Initialize the modal with DOM elements\n     * Typically called after DOM is ready\n     */\n    initialize() {\n        this._modalElement = document.getElementById('modal-overlay');\n        if (!this._modalElement) {\n            console.error('Modal overlay element not found');\n            return;\n        }\n\n        const tabBar = document.getElementById('modal-tab-bar');\n        const content = document.getElementById('modal-content');\n\n        if (!tabBar || !content) {\n            console.error('Modal tab bar or content element not found');\n            return;\n        }\n\n        // Initialize tab manager UI\n        this.tabManager.initializeUI(tabBar, content);\n\n        // Setup close button\n        const closeButton = document.getElementById('modal-close');\n        if (closeButton) {\n            closeButton.addEventListener('click', () => this.hide());\n        }\n\n        // Close on overlay click (not content click)\n        this._modalElement.addEventListener('click', (e) => {\n            if (e.target === this._modalElement) {\n                this.hide();\n            }\n        });\n\n        // Close on Escape key\n        document.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape' && this._isVisible) {\n                this.hide();\n            }\n        });\n    }\n\n    /**\n     * Register a tab with the modal\n     * @param {Tab} tab - Tab instance to register\n     */\n    registerTab(tab) {\n        this.tabManager.register(tab);\n    }\n\n    /**\n     * Show the modal and optionally activate a specific tab\n     * @param {string} [tabId] - Optional tab ID to activate on show\n     * @param {string} [section] - Optional section ID within the tab (e.g., 'integrators')\n     */\n    show(tabId = null, section = null) {\n        if (!this._modalElement) {\n            console.error('Modal not initialized');\n            return;\n        }\n\n        // If no tab specified, activate first tab\n        if (!tabId) {\n            const tabs = this.tabManager.getAllTabs();\n            if (tabs.length > 0) {\n                tabId = tabs[0].id;\n            }\n        }\n\n        // Activate the tab\n        if (tabId) {\n            this.tabManager.activate(tabId);\n\n            // If a section is specified, navigate to it\n            if (section) {\n                const tab = this.tabManager.getAllTabs().find(t => t.id === tabId);\n                if (tab && typeof tab.openToSection === 'function') {\n                    // If tab is already rendered, open to section immediately\n                    if (tab.isRendered) {\n                        tab.openToSection(section);\n                    } else {\n                        // Otherwise, set it as pending for when tab activates\n                        if (typeof tab.setPendingSection === 'function') {\n                            tab.setPendingSection(section);\n                        }\n                    }\n                }\n            }\n        }\n\n        // Show modal\n        this._modalElement.style.display = 'flex';\n        this._isVisible = true;\n\n        // Prevent body scrolling while modal is open\n        document.body.style.overflow = 'hidden';\n\n        // Pause rendering\n        if (window.renderer && window.renderer.isRunning) {\n            window.renderer.stop();\n            this._wasPaused = false; // Renderer was running, we paused it\n        } else {\n            this._wasPaused = true; // Renderer was already paused\n        }\n    }\n\n    /**\n     * Hide the modal\n     */\n    hide() {\n        if (!this._modalElement) return;\n\n        this._modalElement.style.display = 'none';\n        this._isVisible = false;\n\n        // Re-enable body scrolling\n        document.body.style.overflow = '';\n\n        // Resume rendering if it was running before we paused it\n        if (window.renderer && !this._wasPaused) {\n            window.renderer.start();\n        }\n\n        // Call close callback if set\n        if (this._onCloseCallback) {\n            this._onCloseCallback();\n        }\n    }\n\n    /**\n     * Check if modal is currently visible\n     * @returns {boolean}\n     */\n    isVisible() {\n        return this._isVisible;\n    }\n\n    /**\n     * Set callback to be called when modal is closed\n     * @param {Function} callback\n     */\n    onClose(callback) {\n        this._onCloseCallback = callback;\n    }\n\n    /**\n     * Get the active tab\n     * @returns {Tab|null}\n     */\n    getActiveTab() {\n        return this.tabManager.getActiveTab();\n    }\n}\n\n// Global modal instance\nlet globalModal = null;\n\n/**\n * Get or create the global modal instance\n * @returns {Modal}\n */\nexport function getModal() {\n    if (!globalModal) {\n        globalModal = new Modal();\n    }\n    return globalModal;\n}\n\n/**\n * Initialize the global modal\n * Should be called after DOM is ready\n */\nexport function initializeModal() {\n    const modal = getModal();\n    modal.initialize();\n    return modal;\n}\n", "/**\n * Notebook Debug Tab\n *\n * Shows the raw notebook context for debugging purposes.\n * Displays all defined functions and cells.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class NotebookDebugTab extends Tab {\n    constructor() {\n        super('notebook-debug', 'Notebook Debug');\n        this.contextTextarea = null;\n        this.refreshButton = null;\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'notebook-debug-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        content.innerHTML = `\n            <div class=\"info\" style=\"margin-bottom: 16px;\">\n                Debug view of the current notebook context. Shows all defined functions and cells.\n            </div>\n\n            <h4 style=\"margin: 0 0 8px 0; padding: 0; font-size: 14px; color: #4CAF50;\">Notebook Context</h4>\n            <div class=\"control-group\">\n                <textarea id=\"notebook-debug-context\"\n                    readonly\n                    rows=\"20\"\n                    style=\"width: 100%; font-family: 'Courier New', monospace; font-size: 11px; background: #0a0a0a; color: #4CAF50; border: 1px solid #444; border-radius: 4px; padding: 10px; resize: vertical;\"></textarea>\n            </div>\n\n            <div class=\"control-group\" style=\"margin-top: 12px;\">\n                <button id=\"refresh-notebook-debug\" style=\"padding: 8px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;\">\n                    Refresh Context\n                </button>\n            </div>\n        `;\n\n        container.appendChild(content);\n\n        // Get references\n        this.contextTextarea = content.querySelector('#notebook-debug-context');\n        this.refreshButton = content.querySelector('#refresh-notebook-debug');\n\n        // Setup event listeners\n        this.refreshButton.addEventListener('click', () => this._refreshContext());\n\n        // Initial load\n        this._refreshContext();\n\n        return content;\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Refresh context when tab is shown\n        this._refreshContext();\n    }\n\n    /**\n     * Refresh the notebook context display\n     * @private\n     */\n    _refreshContext() {\n        if (!this.contextTextarea) return;\n\n        try {\n            if (!window.notebook) {\n                this.contextTextarea.value = 'Error: Notebook not initialized';\n                return;\n            }\n\n            const notebook = window.notebook;\n            const cells = notebook.cells || [];\n\n            let output = `Notebook Context (${cells.length} cells)\\n`;\n            output += '='.repeat(60) + '\\n\\n';\n\n            if (cells.length === 0) {\n                output += '(No cells defined)\\n';\n            } else {\n                cells.forEach((cell, index) => {\n                    output += `Cell ${index + 1} [${cell.type}]:\\n`;\n                    output += `  ID: ${cell.id}\\n`;\n                    output += `  Input: ${cell.input || '(empty)'}\\n`;\n\n                    if (cell.output) {\n                        output += `  Output: ${cell.output}\\n`;\n                    }\n\n                    if (cell.error) {\n                        output += `  Error: ${cell.error}\\n`;\n                    }\n\n                    output += '\\n';\n                });\n            }\n\n            // Show CAS engine info\n            output += '='.repeat(60) + '\\n';\n            output += 'CAS Engine:\\n';\n            if (notebook.casEngine) {\n                output += `  Name: ${notebook.casEngine.getName()}\\n`;\n            } else {\n                output += '  (Not available)\\n';\n            }\n\n            this.contextTextarea.value = output;\n        } catch (error) {\n            this.contextTextarea.value = `Error refreshing context: ${error.message}`;\n            console.error('Error refreshing notebook debug context:', error);\n        }\n    }\n}\n", "/**\n * Debug Console tab for the modal window\n *\n * Provides debug logging, shader inspection, and performance monitoring.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class DebugTab extends Tab {\n    constructor(logger) {\n        super('debug', 'Debug Console');\n        this.logger = logger;\n\n        // UI elements (created in render())\n        this.debugToggle = null;\n        this.debugVerbosity = null;\n        this.debugOutput = null;\n        this.bufferSizeSpan = null;\n        this.bufferPercentSpan = null;\n        this.bufferStatusDiv = null;\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'debug-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        content.innerHTML = `\n            <div style=\"display: flex; align-items: center; margin-bottom: 16px;\">\n                <label style=\"display: flex; align-items: center; cursor: pointer;\">\n                    <input type=\"checkbox\" id=\"debug-toggle\" checked style=\"margin-right: 8px;\">\n                    <span style=\"font-weight: bold;\">Enable Debug Logging</span>\n                </label>\n            </div>\n\n            <div id=\"debug-controls\" style=\"display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px;\">\n                <select id=\"debug-verbosity\" style=\"flex: 0 0 auto;\">\n                    <option value=\"info\">Info</option>\n                    <option value=\"debug\">Debug</option>\n                    <option value=\"verbose\">Verbose</option>\n                    <option value=\"warn\">Warnings Only</option>\n                    <option value=\"error\">Errors Only</option>\n                    <option value=\"silent\">Silent (Buffer)</option>\n                </select>\n                <button id=\"debug-log-update-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Particle integration shader (updates positions each frame)\">Update Shader</button>\n                <button id=\"debug-log-draw-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Particle rendering shaders (vertex + fragment for color/display)\">Draw Shaders</button>\n                <button id=\"debug-log-screen-shader\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Screen fade shader (trail decay)\">Fade Shader</button>\n                <button id=\"debug-log-stats-shaders\" class=\"secondary\" style=\"padding: 4px 8px;\" title=\"Velocity statistics shader (max velocity tracking)\">Velocity Stats</button>\n                <button id=\"debug-buffer-stats\" class=\"secondary\" style=\"padding: 4px 8px;\">Buffer Stats</button>\n                <button id=\"debug-copy\" class=\"secondary\" style=\"padding: 4px 8px;\">Copy Log</button>\n                <button id=\"debug-clear\" class=\"secondary\" style=\"padding: 4px 8px;\">Clear</button>\n            </div>\n\n            <div id=\"debug-buffer-status\" style=\"display: none; padding: 8px; background: #2a2a2a; border-radius: 4px; margin-bottom: 12px; font-size: 11px; color: #888;\">\n                <span style=\"color: #FFA726; font-weight: bold;\">SILENT MODE:</span>\n                Buffering <span id=\"buffer-size\" style=\"color: #4CAF50;\">0</span> logs\n                (<span id=\"buffer-percent\">0</span>% of max)\n                <button id=\"debug-flush-buffer\" class=\"secondary\" style=\"padding: 2px 6px; margin-left: 8px; font-size: 10px;\">Flush Buffer</button>\n                <button id=\"debug-clear-buffer\" class=\"secondary\" style=\"padding: 2px 6px; margin-left: 4px; font-size: 10px;\">Clear Buffer</button>\n            </div>\n\n            <div style=\"padding: 8px; margin-bottom: 12px; background: #1f1f1f; border-radius: 4px;\">\n                <label style=\"display: flex; align-items: center; cursor: pointer; font-size: 11px; margin-bottom: 8px;\" title=\"Enable particle sampling and detailed logging (expensive GPU readback). Buffer stats for tone mapping are always enabled but optimized.\">\n                    <input type=\"checkbox\" id=\"debug-enable-stats\" style=\"margin-right: 6px;\">\n                    <span>Enable Particle Sampling (expensive GPU readback)</span>\n                </label>\n                <label style=\"display: flex; align-items: center; cursor: pointer; font-size: 11px;\" title=\"Show file name and line number for each log entry (extracts caller info from stack trace)\">\n                    <input type=\"checkbox\" id=\"debug-show-line-numbers\" style=\"margin-right: 6px;\">\n                    <span>Show Line Numbers (file:line)</span>\n                </label>\n            </div>\n\n            <div id=\"debug-output\" style=\"background: #0a0a0a; border: 1px solid #333; border-radius: 4px; padding: 12px; height: calc(100vh - 450px); overflow-y: auto; font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.4;\"></div>\n        `;\n\n        container.appendChild(content);\n\n        // Get references to UI elements\n        this.debugToggle = content.querySelector('#debug-toggle');\n        this.debugVerbosity = content.querySelector('#debug-verbosity');\n        this.debugOutput = content.querySelector('#debug-output');\n        this.bufferSizeSpan = content.querySelector('#buffer-size');\n        this.bufferPercentSpan = content.querySelector('#buffer-percent');\n        this.bufferStatusDiv = content.querySelector('#debug-buffer-status');\n\n        // Setup event listeners\n        this._setupEventListeners(content);\n\n        // Initialize logger with current DOM values\n        this.logger.setEnabled(this.debugToggle.checked);\n        const initialVerbosity = this.debugVerbosity.value;\n        this.logger.setVerbosity(initialVerbosity);\n\n        // Show buffer status if starting in silent mode\n        if (initialVerbosity === 'silent') {\n            this.bufferStatusDiv.style.display = 'block';\n            this._updateBufferStatus();\n        }\n\n        // Make logger output to this debug output div\n        this.logger.setOutputElement(this.debugOutput);\n\n        // Restore line numbers preference from localStorage\n        const showLineNumbers = localStorage.getItem('debugShowLineNumbers') === 'true';\n        const lineNumbersCheckbox = content.querySelector('#debug-show-line-numbers');\n        if (lineNumbersCheckbox) {\n            lineNumbersCheckbox.checked = showLineNumbers;\n            this.logger.setShowLineNumbers(showLineNumbers);\n        }\n\n        return content;\n    }\n\n    /**\n     * Setup event listeners for debug controls\n     * @private\n     */\n    _setupEventListeners(content) {\n        // Toggle debug logging\n        this.debugToggle.addEventListener('change', () => {\n            this.logger.setEnabled(this.debugToggle.checked);\n            this.logger.info('Debug logging ' + (this.debugToggle.checked ? 'enabled' : 'disabled'));\n        });\n\n        // Change verbosity\n        this.debugVerbosity.addEventListener('change', () => {\n            const verbosity = this.debugVerbosity.value;\n            this.logger.setVerbosity(verbosity);\n            this.logger.info('Verbosity set to: ' + verbosity);\n\n            // Show/hide buffer status indicator\n            if (verbosity === 'silent') {\n                this.bufferStatusDiv.style.display = 'block';\n                this._updateBufferStatus();\n            } else {\n                this.bufferStatusDiv.style.display = 'none';\n            }\n        });\n\n        // Copy log to clipboard\n        content.querySelector('#debug-copy').addEventListener('click', () => {\n            const logs = this.logger.getLogs();\n            let logText = 'N-Dimensional Vector Field Renderer - Debug Log\\n';\n            logText += '='.repeat(60) + '\\n\\n';\n\n            for (const log of logs) {\n                logText += `[${log.timestamp}] [${log.level.toUpperCase()}] ${log.message}`;\n                if (log.data) {\n                    const dataStr = typeof log.data === 'object' ?\n                        JSON.stringify(log.data) :\n                        String(log.data);\n                    logText += ` | Data: ${dataStr}`;\n                }\n                if (log.stack) {\n                    logText += `\\nStack Trace:\\n${log.stack}`;\n                }\n                logText += '\\n';\n            }\n\n            // Copy to clipboard\n            navigator.clipboard.writeText(logText).then(() => {\n                this.logger.info('Log copied to clipboard (' + logs.length + ' entries)');\n            }).catch(err => {\n                this.logger.error('Failed to copy log to clipboard', err);\n            });\n        });\n\n        // Clear log\n        content.querySelector('#debug-clear').addEventListener('click', () => {\n            this.logger.clear();\n        });\n\n        // Flush buffer\n        content.querySelector('#debug-flush-buffer').addEventListener('click', () => {\n            this.logger.flush();\n            this._updateBufferStatus();\n        });\n\n        // Clear buffer\n        content.querySelector('#debug-clear-buffer').addEventListener('click', () => {\n            this.logger.clearSilencedBuffer();\n            this._updateBufferStatus();\n        });\n\n        // Toggle line numbers\n        content.querySelector('#debug-show-line-numbers').addEventListener('change', (e) => {\n            this.logger.setShowLineNumbers(e.target.checked);\n            this.logger.info('Line numbers ' + (e.target.checked ? 'enabled' : 'disabled'));\n            this.logger.updateUI(); // Refresh display to show/hide line numbers\n        });\n\n        // Shader logging buttons\n        content.querySelector('#debug-log-update-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logUpdateShader === 'function') {\n                window.renderer.logUpdateShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log update shader');\n            }\n        });\n\n        content.querySelector('#debug-log-draw-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logDrawShader === 'function') {\n                window.renderer.logDrawShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log draw shader');\n            }\n        });\n\n        content.querySelector('#debug-log-screen-shader').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logScreenShader === 'function') {\n                window.renderer.logScreenShader();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log screen shader');\n            }\n        });\n\n        content.querySelector('#debug-log-stats-shaders').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logStatsShaders === 'function') {\n                window.renderer.logStatsShaders();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log stats shaders');\n            }\n        });\n\n        content.querySelector('#debug-buffer-stats').addEventListener('click', () => {\n            if (window.renderer && typeof window.renderer.logBufferStats === 'function') {\n                window.renderer.logBufferStats();\n            } else {\n                this.logger.warn('Renderer not initialized - cannot log buffer stats');\n            }\n        });\n\n        // Enable/disable stats\n        content.querySelector('#debug-enable-stats').addEventListener('change', (e) => {\n            if (window.renderer) {\n                const enabled = e.target.checked;\n                window.renderer.enableDebugStats = enabled;\n                this.logger.info(`GPU debug stats ${enabled ? 'ENABLED' : 'DISABLED'}`);\n            }\n        });\n    }\n\n    /**\n     * Update buffer status display\n     * @private\n     */\n    _updateBufferStatus() {\n        const stats = this.logger.getBufferStats();\n        this.bufferSizeSpan.textContent = stats.bufferSize;\n        this.bufferPercentSpan.textContent = stats.bufferUsagePercent;\n\n        // Update color based on buffer usage\n        if (stats.bufferUsagePercent > 80) {\n            this.bufferSizeSpan.style.color = '#EF5350'; // Red when near full\n        } else if (stats.bufferUsagePercent > 50) {\n            this.bufferSizeSpan.style.color = '#FFA726'; // Orange when half full\n        } else {\n            this.bufferSizeSpan.style.color = '#4CAF50'; // Green when plenty of space\n        }\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Start periodic buffer status updates if in silent mode\n        if (!this._bufferUpdateInterval) {\n            this._bufferUpdateInterval = setInterval(() => {\n                if (this.logger.isSilenced() && this._isActive) {\n                    this._updateBufferStatus();\n                }\n            }, 1000);\n        }\n    }\n\n    /**\n     * Called when tab becomes inactive\n     */\n    onDeactivate() {\n        // Stop buffer status updates\n        if (this._bufferUpdateInterval) {\n            clearInterval(this._bufferUpdateInterval);\n            this._bufferUpdateInterval = null;\n        }\n    }\n\n    /**\n     * Clean up resources\n     */\n    destroy() {\n        if (this._bufferUpdateInterval) {\n            clearInterval(this._bufferUpdateInterval);\n            this._bufferUpdateInterval = null;\n        }\n        super.destroy();\n    }\n}\n", "/**\n * Documentation tab for the modal window\n *\n * Provides organized documentation with collapsible sections.\n * Can be opened to specific sections via anchor links from help icons.\n * Loads documentation from markdown files.\n */\n\nimport { Tab } from './tab-base.js';\n\nexport class DocsTab extends Tab {\n    constructor() {\n        super('docs', 'Documentation');\n        this.sections = [];\n\n        // Define documentation sections\n        this.sectionDefinitions = [\n            { id: 'display-options', title: 'Display Options & UI Controls', file: 'docs/display-options.md' },\n            { id: 'vector-fields', title: 'Vector Fields', file: 'docs/vector-fields.md' },\n            { id: 'integrators', title: 'Integration Methods', file: 'docs/integrators.md' },\n            { id: 'color-modes', title: 'Color Modes', file: 'docs/color-modes.md' },\n            { id: 'projection', title: '2D Projection', file: 'docs/projection.md' },\n            { id: 'coordinate-systems', title: 'Coordinate Systems', file: 'docs/coordinate-systems.md' },\n            { id: 'domain-transforms', title: 'Domain Transforms', file: 'docs/domain-transforms.md' },\n            { id: 'hdr-rendering', title: 'HDR & Tone Mapping', file: 'docs/hdr-rendering.md' },\n            { id: 'rendering-effects', title: 'Rendering Effects', file: 'docs/rendering-effects.md' },\n            { id: 'particle-settings', title: 'Particle Settings', file: 'docs/particle-settings.md' },\n            { id: 'animation', title: 'Animation System', file: 'docs/animation.md' },\n            { id: 'preset-management', title: 'Preset Management', file: 'docs/preset-management.md' },\n            { id: 'storage-strategy', title: 'Storage Strategy', file: 'docs/storage-strategy.md' },\n            { id: 'keyboard-shortcuts', title: 'Keyboard Shortcuts', file: 'docs/keyboard-shortcuts.md' }\n        ];\n    }\n\n    /**\n     * Load markdown file and convert to HTML\n     * @private\n     */\n    async _loadMarkdown(file) {\n        try {\n            const response = await fetch(file);\n            if (!response.ok) {\n                throw new Error(`Failed to load ${file}: ${response.statusText}`);\n            }\n            const markdown = await response.text();\n\n            // Parse markdown with marked.js\n            if (typeof marked === 'undefined') {\n                console.error('marked.js not loaded');\n                return `<p>Error: Markdown parser not available</p>`;\n            }\n\n            return marked.parse(markdown);\n        } catch (error) {\n            console.error('Error loading markdown:', error);\n            return `<p>Error loading documentation: ${error.message}</p>`;\n        }\n    }\n\n    /**\n     * Render the tab content\n     */\n    render(container) {\n        const content = document.createElement('div');\n        content.id = 'docs-tab-content';\n        content.className = 'modal-tab-content';\n        content.style.display = 'none';\n\n        // Create container with loading message\n        content.innerHTML = `\n            <div class=\"docs-container\">\n                <p style=\"text-align: center; padding: 40px; color: #888;\">Loading documentation...</p>\n            </div>\n        `;\n\n        container.appendChild(content);\n\n        // Load all markdown files and render sections\n        this._loadAllSections(content);\n\n        return content;\n    }\n\n    /**\n     * Load all markdown sections asynchronously\n     * @private\n     */\n    async _loadAllSections(content) {\n        const docsContainer = content.querySelector('.docs-container');\n\n        // Load all sections\n        const sectionPromises = this.sectionDefinitions.map(async (def) => {\n            const html = await this._loadMarkdown(def.file);\n            return { id: def.id, title: def.title, html };\n        });\n\n        const sections = await Promise.all(sectionPromises);\n\n        // Render all sections\n        const sectionsHTML = sections.map(section =>\n            this._renderSection(section.id, section.title, section.html)\n        ).join('');\n\n        docsContainer.innerHTML = sectionsHTML;\n\n        // Setup collapsible sections\n        this._setupCollapsibles(content);\n\n        // If there's a pending section, open it now\n        if (this._pendingSection) {\n            this.openToSection(this._pendingSection);\n            this._pendingSection = null;\n        }\n    }\n\n    /**\n     * Render a collapsible documentation section\n     * @private\n     */\n    _renderSection(id, title, content) {\n        return `\n            <div class=\"docs-section collapsed\" id=\"docs-${id}\">\n                <div class=\"docs-section-header\">\n                    <h3>${title}</h3>\n                    <span class=\"docs-toggle\">\u25B6</span>\n                </div>\n                <div class=\"docs-section-content\" style=\"max-height: 0;\">\n                    ${content}\n                </div>\n            </div>\n        `;\n    }\n\n    /**\n     * Setup collapsible section behavior\n     * @private\n     */\n    _setupCollapsibles(container) {\n        const headers = container.querySelectorAll('.docs-section-header');\n\n        headers.forEach(header => {\n            header.addEventListener('click', () => {\n                const section = header.parentElement;\n                const content = section.querySelector('.docs-section-content');\n                const toggle = header.querySelector('.docs-toggle');\n                const isCollapsed = section.classList.contains('collapsed');\n\n                if (isCollapsed) {\n                    section.classList.remove('collapsed');\n                    // Set a large initial max-height to allow content to render\n                    content.style.maxHeight = '5000px';\n                    toggle.textContent = '\u25BC';\n\n                    // After content has rendered, set to exact height for smooth future collapses\n                    setTimeout(() => {\n                        if (!section.classList.contains('collapsed')) {\n                            content.style.maxHeight = content.scrollHeight + 'px';\n                        }\n                    }, 350);\n                } else {\n                    section.classList.add('collapsed');\n                    content.style.maxHeight = '0';\n                    toggle.textContent = '\u25B6';\n                }\n            });\n        });\n    }\n\n    /**\n     * Open to a specific section\n     * @param {string} sectionId - Section ID (e.g., 'integrators')\n     */\n    openToSection(sectionId) {\n        if (!this._contentElement) return;\n\n        const section = this._contentElement.querySelector(`#docs-${sectionId}`);\n        if (!section) {\n            console.warn(`Documentation section '${sectionId}' not found`);\n            return;\n        }\n\n        // Expand the section if collapsed\n        if (section.classList.contains('collapsed')) {\n            const header = section.querySelector('.docs-section-header');\n            header.click();\n        }\n\n        // Scroll to section after expansion animation completes\n        setTimeout(() => {\n            section.scrollIntoView({ behavior: 'smooth', block: 'start' });\n        }, 400);\n    }\n\n    /**\n     * Called when tab becomes active\n     */\n    onActivate() {\n        // Check if we need to open to a specific section\n        if (this._pendingSection) {\n            this.openToSection(this._pendingSection);\n            this._pendingSection = null;\n        }\n    }\n\n    /**\n     * Set a section to open when tab becomes active\n     * @param {string} sectionId - Section ID\n     */\n    setPendingSection(sectionId) {\n        this._pendingSection = sectionId;\n    }\n}\n", "/**\n * Web Components - Main export and registration\n *\n * Import from this file to get all web components and the registration function.\n */\n\n// Export base class\nexport { ControlElement } from './base.js';\n\n// Export components\nexport { LinearSlider } from './slider.js';\nexport { LogSlider } from './log-slider.js';\nexport { PercentSlider } from './percent-slider.js';\nexport { AnimatableSlider, createFadeTransform } from './animatable-slider.js';\nexport { AnimatableTimestep } from './animatable-timestep.js';\nexport { AnimationAlpha } from './animation-alpha.js';\nexport { AnimationSpeed } from './animation-speed.js';\nexport { NumberInput } from './number-input.js';\nexport { ActionButton } from './action-button.js';\nexport { Checkbox } from './checkbox.js';\nexport { SelectControl } from './select-control.js';\nexport { MobileControls } from './mobile-controls.js';\n\n// Import for registration\nimport { LinearSlider } from './slider.js';\nimport { LogSlider } from './log-slider.js';\nimport { PercentSlider } from './percent-slider.js';\nimport { AnimatableSlider } from './animatable-slider.js';\nimport { AnimatableTimestep } from './animatable-timestep.js';\nimport { AnimationAlpha } from './animation-alpha.js';\nimport { AnimationSpeed } from './animation-speed.js';\nimport { NumberInput } from './number-input.js';\nimport { ActionButton } from './action-button.js';\nimport { Checkbox } from './checkbox.js';\nimport { SelectControl } from './select-control.js';\n\n/**\n * Register all custom elements with the browser\n * Call this once at application startup, before using any components\n *\n * Example:\n * import { registerControlElements } from './src/ui/web-components/index.js';\n * registerControlElements();\n */\nexport function registerControlElements() {\n    // Check if already registered to avoid errors\n    if (!customElements.get('linear-slider')) {\n        customElements.define('linear-slider', LinearSlider);\n    }\n    if (!customElements.get('log-slider')) {\n        customElements.define('log-slider', LogSlider);\n    }\n    if (!customElements.get('percent-slider')) {\n        customElements.define('percent-slider', PercentSlider);\n    }\n    if (!customElements.get('animatable-slider')) {\n        customElements.define('animatable-slider', AnimatableSlider);\n    }\n    if (!customElements.get('animatable-timestep')) {\n        customElements.define('animatable-timestep', AnimatableTimestep);\n    }\n    if (!customElements.get('animation-alpha')) {\n        customElements.define('animation-alpha', AnimationAlpha);\n    }\n    if (!customElements.get('animation-speed')) {\n        customElements.define('animation-speed', AnimationSpeed);\n    }\n    if (!customElements.get('number-input')) {\n        customElements.define('number-input', NumberInput);\n    }\n    if (!customElements.get('action-button')) {\n        customElements.define('action-button', ActionButton);\n    }\n    if (!customElements.get('check-box')) {\n        customElements.define('check-box', Checkbox);\n    }\n    if (!customElements.get('select-control')) {\n        customElements.define('select-control', SelectControl);\n    }\n}\n", "/**\n * Logarithmic Slider Web Component\n */\n\nimport { ControlElement } from './base.js';\n\n/**\n * LogSlider - Logarithmic slider control with reactive binding\n *\n * The slider position is linear (0-100), but the value is logarithmically\n * mapped to the range [minValue, maxValue].\n *\n * Usage:\n * <log-slider\n *   id=\"exposure\"\n *   label=\"Exposure\"\n *   default=\"1.0\"\n *   min-value=\"0.01\"\n *   max-value=\"100.0\"\n *   display-format=\"3\"\n *   transform=\"1.0\"\n *   bind-label=\"label\"\n *   bind-value=\"value\">\n *   <label>\n *     <span>{{label}}</span>: <span bind-text=\"value\">{{value}}</span>\n *   </label>\n *   <input type=\"range\" min=\"0\" max=\"100\" step=\"0.1\">\n * </log-slider>\n *\n * The 'transform' attribute applies linear scaling AFTER logarithmic mapping:\n * - transform=\"1.0\" (default) \u2192 no scaling\n * - transform=\"100\" \u2192 divide final value by 100\n */\nexport class LogSlider extends ControlElement {\n    constructor() {\n        super();\n\n        // Create reactive properties using helper\n        this.createReactiveProperties({\n            label: 'Value',\n            value: 1.0,\n            minValue: 0.01,\n            maxValue: 100.0\n        });\n\n        this._displayFormat = null;\n        this.sliderInput = null;\n    }\n\n    initializeProperties() {\n        this.label = this.getAttribute('label') || 'Value';\n        this.minValue = this.getNumberAttribute('min-value', 0.01);\n        this.maxValue = this.getNumberAttribute('max-value', 100.0);\n        this.transform = this.getNumberAttribute('transform', 1.0);\n        this.curve = this.getNumberAttribute('curve', 1.0); // Sensitivity curve: <1 = easier at low end, >1 = easier at high end\n        this.defaultValue = this.getNumberAttribute('default', 1.0);\n\n        // Parse display format BEFORE setting value (since setter triggers formatValue)\n        const formatAttr = this.getAttribute('display-format');\n        if (formatAttr !== null) {\n            const decimals = parseInt(formatAttr);\n            this._displayFormat = (v) => (v != null ? v.toFixed(decimals) : '0');\n        } else {\n            this._displayFormat = (v) => (v != null ? v.toFixed(3) : '0');\n        }\n\n        // Set value after _displayFormat is ready\n        this.value = this.defaultValue;\n    }\n\n    formatValue(value) {\n        // Only use _displayFormat for numeric values (not strings like labels)\n        // This allows animation bounds to be formatted correctly too\n        if (this._displayFormat && typeof value === 'number') {\n            return this._displayFormat(value);\n        }\n        return super.formatValue(value);\n    }\n\n    /**\n     * Convert linear slider position [0, 100] to logarithmic value\n     * Applies curve parameter to adjust sensitivity\n     */\n    linearToLog(sliderValue) {\n        // Apply curve to slider position (0-1 range)\n        const normalized = sliderValue / 100;\n        const curved = Math.pow(normalized, this.curve);\n        const curvedSliderValue = curved * 100;\n\n        // Apply logarithmic transformation\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        return Math.exp(minLog + scale * curvedSliderValue);\n    }\n\n    /**\n     * Convert logarithmic value to linear slider position [0, 100]\n     * Applies inverse curve to maintain consistency\n     */\n    logToLinear(actualValue) {\n        // Apply inverse logarithmic transformation\n        const minLog = Math.log(this.minValue);\n        const maxLog = Math.log(this.maxValue);\n        const scale = (maxLog - minLog) / 100;\n        const curvedSliderValue = (Math.log(actualValue) - minLog) / scale;\n\n        // Apply inverse curve\n        const curved = curvedSliderValue / 100;\n        const normalized = Math.pow(curved, 1 / this.curve);\n        return normalized * 100;\n    }\n\n    attachInternalListeners() {\n        // Find the slider input using helper\n        this.sliderInput = this.findByRole('slider', 'input[type=\"range\"]');\n        if (!this.sliderInput) return;\n\n        const updateValue = () => {\n            const sliderValue = parseFloat(this.sliderInput.value);\n            this.value = this.linearToLog(sliderValue) / this.transform;\n            this.triggerChange();\n        };\n\n        // Add input listener (fires during drag)\n        this.addInputListener(this.sliderInput, updateValue);\n\n        // Add change listener (fires on click and after drag ends)\n        this.sliderInput.addEventListener('change', updateValue);\n\n        // Add click listener to handle clicks on the track\n        this.sliderInput.addEventListener('click', (e) => {\n            // The browser will update the slider value automatically on click,\n            // but we need to trigger our update function\n            updateValue();\n        });\n\n        // Register action buttons using helper\n        this.registerActionButtons(['decrease', 'increase', 'decrease-large', 'increase-large', 'reset']);\n    }\n\n    getValue() {\n        // Read from actual DOM input if available\n        if (this.sliderInput) {\n            const sliderValue = parseFloat(this.sliderInput.value);\n            return this.linearToLog(sliderValue) / this.transform;\n        }\n        return this.value;\n    }\n\n    setValue(newValue) {\n        this.value = newValue;\n        if (this.sliderInput) {\n            const sliderValue = this.logToLinear(newValue * this.transform);\n            this.sliderInput.value = sliderValue;\n        }\n    }\n\n    handleButtonAction(action) {\n        if (!this.sliderInput) return false;\n\n        const currentSliderValue = parseFloat(this.sliderInput.value);\n        let newSliderValue = currentSliderValue;\n\n        let increment = 1.0;\n        if (action === 'increase-large' || action === 'decrease-large') {\n            increment = 10.0;\n        }\n\n        if (action === 'increase' || action === 'increase-large') {\n            newSliderValue = Math.min(100, currentSliderValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newSliderValue = Math.max(0, currentSliderValue - increment);\n        } else if (action === 'reset') {\n            newSliderValue = this.logToLinear(this.defaultValue);\n        } else {\n            return false;\n        }\n\n        if (newSliderValue !== currentSliderValue) {\n            this.sliderInput.value = newSliderValue;\n            this.value = this.linearToLog(newSliderValue) / this.transform;\n            this.triggerChange();\n            return true;\n        }\n\n        return false;\n    }\n}\n", "/**\n * Percent Slider Web Component\n */\n\nimport { LinearSlider } from './slider.js';\n\n/**\n * PercentSlider - Shows 0-100 in UI, stores 0.0-1.0 in settings\n *\n * Extends LinearSlider with transform=\"100\" by default\n *\n * Usage:\n * <percent-slider\n *   id=\"color-saturation\"\n *   label=\"Saturation\"\n *   default=\"1.0\"\n *   min=\"0\"\n *   max=\"100\"\n *   step=\"1\"\n *   display-format=\"2\">\n *   <label>\n *     <span>{{label}}</span>: <span bind-text=\"value\">{{value}}</span>\n *   </label>\n *   <input type=\"range\" min=\"{{min}}\" max=\"{{max}}\" step=\"{{step}}\" value=\"{{value}}\">\n * </percent-slider>\n */\nexport class PercentSlider extends LinearSlider {\n    constructor() {\n        super();\n        // Always use transform of 100 (slider 0-100 \u2192 value 0.0-1.0)\n        this.transform = 100;\n        this._displayMultiplier = 100; // Multiply stored value by 100 for display\n        this._displaySuffix = '%';\n    }\n\n    initializeProperties() {\n        // Call parent initialization\n        super.initializeProperties();\n\n        // Override transform to always be 100\n        this.transform = 100;\n\n        // Multiply by 100 for display (unless explicitly overridden)\n        if (!this.hasAttribute('display-multiplier')) {\n            this._displayMultiplier = 100;\n        }\n\n        // Always show percent suffix (unless explicitly overridden)\n        if (!this.hasAttribute('display-suffix')) {\n            this._displaySuffix = '%';\n        }\n    }\n}\n", "/**\n * Animatable Timestep Web Component\n * Extends AnimatableSlider with custom timestep increment buttons (-- - + ++)\n */\n\nimport { AnimatableSlider } from './animatable-slider.js';\n\n/**\n * AnimatableTimestep - Animatable slider with timestep-specific increment buttons\n *\n * Usage:\n * <animatable-timestep\n *   id=\"timestep\"\n *   label=\"Timestep\"\n *   default=\"0.01\"\n *   min=\"0.001\"\n *   max=\"2.5\"\n *   step=\"0.001\"\n *   small-increment=\"0.001\"\n *   large-increment=\"0.01\"\n *   animation-min=\"0.001\"\n *   animation-max=\"0.1\"\n *   display-format=\"3\">\n *   <!-- Include buttons with decrease-large, decrease, increase, increase-large attributes -->\n * </animatable-timestep>\n *\n * Features:\n * - All AnimatableSlider features\n * - Custom small increment for - and + buttons (e.g., 0.001)\n * - Custom large increment for -- and ++ buttons (e.g., 0.01)\n * - Configurable via attributes\n */\nexport class AnimatableTimestep extends AnimatableSlider {\n    constructor() {\n        super();\n\n        // Timestep-specific increments\n        this.smallIncrement = 0.001;\n        this.largeIncrement = 0.01;\n    }\n\n    initializeProperties() {\n        super.initializeProperties();\n\n        // Read increment attributes\n        const smallInc = this.getAttribute('small-increment');\n        const largeInc = this.getAttribute('large-increment');\n\n        if (smallInc !== null) {\n            this.smallIncrement = parseFloat(smallInc);\n        }\n        if (largeInc !== null) {\n            this.largeIncrement = parseFloat(largeInc);\n        }\n    }\n\n    /**\n     * Handle button actions with timestep-specific increments\n     */\n    handleButtonAction(action) {\n        const currentValue = this.getValue();\n        const minValue = this.min || 0;\n        const maxValue = this.max || 100;\n\n        let increment;\n        if (action === 'increase' || action === 'decrease') {\n            increment = this.smallIncrement;\n        } else if (action === 'increase-large' || action === 'decrease-large') {\n            increment = this.largeIncrement;\n        } else if (action === 'reset') {\n            const newValue = this.defaultValue;\n            if (newValue !== currentValue) {\n                this.setValue(newValue);\n                this.triggerChange();\n                return true;\n            }\n            return false;\n        } else {\n            return false;\n        }\n\n        let newValue = currentValue;\n        if (action === 'increase' || action === 'increase-large') {\n            newValue = Math.min(maxValue, currentValue + increment);\n        } else if (action === 'decrease' || action === 'decrease-large') {\n            newValue = Math.max(minValue, currentValue - increment);\n        }\n\n        if (newValue !== currentValue) {\n            this.setValue(newValue);\n            this.triggerChange();\n            return true;\n        }\n\n        return false;\n    }\n}\n", "/**\n * Animation Alpha Web Component\n *\n * Extends PercentSlider with auto-animate button for animation control.\n * Works with AnimationController to manage alpha-based parameter animation.\n *\n * Usage:\n * <animation-alpha\n *   id=\"animation-alpha\"\n *   settings-key=\"animationAlpha\"\n *   default=\"0.0\">\n * </animation-alpha>\n */\n\nimport { PercentSlider } from './percent-slider.js';\n\nexport class AnimationAlpha extends PercentSlider {\n    constructor() {\n        super();\n\n        // Animation controller (set by controls-v2.js)\n        this._controller = null;\n        this._animateButton = null;\n        this._isAnimating = false;\n    }\n\n    /**\n     * Set the animation controller\n     * @param {AnimationController} controller - The animation controller instance\n     */\n    setController(controller) {\n        this._controller = controller;\n\n        // Listen to controller alpha changes to update slider during auto-animation\n        if (this._controller) {\n            this._controller.onAlphaChanged((alpha) => {\n                // Update slider value without triggering change event\n                this.value = alpha;\n                if (this.sliderInput) {\n                    this.sliderInput.value = alpha * this.transform;\n                }\n            });\n        }\n    }\n\n    /**\n     * Override connectedCallback to render auto-animate button\n     */\n    connectedCallback() {\n        super.connectedCallback();\n\n        // Render auto-animate button after slider\n        this._renderAnimateButton();\n    }\n\n    /**\n     * Render auto-animate button in the slider control\n     * @private\n     */\n    _renderAnimateButton() {\n        // Find the slider control div\n        const sliderControl = this.querySelector('.slider-control');\n        if (!sliderControl) {\n            console.warn('AnimationAlpha: No .slider-control found in template');\n            return;\n        }\n\n        // Create animate button\n        this._animateButton = document.createElement('button');\n        this._animateButton.className = 'slider-btn';\n        this._animateButton.style.marginLeft = '8px';\n        this._animateButton.style.background = '#4CAF50';\n        this._animateButton.style.color = 'white';\n        this._animateButton.title = 'Auto-animate';\n        this._animateButton.textContent = '\u25B6';\n\n        // Add click handler\n        this._animateButton.addEventListener('click', (e) => {\n            e.stopPropagation(); // Prevent panel close\n            this._handleAnimateClick();\n        });\n\n        // Append to slider control\n        sliderControl.appendChild(this._animateButton);\n    }\n\n    /**\n     * Handle auto-animate button click\n     * @private\n     */\n    _handleAnimateClick() {\n        if (!this._controller) {\n            console.warn('AnimationAlpha: No controller set');\n            return;\n        }\n\n        if (this._isAnimating) {\n            // Stop animation\n            this._controller.stop();\n            this._isAnimating = false;\n\n            // Update button appearance\n            this._animateButton.textContent = '\u25B6';\n            this._animateButton.style.background = '#4CAF50';\n            this._animateButton.title = 'Auto-animate';\n        } else {\n            // Start animation\n            this._controller.start();\n            this._isAnimating = true;\n\n            // Update button appearance\n            this._animateButton.textContent = '\u23F8';\n            this._animateButton.style.background = '#FFA726';\n            this._animateButton.title = 'Stop auto-animate';\n        }\n    }\n\n    /**\n     * Override _handleValueChange to update controller when slider changes manually\n     * @private\n     */\n    _handleValueChange() {\n        super._handleValueChange();\n\n        // Update controller when value changes manually (not during animation)\n        if (this._controller && !this._isAnimating) {\n            this._controller.setAlpha(this.value);\n        }\n    }\n}\n\n// Register custom element\ncustomElements.define('animation-alpha', AnimationAlpha);\n", "/**\n * Animation Speed Web Component\n *\n * Linear slider for controlling animation speed (steps per alpha increment).\n * NOT saved to settings (ephemeral).\n *\n * Usage:\n * <animation-speed\n *   id=\"animation-speed\"\n *   default=\"10\"\n *   min=\"1\"\n *   max=\"200\">\n * </animation-speed>\n */\n\nimport { LinearSlider } from './slider.js';\n\nexport class AnimationSpeed extends LinearSlider {\n    constructor() {\n        super();\n\n        // Animation controller (set by controls-v2.js)\n        this._controller = null;\n    }\n\n    /**\n     * Set the animation controller\n     * @param {AnimationController} controller - The animation controller instance\n     */\n    setController(controller) {\n        this._controller = controller;\n\n        // Set initial speed\n        if (this._controller && this.value) {\n            this._controller.setSpeed(this.value);\n        }\n    }\n\n    /**\n     * Override attachInternalListeners to add controller updates\n     */\n    attachInternalListeners() {\n        // Call parent to set up slider\n        super.attachInternalListeners();\n\n        // Add listener to update controller when value changes\n        this.addEventListener('change', () => {\n            if (this._controller) {\n                this._controller.setSpeed(this.value);\n            }\n        });\n    }\n\n    /**\n     * Override saveToSettings to prevent saving (ephemeral control)\n     */\n    saveToSettings(settings) {\n        // Do nothing - animation speed is not saved\n    }\n\n    /**\n     * Override restoreFromSettings to prevent restoring (ephemeral control)\n     */\n    restoreFromSettings(settings) {\n        // Do nothing - animation speed is not saved\n    }\n}\n\n// Register custom element\ncustomElements.define('animation-speed', AnimationSpeed);\n", "/**\n * Number Input Web Component\n *\n * Numeric input control for animation frame capture settings.\n * Does NOT integrate with ControlManager (no save/restore).\n *\n * Usage:\n * <number-input\n *   id=\"animation-frames\"\n *   label=\"Frames\"\n *   default=\"100\"\n *   min=\"1\"\n *   max=\"10000\">\n * </number-input>\n */\n\nimport { ControlElement } from './base.js';\n\nexport class NumberInput extends ControlElement {\n    constructor() {\n        super();\n\n        // Create reactive properties\n        this.createReactiveProperties({\n            label: 'Value',\n            value: 100\n        });\n\n        this.numberInput = null;\n        this._min = 1;\n        this._max = 10000;\n    }\n\n    initializeProperties() {\n        // Read configuration from attributes\n        this.label = this.getAttribute('label') || 'Value';\n        this._min = this.getNumberAttribute('min', 1);\n        this._max = this.getNumberAttribute('max', 10000);\n        this.defaultValue = this.getNumberAttribute('default', 100);\n        this.value = this.defaultValue;\n    }\n\n    attachInternalListeners() {\n        // Find the number input\n        this.numberInput = this.findByRole('input', 'input[type=\"number\"]');\n        if (!this.numberInput) return;\n\n        // Set min/max attributes\n        this.numberInput.setAttribute('min', this._min);\n        this.numberInput.setAttribute('max', this._max);\n\n        // Add input listener\n        this.addInputListener(this.numberInput, () => {\n            const rawValue = parseInt(this.numberInput.value);\n            this.value = isNaN(rawValue) ? this.defaultValue : Math.max(this._min, Math.min(this._max, rawValue));\n            this.triggerChange();\n        });\n    }\n\n    getValue() {\n        if (this.numberInput) {\n            const rawValue = parseInt(this.numberInput.value);\n            return isNaN(rawValue) ? this.defaultValue : Math.max(this._min, Math.min(this._max, rawValue));\n        }\n        return this.value;\n    }\n\n    setValue(value) {\n        const numValue = typeof value === 'number' ? value : parseInt(value);\n        this.value = isNaN(numValue) ? this.defaultValue : Math.max(this._min, Math.min(this._max, numValue));\n\n        if (this.numberInput) {\n            this.numberInput.value = this.value;\n        }\n    }\n\n    reset() {\n        this.setValue(this.defaultValue);\n        this.triggerChange();\n    }\n\n    /**\n     * Override saveToSettings to prevent saving (not managed by ControlManager)\n     */\n    saveToSettings(settings) {\n        // Do nothing - number inputs are not saved\n    }\n\n    /**\n     * Override restoreFromSettings to prevent restoring (not managed by ControlManager)\n     */\n    restoreFromSettings(settings) {\n        // Do nothing - number inputs are not saved\n    }\n}\n\n// Register custom element\ncustomElements.define('number-input', NumberInput);\n", "/**\n * Action Button Web Component\n *\n * Button with state management for enabled/disabled and loading states.\n * Used for Create Animation, Download, Export buttons.\n *\n * Usage:\n * <action-button\n *   id=\"animation-create-btn\"\n *   label=\"Create Animation\"\n *   icon=\"\u25B6\">\n * </action-button>\n */\n\nexport class ActionButton extends HTMLElement {\n    constructor() {\n        super();\n\n        this._label = 'Action';\n        this._icon = '';\n        this._enabled = true;\n        this._loading = false;\n        this._button = null;\n    }\n\n    connectedCallback() {\n        // Read attributes\n        this._label = this.getAttribute('label') || 'Action';\n        this._icon = this.getAttribute('icon') || '';\n\n        // Create button element\n        this._button = document.createElement('button');\n        this._button.className = 'action-btn';\n        this._updateButtonText();\n\n        // Forward click events\n        this._button.addEventListener('click', (e) => {\n            if (this._enabled && !this._loading) {\n                this.dispatchEvent(new CustomEvent('action', { bubbles: true }));\n            }\n        });\n\n        // Append to this element\n        this.appendChild(this._button);\n    }\n\n    /**\n     * Update button text from label and icon\n     * @private\n     */\n    _updateButtonText() {\n        if (!this._button) return;\n\n        const text = this._icon ? `${this._icon} ${this._label}` : this._label;\n        this._button.textContent = text;\n    }\n\n    /**\n     * Set button label\n     * @param {string} label - Button label\n     */\n    setLabel(label) {\n        this._label = label;\n        this._updateButtonText();\n    }\n\n    /**\n     * Set button icon\n     * @param {string} icon - Button icon (emoji or character)\n     */\n    setIcon(icon) {\n        this._icon = icon;\n        this._updateButtonText();\n    }\n\n    /**\n     * Enable or disable button\n     * @param {boolean} enabled - Whether button is enabled\n     */\n    setEnabled(enabled) {\n        this._enabled = enabled;\n        if (this._button) {\n            this._button.disabled = !enabled;\n        }\n    }\n\n    /**\n     * Set loading state\n     * @param {boolean} loading - Whether button is in loading state\n     * @param {string} loadingLabel - Optional label to show while loading\n     */\n    setLoading(loading, loadingLabel = null) {\n        this._loading = loading;\n\n        if (this._button) {\n            this._button.disabled = loading;\n\n            if (loading && loadingLabel) {\n                const originalLabel = this._label;\n                this._label = loadingLabel;\n                this._updateButtonText();\n                this._originalLabel = originalLabel;\n            } else if (!loading && this._originalLabel) {\n                this._label = this._originalLabel;\n                this._updateButtonText();\n                delete this._originalLabel;\n            }\n        }\n    }\n\n    /**\n     * Set button style/color\n     * @param {string} background - Background color\n     */\n    setStyle(background) {\n        if (this._button) {\n            this._button.style.background = background;\n        }\n    }\n\n    /**\n     * Check if button is enabled\n     * @returns {boolean} Whether button is enabled\n     */\n    isEnabled() {\n        return this._enabled && !this._loading;\n    }\n\n    /**\n     * Check if button is loading\n     * @returns {boolean} Whether button is in loading state\n     */\n    isLoading() {\n        return this._loading;\n    }\n}\n\n// Register custom element\ncustomElements.define('action-button', ActionButton);\n", "/**\n * Checkbox Web Component\n *\n * Checkbox control with reactive binding and ControlManager integration.\n *\n * Usage:\n * <check-box\n *   id=\"sync-steps-to-frame-limit\"\n *   settings-key=\"syncStepsToFrameLimit\"\n *   default=\"false\"\n *   label=\"Sync to frame limit\">\n * </check-box>\n *\n * Or with template:\n * <check-box id=\"my-checkbox\" settings-key=\"myCheckbox\" default=\"false\">\n *   <label>\n *     <input type=\"checkbox\">\n *     <span>{{label}}</span>\n *   </label>\n * </check-box>\n */\n\nimport { ControlElement } from './base.js';\n\nexport class Checkbox extends ControlElement {\n    constructor() {\n        super();\n\n        // Create reactive properties\n        this.createReactiveProperties({\n            label: 'Checkbox',\n            checked: false\n        });\n\n        this.checkboxInput = null;\n    }\n\n    initializeProperties() {\n        // Read configuration from attributes\n        this.label = this.getAttribute('label') || 'Checkbox';\n        this.defaultValue = this.getBooleanAttribute('default', false);\n        this.checked = this.defaultValue;\n    }\n\n    attachInternalListeners() {\n        // Find the checkbox input\n        this.checkboxInput = this.findByRole('checkbox', 'input[type=\"checkbox\"]');\n\n        // If no checkbox found, create one with label\n        if (!this.checkboxInput) {\n            this._createDefaultTemplate();\n            this.checkboxInput = this.querySelector('input[type=\"checkbox\"]');\n        }\n\n        if (!this.checkboxInput) return;\n\n        // Sync initial state\n        this.checkboxInput.checked = this.checked;\n\n        // Add change listener\n        this.checkboxInput.addEventListener('change', () => {\n            this.checked = this.checkboxInput.checked;\n            this.triggerChange();\n            // Also dispatch standard 'change' event for compatibility\n            this.dispatchEvent(new Event('change', { bubbles: true }));\n        });\n    }\n\n    /**\n     * Create default checkbox template if none provided\n     * @private\n     */\n    _createDefaultTemplate() {\n        const label = document.createElement('label');\n        label.style.cssText = 'display: flex; align-items: center; cursor: pointer; padding: 4px 0;';\n\n        const input = document.createElement('input');\n        input.type = 'checkbox';\n        input.style.marginRight = '8px';\n\n        const span = document.createElement('span');\n        span.textContent = this.label;\n\n        label.appendChild(input);\n        label.appendChild(span);\n        this.appendChild(label);\n    }\n\n    getValue() {\n        if (this.checkboxInput) {\n            return this.checkboxInput.checked;\n        }\n        return this.checked;\n    }\n\n    setValue(value) {\n        this.checked = Boolean(value);\n        if (this.checkboxInput) {\n            this.checkboxInput.checked = this.checked;\n        }\n    }\n\n    /**\n     * Enable/disable the checkbox\n     */\n    set disabled(value) {\n        if (this.checkboxInput) {\n            this.checkboxInput.disabled = value;\n        }\n    }\n\n    get disabled() {\n        return this.checkboxInput ? this.checkboxInput.disabled : false;\n    }\n\n    /**\n     * Override to store boolean value\n     */\n    saveToSettings(settings) {\n        if (this.settingsKey) {\n            settings[this.settingsKey] = this.getValue();\n        }\n    }\n\n    /**\n     * Override to restore boolean value\n     */\n    restoreFromSettings(settings) {\n        if (settings && this.settingsKey && settings[this.settingsKey] != null) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n// Register custom element\ncustomElements.define('check-box', Checkbox);\n", "/**\n * Select Control Web Component\n *\n * Wraps a native <select> element with ControlManager integration.\n * Preserves optgroups and native browser behavior.\n *\n * Usage:\n * <select-control\n *   id=\"integrator\"\n *   settings-key=\"integrator\"\n *   default=\"rk4\">\n *   <select>\n *     <optgroup label=\"Explicit Methods\">\n *       <option value=\"euler\">Euler (1st order)</option>\n *       <option value=\"rk4\" selected>RK4 (4th order)</option>\n *     </optgroup>\n *   </select>\n * </select-control>\n *\n * Or with options directly in the component:\n * <select-control\n *   id=\"simple-select\"\n *   settings-key=\"simpleSelect\"\n *   default=\"a\">\n *   <option value=\"a\">Option A</option>\n *   <option value=\"b\">Option B</option>\n * </select-control>\n */\n\nimport { ControlElement } from './base.js';\n\nexport class SelectControl extends ControlElement {\n    constructor() {\n        super();\n        this.selectElement = null;\n    }\n\n    initializeProperties() {\n        // Read default from attribute, or from selected option\n        this.defaultValue = this.getAttribute('default') || null;\n    }\n\n    attachInternalListeners() {\n        // Find or create the select element\n        this.selectElement = this.querySelector('select');\n\n        if (!this.selectElement) {\n            // If no <select> found, wrap any <option>/<optgroup> children in a select\n            this._wrapOptionsInSelect();\n            this.selectElement = this.querySelector('select');\n        }\n\n        if (!this.selectElement) return;\n\n        // If no default specified, use the selected option or first option\n        if (!this.defaultValue) {\n            const selected = this.selectElement.querySelector('option[selected]');\n            if (selected) {\n                this.defaultValue = selected.value;\n            } else {\n                const firstOption = this.selectElement.querySelector('option');\n                if (firstOption) {\n                    this.defaultValue = firstOption.value;\n                }\n            }\n        }\n\n        // Set initial value to default\n        if (this.defaultValue) {\n            this.selectElement.value = this.defaultValue;\n        }\n\n        // Add change listener\n        this.selectElement.addEventListener('change', () => {\n            this.triggerChange();\n            // Also dispatch standard 'change' event for compatibility\n            this.dispatchEvent(new Event('change', { bubbles: true }));\n        });\n    }\n\n    /**\n     * Wrap loose option/optgroup elements in a select\n     * @private\n     */\n    _wrapOptionsInSelect() {\n        const options = this.querySelectorAll(':scope > option, :scope > optgroup');\n        if (options.length === 0) return;\n\n        const select = document.createElement('select');\n        for (const opt of Array.from(options)) {\n            select.appendChild(opt);\n        }\n        this.appendChild(select);\n    }\n\n    getValue() {\n        if (this.selectElement) {\n            return this.selectElement.value;\n        }\n        return this.defaultValue;\n    }\n\n    setValue(value) {\n        if (this.selectElement) {\n            this.selectElement.value = value;\n        }\n    }\n\n    /**\n     * Enable/disable the select\n     */\n    set disabled(value) {\n        if (this.selectElement) {\n            this.selectElement.disabled = value;\n        }\n    }\n\n    get disabled() {\n        return this.selectElement ? this.selectElement.disabled : false;\n    }\n\n    /**\n     * Get the selected option text\n     */\n    getSelectedText() {\n        if (this.selectElement && this.selectElement.selectedOptions.length > 0) {\n            return this.selectElement.selectedOptions[0].text;\n        }\n        return '';\n    }\n\n    /**\n     * Override to store string value\n     */\n    saveToSettings(settings) {\n        if (this.settingsKey) {\n            settings[this.settingsKey] = this.getValue();\n        }\n    }\n\n    /**\n     * Override to restore string value\n     */\n    restoreFromSettings(settings) {\n        if (settings && this.settingsKey && settings[this.settingsKey] != null) {\n            this.setValue(settings[this.settingsKey]);\n        }\n    }\n}\n\n// Register custom element\ncustomElements.define('select-control', SelectControl);\n", "import { ControlElement } from './base.js';\nimport { CompositeMixin, ShadowDOMMixin, composeMixins } from '../mixins/index.js';\n\n/**\n * Mobile Controls Component\n * Unified compact control panel for mobile view containing:\n * - FPS display\n * - Timestep slider with +/- buttons\n * - Frame limit toggle and slider\n *\n * Uses shadow DOM for style encapsulation (ShadowDOMMixin).\n * Composite control with children: timestep, frameLimitEnabled, frameLimit (CompositeMixin).\n */\nexport class MobileControls extends composeMixins(\n    ControlElement,\n    CompositeMixin,\n    ShadowDOMMixin\n) {\n    constructor() {\n        super();\n\n        // Default values (mobile-specific)\n        this._defaultValue = {\n            timestep: 0.01,\n            frameLimitEnabled: true,\n            frameLimit: 200\n        };\n\n        // Timestep slider curve (makes low values easier to adjust)\n        this._timestepCurve = 0.4;\n\n        // State\n        this._fps = '--';\n        this._timestep = this._defaultValue.timestep;\n        this._timestepLog = Math.log10(this._timestep);\n        this._frameLimitEnabled = this._defaultValue.frameLimitEnabled;\n        this._frameLimit = this._defaultValue.frameLimit;\n    }\n\n    static get observedAttributes() {\n        return ['settings-key', 'default-timestep', 'default-frame-limit', 'default-frame-limit-enabled'];\n    }\n\n    initializeProperties() {\n        // Read default values from attributes if provided\n        if (this.hasAttribute('default-timestep')) {\n            this._defaultValue.timestep = parseFloat(this.getAttribute('default-timestep'));\n            this._timestep = this._defaultValue.timestep;\n            this._timestepLog = Math.log10(this._timestep);\n        }\n        if (this.hasAttribute('default-frame-limit')) {\n            this._defaultValue.frameLimit = parseInt(this.getAttribute('default-frame-limit'));\n            this._frameLimit = this._defaultValue.frameLimit;\n        }\n        if (this.hasAttribute('default-frame-limit-enabled')) {\n            this._defaultValue.frameLimitEnabled = this.getAttribute('default-frame-limit-enabled') === 'true';\n            this._frameLimitEnabled = this._defaultValue.frameLimitEnabled;\n        }\n    }\n\n    connectedCallback() {\n        if (this._initialized) return;\n\n        // Initialize control properties\n        this.initializeControlProperties();\n        this.initializeProperties();\n\n        this.render();\n        this.initializeChildren();\n        this.attachInternalListeners();\n        this.updateTheme();\n\n        // Watch for theme changes\n        this._themeObserver = new MutationObserver(() => this.updateTheme());\n        this._themeObserver.observe(document.body, {\n            attributes: true,\n            attributeFilter: ['class']\n        });\n\n        this._initialized = true;\n    }\n\n    /**\n     * Register child controls (required by CompositeControlElement)\n     */\n    initializeChildren() {\n        // Register timestep control\n        this.registerChildControl(\n            'timestep',\n            () => this._timestep,\n            (v) => this.setTimestep(v),\n            () => this.setTimestep(this._defaultValue.timestep)\n        );\n\n        // Register frameLimitEnabled control\n        this.registerChildControl(\n            'frameLimitEnabled',\n            () => this._frameLimitEnabled,\n            (v) => this.setFrameLimitEnabled(v),\n            () => this.setFrameLimitEnabled(this._defaultValue.frameLimitEnabled)\n        );\n\n        // Register frameLimit control\n        this.registerChildControl(\n            'frameLimit',\n            () => this._frameLimit,\n            (v) => this.setFrameLimit(v),\n            () => this.setFrameLimit(this._defaultValue.frameLimit)\n        );\n    }\n\n    disconnectedCallback() {\n        if (this._themeObserver) {\n            this._themeObserver.disconnect();\n        }\n    }\n\n    updateTheme() {\n        if (document.body.classList.contains('light-theme')) {\n            this.classList.add('light-theme');\n        } else {\n            this.classList.remove('light-theme');\n        }\n    }\n\n    render() {\n        // Render to shadow DOM for style encapsulation (provided by ShadowDOMMixin)\n        this.renderToShadow(`\n            <style>\n                :host {\n                    display: block;\n                }\n\n                .container {\n                    background: rgba(30, 30, 30, 0.9);\n                    border: 1px solid #444;\n                    border-radius: 4px;\n                    padding: 6px 8px;\n                    font-size: 10px;\n                    color: #4CAF50;\n                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n                }\n\n                :host(.light-theme) .container {\n                    background: rgba(255, 255, 255, 0.9);\n                    border-color: #ccc;\n                    color: #2E7D32;\n                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);\n                }\n\n                .fps-display {\n                    text-align: right;\n                    font-weight: bold;\n                    margin-bottom: 3px;\n                    font-size: 10px;\n                }\n\n                .controls-grid {\n                    display: grid;\n                    grid-template-columns: 1fr 1px 1fr;\n                    gap: 6px;\n                    align-items: start;\n                }\n\n                .divider {\n                    width: 1px;\n                    height: 100%;\n                    background: #444;\n                    justify-self: center;\n                }\n\n                :host(.light-theme) .divider {\n                    background: #ccc;\n                }\n\n                /* Timestep section */\n                .timestep-section {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 2px;\n                    min-width: 0; /* Allow grid to shrink this properly */\n                }\n\n                .timestep-label {\n                    font-size: 11px;\n                    font-weight: bold;\n                    text-align: center;\n                    /* Inherits color from .container (#4CAF50 or #2E7D32) */\n                }\n\n                .timestep-controls {\n                    display: flex;\n                    align-items: center;\n                    gap: 3px;\n                }\n\n                .btn {\n                    padding: 0px 4px;\n                    font-size: 11px;\n                    min-width: 20px;\n                    height: 20px;\n                    line-height: 20px;\n                    background: rgba(255, 255, 255, 0.1);\n                    border: 1px solid #555;\n                    border-radius: 2px;\n                    color: #fff;\n                    cursor: pointer;\n                    flex-shrink: 0;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n\n                .btn:active {\n                    background: rgba(255, 255, 255, 0.2);\n                }\n\n                :host(.light-theme) .btn {\n                    background: rgba(0, 0, 0, 0.05);\n                    border-color: #bbb;\n                    color: #333;\n                }\n\n                :host(.light-theme) .btn:active {\n                    background: rgba(0, 0, 0, 0.1);\n                }\n\n                .timestep-slider {\n                    flex: 1;\n                    min-width: 0;\n                }\n\n                /* Frame limit section */\n                .frame-limit-section {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 2px;\n                    min-width: 0; /* Allow grid to shrink this properly */\n                }\n\n                .frame-limit-header {\n                    display: flex;\n                    align-items: center;\n                    gap: 4px;\n                }\n\n                .frame-limit-label {\n                    color: #aaa;\n                    font-size: 11px;\n                    font-weight: 500;\n                    display: flex;\n                    align-items: center;\n                    gap: 3px;\n                    cursor: pointer;\n                    user-select: none;\n                }\n\n                :host(.light-theme) .frame-limit-label {\n                    color: #666;\n                }\n\n                .frame-limit-checkbox {\n                    margin: 0;\n                    cursor: pointer;\n                }\n\n                .frame-limit-value {\n                    color: #4CAF50;\n                    font-weight: bold;\n                    font-size: 10px;\n                    margin-left: auto;\n                }\n\n                :host(.light-theme) .frame-limit-value {\n                    color: #2E7D32;\n                }\n\n                .frame-limit-slider {\n                    width: 100%;\n                }\n\n                /* Slider styling */\n                input[type=\"range\"] {\n                    -webkit-appearance: none;\n                    appearance: none;\n                    background: transparent;\n                    cursor: pointer;\n                }\n\n                input[type=\"range\"]::-webkit-slider-track {\n                    background: #333;\n                    height: 6px;\n                    border-radius: 3px;\n                }\n\n                :host(.light-theme) input[type=\"range\"]::-webkit-slider-track {\n                    background: #ddd;\n                }\n\n                input[type=\"range\"]::-webkit-slider-thumb {\n                    -webkit-appearance: none;\n                    appearance: none;\n                    width: 14px;\n                    height: 14px;\n                    border-radius: 50%;\n                    background: #4CAF50;\n                    cursor: pointer;\n                    margin-top: -4px;\n                }\n\n                :host(.light-theme) input[type=\"range\"]::-webkit-slider-thumb {\n                    background: #2E7D32;\n                }\n\n                input[type=\"range\"]::-moz-range-track {\n                    background: #333;\n                    height: 6px;\n                    border-radius: 3px;\n                }\n\n                :host(.light-theme) input[type=\"range\"]::-moz-range-track {\n                    background: #ddd;\n                }\n\n                input[type=\"range\"]::-moz-range-thumb {\n                    width: 14px;\n                    height: 14px;\n                    border: none;\n                    border-radius: 50%;\n                    background: #4CAF50;\n                    cursor: pointer;\n                }\n\n                :host(.light-theme) input[type=\"range\"]::-moz-range-thumb {\n                    background: #2E7D32;\n                }\n            </style>\n\n            <div class=\"container\">\n                <div class=\"fps-display\">FPS: ${this._fps}</div>\n\n                <div class=\"controls-grid\">\n                <!-- Timestep section -->\n                <div class=\"timestep-section\">\n                    <div class=\"timestep-label\">Time Step: <span id=\"timestep-value\">${this._timestep.toFixed(4)}</span></div>\n                    <div class=\"timestep-controls\">\n                        <button class=\"btn\" id=\"timestep-decrease\">-</button>\n                        <input type=\"range\" class=\"timestep-slider\" id=\"timestep-slider\"\n                               min=\"-3\" max=\"0.4\" step=\"0.01\" value=\"${this.timestepLogToSlider(this._timestepLog)}\">\n                        <button class=\"btn\" id=\"timestep-increase\">+</button>\n                    </div>\n                </div>\n\n                <!-- Divider -->\n                <div class=\"divider\"></div>\n\n                <!-- Frame limit section -->\n                <div class=\"frame-limit-section\">\n                    <div class=\"frame-limit-header\">\n                        <label class=\"frame-limit-label\" for=\"frame-limit-checkbox\">\n                            <input type=\"checkbox\" class=\"frame-limit-checkbox\" id=\"frame-limit-checkbox\" ${this._frameLimitEnabled ? 'checked' : ''}>\n                            Stop at:\n                        </label>\n                        <span class=\"frame-limit-value\" id=\"frame-limit-value\">${Math.round(this._frameLimit)}</span>\n                    </div>\n                    <input type=\"range\" class=\"frame-limit-slider\" id=\"frame-limit-slider\"\n                           min=\"0\" max=\"100\" step=\"1\" value=\"${this.frameToSlider(this._frameLimit)}\">\n                </div>\n            </div>\n            </div>\n        `);\n    }\n\n    attachInternalListeners() {\n        // Query elements (ShadowDOMMixin provides querySelector override)\n        const timestepSlider = this.querySelector('#timestep-slider');\n        const timestepValue = this.querySelector('#timestep-value');\n        const decreaseBtn = this.querySelector('#timestep-decrease');\n        const increaseBtn = this.querySelector('#timestep-increase');\n\n        timestepSlider.addEventListener('input', () => {\n            const rawSliderValue = parseFloat(timestepSlider.value);\n            this._timestepLog = this.sliderToTimestepLog(rawSliderValue);\n            this._timestep = Math.pow(10, this._timestepLog);\n            timestepValue.textContent = this._timestep.toFixed(4);\n\n            // Trigger ControlElement change callback\n            this.triggerChange();\n\n            // Also trigger component-specific callback for backward compatibility\n            if (this.onTimestepChange) {\n                this.onTimestepChange(this._timestep);\n            }\n        });\n\n        decreaseBtn.addEventListener('click', () => {\n            // Multiply by 0.98 (2% decrease) - linear adjustment\n            const minTimestep = Math.pow(10, -3);\n            this._timestep = Math.max(minTimestep, this._timestep * 0.98);\n            this._timestepLog = Math.log10(this._timestep);\n            timestepSlider.value = this.timestepLogToSlider(this._timestepLog);\n            timestepValue.textContent = this._timestep.toFixed(4);\n\n            this.triggerChange();\n            if (this.onTimestepChange) {\n                this.onTimestepChange(this._timestep);\n            }\n        });\n\n        increaseBtn.addEventListener('click', () => {\n            // Multiply by 1.02 (2% increase) - linear adjustment\n            const maxTimestep = Math.pow(10, 0.4);\n            this._timestep = Math.min(maxTimestep, this._timestep * 1.02);\n            this._timestepLog = Math.log10(this._timestep);\n            timestepSlider.value = this.timestepLogToSlider(this._timestepLog);\n            timestepValue.textContent = this._timestep.toFixed(4);\n\n            this.triggerChange();\n            if (this.onTimestepChange) {\n                this.onTimestepChange(this._timestep);\n            }\n        });\n\n        // Frame limit controls\n        const frameLimitCheckbox = this.querySelector('#frame-limit-checkbox');\n        const frameLimitSlider = this.querySelector('#frame-limit-slider');\n        const frameLimitValue = this.querySelector('#frame-limit-value');\n\n        frameLimitCheckbox.addEventListener('change', () => {\n            this._frameLimitEnabled = frameLimitCheckbox.checked;\n\n            this.triggerChange();\n            if (this.onFrameLimitEnabledChange) {\n                this.onFrameLimitEnabledChange(this._frameLimitEnabled);\n            }\n        });\n\n        frameLimitSlider.addEventListener('input', () => {\n            const sliderValue = parseFloat(frameLimitSlider.value);\n            this._frameLimit = this.sliderToFrame(sliderValue);\n            frameLimitValue.textContent = Math.round(this._frameLimit);\n\n            this.triggerChange();\n            if (this.onFrameLimitChange) {\n                this.onFrameLimitChange(this._frameLimit);\n            }\n        });\n    }\n\n    // ====================================\n    // Component-Specific Public Methods\n    // (getValue/setValue/reset/attachListeners inherited from CompositeControlElement)\n    // ====================================\n\n    // Logarithmic scaling for frame limit (1 to 100000)\n    frameToSlider(frame) {\n        return (Math.log10(Math.max(1, frame)) / Math.log10(100000)) * 100;\n    }\n\n    sliderToFrame(sliderValue) {\n        return Math.round(Math.pow(10, (sliderValue / 100) * Math.log10(100000)));\n    }\n\n    // Timestep slider with curve adjustment\n    // Range: -3 to 0.4 (10^-3 to 10^0.4)\n    sliderToTimestepLog(sliderValue) {\n        const minLog = -3;\n        const maxLog = 0.4;\n        const range = maxLog - minLog;\n\n        // Normalize to 0-1\n        const normalized = (sliderValue - minLog) / range;\n\n        // Apply curve (lower curve = easier to adjust small values)\n        const curved = Math.pow(normalized, this._timestepCurve);\n\n        // Map back to log range\n        return minLog + curved * range;\n    }\n\n    timestepLogToSlider(logValue) {\n        const minLog = -3;\n        const maxLog = 0.4;\n        const range = maxLog - minLog;\n\n        // Normalize to 0-1\n        const curved = (logValue - minLog) / range;\n\n        // Apply inverse curve\n        const normalized = Math.pow(curved, 1 / this._timestepCurve);\n\n        // Map back to slider range\n        return minLog + normalized * range;\n    }\n\n    // Public methods\n    setFPS(fps) {\n        this._fps = fps;\n        if (!this.shadowRoot) return;\n        const display = this.shadowRoot.querySelector('.fps-display');\n        if (display) {\n            display.textContent = `FPS: ${fps}`;\n        }\n    }\n\n    setTimestep(timestep) {\n        this._timestep = timestep;\n        this._timestepLog = Math.log10(timestep);\n        if (!this.shadowRoot) return;\n        const slider = this.shadowRoot.querySelector('#timestep-slider');\n        const value = this.shadowRoot.querySelector('#timestep-value');\n        if (slider) slider.value = this.timestepLogToSlider(this._timestepLog);\n        if (value) value.textContent = timestep.toFixed(4);\n    }\n\n    setFrameLimitEnabled(enabled) {\n        this._frameLimitEnabled = enabled;\n        if (!this.shadowRoot) return;\n        const checkbox = this.shadowRoot.querySelector('#frame-limit-checkbox');\n        if (checkbox) checkbox.checked = enabled;\n    }\n\n    setFrameLimit(limit) {\n        this._frameLimit = limit;\n        if (!this.shadowRoot) return;\n        const slider = this.shadowRoot.querySelector('#frame-limit-slider');\n        const value = this.shadowRoot.querySelector('#frame-limit-value');\n        if (slider) slider.value = this.frameToSlider(limit);\n        if (value) value.textContent = Math.round(limit);\n    }\n\n    getTimestep() {\n        return this._timestep;\n    }\n\n    getFrameLimitEnabled() {\n        return this._frameLimitEnabled;\n    }\n\n    getFrameLimit() {\n        return this._frameLimit;\n    }\n}\n\ncustomElements.define('mobile-controls', MobileControls);\n", "/**\n * Standalone Notebook Editor\n *\n * Opens the notebook modal for editing math functions and definitions\n * Accessible via top menu bar button\n */\n\nimport { logger } from '../utils/debug-logger.js';\nimport { NotebookModal } from './components/notebook-modal.js';\n\nexport class NotebookEditor {\n    constructor() {\n        this.modal = null;\n        this._initialized = false;\n    }\n\n    /**\n     * Initialize the notebook editor (lazy - called on first open)\n     * @private\n     */\n    _initialize() {\n        if (this._initialized) return;\n\n        // Create modal instance (minimal config for standalone notebook)\n        this.modal = new NotebookModal({\n            title: 'Notebook',\n            customContent: null,  // No extra content needed\n            applyButtonText: 'Close',\n            showNotebook: true,\n            showExport: true,\n            onApply: () => {\n                // Just close the modal, notebook auto-saves\n                return { success: true };\n            }\n        });\n\n        this._initialized = true;\n        logger.info('Notebook editor initialized');\n    }\n\n    /**\n     * Create info section for standalone notebook\n     * @private\n     */\n    _createInfoSection() {\n        const info = document.createElement('div');\n        info.style.cssText = 'margin-bottom: 16px; font-size: 13px; color: #e0e0e0;';\n        info.innerHTML = `\n            <p style=\"margin: 0 0 8px 0;\">\n                Define mathematical functions and expressions that can be used throughout the application.\n            </p>\n            <p style=\"margin: 0; font-family: monospace; color: #888; font-size: 11px;\">\n                Example: <span style=\"color: #4CAF50;\">f(x) = sin(x) * exp(-x)</span>\n            </p>\n        `;\n        return info;\n    }\n\n    /**\n     * Open the notebook editor\n     */\n    open() {\n        // Lazy-initialize on first open\n        this._initialize();\n        this.modal.show();\n    }\n\n    /**\n     * Check if notebook editor is open\n     * @returns {boolean}\n     */\n    isOpen() {\n        return this.modal && this.modal.isOpen();\n    }\n\n    /**\n     * Get the modal instance (for advanced usage)\n     * @returns {NotebookModal}\n     */\n    getModal() {\n        return this.modal;\n    }\n}\n\n// Create global singleton instance\nexport const notebookEditor = new NotebookEditor();\n", "/**\n * NotebookModal - Generic modal with notebook REPL and custom content\n *\n * Provides a modal overlay with:\n * - Custom content area (for editor-specific controls)\n * - Notebook REPL section (always present)\n * - Apply/Cancel buttons with validation\n *\n * Used for:\n * - Standalone Notebook editor\n * - Custom integrator/transform editors\n * - Field equation advanced editor\n * - Any other math expression editing\n */\n\nimport { logger } from '../../utils/debug-logger.js';\nimport { NotebookREPL } from './notebook-repl.js';\n\nexport class NotebookModal {\n    /**\n     * @param {Object} config - Modal configuration\n     * @param {string} config.title - Modal title\n     * @param {HTMLElement|string} config.customContent - Custom HTML content or element\n     * @param {Function} config.onApply - Apply callback: (notebook, customFields) => {success: bool, error?: string}\n     * @param {Function} config.onCancel - Cancel callback (optional)\n     * @param {string} config.applyButtonText - Apply button text (default: \"Apply\")\n     * @param {boolean} config.showNotebook - Show notebook section (default: true)\n     * @param {boolean} config.showExport - Show export/import in notebook (default: true)\n     */\n    constructor(config) {\n        this.config = {\n            title: config.title || 'Notebook Editor',\n            customContent: config.customContent || null,\n            onApply: config.onApply || (() => ({ success: true })),\n            onCancel: config.onCancel || null,\n            applyButtonText: config.applyButtonText || 'Apply',\n            showNotebook: config.showNotebook !== false,\n            showExport: config.showExport !== false\n        };\n\n        this.overlay = null;\n        this.modalContainer = null;\n        this.notebookRepl = null;\n        this.customContentContainer = null;\n        this.errorContainer = null;\n        this.isVisible = false;\n\n        this._createUI();\n    }\n\n    /**\n     * Create the modal UI\n     * @private\n     */\n    _createUI() {\n        // Modal overlay (backdrop)\n        this.overlay = document.createElement('div');\n        this.overlay.className = 'notebook-modal-overlay';\n\n        // Click overlay to close\n        this.overlay.addEventListener('click', (e) => {\n            if (e.target === this.overlay) {\n                this.hide();\n            }\n        });\n\n        // Modal container\n        this.modalContainer = document.createElement('div');\n        this.modalContainer.className = 'notebook-modal-container';\n\n        // Title bar\n        const titleBar = document.createElement('div');\n        titleBar.className = 'notebook-modal-header';\n\n        const title = document.createElement('h2');\n        title.className = 'notebook-modal-title';\n        title.textContent = this.config.title;\n\n        // Title bar buttons container\n        const titleButtons = document.createElement('div');\n        titleButtons.style.cssText = 'display: flex; gap: 8px; align-items: center;';\n\n        // Export/Import buttons (if enabled)\n        if (this.config.showExport) {\n            const exportButton = document.createElement('button');\n            exportButton.className = 'notebook-modal-header-button';\n            exportButton.textContent = 'Export';\n            exportButton.title = 'Export notebook as JSON';\n            exportButton.addEventListener('click', () => {\n                if (this.notebookRepl) this.notebookRepl.exportNotebook();\n            });\n\n            const importButton = document.createElement('button');\n            importButton.className = 'notebook-modal-header-button';\n            importButton.textContent = 'Import';\n            importButton.title = 'Import notebook from JSON';\n            importButton.addEventListener('click', () => {\n                if (this.notebookRepl) this.notebookRepl.importNotebook();\n            });\n\n            titleButtons.appendChild(exportButton);\n            titleButtons.appendChild(importButton);\n        }\n\n        const closeButton = document.createElement('button');\n        closeButton.className = 'notebook-modal-close';\n        closeButton.textContent = '\u00D7';\n        closeButton.title = 'Close';\n        closeButton.addEventListener('click', () => this.hide());\n\n        titleButtons.appendChild(closeButton);\n\n        titleBar.appendChild(title);\n        titleBar.appendChild(titleButtons);\n\n        // Content area\n        const contentArea = document.createElement('div');\n        contentArea.className = 'notebook-modal-content';\n\n        // Custom content section\n        this.customContentContainer = document.createElement('div');\n        this.customContentContainer.className = 'notebook-modal-custom-content';\n\n        if (this.config.customContent) {\n            if (typeof this.config.customContent === 'string') {\n                this.customContentContainer.innerHTML = this.config.customContent;\n            } else if (this.config.customContent instanceof HTMLElement) {\n                this.customContentContainer.appendChild(this.config.customContent);\n            }\n            contentArea.appendChild(this.customContentContainer);\n        }\n\n        // Notebook REPL section\n        if (this.config.showNotebook) {\n            const notebookSection = document.createElement('div');\n            notebookSection.className = 'notebook-modal-notebook-section';\n\n            this.notebookRepl = new NotebookREPL({\n                showExport: false  // Export/Import in title bar instead\n            });\n\n            notebookSection.appendChild(this.notebookRepl.getElement());\n            contentArea.appendChild(notebookSection);\n        }\n\n        // Error container\n        this.errorContainer = document.createElement('div');\n        this.errorContainer.className = 'notebook-modal-error';\n\n        // Footer with buttons\n        const footer = document.createElement('div');\n        footer.className = 'notebook-modal-footer';\n\n        const cancelButton = document.createElement('button');\n        cancelButton.className = 'notebook-modal-button-cancel';\n        cancelButton.textContent = 'Cancel';\n        cancelButton.addEventListener('click', () => this.hide());\n\n        const applyButton = document.createElement('button');\n        applyButton.className = 'notebook-modal-button-apply';\n        applyButton.textContent = this.config.applyButtonText;\n        applyButton.addEventListener('click', () => this._handleApply());\n\n        footer.appendChild(cancelButton);\n        footer.appendChild(applyButton);\n\n        // Assemble modal\n        this.modalContainer.appendChild(titleBar);\n        this.modalContainer.appendChild(contentArea);\n        this.modalContainer.appendChild(this.errorContainer);\n        this.modalContainer.appendChild(footer);\n\n        this.overlay.appendChild(this.modalContainer);\n        document.body.appendChild(this.overlay);\n\n        // Close on Escape key\n        this._escapeHandler = (e) => {\n            if (e.key === 'Escape' && this.isVisible) {\n                this.hide();\n            }\n        };\n        document.addEventListener('keydown', this._escapeHandler);\n    }\n\n    /**\n     * Handle Apply button click\n     * @private\n     */\n    async _handleApply() {\n        try {\n            // Clean up empty cells before applying\n            if (this.notebookRepl) {\n                this.notebookRepl.cleanupEmptyCells();\n            }\n\n            // Gather custom fields (if any)\n            const customFields = this._gatherCustomFields();\n\n            // Call apply callback\n            const result = await this.config.onApply(window.notebook, customFields);\n\n            if (result.success) {\n                logger.info('Modal apply successful');\n                this.hide();\n            } else {\n                // Show error\n                alert(`Error: ${result.error || 'Unknown error'}`);\n                logger.error('Modal apply failed:', result.error);\n            }\n        } catch (error) {\n            alert(`Error: ${error.message}`);\n            logger.error('Modal apply error:', error);\n        }\n    }\n\n    /**\n     * Gather values from custom content fields\n     * @private\n     * @returns {Object} Field values keyed by input ID\n     */\n    _gatherCustomFields() {\n        const fields = {};\n\n        if (!this.customContentContainer) return fields;\n\n        // Gather all inputs, textareas, and selects\n        const inputs = this.customContentContainer.querySelectorAll('input, textarea, select');\n        inputs.forEach(input => {\n            if (input.id) {\n                if (input.type === 'checkbox') {\n                    fields[input.id] = input.checked;\n                } else {\n                    fields[input.id] = input.value;\n                }\n            }\n        });\n\n        return fields;\n    }\n\n    /**\n     * Show the modal\n     */\n    show() {\n        this.overlay.style.display = 'block';\n        this.isVisible = true;\n\n        // Clear any previous errors\n        this.hideError();\n\n        // Refresh notebook REPL\n        if (this.notebookRepl) {\n            this.notebookRepl.refresh();\n        }\n\n        logger.info('Opened notebook modal:', this.config.title);\n    }\n\n    /**\n     * Hide the modal\n     */\n    hide() {\n        // Clean up empty cells before closing\n        if (this.notebookRepl) {\n            this.notebookRepl.cleanupEmptyCells();\n        }\n\n        this.overlay.style.display = 'none';\n        this.isVisible = false;\n\n        // Call cancel callback if provided\n        if (this.config.onCancel) {\n            this.config.onCancel();\n        }\n\n        logger.info('Closed notebook modal');\n    }\n\n    /**\n     * Check if modal is visible\n     * @returns {boolean}\n     */\n    isOpen() {\n        return this.isVisible;\n    }\n\n    /**\n     * Get custom content container for dynamic manipulation\n     * @returns {HTMLElement}\n     */\n    getCustomContentContainer() {\n        return this.customContentContainer;\n    }\n\n    /**\n     * Get notebook REPL instance\n     * @returns {NotebookREPL}\n     */\n    getNotebookREPL() {\n        return this.notebookRepl;\n    }\n\n    /**\n     * Show error message in modal\n     * @param {string} errorHtml - Error message (can include HTML)\n     */\n    showError(errorHtml) {\n        this.errorContainer.innerHTML = errorHtml;\n        this.errorContainer.style.display = 'block';\n    }\n\n    /**\n     * Hide error message\n     */\n    hideError() {\n        this.errorContainer.style.display = 'none';\n        this.errorContainer.innerHTML = '';\n    }\n\n    /**\n     * Destroy the modal and clean up\n     */\n    destroy() {\n        document.removeEventListener('keydown', this._escapeHandler);\n\n        if (this.notebookRepl) {\n            this.notebookRepl.destroy();\n        }\n\n        if (this.overlay && this.overlay.parentNode) {\n            this.overlay.parentNode.removeChild(this.overlay);\n        }\n\n        this.overlay = null;\n        this.modalContainer = null;\n        this.notebookRepl = null;\n        this.customContentContainer = null;\n    }\n}\n", "/**\n * NotebookREPL - Manages notebook cells and provides REPL interface\n *\n * Features:\n * - Add/delete/reorder cells\n * - Evaluate individual cells or all cells\n * - Export/import notebook as JSON\n * - Syncs with global window.notebook instance\n */\n\nimport { logger } from '../../utils/debug-logger.js';\nimport { NotebookCell } from './notebook-cell.js';\n\nexport class NotebookREPL {\n    /**\n     * @param {Object} options - Configuration options\n     * @param {Notebook} options.notebook - Notebook instance to use (defaults to window.notebook)\n     * @param {boolean} options.showExport - Show export/import buttons (default: true)\n     */\n    constructor(options = {}) {\n        this.notebook = options.notebook || window.notebook;\n        this.showExport = options.showExport !== false;\n\n        if (!this.notebook) {\n            throw new Error('No notebook instance provided');\n        }\n\n        this.element = null;\n        this.cellsContainer = null;\n        this.cellComponents = new Map(); // cellId \u2192 NotebookCell component\n\n        this._createUI();\n        this._renderCells();\n    }\n\n    /**\n     * Create the REPL UI\n     * @private\n     */\n    _createUI() {\n        this.element = document.createElement('div');\n        this.element.className = 'notebook-repl';\n        this.element.style.cssText = `\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n        `;\n\n        // Cells container\n        this.cellsContainer = document.createElement('div');\n        this.cellsContainer.className = 'notebook-cells';\n        this.cellsContainer.style.cssText = `\n            display: flex;\n            flex-direction: column;\n            gap: 8px;\n            min-height: 50px;\n        `;\n\n        // Assemble\n        this.element.appendChild(this.cellsContainer);\n    }\n\n    /**\n     * Render all cells from notebook\n     * @private\n     */\n    _renderCells() {\n        // Clear existing cell components\n        this.cellComponents.forEach(comp => comp.destroy());\n        this.cellComponents.clear();\n        this.cellsContainer.innerHTML = '';\n\n        // Render cells from notebook\n        const cells = this.notebook.cells || [];\n\n        // Auto-create blank cell if empty\n        if (cells.length === 0) {\n            this.addCell();\n            return;\n        }\n\n        cells.forEach((cellData) => {\n            this._renderCell(cellData);\n        });\n    }\n\n    /**\n     * Render a single cell\n     * @private\n     */\n    _renderCell(cellData) {\n        const cell = new NotebookCell(cellData, {\n            onEvaluate: (id) => this.evaluateCell(id),\n            onMoveUp: (id) => this.moveCellUp(id),\n            onMoveDown: (id) => this.moveCellDown(id),\n            onDelete: (id) => this.deleteCell(id),\n            onInsertBelow: (id) => this.insertCellBelow(id),\n            onInputChange: (id, value) => this.updateCellInput(id, value)\n        });\n\n        this.cellComponents.set(cellData.id, cell);\n        this.cellsContainer.appendChild(cell.getElement());\n    }\n\n    /**\n     * Add a new code cell at the end\n     * @returns {string} - Cell ID\n     */\n    addCell() {\n        const cellId = this.notebook.addCell('code', '');\n        logger.info('Added new cell:', cellId);\n\n        // Render just the new cell (don't re-render everything)\n        const cellData = this.notebook.cells.find(c => c.id === cellId);\n        if (cellData) {\n            this._renderCell(cellData);\n        }\n\n        return cellId;\n    }\n\n    /**\n     * Insert a new cell below the specified cell\n     * @param {string} afterCellId - Cell ID to insert after\n     * @returns {string} - New cell ID\n     */\n    insertCellBelow(afterCellId) {\n        // Find the index of the cell to insert after\n        const cells = this.notebook.cells || [];\n        const afterIndex = cells.findIndex(c => c.id === afterCellId);\n\n        if (afterIndex === -1) {\n            logger.warn('Cell not found:', afterCellId);\n            return this.addCell();\n        }\n\n        // Add new cell at the end\n        const newCellId = this.notebook.addCell('code', '');\n\n        // Move it to the correct position (after the specified cell)\n        const newIndex = cells.findIndex(c => c.id === newCellId);\n        if (newIndex !== -1) {\n            // Move new cell from end to after the target cell\n            const targetPosition = afterIndex + 1;\n            for (let i = newIndex; i > targetPosition; i--) {\n                this.notebook.moveCellUp(newCellId);\n            }\n        }\n\n        logger.info('Inserted new cell below:', afterCellId);\n\n        // Re-render all cells to show correct order\n        this._renderCells();\n\n        // Focus the new cell\n        setTimeout(() => {\n            const newCellComponent = this.cellComponents.get(newCellId);\n            if (newCellComponent) {\n                newCellComponent.focus();\n            }\n        }, 50);\n\n        return newCellId;\n    }\n\n    /**\n     * Delete a cell\n     * @param {string} cellId - Cell ID\n     */\n    deleteCell(cellId) {\n        this.notebook.deleteCell(cellId);\n        logger.info('Deleted cell:', cellId);\n\n        // Re-render\n        this._renderCells();\n    }\n\n    /**\n     * Move cell up\n     * @param {string} cellId - Cell ID\n     */\n    moveCellUp(cellId) {\n        this.notebook.moveCellUp(cellId);\n        logger.verbose('Moved cell up:', cellId);\n\n        // Re-render\n        this._renderCells();\n    }\n\n    /**\n     * Move cell down\n     * @param {string} cellId - Cell ID\n     */\n    moveCellDown(cellId) {\n        this.notebook.moveCellDown(cellId);\n        logger.verbose('Moved cell down:', cellId);\n\n        // Re-render\n        this._renderCells();\n    }\n\n    /**\n     * Update cell input (on typing)\n     * @param {string} cellId - Cell ID\n     * @param {string} value - New input value\n     */\n    updateCellInput(cellId, value) {\n        this.notebook.updateCell(cellId, value);\n        logger.verbose('Updated cell input:', cellId);\n    }\n\n    /**\n     * Evaluate a single cell\n     * @param {string} cellId - Cell ID\n     * @returns {Promise<void>}\n     */\n    async evaluateCell(cellId) {\n        logger.info('Evaluating cell:', cellId);\n\n        // Check if this is the last cell\n        const cells = this.notebook.cells || [];\n        const cellIndex = cells.findIndex(c => c.id === cellId);\n        const isLastCell = cellIndex === cells.length - 1;\n\n        try {\n            const result = await this.notebook.evaluateCell(cellId);\n\n            // Update cell UI with result\n            const cellComponent = this.cellComponents.get(cellId);\n            if (cellComponent) {\n                await cellComponent.updateOutput(result);\n            }\n\n            logger.info('Cell evaluated successfully:', cellId);\n\n            // If this was the last cell, create a new one and focus it\n            if (isLastCell) {\n                const newCellId = this.addCell();\n                // Wait for re-render to complete\n                setTimeout(() => {\n                    const newCellComponent = this.cellComponents.get(newCellId);\n                    if (newCellComponent) {\n                        newCellComponent.focus();\n                    }\n                }, 50);\n            }\n        } catch (error) {\n            logger.error('Error evaluating cell:', error);\n\n            // Show error in cell\n            const cellComponent = this.cellComponents.get(cellId);\n            if (cellComponent) {\n                await cellComponent.updateOutput({\n                    output: null,\n                    tex: null,\n                    error: error.message\n                });\n            }\n        }\n    }\n\n    /**\n     * Evaluate all cells in sequence\n     * @returns {Promise<void>}\n     */\n    async evaluateAll() {\n        logger.info('Evaluating all cells');\n\n        try {\n            await this.notebook.evaluateAll();\n\n            // Update all cell UIs with results\n            for (const [cellId, cellComponent] of this.cellComponents.entries()) {\n                const cellData = this.notebook.cells.find(c => c.id === cellId);\n                if (cellData) {\n                    await cellComponent.updateOutput(cellData);\n                }\n            }\n\n            logger.info('All cells evaluated successfully');\n        } catch (error) {\n            logger.error('Error evaluating all cells:', error);\n        }\n    }\n\n    /**\n     * Export notebook as JSON file\n     */\n    exportNotebook() {\n        try {\n            this.notebook.exportJSON('notebook.json');\n            logger.info('Exported notebook');\n        } catch (error) {\n            logger.error('Failed to export notebook:', error);\n            alert(`Export failed: ${error.message}`);\n        }\n    }\n\n    /**\n     * Import notebook from JSON file\n     */\n    importNotebook() {\n        // Create file input\n        const input = document.createElement('input');\n        input.type = 'file';\n        input.accept = '.json';\n\n        input.addEventListener('change', async (e) => {\n            const file = e.target.files[0];\n            if (!file) return;\n\n            try {\n                await this.notebook.importJSON(file);\n                logger.info('Imported notebook');\n\n                // Re-render with new cells\n                this._renderCells();\n            } catch (error) {\n                logger.error('Failed to import notebook:', error);\n                alert(`Import failed: ${error.message}`);\n            }\n        });\n\n        input.click();\n    }\n\n    /**\n     * Refresh the REPL (re-render all cells)\n     */\n    refresh() {\n        this._renderCells();\n    }\n\n    /**\n     * Clean up empty cells (cells with no input)\n     */\n    cleanupEmptyCells() {\n        const cells = this.notebook.cells || [];\n        const emptyCells = cells.filter(cell => !cell.input || !cell.input.trim());\n\n        if (emptyCells.length > 0) {\n            logger.info(`Cleaning up ${emptyCells.length} empty cells`);\n            emptyCells.forEach(cell => {\n                this.notebook.deleteCell(cell.id);\n            });\n\n            // Re-render to reflect changes\n            this._renderCells();\n        }\n    }\n\n    /**\n     * Get the DOM element\n     * @returns {HTMLElement}\n     */\n    getElement() {\n        return this.element;\n    }\n\n    /**\n     * Destroy the REPL and clean up\n     */\n    destroy() {\n        this.cellComponents.forEach(comp => comp.destroy());\n        this.cellComponents.clear();\n\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode.removeChild(this.element);\n        }\n\n        this.element = null;\n        this.cellsContainer = null;\n    }\n}\n", "/**\n * NotebookCell - Individual notebook cell component\n *\n * Compact single-line layout:\n * [input text........][\u2192][...][\u2191][\u2193][\u2715][+]\n * Output displayed below, right-aligned\n */\n\nimport { logger } from '../../utils/debug-logger.js';\nimport { renderTeXScaled } from '../../utils/math-renderer.js';\n\nexport class NotebookCell {\n    constructor(cellData, callbacks = {}) {\n        this.cellData = cellData;\n        this.callbacks = callbacks;\n\n        this.element = null;\n        this.inputField = null;\n        this.outputDiv = null;\n        this.errorDiv = null;\n\n        this._createUI();\n    }\n\n    /**\n     * Create the cell UI\n     * @private\n     */\n    _createUI() {\n        this.element = document.createElement('div');\n        this.element.className = 'notebook-cell';\n        this.element.dataset.cellId = this.cellData.id;\n        this.element.style.cssText = `\n            margin: 8px 0;\n            display: flex;\n            flex-direction: column;\n            gap: 4px;\n        `;\n\n        // Input row: [input][\u2192][spacer][\u2191][\u2193][\u2715]\n        const inputRow = document.createElement('div');\n        inputRow.style.cssText = `\n            display: flex;\n            align-items: center;\n            gap: 6px;\n        `;\n\n        // Input field\n        this.inputField = document.createElement('input');\n        this.inputField.type = 'text';\n        this.inputField.value = this.cellData.input || '';\n        this.inputField.placeholder = 'Enter expression or function definition (e.g., f(x) = sin(x))';\n        this.inputField.style.cssText = `\n            flex: 1;\n            font-family: 'Courier New', monospace;\n            font-size: 13px;\n            background: #0a0a0a;\n            color: #4CAF50;\n            border: 1px solid #333;\n            border-radius: 4px;\n            padding: 6px 8px;\n        `;\n\n        // On input change\n        this.inputField.addEventListener('input', () => {\n            if (this.callbacks.onInputChange) {\n                this.callbacks.onInputChange(this.cellData.id, this.inputField.value);\n            }\n        });\n\n        // On Enter key, evaluate\n        this.inputField.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                this._evaluate();\n            }\n        });\n\n        // Evaluate button (\u2192)\n        const evalButton = this._createIconButton('\u2192', 'Evaluate (Enter)', () => this._evaluate());\n        evalButton.style.color = '#4CAF50';\n        evalButton.style.fontSize = '18px';\n\n        // Spacer\n        const spacer = document.createElement('div');\n        spacer.style.flex = '0 0 8px';\n\n        // Control buttons\n        const upButton = this._createIconButton('\u2191', 'Move up', () => {\n            if (this.callbacks.onMoveUp) this.callbacks.onMoveUp(this.cellData.id);\n        });\n\n        const downButton = this._createIconButton('\u2193', 'Move down', () => {\n            if (this.callbacks.onMoveDown) this.callbacks.onMoveDown(this.cellData.id);\n        });\n\n        const deleteButton = this._createIconButton('\u2715', 'Delete cell', () => {\n            if (this.callbacks.onDelete) this.callbacks.onDelete(this.cellData.id);\n        });\n        deleteButton.style.color = '#f44336';\n\n        const addButton = this._createIconButton('+', 'Insert cell below', () => {\n            if (this.callbacks.onInsertBelow) this.callbacks.onInsertBelow(this.cellData.id);\n        });\n        addButton.style.color = '#4CAF50';\n\n        // Assemble input row\n        inputRow.appendChild(this.inputField);\n        inputRow.appendChild(evalButton);\n        inputRow.appendChild(spacer);\n        inputRow.appendChild(upButton);\n        inputRow.appendChild(downButton);\n        inputRow.appendChild(deleteButton);\n        inputRow.appendChild(addButton);\n\n        // Output area (right-aligned, no border)\n        this.outputDiv = document.createElement('div');\n        this.outputDiv.className = 'notebook-cell-output';\n        this.outputDiv.style.cssText = `\n            display: none;\n            text-align: right;\n            color: #e0e0e0;\n            font-size: 14px;\n            padding: 0;\n            margin: 2px 0 0 0;\n            line-height: 1;\n            width: 100%;\n            overflow: hidden;\n            box-sizing: border-box;\n        `;\n\n        // Error area\n        this.errorDiv = document.createElement('div');\n        this.errorDiv.className = 'notebook-cell-error';\n        this.errorDiv.style.cssText = `\n            display: none;\n            padding: 6px 8px;\n            background: rgba(244, 67, 54, 0.1);\n            border: 1px solid #f44336;\n            border-radius: 4px;\n            color: #f44336;\n            font-size: 11px;\n        `;\n\n        // Assemble\n        this.element.appendChild(inputRow);\n        this.element.appendChild(this.outputDiv);\n        this.element.appendChild(this.errorDiv);\n\n        // Render initial output if present\n        if (this.cellData.output || this.cellData.error) {\n            this.updateOutput(this.cellData);\n        }\n    }\n\n    /**\n     * Create an icon button\n     * @private\n     */\n    _createIconButton(icon, title, onClick) {\n        const button = document.createElement('button');\n        button.textContent = icon;\n        button.title = title;\n        button.style.cssText = `\n            width: 28px;\n            height: 28px;\n            padding: 0;\n            background: rgba(76, 175, 80, 0.1);\n            border: 1px solid #444;\n            border-radius: 4px;\n            color: #4CAF50;\n            font-size: 14px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            flex-shrink: 0;\n            transition: all 0.15s;\n        `;\n\n        button.addEventListener('click', onClick);\n\n        button.addEventListener('mouseenter', () => {\n            button.style.background = 'rgba(76, 175, 80, 0.2)';\n            button.style.borderColor = '#4CAF50';\n        });\n\n        button.addEventListener('mouseleave', () => {\n            button.style.background = 'rgba(76, 175, 80, 0.1)';\n            button.style.borderColor = '#444';\n        });\n\n        return button;\n    }\n\n    /**\n     * Evaluate the cell\n     * @private\n     */\n    _evaluate() {\n        if (this.callbacks.onEvaluate) {\n            this.callbacks.onEvaluate(this.cellData.id);\n        }\n    }\n\n    /**\n     * Update cell output after evaluation\n     */\n    async updateOutput(result) {\n        // Update internal data\n        this.cellData.output = result.output;\n        this.cellData.tex = result.tex;\n        this.cellData.error = result.error;\n\n        // Clear previous output/error\n        this.outputDiv.style.display = 'none';\n        this.errorDiv.style.display = 'none';\n\n        if (result.error) {\n            // Show error\n            this.errorDiv.textContent = result.error;\n            this.errorDiv.style.display = 'block';\n        } else if (result.tex || result.output) {\n            // Show output\n            this.outputDiv.style.display = 'block';\n\n            if (result.tex) {\n                // Render with MathJax if TeX available, with auto-scaling\n                try {\n                    // Use the full notebook-cell width\n                    const cellWidth = this.element.clientWidth;\n                    logger.info(`Cell width: ${cellWidth}px, using for TeX scaling`);\n                    await renderTeXScaled(this.outputDiv, result.tex, cellWidth);\n                } catch (error) {\n                    logger.warn('Failed to render TeX, falling back to plain text:', error);\n                    this.outputDiv.textContent = result.output || result.tex;\n                }\n            } else {\n                // Plain text output\n                this.outputDiv.textContent = result.output;\n            }\n        }\n    }\n\n    getElement() {\n        return this.element;\n    }\n\n    getInput() {\n        return this.inputField.value;\n    }\n\n    setInput(value) {\n        this.inputField.value = value;\n    }\n\n    getId() {\n        return this.cellData.id;\n    }\n\n    focus() {\n        if (this.inputField) {\n            this.inputField.focus();\n        }\n    }\n\n    destroy() {\n        if (this.element && this.element.parentNode) {\n            this.element.parentNode.removeChild(this.element);\n        }\n        this.element = null;\n        this.inputField = null;\n        this.outputDiv = null;\n        this.errorDiv = null;\n    }\n}\n", "/**\n * CAS (Computer Algebra System) Engine Interface\n *\n * Abstract base class defining the interface that all CAS engines must implement.\n * Supports notebook context management and symbolic computation operations.\n */\n\n/**\n * Abstract base class for CAS engines\n * All engines (Nerdamer, Maxima, etc.) must implement this interface\n */\nexport class CASEngine {\n    constructor() {\n        this._ready = false;\n    }\n\n    // ===== Lifecycle =====\n\n    /**\n     * Initialize the CAS engine (async - may load WASM, scripts, etc.)\n     * @returns {Promise<void>}\n     */\n    async initialize() {\n        throw new Error('initialize() must be implemented by subclass');\n    }\n\n    /**\n     * Check if engine is ready for use\n     * @returns {boolean}\n     */\n    isReady() {\n        return this._ready;\n    }\n\n    // ===== Core Symbolic Operations =====\n\n    /**\n     * Parse an expression string into engine's internal representation\n     * @param {string} expr - Expression to parse\n     * @returns {any} - Engine-specific representation\n     */\n    parse(expr) {\n        throw new Error('parse() must be implemented by subclass');\n    }\n\n    /**\n     * Evaluate an expression and return result\n     * @param {string} expression - Expression to evaluate\n     * @returns {{result: string, tex: string, error?: string}} - Result with TeX representation\n     */\n    evaluate(expression) {\n        throw new Error('evaluate() must be implemented by subclass');\n    }\n\n    /**\n     * Compute symbolic derivative\n     * @param {string} expr - Expression to differentiate\n     * @param {string} variable - Variable to differentiate with respect to\n     * @returns {string} - Symbolic derivative as string\n     */\n    differentiate(expr, variable) {\n        throw new Error('differentiate() must be implemented by subclass');\n    }\n\n    /**\n     * Simplify an expression\n     * @param {string} expr - Expression to simplify\n     * @returns {string} - Simplified expression\n     */\n    simplify(expr) {\n        throw new Error('simplify() must be implemented by subclass');\n    }\n\n    /**\n     * Solve equation for variable\n     * @param {string} equation - Equation to solve (e.g., \"x^2 - 4\")\n     * @param {string} variable - Variable to solve for\n     * @returns {string|string[]|null} - Solution(s) or null if failed\n     */\n    solve(equation, variable) {\n        throw new Error('solve() must be implemented by subclass');\n    }\n\n    // ===== Matrix Operations =====\n\n    /**\n     * Invert a symbolic matrix\n     * @param {string[][]} matrixElements - 2D array of expression strings\n     * @returns {string[][]|null} - Inverted matrix or null if failed\n     */\n    invertMatrix(matrixElements) {\n        throw new Error('invertMatrix() must be implemented by subclass');\n    }\n\n    /**\n     * Get element from symbolic matrix\n     * @param {any} matrix - Engine-specific matrix representation\n     * @param {number} i - Row index (0-based)\n     * @param {number} j - Column index (0-based)\n     * @returns {string} - Matrix element as expression string\n     */\n    matrixElement(matrix, i, j) {\n        throw new Error('matrixElement() must be implemented by subclass');\n    }\n\n    /**\n     * Set a variable in the engine's scope\n     * @param {string} name - Variable name\n     * @param {string} value - Variable value (expression string)\n     */\n    setVariable(name, value) {\n        throw new Error('setVariable() must be implemented by subclass');\n    }\n\n    // ===== Code Generation =====\n\n    /**\n     * Convert symbolic result to GLSL code\n     * @param {string} expr - Expression string\n     * @returns {string} - GLSL code\n     */\n    toGLSL(expr) {\n        throw new Error('toGLSL() must be implemented by subclass');\n    }\n\n    /**\n     * Convert symbolic result to LaTeX for MathJax rendering\n     * @param {string} expr - Expression string\n     * @returns {string} - LaTeX code\n     */\n    toTeX(expr) {\n        throw new Error('toTeX() must be implemented by subclass');\n    }\n\n    // ===== Utility Methods =====\n\n    /**\n     * Clear engine's internal computational cache\n     *\n     * ARCHITECTURAL NOTE:\n     * - This clears ONLY temporary computational state (expression simplification cache, etc.)\n     * - After calling this, the Notebook will need to re-apply its context via ensureContext()\n     * - The Notebook class manages this automatically - you rarely need to call this directly\n     *\n     * Use cases:\n     * - Explicit user-triggered cache clearing (future feature)\n     * - Edge cases where cache clearing might be beneficial\n     * - Testing and debugging\n     */\n    clearCache() {\n        throw new Error('clearCache() must be implemented by subclass');\n    }\n\n    /**\n     * Convert engine result to string\n     * @param {any} result - Engine-specific result object\n     * @returns {string} - String representation\n     */\n    toString(result) {\n        throw new Error('toString() must be implemented by subclass');\n    }\n\n    // ===== Metadata =====\n\n    /**\n     * Get engine name\n     * @returns {string} - Engine name (e.g., \"Nerdamer\", \"Maxima\")\n     */\n    getName() {\n        throw new Error('getName() must be implemented by subclass');\n    }\n\n    /**\n     * Get engine capabilities\n     * @returns {{\n     *   differentiate: boolean,\n     *   integrate: boolean,\n     *   solve: boolean,\n     *   matrices: boolean,\n     *   simplify: boolean,\n     *   persistentNotebookContext: boolean\n     * }}\n     *\n     * persistentNotebookContext: If true, engine can keep notebook definitions separate\n     * from computational cache. If false, notebook must be re-evaluated on cache clear.\n     */\n    getCapabilities() {\n        throw new Error('getCapabilities() must be implemented by subclass');\n    }\n\n    /**\n     * Get engine version info\n     * @returns {string} - Version string\n     */\n    getVersion() {\n        return 'unknown';\n    }\n}\n", "/**\n * Nerdamer CAS Engine Implementation\n *\n * Wraps the Nerdamer symbolic math library to implement the CASEngine interface.\n * Nerdamer is loaded globally via CDN in index.html.\n */\n\nimport { CASEngine } from './cas-interface.js';\nimport { logger } from '../../utils/debug-logger.js';\n\n/**\n * Optimize power expressions: replace pow(x, n) with x*x*... for small integers\n * Also cleans up other common patterns\n *\n * @param {string} expr - Expression to optimize\n * @returns {string} - Optimized expression\n */\nfunction optimizePowerExpressions(expr) {\n    // Replace var^integer with repeated multiplication\n    expr = expr.replace(/([a-z]+)\\^(\\d+)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        return Array(n).fill(base).join('*');\n    });\n\n    // Nerdamer uses ^ for exponentiation, but also handle pow() format\n    expr = expr.replace(/pow\\(([a-z]+),\\s*(\\d+)\\)/g, (match, base, exp) => {\n        const n = parseInt(exp);\n        if (n === 0) return '1';\n        if (n === 1) return base;\n        if (n <= 4) {\n            return Array(n).fill(base).join('*');\n        }\n        return match;\n    });\n\n    return expr;\n}\n\n/**\n * Nerdamer CAS Engine\n */\nexport class NerdamerEngine extends CASEngine {\n    constructor() {\n        super();\n    }\n\n    // ===== Lifecycle =====\n\n    async initialize() {\n        // Check if Nerdamer is loaded (should be loaded via CDN in index.html)\n        if (!window.nerdamer) {\n            throw new Error('Nerdamer not loaded - ensure nerdamer CDN script is included in index.html');\n        }\n\n        if (typeof window.nerdamer !== 'function') {\n            throw new Error('Nerdamer is not a function - invalid state');\n        }\n\n        if (!window.nerdamer.diff) {\n            throw new Error('Nerdamer.diff not available - incomplete initialization');\n        }\n\n        this._ready = true;\n        logger.info('NerdamerEngine initialized successfully');\n    }\n\n    // ===== Core Symbolic Operations =====\n\n    parse(expr) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n        return window.nerdamer(expr);\n    }\n\n    evaluate(expression) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        try {\n            const result = window.nerdamer(expression);\n            const resultStr = result.toString();\n\n            // Use Nerdamer's built-in LaTeX converter\n            let tex = window.nerdamer.convertToLaTeX(resultStr);\n\n            // Clean up Nerdamer's quirks\n            tex = this._cleanupTeX(tex);\n\n            return {\n                result: resultStr,\n                tex: tex\n            };\n        } catch (error) {\n            return {\n                result: '',\n                tex: '',\n                error: error.message\n            };\n        }\n    }\n\n    differentiate(expr, variable) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        try {\n            // Parse expression fresh each time to avoid cache issues\n            const parsed = window.nerdamer(expr);\n            const derivative = window.nerdamer.diff(parsed, variable);\n            const derivativeStr = derivative.toString();\n\n            // DON'T call simplify() - Nerdamer often makes things worse\n            // Just optimize power expressions and use the raw derivative\n            return optimizePowerExpressions(derivativeStr);\n        } catch (error) {\n            logger.warn(`Failed to differentiate \"${expr}\" w.r.t. ${variable}:`, error.message);\n            return '0'; // Default to zero if differentiation fails\n        }\n    }\n\n    simplify(expr) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        try {\n            // NOTE: Nerdamer's simplify() is problematic and often makes things worse\n            // We avoid using it in most cases, but provide the method for completeness\n            const result = window.nerdamer(`simplify(${expr})`);\n            return result.toString();\n        } catch (error) {\n            logger.warn(`Failed to simplify \"${expr}\":`, error.message);\n            return expr; // Return original if simplification fails\n        }\n    }\n\n    solve(equation, variable) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        try {\n            const solutions = window.nerdamer.solve(equation, variable);\n            return solutions ? solutions.toString() : null;\n        } catch (error) {\n            logger.warn(`Failed to solve \"${equation}\" for ${variable}:`, error.message);\n            return null;\n        }\n    }\n\n    // ===== Matrix Operations =====\n\n    invertMatrix(matrixElements) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        const n = matrixElements.length;\n        if (n < 2 || n > 4) {\n            logger.error(`Matrix inversion only supported for 2x2, 3x3, and 4x4 matrices (got ${n}x${n})`);\n            return null;\n        }\n\n        try {\n            // Use Nerdamer's matrix inversion\n            // matrix() takes rows as separate arguments: matrix([a,b],[c,d])\n            const matrixArgs = matrixElements.map(row => `[${row.join(',')}]`).join(',');\n            logger.verbose('Inverting matrix:', `matrix(${matrixArgs})`);\n\n            // Invert the matrix using Nerdamer's invert function\n            window.nerdamer.setVar('J_temp', `matrix(${matrixArgs})`);\n            window.nerdamer.setVar('J_inv', 'invert(J_temp)');\n\n            // Extract result as array using matget() for each element\n            const result = [];\n            for (let i = 0; i < n; i++) {\n                const row = [];\n                for (let j = 0; j < n; j++) {\n                    const element = window.nerdamer(`matget(J_inv, ${i}, ${j})`).toString();\n                    const optimized = optimizePowerExpressions(element);\n                    row.push(optimized);\n                }\n                result.push(row);\n            }\n\n            logger.verbose('Inverted matrix successfully');\n            return result;\n\n        } catch (error) {\n            logger.error('Failed to invert matrix:', error.message);\n            return null;\n        }\n    }\n\n    matrixElement(matrix, i, j) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        try {\n            // Assuming matrix is a Nerdamer matrix variable name\n            const element = window.nerdamer(`matget(${matrix}, ${i}, ${j})`);\n            return element.toString();\n        } catch (error) {\n            logger.error(`Failed to get matrix element [${i},${j}]:`, error.message);\n            return '0';\n        }\n    }\n\n    setVariable(name, value) {\n        if (!this._ready) {\n            throw new Error('NerdamerEngine not initialized');\n        }\n\n        window.nerdamer.setVar(name, value);\n    }\n\n    // ===== Code Generation =====\n\n    toGLSL(expr) {\n        // Nerdamer expressions are already close to GLSL syntax\n        // Just need to handle a few conversions\n        let glsl = expr;\n\n        // Convert ^ to pow() for GLSL\n        glsl = glsl.replace(/([a-zA-Z0-9_]+)\\^([a-zA-Z0-9_]+)/g, 'pow($1, $2)');\n\n        // Nerdamer uses log() for natural log, GLSL uses log()\n        // Nerdamer uses ln() for natural log in some cases\n        glsl = glsl.replace(/\\bln\\(/g, 'log(');\n\n        return glsl;\n    }\n\n    toTeX(expr) {\n        // Use Nerdamer's built-in LaTeX converter\n        let tex = window.nerdamer.convertToLaTeX(expr);\n        return this._cleanupTeX(tex);\n    }\n\n    /**\n     * Clean up quirks in Nerdamer's LaTeX output\n     * @private\n     */\n    _cleanupTeX(tex) {\n        // Remove unnecessary ^{1} exponents\n        tex = tex.replace(/\\^\\{1\\}/g, '');\n        return tex;\n    }\n\n    /**\n     * Basic conversion of math expressions to TeX\n     * @private\n     */\n    _basicTexConversion(expr) {\n        let tex = expr;\n\n        // Convert ^ to superscript\n        tex = tex.replace(/([a-zA-Z0-9_]+)\\^([0-9]+)/g, '$1^{$2}');\n        tex = tex.replace(/([a-zA-Z0-9_]+)\\^([a-zA-Z]+)/g, '$1^{$2}');\n\n        // Convert * to \\cdot (optional, for better appearance)\n        // tex = tex.replace(/\\*/g, '\\\\cdot ');\n\n        // Convert sqrt to \\sqrt\n        tex = tex.replace(/sqrt\\(([^)]+)\\)/g, '\\\\sqrt{$1}');\n\n        // Convert fractions (simple case: a/b where a,b are single tokens)\n        tex = tex.replace(/([a-zA-Z0-9_]+)\\/([a-zA-Z0-9_]+)/g, '\\\\frac{$1}{$2}');\n\n        return tex;\n    }\n\n    // ===== Utility Methods =====\n\n    clearCache() {\n        if (!this._ready) return;\n\n        // NOTE: Clearing nerdamer cache will clear ALL definitions (including notebook)\n        // The Notebook class will handle re-applying its context via ensureContext()\n        // after any cache clear operation\n        if (window.nerdamer && window.nerdamer.clear) {\n            logger.verbose('Clearing Nerdamer cache (all definitions cleared)');\n            window.nerdamer.clear('all');\n        }\n    }\n\n    toString(result) {\n        if (typeof result === 'string') {\n            return result;\n        }\n        if (result && typeof result.toString === 'function') {\n            return result.toString();\n        }\n        return String(result);\n    }\n\n    // ===== Metadata =====\n\n    getName() {\n        return 'Nerdamer';\n    }\n\n    getCapabilities() {\n        return {\n            differentiate: true,\n            integrate: false, // Nerdamer has integration but we're not using it\n            solve: true,\n            matrices: true,\n            simplify: true, // Available but problematic\n            persistentNotebookContext: false // Nerdamer.clear('all') clears everything, must re-apply notebook\n        };\n    }\n\n    getVersion() {\n        // Nerdamer doesn't expose version easily, but we can check\n        return window.nerdamer ? 'loaded' : 'not loaded';\n    }\n}\n", "/**\n * CAS Engine Factory\n *\n * Creates and initializes CAS engines based on configuration.\n * Supports multiple engines (Nerdamer, Maxima, etc.)\n */\n\nimport { NerdamerEngine } from './nerdamer-engine.js';\nimport { logger } from '../../utils/debug-logger.js';\n\n/**\n * Available CAS engine types\n */\nexport const CASEngineType = {\n    NERDAMER: 'nerdamer',\n    MAXIMA: 'maxima' // Will be implemented in Phase 10-11\n};\n\n/**\n * Create and initialize a CAS engine\n *\n * @param {string} type - Engine type (from CASEngineType)\n * @returns {Promise<CASEngine>} - Initialized CAS engine\n * @throws {Error} - If engine type is unknown or initialization fails\n */\nexport async function createCASEngine(type = CASEngineType.NERDAMER) {\n    logger.info(`Creating CAS engine: ${type}`);\n\n    let engine;\n\n    switch (type) {\n        case CASEngineType.NERDAMER:\n            engine = new NerdamerEngine();\n            break;\n\n        case CASEngineType.MAXIMA:\n            throw new Error('Maxima engine not yet implemented (Phase 10-11)');\n            // Future: engine = new MaximaEngine();\n            // break;\n\n        default:\n            throw new Error(`Unknown CAS engine type: ${type}`);\n    }\n\n    // Initialize the engine\n    try {\n        await engine.initialize();\n        logger.info(`CAS engine ${type} initialized successfully`);\n        return engine;\n    } catch (error) {\n        logger.error(`Failed to initialize CAS engine ${type}:`, error.message);\n        throw error;\n    }\n}\n\n/**\n * Get the currently selected CAS engine type from settings\n *\n * @returns {string} - Engine type from CASEngineType\n */\nexport function getSelectedEngineType() {\n    // Check localStorage for saved preference\n    const stored = localStorage.getItem('casEngine');\n    if (stored && Object.values(CASEngineType).includes(stored)) {\n        return stored;\n    }\n\n    // Default to Nerdamer\n    return CASEngineType.NERDAMER;\n}\n\n/**\n * Save CAS engine type preference to localStorage\n *\n * @param {string} type - Engine type from CASEngineType\n */\nexport function saveEngineTypePreference(type) {\n    if (!Object.values(CASEngineType).includes(type)) {\n        throw new Error(`Invalid CAS engine type: ${type}`);\n    }\n\n    localStorage.setItem('casEngine', type);\n    logger.info(`Saved CAS engine preference: ${type}`);\n}\n", "/**\n * Notebook - Primary interface for symbolic mathematics\n *\n * The Notebook manages:\n * 1. User-defined cells (code and markdown)\n * 2. Context management (ensuring definitions are available in CAS)\n * 3. Delegation to CAS engine for actual computation\n *\n * ARCHITECTURAL PRINCIPLE:\n * - Notebook is the HIGH-LEVEL interface - main program calls Notebook methods\n * - CAS Engine is the LOW-LEVEL backend - only Notebook calls it directly\n * - This ensures context is always applied before symbolic operations\n */\n\nimport { logger } from '../utils/debug-logger.js';\n\nconst LOCALSTORAGE_KEY = 'de-render-notebook';\n\n/**\n * Generate unique cell ID\n */\nfunction generateCellId() {\n    return `cell-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\n/**\n * Notebook class - manages cells and provides context-aware CAS operations\n */\nexport class Notebook {\n    /**\n     * @param {import('./cas/cas-interface.js').CASEngine} casEngine - CAS engine to use\n     */\n    constructor(casEngine) {\n        this.casEngine = casEngine;\n        this.cells = [];\n        this.contextDirty = false; // True if context needs to be reapplied to CAS\n\n        logger.info('Notebook initialized with CAS engine:', casEngine.getName());\n    }\n\n    // ===== Cell Management =====\n\n    /**\n     * Add a new cell to the notebook\n     * @param {'code'|'markdown'} type - Cell type\n     * @param {string} input - Initial cell content\n     * @returns {string} - Cell ID\n     */\n    addCell(type, input = '') {\n        const id = generateCellId();\n        const cell = {\n            id,\n            type,\n            input,\n            output: null,    // Evaluation result (for code cells)\n            tex: null,       // TeX representation (for code cells)\n            error: null      // Error message if evaluation failed\n        };\n\n        this.cells.push(cell);\n        this.save();\n        logger.info(`Added ${type} cell:`, id);\n\n        return id;\n    }\n\n    /**\n     * Update cell content\n     * @param {string} id - Cell ID\n     * @param {string} input - New cell content\n     */\n    updateCell(id, input) {\n        const cell = this.cells.find(c => c.id === id);\n        if (!cell) {\n            logger.warn(`Cell not found: ${id}`);\n            return;\n        }\n\n        cell.input = input;\n        // Clear output - cell needs re-evaluation\n        cell.output = null;\n        cell.tex = null;\n        cell.error = null;\n\n        this.save();\n        this.markContextDirty(); // Context changed, need to reapply\n    }\n\n    /**\n     * Delete a cell\n     * @param {string} id - Cell ID\n     */\n    deleteCell(id) {\n        const index = this.cells.findIndex(c => c.id === id);\n        if (index === -1) {\n            logger.warn(`Cell not found: ${id}`);\n            return;\n        }\n\n        this.cells.splice(index, 1);\n        this.save();\n        this.markContextDirty();\n        logger.info(`Deleted cell: ${id}`);\n    }\n\n    /**\n     * Move cell up in order\n     * @param {string} id - Cell ID\n     */\n    moveCellUp(id) {\n        const index = this.cells.findIndex(c => c.id === id);\n        if (index <= 0) return; // Already at top or not found\n\n        [this.cells[index - 1], this.cells[index]] = [this.cells[index], this.cells[index - 1]];\n        this.save();\n        this.markContextDirty(); // Order matters for definitions\n    }\n\n    /**\n     * Move cell down in order\n     * @param {string} id - Cell ID\n     */\n    moveCellDown(id) {\n        const index = this.cells.findIndex(c => c.id === id);\n        if (index === -1 || index >= this.cells.length - 1) return; // At bottom or not found\n\n        [this.cells[index], this.cells[index + 1]] = [this.cells[index + 1], this.cells[index]];\n        this.save();\n        this.markContextDirty();\n    }\n\n    // ===== Cell Evaluation =====\n\n    /**\n     * Evaluate a single cell\n     * @param {string} id - Cell ID\n     * @returns {Promise<{result: string, tex: string, error?: string}>}\n     */\n    async evaluateCell(id) {\n        const cell = this.cells.find(c => c.id === id);\n        if (!cell) {\n            logger.warn(`Cell not found: ${id}`);\n            return { result: '', tex: '', error: 'Cell not found' };\n        }\n\n        if (cell.type !== 'code') {\n            return { result: '', tex: '', error: 'Not a code cell' };\n        }\n\n        try {\n            // Ensure all previous cells are evaluated first (for dependencies)\n            await this.evaluateUpTo(id);\n\n            // Evaluate this cell using notebook's evaluate() method\n            // (not casEngine directly - notebook.evaluate handles function definitions)\n            logger.verbose(`Evaluating cell ${id}: \"${cell.input}\"`);\n            const result = this.evaluate(cell.input);  // <-- Changed from casEngine.evaluate to this.evaluate\n\n            // Store result\n            cell.output = result.result;\n            cell.tex = result.tex;\n            cell.error = result.error || null;\n\n            this.save();\n            logger.info(`Cell ${id} evaluated successfully:`, result.result);\n\n            return result;\n        } catch (error) {\n            logger.error(`Error evaluating cell ${id}:`, error.message);\n            cell.error = error.message;\n            cell.output = null;\n            cell.tex = null;\n            this.save();\n\n            return { result: '', tex: '', error: error.message };\n        }\n    }\n\n    /**\n     * Evaluate all cells up to (but not including) the given cell\n     * Ensures dependencies are available\n     * @private\n     */\n    async evaluateUpTo(id) {\n        const targetIndex = this.cells.findIndex(c => c.id === id);\n        if (targetIndex === -1) return;\n\n        for (let i = 0; i < targetIndex; i++) {\n            const cell = this.cells[i];\n            if (cell.type === 'code' && !cell.output && !cell.error) {\n                // Cell not yet evaluated\n                await this.evaluateCell(cell.id);\n            }\n        }\n    }\n\n    /**\n     * Evaluate all code cells in sequence\n     */\n    async evaluateAll() {\n        logger.info('Evaluating all notebook cells');\n\n        for (const cell of this.cells) {\n            if (cell.type === 'code') {\n                await this.evaluateCell(cell.id);\n            }\n        }\n\n        logger.info('All cells evaluated');\n    }\n\n    // ===== Context Management =====\n\n    /**\n     * Mark context as dirty (needs reapply before next operation)\n     * Called when cells are modified or CAS cache is cleared\n     */\n    markContextDirty() {\n        this.contextDirty = true;\n    }\n\n    /**\n     * Ensure notebook context is applied to CAS engine\n     * Re-evaluates all successfully evaluated cells if context is dirty\n     */\n    ensureContext() {\n        if (!this.contextDirty) {\n            return; // Context already applied\n        }\n\n        logger.verbose('Re-applying notebook context to CAS engine');\n\n        // Temporarily disable context dirty flag to avoid infinite recursion\n        const wasDirty = this.contextDirty;\n        this.contextDirty = false;\n\n        // Re-evaluate all cells that previously succeeded\n        for (const cell of this.cells) {\n            if (cell.type === 'code' && cell.output && !cell.error) {\n                try {\n                    // Use notebook.evaluate() to handle function definitions properly\n                    this.evaluate(cell.input);\n                } catch (error) {\n                    logger.warn(`Failed to re-apply cell ${cell.id}:`, error.message);\n                }\n            }\n        }\n\n        logger.verbose('Notebook context applied');\n    }\n\n    // ===== Function Expansion for GLSL =====\n\n    /**\n     * Expand notebook function calls in an expression using nerdamer evaluation\n     * This prepares expressions for GLSL compilation by expanding user-defined functions\n     *\n     * Example: \"sqr(x) + y\" with sqr(x)=x*x defined becomes \"(x)*(x) + y\"\n     *\n     * @param {string} expr - Expression to expand\n     * @returns {string} - Expression with function calls expanded\n     */\n    expandFunctions(expr) {\n        this.ensureContext();\n\n        try {\n            // Check if there are any custom functions defined in the notebook\n            const definedFunctions = [];\n            for (const cell of this.cells) {\n                if (cell.type === 'code' && cell.output && !cell.error) {\n                    const match = cell.input.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(([^)]*)\\)\\s*=\\s*(.+)$/);\n                    if (match) {\n                        const [, funcName] = match;\n                        definedFunctions.push(funcName);\n                    }\n                }\n            }\n\n            // Only use Nerdamer expansion if there are custom functions that appear in the expression\n            let needsExpansion = false;\n            for (const funcName of definedFunctions) {\n                const funcRegex = new RegExp(`\\\\b${funcName}\\\\s*\\\\(`);\n                if (funcRegex.test(expr)) {\n                    needsExpansion = true;\n                    break;\n                }\n            }\n\n            if (!needsExpansion) {\n                // No custom functions to expand - return original expression unchanged\n                logger.verbose(`No custom functions in \"${expr}\", skipping expansion`);\n                return expr;\n            }\n\n            // Let nerdamer expand the expression (it knows about our setFunction definitions)\n            const result = this.casEngine.evaluate(expr);\n\n            if (result.result && result.result !== expr) {\n                // Find which functions were actually used\n                const usedFunctions = definedFunctions.filter(funcName => {\n                    const funcRegex = new RegExp(`\\\\b${funcName}\\\\s*\\\\(`);\n                    return funcRegex.test(expr);\n                });\n\n                if (usedFunctions.length > 0) {\n                    logger.verbose(`Expanded with: ${usedFunctions.join(', ')}`);\n                }\n                logger.verbose(`  \"${expr}\" -> \"${result.result}\"`);\n                return result.result;\n            }\n\n            return expr;\n        } catch (error) {\n            logger.warn(`Failed to expand functions in \"${expr}\":`, error.message);\n            return expr; // Return original if expansion fails\n        }\n    }\n\n    // ===== CAS Operations (Primary Interface) =====\n    // All symbolic operations go through these methods to ensure context\n\n    /**\n     * Differentiate expression (with notebook context)\n     * @param {string} expr - Expression to differentiate\n     * @param {string} variable - Variable to differentiate with respect to\n     * @returns {string} - Derivative\n     */\n    differentiate(expr, variable) {\n        this.ensureContext();\n        return this.casEngine.differentiate(expr, variable);\n    }\n\n    /**\n     * Solve equation (with notebook context)\n     * @param {string} equation - Equation to solve\n     * @param {string} variable - Variable to solve for\n     * @returns {string|string[]|null} - Solution(s)\n     */\n    solve(equation, variable) {\n        this.ensureContext();\n        return this.casEngine.solve(equation, variable);\n    }\n\n    /**\n     * Invert matrix (with notebook context)\n     * @param {string[][]} matrix - Matrix elements\n     * @returns {string[][]|null} - Inverted matrix\n     */\n    invertMatrix(matrix) {\n        this.ensureContext();\n        return this.casEngine.invertMatrix(matrix);\n    }\n\n    /**\n     * Evaluate expression (with notebook context)\n     * Note: This adds to the context (side effect)\n     * Handles function definitions in the form: f(x, y) = expression\n     * @param {string} expr - Expression to evaluate\n     * @returns {{result: string, tex: string, error?: string}}\n     */\n    evaluate(expr) {\n        this.ensureContext();\n\n        logger.verbose(`Notebook.evaluate() called with: \"${expr}\"`);\n\n        // Check if this is a function definition: f(x, y, ...) = expression\n        const functionDefMatch = expr.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\\s*\\(([^)]*)\\)\\s*=\\s*(.+)$/);\n\n        logger.verbose(`Function definition regex match:`, functionDefMatch ? 'YES' : 'NO');\n\n        if (functionDefMatch) {\n            const [, funcName, argsStr, body] = functionDefMatch;\n            const args = argsStr.split(',').map(arg => arg.trim()).filter(arg => arg);\n\n            logger.verbose(`Parsed function: name=\"${funcName}\", args=[${args.join(', ')}], body=\"${body}\"`);\n\n            // Use nerdamer.setFunction to define the function\n            if (this.casEngine.getName() === 'Nerdamer' && window.nerdamer && window.nerdamer.setFunction) {\n                try {\n                    // nerdamer.setFunction(name, argArray, body)\n                    logger.verbose(`Calling nerdamer.setFunction(\"${funcName}\", [${args.join(', ')}], \"${body}\")`);\n                    window.nerdamer.setFunction(funcName, args, body);\n\n                    logger.info(`Defined function: ${funcName}(${args.join(', ')}) = ${body}`);\n\n                    const signature = `${funcName}(${args.join(', ')})`;\n                    const result = {\n                        result: `${signature} = ${body}`,\n                        tex: `${signature} = ${body}`\n                    };\n                    logger.verbose(`Returning result:`, result);\n                    return result;\n                } catch (error) {\n                    logger.error(`Error defining function: ${error.message}`);\n                    return {\n                        result: '',\n                        tex: '',\n                        error: `Failed to define function ${funcName}: ${error.message}`\n                    };\n                }\n            } else {\n                // Fallback for engines without setFunction\n                logger.warn('CAS engine does not support setFunction, function definition ignored');\n                const signature = `${funcName}(${args.join(', ')})`;\n                return {\n                    result: `${signature} = ${body} (not supported by engine)`,\n                    tex: `${signature} = ${body}`,\n                    error: 'Function definitions not supported by current CAS engine'\n                };\n            }\n        }\n\n        // Not a function definition, evaluate normally\n        logger.verbose('Not a function definition, evaluating normally');\n        return this.casEngine.evaluate(expr);\n    }\n\n    /**\n     * Parse expression (with notebook context)\n     * @param {string} expr - Expression to parse\n     * @returns {any} - Parsed expression (engine-specific)\n     */\n    parse(expr) {\n        this.ensureContext();\n        return this.casEngine.parse(expr);\n    }\n\n    // ===== Persistence =====\n\n    /**\n     * Save notebook to localStorage\n     */\n    save() {\n        try {\n            const data = this.toJSON();\n            localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(data));\n            logger.verbose('Notebook saved to localStorage');\n        } catch (error) {\n            logger.error('Failed to save notebook:', error.message);\n        }\n    }\n\n    /**\n     * Load notebook from localStorage\n     */\n    load() {\n        try {\n            const stored = localStorage.getItem(LOCALSTORAGE_KEY);\n            if (!stored) {\n                logger.info('No saved notebook found');\n                return;\n            }\n\n            const data = JSON.parse(stored);\n            this.fromJSON(data);\n            logger.info(`Loaded notebook with ${this.cells.length} cells`);\n\n            // Re-evaluate all cells to restore context\n            this.evaluateAll();\n        } catch (error) {\n            logger.error('Failed to load notebook:', error.message);\n        }\n    }\n\n    /**\n     * Serialize notebook to JSON\n     * @returns {object}\n     */\n    toJSON() {\n        return {\n            version: 1,\n            cells: this.cells.map(cell => ({\n                id: cell.id,\n                type: cell.type,\n                input: cell.input,\n                output: cell.output,\n                tex: cell.tex,\n                error: cell.error\n            }))\n        };\n    }\n\n    /**\n     * Deserialize notebook from JSON\n     * @param {object} data\n     */\n    fromJSON(data) {\n        if (data.version !== 1) {\n            throw new Error(`Unsupported notebook version: ${data.version}`);\n        }\n\n        this.cells = data.cells || [];\n        this.markContextDirty(); // Need to reapply context\n    }\n\n    /**\n     * Export notebook as JSON file (download)\n     * @param {string} filename - Filename for download\n     */\n    exportJSON(filename = 'notebook.json') {\n        const data = this.toJSON();\n        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n        const url = URL.createObjectURL(blob);\n\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = filename;\n        a.click();\n\n        URL.revokeObjectURL(url);\n        logger.info(`Exported notebook to ${filename}`);\n    }\n\n    /**\n     * Import notebook from JSON file\n     * @param {File} file - File object from file input\n     * @returns {Promise<void>}\n     */\n    async importJSON(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n\n            reader.onload = async (e) => {\n                try {\n                    const data = JSON.parse(e.target.result);\n                    this.fromJSON(data);\n                    this.save();\n                    await this.evaluateAll();\n                    logger.info('Imported notebook successfully');\n                    resolve();\n                } catch (error) {\n                    logger.error('Failed to import notebook:', error.message);\n                    reject(error);\n                }\n            };\n\n            reader.onerror = () => reject(new Error('Failed to read file'));\n            reader.readAsText(file);\n        });\n    }\n\n    /**\n     * Clear all cells\n     */\n    clear() {\n        this.cells = [];\n        this.save();\n        this.markContextDirty();\n        logger.info('Notebook cleared');\n    }\n}\n", "/**\n * MathToGLSLControl - Reusable control for converting math expressions to GLSL\n *\n * Displays two text areas side by side:\n * - Left: Math expression input (uses notebook context)\n * - Right: Generated GLSL code (editable)\n * - Middle: Generate button\n *\n * Default behavior: wraps expression in a GLSL function\n * Custom behavior: pass onGenerate hook for advanced logic\n */\n\nimport { logger } from '../../utils/debug-logger.js';\n\nexport class MathToGLSLControl {\n    /**\n     * @param {Object} config - Configuration\n     * @param {IGLSLGenerator} config.generator - GLSL generator instance (REQUIRED if no custom onGenerate)\n     * @param {Function} config.onGenerate - Custom generator: (mathExpr, notebook, context) => glslCode\n     * @param {Object} config.context - Additional context passed to generator\n     * @param {string} config.mathPlaceholder - Placeholder for math input\n     * @param {string} config.glslPlaceholder - Placeholder for GLSL output\n     * @param {string} config.initialMath - Initial math expression\n     * @param {string} config.initialGLSL - Initial GLSL code\n     * @param {boolean} config.readonly - Make both fields readonly\n     */\n    constructor(config = {}) {\n        this.config = {\n            generator: config.generator || null,\n            onGenerate: config.onGenerate || null,\n            context: config.context || {},\n            mathPlaceholder: config.mathPlaceholder || (config.generator ? config.generator.getMathPlaceholder() : 'Enter math expression...'),\n            glslPlaceholder: config.glslPlaceholder || (config.generator ? config.generator.getGLSLPlaceholder() : 'Generated GLSL code...'),\n            initialMath: config.initialMath || '',\n            initialGLSL: config.initialGLSL || '',\n            readonly: config.readonly || false\n        };\n\n        // Validate: must have either generator or onGenerate\n        if (!this.config.generator && !this.config.onGenerate) {\n            throw new Error('MathToGLSLControl requires either generator or onGenerate');\n        }\n\n        this.element = null;\n        this.mathInput = null;\n        this.glslOutput = null;\n        this.generateButton = null;\n        this.errorDiv = null;\n\n        this._createUI();\n    }\n\n    /**\n     * Create the UI elements\n     * @private\n     */\n    _createUI() {\n        this.element = document.createElement('div');\n        this.element.className = 'math-to-glsl-control';\n        this.element.style.cssText = `\n            display: grid;\n            grid-template-columns: 1fr auto 1fr;\n            gap: 12px;\n            align-items: start;\n            margin: 12px 0;\n        `;\n\n        // Math input (left)\n        const mathContainer = document.createElement('div');\n        mathContainer.style.cssText = 'display: flex; flex-direction: column; gap: 4px;';\n\n        const mathLabel = document.createElement('label');\n        mathLabel.textContent = 'Math Expression';\n        mathLabel.style.cssText = 'font-size: 12px; color: #4CAF50; font-weight: bold;';\n\n        this.mathInput = document.createElement('textarea');\n        this.mathInput.placeholder = this.config.mathPlaceholder;\n        this.mathInput.value = this.config.initialMath;\n        this.mathInput.rows = 6;\n        this.mathInput.readOnly = this.config.readonly;\n        this.mathInput.style.cssText = `\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            background: #1a1a1a;\n            color: #4CAF50;\n            border: 1px solid #444;\n            border-radius: 4px;\n            padding: 8px;\n            resize: vertical;\n            width: 100%;\n            box-sizing: border-box;\n        `;\n\n        mathContainer.appendChild(mathLabel);\n        mathContainer.appendChild(this.mathInput);\n\n        // Generate button (middle)\n        const buttonContainer = document.createElement('div');\n        buttonContainer.style.cssText = 'display: flex; align-items: center; padding-top: 20px;';\n\n        this.generateButton = document.createElement('button');\n        this.generateButton.textContent = '\u2192';\n        this.generateButton.title = 'Generate GLSL';\n        this.generateButton.disabled = this.config.readonly;\n        this.generateButton.style.cssText = `\n            padding: 8px 16px;\n            background: #4CAF50;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: ${this.config.readonly ? 'not-allowed' : 'pointer'};\n            font-size: 16px;\n            font-weight: bold;\n            opacity: ${this.config.readonly ? '0.5' : '1'};\n        `;\n\n        if (!this.config.readonly) {\n            this.generateButton.addEventListener('click', () => this.generate());\n        }\n\n        buttonContainer.appendChild(this.generateButton);\n\n        // GLSL output (right)\n        const glslContainer = document.createElement('div');\n        glslContainer.style.cssText = 'display: flex; flex-direction: column; gap: 4px;';\n\n        const glslLabel = document.createElement('label');\n        glslLabel.textContent = 'GLSL Code';\n        glslLabel.style.cssText = 'font-size: 12px; color: #4CAF50; font-weight: bold;';\n\n        this.glslOutput = document.createElement('textarea');\n        this.glslOutput.placeholder = this.config.glslPlaceholder;\n        this.glslOutput.value = this.config.initialGLSL;\n        this.glslOutput.rows = 6;\n        this.glslOutput.readOnly = this.config.readonly;\n        this.glslOutput.style.cssText = `\n            font-family: 'Courier New', monospace;\n            font-size: 12px;\n            background: #1a1a1a;\n            color: #64B5F6;\n            border: 1px solid #444;\n            border-radius: 4px;\n            padding: 8px;\n            resize: vertical;\n            width: 100%;\n            box-sizing: border-box;\n        `;\n\n        glslContainer.appendChild(glslLabel);\n        glslContainer.appendChild(this.glslOutput);\n\n        // Error display\n        this.errorDiv = document.createElement('div');\n        this.errorDiv.style.cssText = `\n            grid-column: 1 / -1;\n            display: none;\n            padding: 8px;\n            background: rgba(244, 67, 54, 0.1);\n            border: 1px solid #f44336;\n            border-radius: 4px;\n            color: #f44336;\n            font-size: 11px;\n        `;\n\n        // Assemble\n        this.element.appendChild(mathContainer);\n        this.element.appendChild(buttonContainer);\n        this.element.appendChild(glslContainer);\n        this.element.appendChild(this.errorDiv);\n    }\n\n    /**\n     * Generate GLSL from math expression\n     */\n    generate() {\n        const mathExpr = this.mathInput.value.trim();\n        this.errorDiv.style.display = 'none';\n\n        // Validate first\n        let validation;\n        if (this.config.generator) {\n            validation = this.config.generator.validate(mathExpr, this.config.context);\n        } else {\n            // Basic validation for custom onGenerate\n            validation = mathExpr ? { valid: true } : { valid: false, error: 'Expression is empty' };\n        }\n\n        if (!validation.valid) {\n            this._showError(validation.error || 'Invalid expression');\n            return;\n        }\n\n        try {\n            let glslCode;\n\n            if (this.config.onGenerate) {\n                // Custom generation logic\n                glslCode = this.config.onGenerate(mathExpr, window.notebook, this.config.context);\n            } else if (this.config.generator) {\n                // Use generator interface\n                glslCode = this.config.generator.generate(mathExpr, window.notebook, this.config.context);\n            }\n\n            this.glslOutput.value = glslCode;\n            logger.info('Generated GLSL from math expression');\n        } catch (error) {\n            this._showError(error.message);\n            logger.error('Failed to generate GLSL:', error);\n        }\n    }\n\n    /**\n     * Show error message\n     * @private\n     */\n    _showError(message) {\n        this.errorDiv.textContent = `Error: ${message}`;\n        this.errorDiv.style.display = 'block';\n    }\n\n    /**\n     * Get the DOM element\n     * @returns {HTMLElement}\n     */\n    getElement() {\n        return this.element;\n    }\n\n    /**\n     * Get current math expression\n     * @returns {string}\n     */\n    getMath() {\n        return this.mathInput.value.trim();\n    }\n\n    /**\n     * Get current GLSL code\n     * @returns {string}\n     */\n    getGLSL() {\n        return this.glslOutput.value.trim();\n    }\n\n    /**\n     * Set math expression\n     * @param {string} math\n     */\n    setMath(math) {\n        this.mathInput.value = math;\n    }\n\n    /**\n     * Set GLSL code\n     * @param {string} glsl\n     */\n    setGLSL(glsl) {\n        this.glslOutput.value = glsl;\n    }\n\n    /**\n     * Get both values\n     * @returns {{math: string, glsl: string}}\n     */\n    getValues() {\n        return {\n            math: this.getMath(),\n            glsl: this.getGLSL()\n        };\n    }\n}\n", "/**\n * Field Equations Editor Modal\n *\n * Modal for editing vector field equations with:\n * - Dimension count selector\n * - N \u00D7 MathToGLSLControl (one per dimension)\n * - Notebook REPL for function definitions\n * - Workflow-based validation and application\n */\n\nimport { NotebookModal } from './notebook-modal.js';\nimport { MathToGLSLControl } from './math-to-glsl-control.js';\nimport { FieldEquationGenerator } from '../../math/field-equation-generator.js';\nimport { FieldEquationWorkflow } from '../../math/field-equation-workflow.js';\nimport { logger } from '../../utils/debug-logger.js';\n\nexport class FieldEquationsEditor {\n    /**\n     * @param {Renderer} renderer - Renderer instance\n     */\n    constructor(renderer) {\n        this.renderer = renderer;\n        this.modal = null;\n        this.controls = [];\n        this.controlsContainer = null;\n        this.dimensionSelector = null;\n\n        // Create generator and workflow\n        this.generator = new FieldEquationGenerator();\n        this.workflow = new FieldEquationWorkflow(this.generator);\n\n        this._createModal();\n    }\n\n    /**\n     * Create the modal\n     * @private\n     */\n    _createModal() {\n        // Create custom content container\n        const customContent = document.createElement('div');\n        customContent.className = 'field-equations-editor-content';\n\n        // Dimension selector\n        const dimensionRow = document.createElement('div');\n        dimensionRow.className = 'field-equations-dimension-row';\n\n        const dimensionLabel = document.createElement('label');\n        dimensionLabel.textContent = 'Number of Dimensions:';\n        dimensionLabel.style.cssText = 'font-size: 14px; color: #4CAF50; font-weight: bold;';\n\n        this.dimensionSelector = document.createElement('select');\n        this.dimensionSelector.className = 'field-equations-dimension-select';\n        for (let i = 2; i <= 6; i++) {\n            const option = document.createElement('option');\n            option.value = i;\n            option.textContent = `${i}D`;\n            this.dimensionSelector.appendChild(option);\n        }\n\n        // Handle dimension changes\n        this.dimensionSelector.addEventListener('change', () => {\n            this._updateControls(parseInt(this.dimensionSelector.value));\n        });\n\n        dimensionRow.appendChild(dimensionLabel);\n        dimensionRow.appendChild(this.dimensionSelector);\n\n        // Controls container\n        this.controlsContainer = document.createElement('div');\n        this.controlsContainer.className = 'field-equations-controls';\n\n        customContent.appendChild(dimensionRow);\n        customContent.appendChild(this.controlsContainer);\n\n        // Create modal with workflow-based onApply\n        this.modal = new NotebookModal({\n            title: 'Field Equations Editor',\n            customContent: customContent,\n            applyButtonText: 'Apply to Renderer',\n            onApply: async (notebook, customFields) => {\n                // Use workflow to validate, generate, and apply\n                const result = await this.workflow.executeInteractive(\n                    this.controls,\n                    notebook,\n                    this.renderer,\n                    this.modal\n                );\n\n                // If successful, sync simple UI controls with the original expressions from this editor\n                if (result.success) {\n                    // Sync dimensions\n                    const dimensionsElement = document.getElementById('dimensions');\n                    if (dimensionsElement && dimensionsElement.setValue) {\n                        dimensionsElement.setValue(this.controls.length);\n                    }\n\n                    // Sync expression inputs with ORIGINAL expressions (not expanded)\n                    const expressionsControl = window.manager?.get('dimension-inputs');\n                    if (expressionsControl && result.expressions) {\n                        expressionsControl.setValue(result.expressions);\n                    }\n\n                    // Sync equation overlay if visible\n                    if (window.equationOverlay && window.equationOverlay.isVisible && window.equationOverlay.isVisible()) {\n                        const variables = this.renderer.coordinateSystem.getVariableNames();\n                        // Use renderer.expressions (already expanded) for overlay\n                        window.equationOverlay.updateEquations(this.renderer.expressions, variables);\n                    }\n                }\n\n                // Workflow handles modal close and error display\n                return result;\n            }\n        });\n\n        // Initialize with default 2D (will be updated when modal is shown)\n        this._updateControls(2);\n    }\n\n    /**\n     * Update controls for new dimension count\n     * @private\n     * @param {number} dimensions - Number of dimensions\n     * @param {string[]} expressions - Optional expressions to use (if not provided, reads from renderer)\n     */\n    _updateControls(dimensions, expressions = null) {\n        // Clear existing controls\n        this.controlsContainer.innerHTML = '';\n        this.controls = [];\n\n        // Get current expressions from renderer (only if not provided)\n        const currentExpressions = expressions || this.renderer.expressions || [];\n\n        // Create controls for each dimension\n        const varNames = ['x', 'y', 'z', 'w', 'u', 'v'];\n        for (let i = 0; i < dimensions; i++) {\n            const varName = varNames[i] || `x${i}`;\n            const initialMath = currentExpressions[i] || '';\n\n            // Create control\n            const control = new MathToGLSLControl({\n                generator: this.generator,\n                context: {\n                    dimension: i,\n                    totalDims: dimensions\n                },\n                mathPlaceholder: `d${varName}/dt = ...`,\n                glslPlaceholder: 'Generated GLSL...',\n                initialMath: initialMath,\n                initialGLSL: ''\n            });\n\n            // Create dimension label\n            const dimensionLabel = document.createElement('div');\n            dimensionLabel.className = 'field-equation-label';\n            dimensionLabel.textContent = `Dimension ${i}: d${varName}/dt`;\n\n            // Add to container\n            this.controlsContainer.appendChild(dimensionLabel);\n            this.controlsContainer.appendChild(control.getElement());\n\n            this.controls.push(control);\n        }\n\n        logger.info(`Created ${dimensions} field equation controls`);\n    }\n\n    /**\n     * Show the editor modal\n     */\n    show() {\n        // Get current dimensions\n        const currentDims = this.renderer.dimensions || 2;\n        this.dimensionSelector.value = currentDims;\n\n        // Get expressions from simple UI (not renderer, which has expanded form)\n        // The simple UI is the source of truth for user's original expressions\n        let currentExpressions = null;\n        if (window.manager) {\n            const expressionsControl = window.manager.get('dimension-inputs');\n            if (expressionsControl) {\n                currentExpressions = expressionsControl.getValue();\n            }\n        }\n\n        // If we couldn't get from simple UI, fall back to renderer (expanded form)\n        if (!currentExpressions) {\n            currentExpressions = this.renderer.expressions;\n        }\n\n        this._updateControls(currentDims, currentExpressions);\n\n        this.modal.show();\n    }\n\n    /**\n     * Hide the editor modal\n     */\n    hide() {\n        this.modal.hide();\n    }\n\n    /**\n     * Check if modal is open\n     * @returns {boolean}\n     */\n    isOpen() {\n        return this.modal.isOpen();\n    }\n\n    /**\n     * Destroy the modal\n     */\n    destroy() {\n        if (this.modal) {\n            this.modal.destroy();\n        }\n        this.controls = [];\n    }\n}\n"],
  "mappings": "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",
  "names": ["DebugLogger", "logger", "init_debug_logger", "__esmMin", "saved", "show", "stack", "lines", "line", "match", "element", "enabled", "level", "wasSilent", "isSilent", "bufferSize", "consoleMethod", "logEntry", "callerPrefix", "consoleMsg", "count", "levels", "message", "data", "silenceable", "timestamp", "caller", "output", "log", "logDiv", "dataStr", "dataSpan", "stackBtn", "stackDiv", "self", "args", "arg", "tokenize", "expr", "tokens", "i", "lastToken", "char", "num", "token", "TOKEN_TYPES", "name", "BUILTIN_FUNCTIONS", "customFunctions", "CONSTANTS", "OPERATORS", "parse", "output", "operators", "peek", "consume", "o1", "o2", "op1", "op2", "op", "rpnToAST", "rpn", "stack", "NumberNode", "VariableNode", "operand", "UnaryOpNode", "right", "left", "BinaryOpNode", "argCount", "getFunctionArgCount", "args", "FunctionCallNode", "cloneAST", "node", "arg", "substituteVariables", "substitutions", "newArgs", "substituteAST", "functionDefs", "funcDef", "evalArgs", "param", "prettyPrintAST", "indent", "indentStr", "operandStr", "leftStr", "rightStr", "argsStr", "astToJS", "variables", "varSet", "v", "walk", "optimizeIntegerPower", "base", "exponent", "expMatch", "n", "astToGLSL", "useDirectMapping", "posVarName", "varMap", "swizzles", "velocityVars", "numStr", "glslFunc", "astToTeX", "needsParensForPower", "needsParensForMultiply", "leftParen", "rightParen", "funcName", "generateGLSLFunctionDeclarations", "availableVars", "declarations", "func", "bodyTokens", "bodyAST", "bodyGLSL", "p", "parseToExpression", "expression", "dimensions", "customVariables", "ast", "logger", "NativeExpression", "error", "parseExpression", "getGLSLFunctionDeclarations", "parseVectorField", "expressions", "createVelocityEvaluators", "funcBody", "parseExpressionToTeX", "setCustomFunctions", "functionsText", "key", "lines", "lineNum", "line", "match", "functionName", "paramsStr", "body", "params", "testTokens", "getCustomFunctions", "IExpression", "ASTNode", "init_parser", "__esmMin", "init_debug_logger", "options", "_NativeExpression", "astFunctionDefs", "substitutedAST", "type", "value", "isConstant", "operator", "setNotebook", "nb", "notebook", "logger", "computeSymbolicJacobian", "expressions", "dimensions", "expressionsForDiff", "expr", "replaced", "jacobian", "i", "row", "j", "variable", "VARIABLE_NAMES", "derivative", "error", "isValidJacobian", "entry", "invertJacobian", "n", "result", "init_jacobian", "__esmMin", "init_debug_logger", "detectAtan2Patterns", "expression", "patterns", "regex", "match", "generateAlternativeChart", "forwardTransforms", "atan2Info", "numerator", "denominator", "fullMatch", "swappedAtan2", "alternativeTransforms", "expr", "generateCharts", "dimensions", "charts", "allAtan2Patterns", "index", "pattern", "azimuthalAtan2", "generateGLSLCondition", "condition", "cartesianVars", "glslCondition", "varName", "swizzle", "init_coordinate_charts", "__esmMin", "coordinate_systems_exports", "__export", "CoordinateSystem", "PRESET_COORDINATE_SYSTEMS", "createCartesianSystem", "getCartesianSystem", "getCoordinateSystem", "getPresetsForDimension", "key", "dimensions", "presets", "system", "varNames", "v", "init_coordinate_systems", "__esmMin", "init_jacobian", "init_coordinate_charts", "_CoordinateSystem", "name", "variables", "forwardTransforms", "inverseTransforms", "useIterativeSolver", "charts", "generateCharts", "cartesianVars", "parseFunc", "nativeVars", "dimType", "transformCode", "expr", "i", "glsl", "jacobian", "computeSymbolicJacobian", "inverseJacobian", "invertJacobian", "swizzles", "matrixMultCode", "terms", "entry", "j", "row", "chartData", "chart", "index", "data", "chartCases", "glslCondition", "generateGLSLCondition", "keyword", "condPart", "chartDocs", "matType", "forwardTransformCode", "jacobianCode", "parsedEntry", "json", "float_packing_exports", "__export", "decodeFloatRGBA", "encodeFloatRGBA", "getDecodeGLSL", "getEncodeGLSL", "getFixedPointConstantsGLSL", "value", "out", "offset", "intValue", "r", "g", "b", "a", "init_float_packing", "__esmMin", "composeMixins", "Base", "mixins", "acc", "mixin", "ControlMixin", "ButtonActionMixin", "AttributeHelpersMixin", "init_control_mixin", "__esmMin", "defaultAttr", "value", "callback", "settings", "action", "actions", "buttons", "button", "name", "defaultValue", "parsed", "AnimatableSliderMixin", "init_animatable_mixin", "__esmMin", "Base", "animMinAttr", "animMaxAttr", "container", "animBtn", "e", "boundsHTML", "enabled", "boundsContainer", "min", "max", "alpha", "value", "indicator", "minHandle", "maxHandle", "minDisplay", "maxDisplay", "range", "minPercent", "maxPercent", "minValue", "maxValue", "percent", "track", "handle", "bound", "isDragging", "rect", "mouseX", "trackWidth", "newPercent", "settings", "animData", "AccordionAwareMixin", "init_accordion_aware_mixin", "__esmMin", "Base", "entries", "newHeight", "ShadowDOMMixin", "init_shadow_dom_mixin", "__esmMin", "Base", "htmlString", "shadow", "selector", "CompositeMixin", "init_composite_mixin", "__esmMin", "Base", "key", "getValue", "setValue", "reset", "value", "control", "init_mixins", "__esmMin", "init_control_mixin", "init_animatable_mixin", "init_accordion_aware_mixin", "init_shadow_dom_mixin", "init_composite_mixin", "ControlElement", "init_base", "__esmMin", "init_mixins", "composeMixins", "ControlMixin", "ButtonActionMixin", "AttributeHelpersMixin", "AccordionAwareMixin", "attr", "propName", "templateContent", "templateId", "externalTemplate", "inlineTemplate", "workingRoot", "walker", "attributeBindings", "node", "matches", "newValue", "match", "varName", "value", "html", "binding", "attrName", "elements", "element", "root", "bindAttr", "bindings", "className", "type", "role", "input", "name", "defaultValue", "privateName", "config", "callback", "debounce", "timeout", "fallback", "LinearSlider", "init_slider", "__esmMin", "init_base", "ControlElement", "formatAttr", "decimals", "v", "value", "displayValue", "updateValue", "e", "newValue", "action", "currentValue", "valueStep", "valueMin", "valueMax", "animatable_slider_exports", "__export", "AnimatableSlider", "createFadeTransform", "minLog", "scale", "sliderValue", "inverted", "fadeValue", "init_animatable_slider", "__esmMin", "init_slider", "init_mixins", "AnimatableSliderMixin", "LinearSlider", "value", "minSlider", "maxSlider", "percent", "newValue", "transform", "inverseTransform", "TextureManager", "gl", "dimensions", "resolution", "strategy", "i", "texture", "format", "enabled", "data", "ArrayType", "componentsPerValue", "dim0Data", "program", "uniformName", "location", "textureUnit", "dimension", "temp", "newResolution", "framebuffer", "init_debug_logger", "FramebufferManager", "gl", "width", "height", "config", "logger", "i", "texture", "minFilter", "magFilter", "index", "status", "errorMsg", "r", "g", "b", "a", "framebuffer", "init_debug_logger", "init_parser", "compileShader", "gl", "type", "source", "shader", "info", "addLineNumbers", "linkProgram", "vertexShader", "fragmentShader", "program", "createProgram", "vertexSource", "fragmentSource", "line", "i", "generateUpdateVertexShader", "generateUpdateFragmentShader", "dimensions", "velocityExpressions", "integratorCode", "strategy", "transformCode", "coordinateSystemCode", "positionUniforms", "_", "vecType", "readPositions", "swizzles", "velocityComponents", "expr", "hasCoordinateSystem", "coordinateSystemFunctions", "hasTransform", "transformFunctions", "velocityFunction", "v", "s", "customFunctions", "getGLSLFunctionDeclarations", "coord", "coords", "normalizeExpr", "generateDrawVertexShader", "mapperCode", "lineMode", "prevPositionUniforms", "generateDrawFragmentShader", "colorCode", "usesMaxVelocity", "generateScreenVertexShader", "generateScreenFadeFragmentShader", "generateTonemapFragmentShader", "tonemapCode", "generateBilateralFilterShader", "BilateralFilterManager", "gl", "width", "height", "config", "logger", "quadVertices", "status", "vertexShaderSource", "fragmentShaderSource", "createProgram", "inputTexture", "aPosLoc", "buffer", "init_debug_logger", "generateSMAAEdgeDetectionShader", "generateSMAABlendingWeightShader", "generateSMAANeighborhoodBlendingShader", "SMAAManager", "gl", "width", "height", "config", "logger", "quadVertices", "texture", "framebuffer", "status", "vertexShaderSource", "createProgram", "inputTexture", "targetFramebuffer", "quadBuffer", "program", "aPosLoc", "buffer", "init_debug_logger", "BufferStatsManager", "gl", "reductionVS", "reductionFS", "logger", "vsSource", "fsSource", "vs", "fs", "program", "sourceTexture", "width", "height", "coarse", "sampleRate", "fbo", "gridSize", "regionSize", "totalPixels", "allPixels", "pixelIndex", "gy", "gx", "x", "y", "regionPixels", "minR", "maxR", "sumR", "minG", "maxG", "sumG", "minB", "maxB", "sumB", "count", "i", "idx", "r", "g", "b", "avgR", "avgG", "avgB", "numBins", "histogram", "maxBright", "logMax", "brightness", "logBrightness", "binIndex", "tex", "init_debug_logger", "VelocityStatsManager", "gl", "dimensions", "velocityExpressions", "coordinateSystemCode", "logger", "vecType", "swizzles", "velocityComponents", "expr", "i", "hasCoordinateSystem", "velocityFunction", "vertexShader", "fragmentShader", "_", "vs", "fs", "positionTextures", "bbox", "resolution", "animationAlpha", "aPosLoc", "results", "velocities", "maxVel", "sumVel", "vel", "count", "avgVel", "percentile90", "percentile95", "a", "b", "idx90", "idx95", "init_debug_logger", "ParticleSystem", "particleCount", "dimensions", "bbox", "strategy", "debugSamples", "ArrayType", "componentsPerValue", "dim", "dimData", "i", "worldValue", "min", "range", "max", "encoded", "offset", "c", "buffer", "decodedWorld", "encodedStr", "logger", "s", "dimension", "newCount", "newDimensions", "newBBox", "init_parser", "init_jacobian", "init_parser", "init_debug_logger", "VARIABLE_NAMES", "generateMatrixInverseGLSL", "matType", "funcName", "code", "col", "row", "pivot", "generateJacobianGLSL", "jacobianMatrix", "dimensions", "vecType", "varDecls", "i", "matrixElements", "symbolicExpr", "glslExpr", "parseExpression", "error", "logger", "generateFixedPointSolverBody", "varName", "updateExprFn", "updateExpr", "generateMidpointSolverBody", "predName", "midName", "updateExprPred", "updateExprMid", "generateNewtonSolverBody", "residualExprFn", "jacobianExprFn", "inverseFuncName", "residualExpr", "jacobianExpr", "generateNewtonFDSolverBody", "velocityExprFn", "hScale", "residualRHS", "coords", "epsilon", "jacobianCode", "dfColumns", "colName", "perturbation", "velocityAtPerturbed", "velocityAtCurrent", "currentVel", "residual", "eulerIntegrator", "explicitMidpointIntegrator", "heunIntegrator", "rk4Integrator", "implicitEulerIntegrator", "iterations", "solutionMethod", "expressions", "initialGuess", "v", "solverBody", "solverName", "jacobianGLSL", "jacobian", "computeSymbolicJacobian", "isValidJacobian", "implicitMidpointIntegrator", "trapezoidalIntegrator", "implicitRK4Integrator", "coeffsGLSL", "initialGuessGLSL", "k1_updateFn", "k2_updateFn", "k1_velocityFn", "k2_velocityFn", "k1_solverBody", "k2_solverBody", "k1_residualFn", "k1_jacobianFn", "k2_residualFn", "k2_jacobianFn", "solverCode", "getIntegrator", "name", "params", "init_parser", "selectMapper", "dim1", "dim2", "totalDims", "depthDim", "hasDepth", "linearProjectionMapper", "matrix", "dimensions", "row1", "val", "i", "row2", "row3", "orthographicMapper", "axis", "sphericalMapper", "stereographicMapper", "getMapper", "type", "params", "horizontalExpr", "verticalExpr", "depthExpr", "customMapper", "horizontalGLSL", "parseExpression", "verticalGLSL", "depthGLSL", "Transform", "name", "description", "dimensions", "IdentityTransform", "vecType", "PowerTransform", "_", "i", "comp", "TanhTransform", "SigmoidTransform", "RationalTransform", "SineTransform", "RadialPowerTransform", "LogTransform", "ExpTransform", "SoftsignTransform", "CustomTransform", "forward", "inverse", "jacobian", "transforms", "getTransform", "getColorMode", "name", "dimensions", "vecType", "mode", "generateExpressionColorMode", "expressionGLSL", "gradientGLSL", "varDecls", "swizzles", "velocityVars", "i", "generateGradientColorMode", "modeName", "valueExpression", "generateGradientGLSL", "stops", "sortedStops", "a", "b", "stop", "code", "stop1", "stop2", "color1", "formatColor", "color2", "pos1", "pos2", "color", "getHSVGradient", "getDefaultGradient", "hexToRgb", "hex", "r", "g", "b", "rgbToHex", "rgb", "getToneMapper", "name", "operators", "generateTonemapGLSL", "operatorName", "params", "operator", "exposure", "gamma", "whitePoint", "luminanceGamma", "code", "init_coordinate_systems", "init_debug_logger", "CoordinateStrategy", "gl", "worldValue", "min", "max", "buffer", "storageValue", "init_float_packing", "RGBAStrategy", "CoordinateStrategy", "gl", "worldValue", "min", "max", "normalized", "buffer", "encodeFloatRGBA", "decodeFloatRGBA", "init_debug_logger", "FloatStrategy", "CoordinateStrategy", "gl", "logger", "worldValue", "min", "max", "buffer", "storageValue", "Renderer", "canvas", "config", "gl", "strategyType", "FloatStrategy", "logger", "RGBAStrategy", "error", "getCartesianSystem", "coordinateVars", "createVelocityEvaluators", "getDefaultGradient", "supersampleFactor", "width", "ParticleSystem", "TextureManager", "canvasWidth", "canvasHeight", "FramebufferManager", "hdrSupport", "SMAAManager", "BilateralFilterManager", "ldrFBStatus", "finalFBStatus", "BufferStatsManager", "VelocityStatsManager", "shaderError", "data", "buffer", "particleCount", "indices", "i", "vertexIds", "isCartesian", "velocityGLSL", "posVarName", "parseVectorField", "coordinateSystemCode", "cartesianVars", "nativeVars", "expr", "vars", "parseExpression", "integratorParams", "integrator", "getIntegrator", "mapper", "getMapper", "transformCode", "transform", "getTransform", "colorMode", "getColorMode", "colorCode", "usesMaxVelocity", "expressionGLSL", "gradientGLSL", "generateGradientGLSL", "generateExpressionColorMode", "generateGradientColorMode", "updateVertexShader", "generateUpdateVertexShader", "updateFragmentShader", "generateUpdateFragmentShader", "createProgram", "isLineMode", "drawVertexShader", "generateDrawVertexShader", "drawFragmentShader", "generateDrawFragmentShader", "screenVertexShader", "generateScreenVertexShader", "fadeFragmentShader", "generateScreenFadeFragmentShader", "tonemapCode", "generateTonemapGLSL", "tonemapFragmentShader", "generateTonemapFragmentShader", "program", "aPosLoc", "resolution", "randSeed", "velocityScale", "alphaLoc", "params", "paramValues", "dim", "writeTexture", "posTextures", "stats", "alpha", "relativeChange", "changeThresholdHigh", "changeThresholdLow", "t", "aIndexLoc", "indexBuffer", "aVertexIdLoc", "currentTex", "displayToCanvas", "filteredTexture", "currentInterval", "hdrTexture", "newStats", "velStats", "age", "dimensionData", "posStats", "componentsPerValue", "ArrayType", "positions", "pos", "texelIdx", "c", "min", "max", "worldValue", "sum", "dimName", "velocity", "position", "vel", "magnitudeSquared", "v", "magnitude", "samples", "particleIdx", "dim0Data", "ageValue", "r", "g", "b", "a", "loop", "now", "elapsed", "finalElapsed", "skipAutoRestart", "recompileShaders", "steps", "resolve", "reject", "pixels", "tempCanvas", "ctx", "imageData", "blob", "height", "needsRecompile", "validFactor", "e", "encodeFloatRGBA", "decodeFloatRGBA", "testValues", "maxError", "avgError", "errors", "problematic", "testVal", "decoded", "worldTests", "worldErrors", "worldVal", "normalized", "worldDecoded", "currentIndex", "pixelCount", "isHDR", "minR", "minG", "minB", "maxR", "maxG", "maxB", "sumR", "sumG", "sumB", "maxBrightness", "pixelsAboveOne", "idx", "brightness", "avgR", "avgG", "avgB", "velShader", "bufferShader", "screenX", "screenY", "fbX", "fbY", "glY", "result", "hdrFramebuffer", "init_coordinate_systems", "Control", "id", "defaultValue", "options", "value", "callback", "event", "element", "offset", "action", "settings", "TextControl", "Control", "id", "defaultValue", "options", "value", "callback", "element", "ControlManager", "options", "control", "controls", "debouncedCallback", "settings", "id", "coordSystemData", "coordinateSystem", "CoordinateSystem", "expressionsControl", "error", "saved", "createScientificFormatter", "precision", "threshold", "v", "absV", "createDecimalFormatter", "createIntegerFormatter", "inferScaleType", "min", "max", "step", "calculateAdaptiveIncrement", "currentValue", "baseStep", "isLarge", "absValue", "increment", "calculateLogIncrement", "calculateLinearIncrement", "createFormatterFromDef", "paramDef", "resizeAccordion", "selectorOrElement", "delay", "$element", "$accordionSection", "ParameterControl", "Control", "id", "parameterDef", "defaultValue", "options", "inferScaleType", "createFormatterFromDef", "currentValue", "isLarge", "calculateAdaptiveIncrement", "calculateLogIncrement", "calculateLinearIncrement", "action", "element", "min", "max", "newValue", "increment", "displayId", "callback", "value", "AnimatableParameterControl", "range", "enabled", "alpha", "indicator", "minHandle", "maxHandle", "minDisplay", "maxDisplay", "minPercent", "maxPercent", "boundsContainer", "animBtn", "resizeAccordion", "e", "boundsHTML", "controlGroup", "track", "handle", "bound", "isDragging", "startX", "startLeft", "trackOffset", "trackWidth", "newPercent", "actualValue", "settings", "animData", "init_debug_logger", "DimensionInputsControl", "Control", "defaultValue", "options", "dimensionsControl", "coordinateSystem", "updateUI", "dimensionsEl", "dimensions", "expressions", "value", "expr", "newValues", "logger", "container", "valuesToUse", "firstElement", "existingValues", "i", "error", "padded", "fallbackVarNames", "varName", "div", "resizeAccordion", "callback", "MapperParamsControl", "mapperControl", "mapper", "horizontalElement", "verticalElement", "depthElement", "dim1Element", "dim2Element", "dim1", "dim2", "params", "row", "group1", "select1", "currentDim1", "selected", "group2", "select2", "currentDim2", "info", "varNames", "currentHorizontal", "input1", "currentVertical", "input2", "group3", "currentDepth", "input3", "GradientControl", "gradientEditor", "gradient", "newGradient", "settings", "TransformParamsControl", "transformControl", "values", "controlId", "paramControl", "paramName", "transformType", "transform", "getTransform", "paramDefs", "paramDef", "index", "AnimatableParameterControl", "sliderId", "action", "control", "initGradientEditor", "containerId", "initialGradient", "onChange", "container", "gradient", "stop", "render", "sorted", "a", "b", "html", "index", "actualIndex", "hex", "rgbToHex", "renderPreview", "attachEventListeners", "preview", "stops", "hexToRgb", "pos", "newPos", "maxGap", "gapPos", "i", "gap", "newColor", "interpolateGradient", "t", "t1", "t2", "segmentT", "c1", "c2", "newGradient", "init_coordinate_systems", "init_debug_logger", "notebook", "setNotebook", "nb", "logger", "solveInverseSymbolically", "forwardTransforms", "dimensions", "cartesianVars", "nativeVars", "inverseTransforms", "isValidPolarTransform", "isValidCylindricalTransform", "isValidSphericalTransform", "i", "cartesianVar", "solved", "j", "nativeVar", "forwardExpr", "equation", "solutions", "solStr", "v", "idx", "e", "error", "transforms", "r", "theta", "hasRadialTerm", "hasAngleTerm", "rho", "phi", "z", "hasZTerm", "hasPolarAngleTerm", "hasAzimuthalTerm", "initCoordinateEditor", "containerId", "dimensions", "initialSystem", "onChange", "container", "currentSystem", "getCartesianSystem", "currentDimensions", "editor", "render", "update", "setDimensions", "presets", "getPresetsForDimension", "html", "currentPresetKey", "key", "system", "PRESET_COORDINATE_SYSTEMS", "i", "variable", "transform", "cartesianVar", "useIterative", "inverseTransform", "nativeVars", "v", "attachEventListeners", "presetKey", "preset", "index", "label", "button", "originalText", "cartesianVars", "inverseTransforms", "solveInverseSymbolically", "error", "validateSystem", "transformsWithAscii", "inverseTransformsWithAscii", "systemToApply", "CoordinateSystem", "newSystem", "newDimensions", "showCoordinateEditor", "onApply", "panel", "isDragging", "dragOffsetX", "dragOffsetY", "e", "init_coordinate_systems", "init_debug_logger", "init_debug_logger", "GLSLWorkflow", "generator", "index", "totalCount", "glslArray", "renderer", "expressions", "controls", "notebook", "modal", "errors", "ctrl", "i", "context", "validation", "glsl", "error", "logger", "errorMsg", "e", "errorHtml", "init_debug_logger", "IGLSLGenerator", "mathExpr", "notebook", "context", "init_parser", "init_debug_logger", "FieldEquationGenerator", "IGLSLGenerator", "options", "mathExpr", "context", "notebook", "validation", "dimension", "totalDims", "expanded", "logger", "error", "vars", "glslExpr", "parseExpression", "dims", "init_debug_logger", "FieldEquationWorkflow", "GLSLWorkflow", "generator", "FieldEquationGenerator", "index", "totalCount", "glslArray", "renderer", "expressions", "expandedExprs", "expr", "i", "error", "logger", "modal", "errors", "errorHtml", "e", "WebComponentControlRegistry", "manager", "tagName", "elementId", "promise", "resolve", "element", "debouncedCallback", "settings", "elements", "init_debug_logger", "init_debug_logger", "init_parser", "waitForMathJax", "logger", "resolve", "checkInterval", "renderTeX", "element", "latex", "renderedNode", "error", "renderTeXScaled", "maxWidth", "wrapper", "scaler", "spacer", "renderedRect", "renderedWidth", "targetWidth", "scale", "heightToUse", "toDerivativeNotation", "expr", "variable", "dimensions", "exprLatex", "parseExpressionToTeX", "createSystemLatex", "expressions", "variables", "i", "EquationOverlay", "overlayId", "logger", "visible", "expressions", "variables", "latex", "createSystemLatex", "renderTeX", "error", "mjxContainer", "maxWidth", "availableWidth", "svg", "contentWidth", "fitPanelToSVG", "finalSvg", "finalRect", "newWidth", "newHeight", "ratio", "fontSize", "scaleFactor", "equationOverlay", "init_debug_logger", "AnimationController", "renderer", "controlManager", "alpha", "updateControls", "stepsPerIncrement", "options", "captureOptions", "captureFrames", "totalFrames", "loops", "halfLoops", "onProgress", "onComplete", "rangesPerLoop", "logger", "stepTimeCounter", "listener", "index", "control", "transformParamsControl", "paramControl", "AnimatableParameterControl", "i", "changedSettings", "newValue", "paramKey", "error", "alphaStepElapsed", "delayNeeded", "elapsed", "blob", "ZIndex", "lowerMenuBar", "restoreMenuBar", "isMobile", "PanelManager", "panelSelector", "options", "ZIndex", "isMobile", "lowerMenuBar", "restoreMenuBar", "zIndex", "excludeSelectors", "e", "selector", "updateWhitePointVisibility", "operator", "showWhitePoint", "updateExpressionControls", "colorMode", "updateGradientButtonVisibility", "updateVelocityScalingVisibility", "init_coordinate_systems", "init_debug_logger", "decodeSettings", "base64", "normalized", "json", "encodeSettings", "settings", "loadSettingsFromURLOrStorage", "urlParams", "urlSettings", "newSearch", "newUrl", "saved", "e", "saveAllSettings", "manager", "renderer", "shareSettings", "encoded", "url", "storageParam", "shareUrl", "button", "originalText", "err", "tempInput", "success", "restoreCoordinateSystem", "savedSettings", "expressionsControl", "coordSystemData", "transform", "coordinateSystem", "CoordinateSystem", "cartesianSystem", "getCartesianSystem", "error", "convertUnicodeToAscii", "expr", "fixMapperParams", "params", "expandBBoxForAspectRatio", "bbox", "canvas", "canvasAspect", "bboxWidth", "bboxHeight", "bboxAspect", "centerX", "centerY", "newWidth", "newHeight", "applyInitialSettings", "callback", "restoreBBox", "expandedBBox", "logger", "init_coordinate_systems", "init_debug_logger", "CUSTOM_PRESETS_KEY", "loadPresets", "expandBBoxForAspectRatio", "bbox", "canvas", "canvasAspect", "bboxWidth", "bboxHeight", "bboxAspect", "centerX", "centerY", "newWidth", "newHeight", "loadPreset", "name", "manager", "preset", "loadCustomPresets", "logger", "coordinateSystem", "CoordinateSystem", "getCartesianSystem", "expressionsControl", "mapperParamsControl", "transformParamsControl", "settings", "expandedBBox", "expressions", "FieldEquationWorkflow", "error", "stored", "e", "saveCustomPreset", "presets", "deleteCustomPreset", "refreshCustomPresetsDropdown", "customPresets", "$group", "presetNames", "displayName", "initPresetControls", "presetName", "updateGradientButtonVisibility", "colorMode", "initGradientPanel", "manager", "gradientControl", "gradientEditor", "gradientPanelManager", "PanelManager", "ZIndex", "initGradientEditor", "newGradient", "showGradientPanel", "hideGradientPanel", "defaultGradient", "getDefaultGradient", "initRenderingPanel", "manager", "renderingPanelManager", "PanelManager", "ZIndex", "updateWhitePointVisibility", "showRenderingPanel", "hideRenderingPanel", "init_debug_logger", "initAnimationControls", "manager", "renderer", "webComponentRegistry", "animationController", "AnimationController", "animationAlphaElement", "animationSpeedElement", "logger", "frameLimitElement", "frameLimitEnabledCheckbox", "syncCheckboxElement", "syncStepsToFrameLimit", "steps", "e", "animClearParticles", "animClearScreen", "animSmoothTiming", "animLockShaders", "halfLoopsElement", "infoText", "createAnimBtn", "framesInput", "loopsInput", "halfLoopsCheckbox", "downloadBtn", "totalFrames", "loops", "isHalfLoops", "frameCount", "total", "alpha", "progress", "frames", "capturedFrames", "numParts", "timestamp", "part", "startIdx", "endIdx", "zip", "framesFolder", "i", "paddedIndex", "zipBlob", "url", "link", "partSuffix", "resolve", "error", "exportJsonBtn", "settings", "animationTemplate", "blob", "a", "init_debug_logger", "initMobilePanelManager", "renderingPanelManager", "panels", "currentPanel", "showPanel", "panelName", "hidePanel", "panel", "logger", "ZIndex", "hideAllPanels", "panelId", "setupMobileControlsSync", "manager", "mobilePanelManager", "mobileControls", "syncMobileControls", "timestepControl", "value", "enabled", "control", "limit", "webComponentRegistry", "frameLimitEnabledControl", "frameLimitControl", "initControls", "renderer", "callback", "previousDimensions", "manager", "ControlManager", "settings", "currentDimensions", "expressionsControl", "mapperParamsControl", "originalExpressions", "expressions", "FieldEquationWorkflow", "logger", "error", "showError", "equationOverlay", "variables", "expandedForLatex", "expr", "settingsToSave", "hideError", "webComponentRegistry", "WebComponentControlRegistry", "integratorElement", "value", "isImplicit", "resizeAccordion", "el", "module", "createFadeTransform", "transform", "inverseTransform", "transformElement", "transformParamsControl", "TransformParamsControl", "mapperElement", "MapperParamsControl", "dimensionsElement", "colorModeElement", "updateExpressionControls", "updateGradientButtonVisibility", "updateVelocityScalingVisibility", "colorExpressionControl", "TextControl", "gradientControl", "GradientControl", "getDefaultGradient", "DimensionInputsControl", "tonemapElement", "updateWhitePointVisibility", "frameLimitEnabledCheckbox", "showEquationsCheckbox", "cb", "showEquations", "themeElement", "shareSettings", "canvas", "width", "blob", "url", "link", "timestamp", "resolution", "currentStrategy", "newStrategy", "sliderId", "action", "control", "currentSystem", "getCartesianSystem", "showCoordinateEditor", "newSystem", "gradientPanelHandlers", "initGradientPanel", "renderingPanelHandlers", "initRenderingPanel", "animationController", "initAnimationControls", "initPresetControls", "loadPresets", "mobilePanelManager", "initMobilePanelManager", "setupMobileControlsSync", "e", "content", "arrow", "histogram", "cursor", "savedSettings", "loadSettingsFromURLOrStorage", "isMobile", "frameLimitElement", "applyInitialSettings", "params", "animClearParticles", "animClearScreen", "animSmoothTiming", "animLockShaders", "colorMode", "currentIntegrator", "syncUIFromRenderer", "currentDimValue", "saveAllSettingsWrapper", "saveAllSettings", "restoreBBox", "message", "init_debug_logger", "init_debug_logger", "EASING_FUNCTIONS", "t", "c4", "Animator", "renderer", "controlManager", "scriptData", "i", "kf", "duration", "totalFrames", "logger", "time", "timeline", "prev", "next", "start", "end", "easingName", "easedT", "v", "endValue", "result", "key", "prevSettings", "nextSettings", "easing", "interpolated", "resolve", "frameNum", "frameConfig", "settings", "alpha", "progressCallback", "settingsWithoutCoordSystem", "CoordinateSystem", "coordSystem", "blob", "error", "JSZip", "zip", "filename", "metadata", "zipBlob", "url", "a", "init_parser", "Tab", "id", "title", "container", "TabManager", "tab", "tabId", "button", "tabBarElement", "contentElement", "isActive", "Modal", "TabManager", "tabBar", "content", "closeButton", "e", "tab", "tabId", "section", "tabs", "t", "callback", "globalModal", "getModal", "initializeModal", "modal", "NotebookDebugTab", "Tab", "container", "content", "notebook", "cells", "output", "cell", "index", "error", "DebugTab", "Tab", "logger", "container", "content", "initialVerbosity", "showLineNumbers", "lineNumbersCheckbox", "verbosity", "logs", "logText", "log", "dataStr", "err", "e", "enabled", "stats", "DocsTab", "Tab", "file", "response", "markdown", "error", "container", "content", "docsContainer", "sectionPromises", "def", "html", "sectionsHTML", "section", "id", "title", "header", "toggle", "sectionId", "init_base", "init_slider", "init_base", "LogSlider", "ControlElement", "formatAttr", "decimals", "v", "value", "sliderValue", "normalized", "curvedSliderValue", "minLog", "scale", "actualValue", "curved", "updateValue", "e", "newValue", "action", "currentSliderValue", "newSliderValue", "increment", "init_slider", "PercentSlider", "LinearSlider", "init_animatable_slider", "init_animatable_slider", "AnimatableTimestep", "AnimatableSlider", "smallInc", "largeInc", "action", "currentValue", "minValue", "maxValue", "increment", "newValue", "AnimationAlpha", "PercentSlider", "controller", "alpha", "sliderControl", "e", "init_slider", "AnimationSpeed", "LinearSlider", "controller", "settings", "init_base", "NumberInput", "ControlElement", "rawValue", "value", "numValue", "settings", "ActionButton", "text", "label", "icon", "enabled", "loading", "loadingLabel", "originalLabel", "background", "init_base", "Checkbox", "ControlElement", "label", "input", "span", "value", "settings", "init_base", "SelectControl", "ControlElement", "selected", "firstOption", "options", "select", "opt", "value", "settings", "init_base", "init_mixins", "MobileControls", "composeMixins", "ControlElement", "CompositeMixin", "ShadowDOMMixin", "v", "timestepSlider", "timestepValue", "decreaseBtn", "increaseBtn", "rawSliderValue", "minTimestep", "maxTimestep", "frameLimitCheckbox", "frameLimitSlider", "frameLimitValue", "sliderValue", "frame", "normalized", "logValue", "curved", "fps", "display", "timestep", "slider", "value", "enabled", "checkbox", "limit", "init_slider", "init_animatable_slider", "registerControlElements", "LinearSlider", "LogSlider", "PercentSlider", "AnimatableSlider", "AnimatableTimestep", "AnimationAlpha", "AnimationSpeed", "NumberInput", "ActionButton", "Checkbox", "SelectControl", "init_debug_logger", "init_debug_logger", "init_debug_logger", "init_debug_logger", "NotebookCell", "cellData", "callbacks", "inputRow", "e", "evalButton", "spacer", "upButton", "downButton", "deleteButton", "addButton", "icon", "title", "onClick", "button", "result", "cellWidth", "logger", "renderTeXScaled", "error", "value", "NotebookREPL", "options", "comp", "cells", "cellData", "cell", "NotebookCell", "id", "value", "cellId", "logger", "c", "afterCellId", "afterIndex", "newCellId", "newIndex", "targetPosition", "i", "newCellComponent", "isLastCell", "result", "cellComponent", "error", "input", "e", "file", "emptyCells", "NotebookModal", "config", "e", "titleBar", "title", "titleButtons", "exportButton", "importButton", "closeButton", "contentArea", "notebookSection", "NotebookREPL", "footer", "cancelButton", "applyButton", "customFields", "result", "logger", "error", "fields", "input", "errorHtml", "NotebookEditor", "NotebookModal", "logger", "info", "notebookEditor", "CASEngine", "expr", "expression", "variable", "equation", "matrixElements", "matrix", "i", "j", "name", "value", "result", "init_debug_logger", "optimizePowerExpressions", "expr", "match", "base", "exp", "n", "NerdamerEngine", "CASEngine", "logger", "expression", "resultStr", "tex", "error", "variable", "parsed", "derivativeStr", "equation", "solutions", "matrixElements", "matrixArgs", "row", "result", "i", "j", "element", "optimized", "matrix", "name", "value", "glsl", "init_debug_logger", "CASEngineType", "createCASEngine", "type", "logger", "engine", "NerdamerEngine", "error", "getSelectedEngineType", "stored", "init_debug_logger", "LOCALSTORAGE_KEY", "generateCellId", "Notebook", "casEngine", "logger", "type", "input", "id", "cell", "c", "index", "result", "error", "targetIndex", "wasDirty", "expr", "definedFunctions", "match", "funcName", "needsExpansion", "usedFunctions", "variable", "equation", "matrix", "functionDefMatch", "argsStr", "body", "args", "arg", "signature", "data", "stored", "filename", "blob", "url", "a", "file", "resolve", "reject", "reader", "e", "init_jacobian", "init_debug_logger", "MathToGLSLControl", "config", "mathContainer", "mathLabel", "buttonContainer", "glslContainer", "glslLabel", "mathExpr", "validation", "glslCode", "logger", "error", "message", "math", "glsl", "init_debug_logger", "FieldEquationsEditor", "renderer", "FieldEquationGenerator", "FieldEquationWorkflow", "customContent", "dimensionRow", "dimensionLabel", "i", "option", "NotebookModal", "notebook", "customFields", "result", "dimensionsElement", "expressionsControl", "variables", "dimensions", "expressions", "currentExpressions", "varNames", "varName", "initialMath", "control", "MathToGLSLControl", "logger", "currentDims", "setCustomFunctions", "getCustomFunctions", "event", "section", "registerControlElements", "logger", "engineType", "getSelectedEngineType", "casEngine", "createCASEngine", "notebook", "Notebook", "setNotebook", "error", "initRenderer", "callback", "canvas", "renderer", "resizeCanvas", "aspectRatio", "bbox", "centerX", "centerY", "newWidth", "storageStrategy", "Renderer", "initUI", "manager", "initControls", "controlsData", "state", "saveSettings", "settings", "setupAnimationPanel", "loadPreset", "modal", "initializeModal", "debugTab", "DebugTab", "notebookDebugTab", "NotebookDebugTab", "docsTab", "DocsTab", "notebookEditor", "FieldEquationsEditor", "setupPanZoom", "isDragging", "lastX", "lastY", "saveTimeout", "debouncedSave", "e", "dx", "dy", "width", "height", "scale", "zoomFactor", "rect", "mouseX", "mouseY", "newHeight", "ratioX", "ratioY", "lastTouchDistance", "distance", "zoomToCenter", "panView", "panX", "panY", "currentBBox", "currentWidth", "currentHeight", "setupGridAndCursor", "gridCanvas", "gridCtx", "cursorDiv", "showGridCheckbox", "showGrid", "cursorX", "cursorY", "resizeGridCanvas", "drawGrid", "screenToWorld", "screenX", "screenY", "worldX", "worldY", "worldToScreen", "getGridSpacing", "rawSpacing", "magnitude", "normalized", "spacing", "startX", "endX", "x", "screen", "label", "startY", "endY", "y", "origin", "updateCursorDisplay", "world", "canvasX", "canvasY", "pixelData", "displayText", "r", "g", "b", "fpsDisplay", "mobileControls", "formatFrameCount", "count", "k", "updateFPS", "framesText", "fpsText", "histogramPanel", "histogramCanvas", "histogramCtx", "drawHistogram", "stats", "ctx", "dpr", "maxCount", "barWidth", "i", "barHeight", "setupKeyboardShortcuts", "openFloatingPanels", "animator", "file", "reader", "scriptData", "Animator", "script", "duration", "totalFrames", "frameNum", "time", "percent", "initAccordion", "ACCORDION_STATE_KEY", "savedState", "saved", "index", "$header", "$section", "sectionId", "$h2", "$content", "isCurrentlyCollapsed", "updateMaxHeight"]
}
